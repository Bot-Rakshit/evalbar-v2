"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
exports.id = "vendor-chunks/chessops";
exports.ids = ["vendor-chunks/chessops"];
exports.modules = {

/***/ "(ssr)/./node_modules/chessops/dist/esm/attacks.js":
/*!***************************************************!*\
  !*** ./node_modules/chessops/dist/esm/attacks.js ***!
  \***************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   attacks: () => (/* binding */ attacks),\n/* harmony export */   between: () => (/* binding */ between),\n/* harmony export */   bishopAttacks: () => (/* binding */ bishopAttacks),\n/* harmony export */   kingAttacks: () => (/* binding */ kingAttacks),\n/* harmony export */   knightAttacks: () => (/* binding */ knightAttacks),\n/* harmony export */   pawnAttacks: () => (/* binding */ pawnAttacks),\n/* harmony export */   queenAttacks: () => (/* binding */ queenAttacks),\n/* harmony export */   ray: () => (/* binding */ ray),\n/* harmony export */   rookAttacks: () => (/* binding */ rookAttacks)\n/* harmony export */ });\n/* harmony import */ var _squareSet_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./squareSet.js */ \"(ssr)/./node_modules/chessops/dist/esm/squareSet.js\");\n/* harmony import */ var _util_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./util.js */ \"(ssr)/./node_modules/chessops/dist/esm/util.js\");\n/**\n * Compute attacks and rays.\n *\n * These are low-level functions that can be used to implement chess rules.\n *\n * Implementation notes: Sliding attacks are computed using\n * [Hyperbola Quintessence](https://www.chessprogramming.org/Hyperbola_Quintessence).\n * Magic Bitboards would deliver slightly faster lookups, but also require\n * initializing considerably larger attack tables. On the web, initialization\n * time is important, so the chosen method may strike a better balance.\n *\n * @packageDocumentation\n */\n\n\nconst computeRange = (square, deltas) => {\n    let range = _squareSet_js__WEBPACK_IMPORTED_MODULE_0__.SquareSet.empty();\n    for (const delta of deltas) {\n        const sq = square + delta;\n        if (0 <= sq && sq < 64 && Math.abs((0,_util_js__WEBPACK_IMPORTED_MODULE_1__.squareFile)(square) - (0,_util_js__WEBPACK_IMPORTED_MODULE_1__.squareFile)(sq)) <= 2) {\n            range = range.with(sq);\n        }\n    }\n    return range;\n};\nconst tabulate = (f) => {\n    const table = [];\n    for (let square = 0; square < 64; square++)\n        table[square] = f(square);\n    return table;\n};\nconst KING_ATTACKS = tabulate(sq => computeRange(sq, [-9, -8, -7, -1, 1, 7, 8, 9]));\nconst KNIGHT_ATTACKS = tabulate(sq => computeRange(sq, [-17, -15, -10, -6, 6, 10, 15, 17]));\nconst PAWN_ATTACKS = {\n    white: tabulate(sq => computeRange(sq, [7, 9])),\n    black: tabulate(sq => computeRange(sq, [-7, -9])),\n};\n/**\n * Gets squares attacked or defended by a king on `square`.\n */\nconst kingAttacks = (square) => KING_ATTACKS[square];\n/**\n * Gets squares attacked or defended by a knight on `square`.\n */\nconst knightAttacks = (square) => KNIGHT_ATTACKS[square];\n/**\n * Gets squares attacked or defended by a pawn of the given `color`\n * on `square`.\n */\nconst pawnAttacks = (color, square) => PAWN_ATTACKS[color][square];\nconst FILE_RANGE = tabulate(sq => _squareSet_js__WEBPACK_IMPORTED_MODULE_0__.SquareSet.fromFile((0,_util_js__WEBPACK_IMPORTED_MODULE_1__.squareFile)(sq)).without(sq));\nconst RANK_RANGE = tabulate(sq => _squareSet_js__WEBPACK_IMPORTED_MODULE_0__.SquareSet.fromRank((0,_util_js__WEBPACK_IMPORTED_MODULE_1__.squareRank)(sq)).without(sq));\nconst DIAG_RANGE = tabulate(sq => {\n    const diag = new _squareSet_js__WEBPACK_IMPORTED_MODULE_0__.SquareSet(134480385, 2151686160);\n    const shift = 8 * ((0,_util_js__WEBPACK_IMPORTED_MODULE_1__.squareRank)(sq) - (0,_util_js__WEBPACK_IMPORTED_MODULE_1__.squareFile)(sq));\n    return (shift >= 0 ? diag.shl64(shift) : diag.shr64(-shift)).without(sq);\n});\nconst ANTI_DIAG_RANGE = tabulate(sq => {\n    const diag = new _squareSet_js__WEBPACK_IMPORTED_MODULE_0__.SquareSet(270549120, 16909320);\n    const shift = 8 * ((0,_util_js__WEBPACK_IMPORTED_MODULE_1__.squareRank)(sq) + (0,_util_js__WEBPACK_IMPORTED_MODULE_1__.squareFile)(sq) - 7);\n    return (shift >= 0 ? diag.shl64(shift) : diag.shr64(-shift)).without(sq);\n});\nconst hyperbola = (bit, range, occupied) => {\n    let forward = occupied.intersect(range);\n    let reverse = forward.bswap64(); // Assumes no more than 1 bit per rank\n    forward = forward.minus64(bit);\n    reverse = reverse.minus64(bit.bswap64());\n    return forward.xor(reverse.bswap64()).intersect(range);\n};\nconst fileAttacks = (square, occupied) => hyperbola(_squareSet_js__WEBPACK_IMPORTED_MODULE_0__.SquareSet.fromSquare(square), FILE_RANGE[square], occupied);\nconst rankAttacks = (square, occupied) => {\n    const range = RANK_RANGE[square];\n    let forward = occupied.intersect(range);\n    let reverse = forward.rbit64();\n    forward = forward.minus64(_squareSet_js__WEBPACK_IMPORTED_MODULE_0__.SquareSet.fromSquare(square));\n    reverse = reverse.minus64(_squareSet_js__WEBPACK_IMPORTED_MODULE_0__.SquareSet.fromSquare(63 - square));\n    return forward.xor(reverse.rbit64()).intersect(range);\n};\n/**\n * Gets squares attacked or defended by a bishop on `square`, given `occupied`\n * squares.\n */\nconst bishopAttacks = (square, occupied) => {\n    const bit = _squareSet_js__WEBPACK_IMPORTED_MODULE_0__.SquareSet.fromSquare(square);\n    return hyperbola(bit, DIAG_RANGE[square], occupied).xor(hyperbola(bit, ANTI_DIAG_RANGE[square], occupied));\n};\n/**\n * Gets squares attacked or defended by a rook on `square`, given `occupied`\n * squares.\n */\nconst rookAttacks = (square, occupied) => fileAttacks(square, occupied).xor(rankAttacks(square, occupied));\n/**\n * Gets squares attacked or defended by a queen on `square`, given `occupied`\n * squares.\n */\nconst queenAttacks = (square, occupied) => bishopAttacks(square, occupied).xor(rookAttacks(square, occupied));\n/**\n * Gets squares attacked or defended by a `piece` on `square`, given\n * `occupied` squares.\n */\nconst attacks = (piece, square, occupied) => {\n    switch (piece.role) {\n        case 'pawn':\n            return pawnAttacks(piece.color, square);\n        case 'knight':\n            return knightAttacks(square);\n        case 'bishop':\n            return bishopAttacks(square, occupied);\n        case 'rook':\n            return rookAttacks(square, occupied);\n        case 'queen':\n            return queenAttacks(square, occupied);\n        case 'king':\n            return kingAttacks(square);\n    }\n};\n/**\n * Gets all squares of the rank, file or diagonal with the two squares\n * `a` and `b`, or an empty set if they are not aligned.\n */\nconst ray = (a, b) => {\n    const other = _squareSet_js__WEBPACK_IMPORTED_MODULE_0__.SquareSet.fromSquare(b);\n    if (RANK_RANGE[a].intersects(other))\n        return RANK_RANGE[a].with(a);\n    if (ANTI_DIAG_RANGE[a].intersects(other))\n        return ANTI_DIAG_RANGE[a].with(a);\n    if (DIAG_RANGE[a].intersects(other))\n        return DIAG_RANGE[a].with(a);\n    if (FILE_RANGE[a].intersects(other))\n        return FILE_RANGE[a].with(a);\n    return _squareSet_js__WEBPACK_IMPORTED_MODULE_0__.SquareSet.empty();\n};\n/**\n * Gets all squares between `a` and `b` (bounds not included), or an empty set\n * if they are not on the same rank, file or diagonal.\n */\nconst between = (a, b) => ray(a, b)\n    .intersect(_squareSet_js__WEBPACK_IMPORTED_MODULE_0__.SquareSet.full().shl64(a).xor(_squareSet_js__WEBPACK_IMPORTED_MODULE_0__.SquareSet.full().shl64(b)))\n    .withoutFirst();\n//# sourceMappingURL=attacks.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvY2hlc3NvcHMvZGlzdC9lc20vYXR0YWNrcy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQzJDO0FBQ1E7QUFDbkQ7QUFDQSxnQkFBZ0Isb0RBQVM7QUFDekI7QUFDQTtBQUNBLDJDQUEyQyxvREFBVSxXQUFXLG9EQUFVO0FBQzFFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCLGFBQWE7QUFDdEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUCxrQ0FBa0Msb0RBQVMsVUFBVSxvREFBVTtBQUMvRCxrQ0FBa0Msb0RBQVMsVUFBVSxvREFBVTtBQUMvRDtBQUNBLHFCQUFxQixvREFBUztBQUM5Qix1QkFBdUIsb0RBQVUsT0FBTyxvREFBVTtBQUNsRDtBQUNBLENBQUM7QUFDRDtBQUNBLHFCQUFxQixvREFBUztBQUM5Qix1QkFBdUIsb0RBQVUsT0FBTyxvREFBVTtBQUNsRDtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0EscUNBQXFDO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0RBQW9ELG9EQUFTO0FBQzdEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEJBQThCLG9EQUFTO0FBQ3ZDLDhCQUE4QixvREFBUztBQUN2QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDTztBQUNQLGdCQUFnQixvREFBUztBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDTztBQUNQLGtCQUFrQixvREFBUztBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVyxvREFBUztBQUNwQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUCxlQUFlLG9EQUFTLHFCQUFxQixvREFBUztBQUN0RDtBQUNBIiwic291cmNlcyI6WyIvVXNlcnMvcmFrc2hpdC93b3Jrc3BhY2UvYXJjaGl2ZXMvcmVwb3MvY2hlc3MvZXZhbC1iYXIvbm9kZV9tb2R1bGVzL2NoZXNzb3BzL2Rpc3QvZXNtL2F0dGFja3MuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb21wdXRlIGF0dGFja3MgYW5kIHJheXMuXG4gKlxuICogVGhlc2UgYXJlIGxvdy1sZXZlbCBmdW5jdGlvbnMgdGhhdCBjYW4gYmUgdXNlZCB0byBpbXBsZW1lbnQgY2hlc3MgcnVsZXMuXG4gKlxuICogSW1wbGVtZW50YXRpb24gbm90ZXM6IFNsaWRpbmcgYXR0YWNrcyBhcmUgY29tcHV0ZWQgdXNpbmdcbiAqIFtIeXBlcmJvbGEgUXVpbnRlc3NlbmNlXShodHRwczovL3d3dy5jaGVzc3Byb2dyYW1taW5nLm9yZy9IeXBlcmJvbGFfUXVpbnRlc3NlbmNlKS5cbiAqIE1hZ2ljIEJpdGJvYXJkcyB3b3VsZCBkZWxpdmVyIHNsaWdodGx5IGZhc3RlciBsb29rdXBzLCBidXQgYWxzbyByZXF1aXJlXG4gKiBpbml0aWFsaXppbmcgY29uc2lkZXJhYmx5IGxhcmdlciBhdHRhY2sgdGFibGVzLiBPbiB0aGUgd2ViLCBpbml0aWFsaXphdGlvblxuICogdGltZSBpcyBpbXBvcnRhbnQsIHNvIHRoZSBjaG9zZW4gbWV0aG9kIG1heSBzdHJpa2UgYSBiZXR0ZXIgYmFsYW5jZS5cbiAqXG4gKiBAcGFja2FnZURvY3VtZW50YXRpb25cbiAqL1xuaW1wb3J0IHsgU3F1YXJlU2V0IH0gZnJvbSAnLi9zcXVhcmVTZXQuanMnO1xuaW1wb3J0IHsgc3F1YXJlRmlsZSwgc3F1YXJlUmFuayB9IGZyb20gJy4vdXRpbC5qcyc7XG5jb25zdCBjb21wdXRlUmFuZ2UgPSAoc3F1YXJlLCBkZWx0YXMpID0+IHtcbiAgICBsZXQgcmFuZ2UgPSBTcXVhcmVTZXQuZW1wdHkoKTtcbiAgICBmb3IgKGNvbnN0IGRlbHRhIG9mIGRlbHRhcykge1xuICAgICAgICBjb25zdCBzcSA9IHNxdWFyZSArIGRlbHRhO1xuICAgICAgICBpZiAoMCA8PSBzcSAmJiBzcSA8IDY0ICYmIE1hdGguYWJzKHNxdWFyZUZpbGUoc3F1YXJlKSAtIHNxdWFyZUZpbGUoc3EpKSA8PSAyKSB7XG4gICAgICAgICAgICByYW5nZSA9IHJhbmdlLndpdGgoc3EpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiByYW5nZTtcbn07XG5jb25zdCB0YWJ1bGF0ZSA9IChmKSA9PiB7XG4gICAgY29uc3QgdGFibGUgPSBbXTtcbiAgICBmb3IgKGxldCBzcXVhcmUgPSAwOyBzcXVhcmUgPCA2NDsgc3F1YXJlKyspXG4gICAgICAgIHRhYmxlW3NxdWFyZV0gPSBmKHNxdWFyZSk7XG4gICAgcmV0dXJuIHRhYmxlO1xufTtcbmNvbnN0IEtJTkdfQVRUQUNLUyA9IHRhYnVsYXRlKHNxID0+IGNvbXB1dGVSYW5nZShzcSwgWy05LCAtOCwgLTcsIC0xLCAxLCA3LCA4LCA5XSkpO1xuY29uc3QgS05JR0hUX0FUVEFDS1MgPSB0YWJ1bGF0ZShzcSA9PiBjb21wdXRlUmFuZ2Uoc3EsIFstMTcsIC0xNSwgLTEwLCAtNiwgNiwgMTAsIDE1LCAxN10pKTtcbmNvbnN0IFBBV05fQVRUQUNLUyA9IHtcbiAgICB3aGl0ZTogdGFidWxhdGUoc3EgPT4gY29tcHV0ZVJhbmdlKHNxLCBbNywgOV0pKSxcbiAgICBibGFjazogdGFidWxhdGUoc3EgPT4gY29tcHV0ZVJhbmdlKHNxLCBbLTcsIC05XSkpLFxufTtcbi8qKlxuICogR2V0cyBzcXVhcmVzIGF0dGFja2VkIG9yIGRlZmVuZGVkIGJ5IGEga2luZyBvbiBgc3F1YXJlYC5cbiAqL1xuZXhwb3J0IGNvbnN0IGtpbmdBdHRhY2tzID0gKHNxdWFyZSkgPT4gS0lOR19BVFRBQ0tTW3NxdWFyZV07XG4vKipcbiAqIEdldHMgc3F1YXJlcyBhdHRhY2tlZCBvciBkZWZlbmRlZCBieSBhIGtuaWdodCBvbiBgc3F1YXJlYC5cbiAqL1xuZXhwb3J0IGNvbnN0IGtuaWdodEF0dGFja3MgPSAoc3F1YXJlKSA9PiBLTklHSFRfQVRUQUNLU1tzcXVhcmVdO1xuLyoqXG4gKiBHZXRzIHNxdWFyZXMgYXR0YWNrZWQgb3IgZGVmZW5kZWQgYnkgYSBwYXduIG9mIHRoZSBnaXZlbiBgY29sb3JgXG4gKiBvbiBgc3F1YXJlYC5cbiAqL1xuZXhwb3J0IGNvbnN0IHBhd25BdHRhY2tzID0gKGNvbG9yLCBzcXVhcmUpID0+IFBBV05fQVRUQUNLU1tjb2xvcl1bc3F1YXJlXTtcbmNvbnN0IEZJTEVfUkFOR0UgPSB0YWJ1bGF0ZShzcSA9PiBTcXVhcmVTZXQuZnJvbUZpbGUoc3F1YXJlRmlsZShzcSkpLndpdGhvdXQoc3EpKTtcbmNvbnN0IFJBTktfUkFOR0UgPSB0YWJ1bGF0ZShzcSA9PiBTcXVhcmVTZXQuZnJvbVJhbmsoc3F1YXJlUmFuayhzcSkpLndpdGhvdXQoc3EpKTtcbmNvbnN0IERJQUdfUkFOR0UgPSB0YWJ1bGF0ZShzcSA9PiB7XG4gICAgY29uc3QgZGlhZyA9IG5ldyBTcXVhcmVTZXQoMTM0NDgwMzg1LCAyMTUxNjg2MTYwKTtcbiAgICBjb25zdCBzaGlmdCA9IDggKiAoc3F1YXJlUmFuayhzcSkgLSBzcXVhcmVGaWxlKHNxKSk7XG4gICAgcmV0dXJuIChzaGlmdCA+PSAwID8gZGlhZy5zaGw2NChzaGlmdCkgOiBkaWFnLnNocjY0KC1zaGlmdCkpLndpdGhvdXQoc3EpO1xufSk7XG5jb25zdCBBTlRJX0RJQUdfUkFOR0UgPSB0YWJ1bGF0ZShzcSA9PiB7XG4gICAgY29uc3QgZGlhZyA9IG5ldyBTcXVhcmVTZXQoMjcwNTQ5MTIwLCAxNjkwOTMyMCk7XG4gICAgY29uc3Qgc2hpZnQgPSA4ICogKHNxdWFyZVJhbmsoc3EpICsgc3F1YXJlRmlsZShzcSkgLSA3KTtcbiAgICByZXR1cm4gKHNoaWZ0ID49IDAgPyBkaWFnLnNobDY0KHNoaWZ0KSA6IGRpYWcuc2hyNjQoLXNoaWZ0KSkud2l0aG91dChzcSk7XG59KTtcbmNvbnN0IGh5cGVyYm9sYSA9IChiaXQsIHJhbmdlLCBvY2N1cGllZCkgPT4ge1xuICAgIGxldCBmb3J3YXJkID0gb2NjdXBpZWQuaW50ZXJzZWN0KHJhbmdlKTtcbiAgICBsZXQgcmV2ZXJzZSA9IGZvcndhcmQuYnN3YXA2NCgpOyAvLyBBc3N1bWVzIG5vIG1vcmUgdGhhbiAxIGJpdCBwZXIgcmFua1xuICAgIGZvcndhcmQgPSBmb3J3YXJkLm1pbnVzNjQoYml0KTtcbiAgICByZXZlcnNlID0gcmV2ZXJzZS5taW51czY0KGJpdC5ic3dhcDY0KCkpO1xuICAgIHJldHVybiBmb3J3YXJkLnhvcihyZXZlcnNlLmJzd2FwNjQoKSkuaW50ZXJzZWN0KHJhbmdlKTtcbn07XG5jb25zdCBmaWxlQXR0YWNrcyA9IChzcXVhcmUsIG9jY3VwaWVkKSA9PiBoeXBlcmJvbGEoU3F1YXJlU2V0LmZyb21TcXVhcmUoc3F1YXJlKSwgRklMRV9SQU5HRVtzcXVhcmVdLCBvY2N1cGllZCk7XG5jb25zdCByYW5rQXR0YWNrcyA9IChzcXVhcmUsIG9jY3VwaWVkKSA9PiB7XG4gICAgY29uc3QgcmFuZ2UgPSBSQU5LX1JBTkdFW3NxdWFyZV07XG4gICAgbGV0IGZvcndhcmQgPSBvY2N1cGllZC5pbnRlcnNlY3QocmFuZ2UpO1xuICAgIGxldCByZXZlcnNlID0gZm9yd2FyZC5yYml0NjQoKTtcbiAgICBmb3J3YXJkID0gZm9yd2FyZC5taW51czY0KFNxdWFyZVNldC5mcm9tU3F1YXJlKHNxdWFyZSkpO1xuICAgIHJldmVyc2UgPSByZXZlcnNlLm1pbnVzNjQoU3F1YXJlU2V0LmZyb21TcXVhcmUoNjMgLSBzcXVhcmUpKTtcbiAgICByZXR1cm4gZm9yd2FyZC54b3IocmV2ZXJzZS5yYml0NjQoKSkuaW50ZXJzZWN0KHJhbmdlKTtcbn07XG4vKipcbiAqIEdldHMgc3F1YXJlcyBhdHRhY2tlZCBvciBkZWZlbmRlZCBieSBhIGJpc2hvcCBvbiBgc3F1YXJlYCwgZ2l2ZW4gYG9jY3VwaWVkYFxuICogc3F1YXJlcy5cbiAqL1xuZXhwb3J0IGNvbnN0IGJpc2hvcEF0dGFja3MgPSAoc3F1YXJlLCBvY2N1cGllZCkgPT4ge1xuICAgIGNvbnN0IGJpdCA9IFNxdWFyZVNldC5mcm9tU3F1YXJlKHNxdWFyZSk7XG4gICAgcmV0dXJuIGh5cGVyYm9sYShiaXQsIERJQUdfUkFOR0Vbc3F1YXJlXSwgb2NjdXBpZWQpLnhvcihoeXBlcmJvbGEoYml0LCBBTlRJX0RJQUdfUkFOR0Vbc3F1YXJlXSwgb2NjdXBpZWQpKTtcbn07XG4vKipcbiAqIEdldHMgc3F1YXJlcyBhdHRhY2tlZCBvciBkZWZlbmRlZCBieSBhIHJvb2sgb24gYHNxdWFyZWAsIGdpdmVuIGBvY2N1cGllZGBcbiAqIHNxdWFyZXMuXG4gKi9cbmV4cG9ydCBjb25zdCByb29rQXR0YWNrcyA9IChzcXVhcmUsIG9jY3VwaWVkKSA9PiBmaWxlQXR0YWNrcyhzcXVhcmUsIG9jY3VwaWVkKS54b3IocmFua0F0dGFja3Moc3F1YXJlLCBvY2N1cGllZCkpO1xuLyoqXG4gKiBHZXRzIHNxdWFyZXMgYXR0YWNrZWQgb3IgZGVmZW5kZWQgYnkgYSBxdWVlbiBvbiBgc3F1YXJlYCwgZ2l2ZW4gYG9jY3VwaWVkYFxuICogc3F1YXJlcy5cbiAqL1xuZXhwb3J0IGNvbnN0IHF1ZWVuQXR0YWNrcyA9IChzcXVhcmUsIG9jY3VwaWVkKSA9PiBiaXNob3BBdHRhY2tzKHNxdWFyZSwgb2NjdXBpZWQpLnhvcihyb29rQXR0YWNrcyhzcXVhcmUsIG9jY3VwaWVkKSk7XG4vKipcbiAqIEdldHMgc3F1YXJlcyBhdHRhY2tlZCBvciBkZWZlbmRlZCBieSBhIGBwaWVjZWAgb24gYHNxdWFyZWAsIGdpdmVuXG4gKiBgb2NjdXBpZWRgIHNxdWFyZXMuXG4gKi9cbmV4cG9ydCBjb25zdCBhdHRhY2tzID0gKHBpZWNlLCBzcXVhcmUsIG9jY3VwaWVkKSA9PiB7XG4gICAgc3dpdGNoIChwaWVjZS5yb2xlKSB7XG4gICAgICAgIGNhc2UgJ3Bhd24nOlxuICAgICAgICAgICAgcmV0dXJuIHBhd25BdHRhY2tzKHBpZWNlLmNvbG9yLCBzcXVhcmUpO1xuICAgICAgICBjYXNlICdrbmlnaHQnOlxuICAgICAgICAgICAgcmV0dXJuIGtuaWdodEF0dGFja3Moc3F1YXJlKTtcbiAgICAgICAgY2FzZSAnYmlzaG9wJzpcbiAgICAgICAgICAgIHJldHVybiBiaXNob3BBdHRhY2tzKHNxdWFyZSwgb2NjdXBpZWQpO1xuICAgICAgICBjYXNlICdyb29rJzpcbiAgICAgICAgICAgIHJldHVybiByb29rQXR0YWNrcyhzcXVhcmUsIG9jY3VwaWVkKTtcbiAgICAgICAgY2FzZSAncXVlZW4nOlxuICAgICAgICAgICAgcmV0dXJuIHF1ZWVuQXR0YWNrcyhzcXVhcmUsIG9jY3VwaWVkKTtcbiAgICAgICAgY2FzZSAna2luZyc6XG4gICAgICAgICAgICByZXR1cm4ga2luZ0F0dGFja3Moc3F1YXJlKTtcbiAgICB9XG59O1xuLyoqXG4gKiBHZXRzIGFsbCBzcXVhcmVzIG9mIHRoZSByYW5rLCBmaWxlIG9yIGRpYWdvbmFsIHdpdGggdGhlIHR3byBzcXVhcmVzXG4gKiBgYWAgYW5kIGBiYCwgb3IgYW4gZW1wdHkgc2V0IGlmIHRoZXkgYXJlIG5vdCBhbGlnbmVkLlxuICovXG5leHBvcnQgY29uc3QgcmF5ID0gKGEsIGIpID0+IHtcbiAgICBjb25zdCBvdGhlciA9IFNxdWFyZVNldC5mcm9tU3F1YXJlKGIpO1xuICAgIGlmIChSQU5LX1JBTkdFW2FdLmludGVyc2VjdHMob3RoZXIpKVxuICAgICAgICByZXR1cm4gUkFOS19SQU5HRVthXS53aXRoKGEpO1xuICAgIGlmIChBTlRJX0RJQUdfUkFOR0VbYV0uaW50ZXJzZWN0cyhvdGhlcikpXG4gICAgICAgIHJldHVybiBBTlRJX0RJQUdfUkFOR0VbYV0ud2l0aChhKTtcbiAgICBpZiAoRElBR19SQU5HRVthXS5pbnRlcnNlY3RzKG90aGVyKSlcbiAgICAgICAgcmV0dXJuIERJQUdfUkFOR0VbYV0ud2l0aChhKTtcbiAgICBpZiAoRklMRV9SQU5HRVthXS5pbnRlcnNlY3RzKG90aGVyKSlcbiAgICAgICAgcmV0dXJuIEZJTEVfUkFOR0VbYV0ud2l0aChhKTtcbiAgICByZXR1cm4gU3F1YXJlU2V0LmVtcHR5KCk7XG59O1xuLyoqXG4gKiBHZXRzIGFsbCBzcXVhcmVzIGJldHdlZW4gYGFgIGFuZCBgYmAgKGJvdW5kcyBub3QgaW5jbHVkZWQpLCBvciBhbiBlbXB0eSBzZXRcbiAqIGlmIHRoZXkgYXJlIG5vdCBvbiB0aGUgc2FtZSByYW5rLCBmaWxlIG9yIGRpYWdvbmFsLlxuICovXG5leHBvcnQgY29uc3QgYmV0d2VlbiA9IChhLCBiKSA9PiByYXkoYSwgYilcbiAgICAuaW50ZXJzZWN0KFNxdWFyZVNldC5mdWxsKCkuc2hsNjQoYSkueG9yKFNxdWFyZVNldC5mdWxsKCkuc2hsNjQoYikpKVxuICAgIC53aXRob3V0Rmlyc3QoKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWF0dGFja3MuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/chessops/dist/esm/attacks.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/chessops/dist/esm/board.js":
/*!*************************************************!*\
  !*** ./node_modules/chessops/dist/esm/board.js ***!
  \*************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Board: () => (/* binding */ Board),\n/* harmony export */   boardEquals: () => (/* binding */ boardEquals)\n/* harmony export */ });\n/* harmony import */ var _squareSet_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./squareSet.js */ \"(ssr)/./node_modules/chessops/dist/esm/squareSet.js\");\n/* harmony import */ var _types_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./types.js */ \"(ssr)/./node_modules/chessops/dist/esm/types.js\");\n\n\n/**\n * Piece positions on a board.\n *\n * Properties are sets of squares, like `board.occupied` for all occupied\n * squares, `board[color]` for all pieces of that color, and `board[role]`\n * for all pieces of that role. When modifying the properties directly, take\n * care to keep them consistent.\n */\nclass Board {\n    constructor() { }\n    static default() {\n        const board = new Board();\n        board.reset();\n        return board;\n    }\n    /**\n     * Resets all pieces to the default starting position for standard chess.\n     */\n    reset() {\n        this.occupied = new _squareSet_js__WEBPACK_IMPORTED_MODULE_0__.SquareSet(0xffff, 4294901760);\n        this.promoted = _squareSet_js__WEBPACK_IMPORTED_MODULE_0__.SquareSet.empty();\n        this.white = new _squareSet_js__WEBPACK_IMPORTED_MODULE_0__.SquareSet(0xffff, 0);\n        this.black = new _squareSet_js__WEBPACK_IMPORTED_MODULE_0__.SquareSet(0, 4294901760);\n        this.pawn = new _squareSet_js__WEBPACK_IMPORTED_MODULE_0__.SquareSet(0xff00, 16711680);\n        this.knight = new _squareSet_js__WEBPACK_IMPORTED_MODULE_0__.SquareSet(0x42, 1107296256);\n        this.bishop = new _squareSet_js__WEBPACK_IMPORTED_MODULE_0__.SquareSet(0x24, 603979776);\n        this.rook = new _squareSet_js__WEBPACK_IMPORTED_MODULE_0__.SquareSet(0x81, 2164260864);\n        this.queen = new _squareSet_js__WEBPACK_IMPORTED_MODULE_0__.SquareSet(0x8, 134217728);\n        this.king = new _squareSet_js__WEBPACK_IMPORTED_MODULE_0__.SquareSet(0x10, 268435456);\n    }\n    static empty() {\n        const board = new Board();\n        board.clear();\n        return board;\n    }\n    clear() {\n        this.occupied = _squareSet_js__WEBPACK_IMPORTED_MODULE_0__.SquareSet.empty();\n        this.promoted = _squareSet_js__WEBPACK_IMPORTED_MODULE_0__.SquareSet.empty();\n        for (const color of _types_js__WEBPACK_IMPORTED_MODULE_1__.COLORS)\n            this[color] = _squareSet_js__WEBPACK_IMPORTED_MODULE_0__.SquareSet.empty();\n        for (const role of _types_js__WEBPACK_IMPORTED_MODULE_1__.ROLES)\n            this[role] = _squareSet_js__WEBPACK_IMPORTED_MODULE_0__.SquareSet.empty();\n    }\n    clone() {\n        const board = new Board();\n        board.occupied = this.occupied;\n        board.promoted = this.promoted;\n        for (const color of _types_js__WEBPACK_IMPORTED_MODULE_1__.COLORS)\n            board[color] = this[color];\n        for (const role of _types_js__WEBPACK_IMPORTED_MODULE_1__.ROLES)\n            board[role] = this[role];\n        return board;\n    }\n    getColor(square) {\n        if (this.white.has(square))\n            return 'white';\n        if (this.black.has(square))\n            return 'black';\n        return;\n    }\n    getRole(square) {\n        for (const role of _types_js__WEBPACK_IMPORTED_MODULE_1__.ROLES) {\n            if (this[role].has(square))\n                return role;\n        }\n        return;\n    }\n    get(square) {\n        const color = this.getColor(square);\n        if (!color)\n            return;\n        const role = this.getRole(square);\n        const promoted = this.promoted.has(square);\n        return { color, role, promoted };\n    }\n    /**\n     * Removes and returns the piece from the given `square`, if any.\n     */\n    take(square) {\n        const piece = this.get(square);\n        if (piece) {\n            this.occupied = this.occupied.without(square);\n            this[piece.color] = this[piece.color].without(square);\n            this[piece.role] = this[piece.role].without(square);\n            if (piece.promoted)\n                this.promoted = this.promoted.without(square);\n        }\n        return piece;\n    }\n    /**\n     * Put `piece` onto `square`, potentially replacing an existing piece.\n     * Returns the existing piece, if any.\n     */\n    set(square, piece) {\n        const old = this.take(square);\n        this.occupied = this.occupied.with(square);\n        this[piece.color] = this[piece.color].with(square);\n        this[piece.role] = this[piece.role].with(square);\n        if (piece.promoted)\n            this.promoted = this.promoted.with(square);\n        return old;\n    }\n    has(square) {\n        return this.occupied.has(square);\n    }\n    *[Symbol.iterator]() {\n        for (const square of this.occupied) {\n            yield [square, this.get(square)];\n        }\n    }\n    pieces(color, role) {\n        return this[color].intersect(this[role]);\n    }\n    rooksAndQueens() {\n        return this.rook.union(this.queen);\n    }\n    bishopsAndQueens() {\n        return this.bishop.union(this.queen);\n    }\n    steppers() {\n        return this.knight.union(this.pawn).union(this.king);\n    }\n    sliders() {\n        return this.bishop.union(this.rook).union(this.queen);\n    }\n    /**\n     * Finds the unique king of the given `color`, if any.\n     */\n    kingOf(color) {\n        return this.pieces(color, 'king').singleSquare();\n    }\n}\nconst boardEquals = (left, right) => left.white.equals(right.white)\n    && left.promoted.equals(right.promoted)\n    && _types_js__WEBPACK_IMPORTED_MODULE_1__.ROLES.every(role => left[role].equals(right[role]));\n//# sourceMappingURL=board.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvY2hlc3NvcHMvZGlzdC9lc20vYm9hcmQuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUEyQztBQUNBO0FBQzNDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLG9EQUFTO0FBQ3JDLHdCQUF3QixvREFBUztBQUNqQyx5QkFBeUIsb0RBQVM7QUFDbEMseUJBQXlCLG9EQUFTO0FBQ2xDLHdCQUF3QixvREFBUztBQUNqQywwQkFBMEIsb0RBQVM7QUFDbkMsMEJBQTBCLG9EQUFTO0FBQ25DLHdCQUF3QixvREFBUztBQUNqQyx5QkFBeUIsb0RBQVM7QUFDbEMsd0JBQXdCLG9EQUFTO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLG9EQUFTO0FBQ2pDLHdCQUF3QixvREFBUztBQUNqQyw0QkFBNEIsNkNBQU07QUFDbEMsMEJBQTBCLG9EQUFTO0FBQ25DLDJCQUEyQiw0Q0FBSztBQUNoQyx5QkFBeUIsb0RBQVM7QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0Qiw2Q0FBTTtBQUNsQztBQUNBLDJCQUEyQiw0Q0FBSztBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLDRDQUFLO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDTztBQUNQO0FBQ0EsT0FBTyw0Q0FBSztBQUNaIiwic291cmNlcyI6WyIvVXNlcnMvcmFrc2hpdC93b3Jrc3BhY2UvYXJjaGl2ZXMvcmVwb3MvY2hlc3MvZXZhbC1iYXIvbm9kZV9tb2R1bGVzL2NoZXNzb3BzL2Rpc3QvZXNtL2JvYXJkLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFNxdWFyZVNldCB9IGZyb20gJy4vc3F1YXJlU2V0LmpzJztcbmltcG9ydCB7IENPTE9SUywgUk9MRVMgfSBmcm9tICcuL3R5cGVzLmpzJztcbi8qKlxuICogUGllY2UgcG9zaXRpb25zIG9uIGEgYm9hcmQuXG4gKlxuICogUHJvcGVydGllcyBhcmUgc2V0cyBvZiBzcXVhcmVzLCBsaWtlIGBib2FyZC5vY2N1cGllZGAgZm9yIGFsbCBvY2N1cGllZFxuICogc3F1YXJlcywgYGJvYXJkW2NvbG9yXWAgZm9yIGFsbCBwaWVjZXMgb2YgdGhhdCBjb2xvciwgYW5kIGBib2FyZFtyb2xlXWBcbiAqIGZvciBhbGwgcGllY2VzIG9mIHRoYXQgcm9sZS4gV2hlbiBtb2RpZnlpbmcgdGhlIHByb3BlcnRpZXMgZGlyZWN0bHksIHRha2VcbiAqIGNhcmUgdG8ga2VlcCB0aGVtIGNvbnNpc3RlbnQuXG4gKi9cbmV4cG9ydCBjbGFzcyBCb2FyZCB7XG4gICAgY29uc3RydWN0b3IoKSB7IH1cbiAgICBzdGF0aWMgZGVmYXVsdCgpIHtcbiAgICAgICAgY29uc3QgYm9hcmQgPSBuZXcgQm9hcmQoKTtcbiAgICAgICAgYm9hcmQucmVzZXQoKTtcbiAgICAgICAgcmV0dXJuIGJvYXJkO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXNldHMgYWxsIHBpZWNlcyB0byB0aGUgZGVmYXVsdCBzdGFydGluZyBwb3NpdGlvbiBmb3Igc3RhbmRhcmQgY2hlc3MuXG4gICAgICovXG4gICAgcmVzZXQoKSB7XG4gICAgICAgIHRoaXMub2NjdXBpZWQgPSBuZXcgU3F1YXJlU2V0KDB4ZmZmZiwgNDI5NDkwMTc2MCk7XG4gICAgICAgIHRoaXMucHJvbW90ZWQgPSBTcXVhcmVTZXQuZW1wdHkoKTtcbiAgICAgICAgdGhpcy53aGl0ZSA9IG5ldyBTcXVhcmVTZXQoMHhmZmZmLCAwKTtcbiAgICAgICAgdGhpcy5ibGFjayA9IG5ldyBTcXVhcmVTZXQoMCwgNDI5NDkwMTc2MCk7XG4gICAgICAgIHRoaXMucGF3biA9IG5ldyBTcXVhcmVTZXQoMHhmZjAwLCAxNjcxMTY4MCk7XG4gICAgICAgIHRoaXMua25pZ2h0ID0gbmV3IFNxdWFyZVNldCgweDQyLCAxMTA3Mjk2MjU2KTtcbiAgICAgICAgdGhpcy5iaXNob3AgPSBuZXcgU3F1YXJlU2V0KDB4MjQsIDYwMzk3OTc3Nik7XG4gICAgICAgIHRoaXMucm9vayA9IG5ldyBTcXVhcmVTZXQoMHg4MSwgMjE2NDI2MDg2NCk7XG4gICAgICAgIHRoaXMucXVlZW4gPSBuZXcgU3F1YXJlU2V0KDB4OCwgMTM0MjE3NzI4KTtcbiAgICAgICAgdGhpcy5raW5nID0gbmV3IFNxdWFyZVNldCgweDEwLCAyNjg0MzU0NTYpO1xuICAgIH1cbiAgICBzdGF0aWMgZW1wdHkoKSB7XG4gICAgICAgIGNvbnN0IGJvYXJkID0gbmV3IEJvYXJkKCk7XG4gICAgICAgIGJvYXJkLmNsZWFyKCk7XG4gICAgICAgIHJldHVybiBib2FyZDtcbiAgICB9XG4gICAgY2xlYXIoKSB7XG4gICAgICAgIHRoaXMub2NjdXBpZWQgPSBTcXVhcmVTZXQuZW1wdHkoKTtcbiAgICAgICAgdGhpcy5wcm9tb3RlZCA9IFNxdWFyZVNldC5lbXB0eSgpO1xuICAgICAgICBmb3IgKGNvbnN0IGNvbG9yIG9mIENPTE9SUylcbiAgICAgICAgICAgIHRoaXNbY29sb3JdID0gU3F1YXJlU2V0LmVtcHR5KCk7XG4gICAgICAgIGZvciAoY29uc3Qgcm9sZSBvZiBST0xFUylcbiAgICAgICAgICAgIHRoaXNbcm9sZV0gPSBTcXVhcmVTZXQuZW1wdHkoKTtcbiAgICB9XG4gICAgY2xvbmUoKSB7XG4gICAgICAgIGNvbnN0IGJvYXJkID0gbmV3IEJvYXJkKCk7XG4gICAgICAgIGJvYXJkLm9jY3VwaWVkID0gdGhpcy5vY2N1cGllZDtcbiAgICAgICAgYm9hcmQucHJvbW90ZWQgPSB0aGlzLnByb21vdGVkO1xuICAgICAgICBmb3IgKGNvbnN0IGNvbG9yIG9mIENPTE9SUylcbiAgICAgICAgICAgIGJvYXJkW2NvbG9yXSA9IHRoaXNbY29sb3JdO1xuICAgICAgICBmb3IgKGNvbnN0IHJvbGUgb2YgUk9MRVMpXG4gICAgICAgICAgICBib2FyZFtyb2xlXSA9IHRoaXNbcm9sZV07XG4gICAgICAgIHJldHVybiBib2FyZDtcbiAgICB9XG4gICAgZ2V0Q29sb3Ioc3F1YXJlKSB7XG4gICAgICAgIGlmICh0aGlzLndoaXRlLmhhcyhzcXVhcmUpKVxuICAgICAgICAgICAgcmV0dXJuICd3aGl0ZSc7XG4gICAgICAgIGlmICh0aGlzLmJsYWNrLmhhcyhzcXVhcmUpKVxuICAgICAgICAgICAgcmV0dXJuICdibGFjayc7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgZ2V0Um9sZShzcXVhcmUpIHtcbiAgICAgICAgZm9yIChjb25zdCByb2xlIG9mIFJPTEVTKSB7XG4gICAgICAgICAgICBpZiAodGhpc1tyb2xlXS5oYXMoc3F1YXJlKSlcbiAgICAgICAgICAgICAgICByZXR1cm4gcm9sZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGdldChzcXVhcmUpIHtcbiAgICAgICAgY29uc3QgY29sb3IgPSB0aGlzLmdldENvbG9yKHNxdWFyZSk7XG4gICAgICAgIGlmICghY29sb3IpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGNvbnN0IHJvbGUgPSB0aGlzLmdldFJvbGUoc3F1YXJlKTtcbiAgICAgICAgY29uc3QgcHJvbW90ZWQgPSB0aGlzLnByb21vdGVkLmhhcyhzcXVhcmUpO1xuICAgICAgICByZXR1cm4geyBjb2xvciwgcm9sZSwgcHJvbW90ZWQgfTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVtb3ZlcyBhbmQgcmV0dXJucyB0aGUgcGllY2UgZnJvbSB0aGUgZ2l2ZW4gYHNxdWFyZWAsIGlmIGFueS5cbiAgICAgKi9cbiAgICB0YWtlKHNxdWFyZSkge1xuICAgICAgICBjb25zdCBwaWVjZSA9IHRoaXMuZ2V0KHNxdWFyZSk7XG4gICAgICAgIGlmIChwaWVjZSkge1xuICAgICAgICAgICAgdGhpcy5vY2N1cGllZCA9IHRoaXMub2NjdXBpZWQud2l0aG91dChzcXVhcmUpO1xuICAgICAgICAgICAgdGhpc1twaWVjZS5jb2xvcl0gPSB0aGlzW3BpZWNlLmNvbG9yXS53aXRob3V0KHNxdWFyZSk7XG4gICAgICAgICAgICB0aGlzW3BpZWNlLnJvbGVdID0gdGhpc1twaWVjZS5yb2xlXS53aXRob3V0KHNxdWFyZSk7XG4gICAgICAgICAgICBpZiAocGllY2UucHJvbW90ZWQpXG4gICAgICAgICAgICAgICAgdGhpcy5wcm9tb3RlZCA9IHRoaXMucHJvbW90ZWQud2l0aG91dChzcXVhcmUpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBwaWVjZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUHV0IGBwaWVjZWAgb250byBgc3F1YXJlYCwgcG90ZW50aWFsbHkgcmVwbGFjaW5nIGFuIGV4aXN0aW5nIHBpZWNlLlxuICAgICAqIFJldHVybnMgdGhlIGV4aXN0aW5nIHBpZWNlLCBpZiBhbnkuXG4gICAgICovXG4gICAgc2V0KHNxdWFyZSwgcGllY2UpIHtcbiAgICAgICAgY29uc3Qgb2xkID0gdGhpcy50YWtlKHNxdWFyZSk7XG4gICAgICAgIHRoaXMub2NjdXBpZWQgPSB0aGlzLm9jY3VwaWVkLndpdGgoc3F1YXJlKTtcbiAgICAgICAgdGhpc1twaWVjZS5jb2xvcl0gPSB0aGlzW3BpZWNlLmNvbG9yXS53aXRoKHNxdWFyZSk7XG4gICAgICAgIHRoaXNbcGllY2Uucm9sZV0gPSB0aGlzW3BpZWNlLnJvbGVdLndpdGgoc3F1YXJlKTtcbiAgICAgICAgaWYgKHBpZWNlLnByb21vdGVkKVxuICAgICAgICAgICAgdGhpcy5wcm9tb3RlZCA9IHRoaXMucHJvbW90ZWQud2l0aChzcXVhcmUpO1xuICAgICAgICByZXR1cm4gb2xkO1xuICAgIH1cbiAgICBoYXMoc3F1YXJlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm9jY3VwaWVkLmhhcyhzcXVhcmUpO1xuICAgIH1cbiAgICAqW1N5bWJvbC5pdGVyYXRvcl0oKSB7XG4gICAgICAgIGZvciAoY29uc3Qgc3F1YXJlIG9mIHRoaXMub2NjdXBpZWQpIHtcbiAgICAgICAgICAgIHlpZWxkIFtzcXVhcmUsIHRoaXMuZ2V0KHNxdWFyZSldO1xuICAgICAgICB9XG4gICAgfVxuICAgIHBpZWNlcyhjb2xvciwgcm9sZSkge1xuICAgICAgICByZXR1cm4gdGhpc1tjb2xvcl0uaW50ZXJzZWN0KHRoaXNbcm9sZV0pO1xuICAgIH1cbiAgICByb29rc0FuZFF1ZWVucygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucm9vay51bmlvbih0aGlzLnF1ZWVuKTtcbiAgICB9XG4gICAgYmlzaG9wc0FuZFF1ZWVucygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYmlzaG9wLnVuaW9uKHRoaXMucXVlZW4pO1xuICAgIH1cbiAgICBzdGVwcGVycygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMua25pZ2h0LnVuaW9uKHRoaXMucGF3bikudW5pb24odGhpcy5raW5nKTtcbiAgICB9XG4gICAgc2xpZGVycygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYmlzaG9wLnVuaW9uKHRoaXMucm9vaykudW5pb24odGhpcy5xdWVlbik7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEZpbmRzIHRoZSB1bmlxdWUga2luZyBvZiB0aGUgZ2l2ZW4gYGNvbG9yYCwgaWYgYW55LlxuICAgICAqL1xuICAgIGtpbmdPZihjb2xvcikge1xuICAgICAgICByZXR1cm4gdGhpcy5waWVjZXMoY29sb3IsICdraW5nJykuc2luZ2xlU3F1YXJlKCk7XG4gICAgfVxufVxuZXhwb3J0IGNvbnN0IGJvYXJkRXF1YWxzID0gKGxlZnQsIHJpZ2h0KSA9PiBsZWZ0LndoaXRlLmVxdWFscyhyaWdodC53aGl0ZSlcbiAgICAmJiBsZWZ0LnByb21vdGVkLmVxdWFscyhyaWdodC5wcm9tb3RlZClcbiAgICAmJiBST0xFUy5ldmVyeShyb2xlID0+IGxlZnRbcm9sZV0uZXF1YWxzKHJpZ2h0W3JvbGVdKSk7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1ib2FyZC5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/chessops/dist/esm/board.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/chessops/dist/esm/chess.js":
/*!*************************************************!*\
  !*** ./node_modules/chessops/dist/esm/chess.js ***!
  \*************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Castles: () => (/* binding */ Castles),\n/* harmony export */   Chess: () => (/* binding */ Chess),\n/* harmony export */   IllegalSetup: () => (/* binding */ IllegalSetup),\n/* harmony export */   Position: () => (/* binding */ Position),\n/* harmony export */   PositionError: () => (/* binding */ PositionError),\n/* harmony export */   castlingSide: () => (/* binding */ castlingSide),\n/* harmony export */   equalsIgnoreMoves: () => (/* binding */ equalsIgnoreMoves),\n/* harmony export */   isImpossibleCheck: () => (/* binding */ isImpossibleCheck),\n/* harmony export */   isStandardMaterial: () => (/* binding */ isStandardMaterial),\n/* harmony export */   isStandardMaterialSide: () => (/* binding */ isStandardMaterialSide),\n/* harmony export */   normalizeMove: () => (/* binding */ normalizeMove),\n/* harmony export */   pseudoDests: () => (/* binding */ pseudoDests)\n/* harmony export */ });\n/* harmony import */ var _badrap_result__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @badrap/result */ \"(ssr)/./node_modules/@badrap/result/dist/node-mjs/index.mjs\");\n/* harmony import */ var _attacks_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./attacks.js */ \"(ssr)/./node_modules/chessops/dist/esm/attacks.js\");\n/* harmony import */ var _board_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./board.js */ \"(ssr)/./node_modules/chessops/dist/esm/board.js\");\n/* harmony import */ var _squareSet_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./squareSet.js */ \"(ssr)/./node_modules/chessops/dist/esm/squareSet.js\");\n/* harmony import */ var _types_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./types.js */ \"(ssr)/./node_modules/chessops/dist/esm/types.js\");\n/* harmony import */ var _util_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./util.js */ \"(ssr)/./node_modules/chessops/dist/esm/util.js\");\n\n\n\n\n\n\nvar IllegalSetup;\n(function (IllegalSetup) {\n    IllegalSetup[\"Empty\"] = \"ERR_EMPTY\";\n    IllegalSetup[\"OppositeCheck\"] = \"ERR_OPPOSITE_CHECK\";\n    IllegalSetup[\"PawnsOnBackrank\"] = \"ERR_PAWNS_ON_BACKRANK\";\n    IllegalSetup[\"Kings\"] = \"ERR_KINGS\";\n    IllegalSetup[\"Variant\"] = \"ERR_VARIANT\";\n})(IllegalSetup || (IllegalSetup = {}));\nclass PositionError extends Error {\n}\nconst attacksTo = (square, attacker, board, occupied) => board[attacker].intersect((0,_attacks_js__WEBPACK_IMPORTED_MODULE_0__.rookAttacks)(square, occupied)\n    .intersect(board.rooksAndQueens())\n    .union((0,_attacks_js__WEBPACK_IMPORTED_MODULE_0__.bishopAttacks)(square, occupied).intersect(board.bishopsAndQueens()))\n    .union((0,_attacks_js__WEBPACK_IMPORTED_MODULE_0__.knightAttacks)(square).intersect(board.knight))\n    .union((0,_attacks_js__WEBPACK_IMPORTED_MODULE_0__.kingAttacks)(square).intersect(board.king))\n    .union((0,_attacks_js__WEBPACK_IMPORTED_MODULE_0__.pawnAttacks)((0,_util_js__WEBPACK_IMPORTED_MODULE_1__.opposite)(attacker), square).intersect(board.pawn)));\nclass Castles {\n    constructor() { }\n    static default() {\n        const castles = new Castles();\n        castles.castlingRights = _squareSet_js__WEBPACK_IMPORTED_MODULE_2__.SquareSet.corners();\n        castles.rook = {\n            white: { a: 0, h: 7 },\n            black: { a: 56, h: 63 },\n        };\n        castles.path = {\n            white: { a: new _squareSet_js__WEBPACK_IMPORTED_MODULE_2__.SquareSet(0xe, 0), h: new _squareSet_js__WEBPACK_IMPORTED_MODULE_2__.SquareSet(0x60, 0) },\n            black: { a: new _squareSet_js__WEBPACK_IMPORTED_MODULE_2__.SquareSet(0, 0x0e000000), h: new _squareSet_js__WEBPACK_IMPORTED_MODULE_2__.SquareSet(0, 0x60000000) },\n        };\n        return castles;\n    }\n    static empty() {\n        const castles = new Castles();\n        castles.castlingRights = _squareSet_js__WEBPACK_IMPORTED_MODULE_2__.SquareSet.empty();\n        castles.rook = {\n            white: { a: undefined, h: undefined },\n            black: { a: undefined, h: undefined },\n        };\n        castles.path = {\n            white: { a: _squareSet_js__WEBPACK_IMPORTED_MODULE_2__.SquareSet.empty(), h: _squareSet_js__WEBPACK_IMPORTED_MODULE_2__.SquareSet.empty() },\n            black: { a: _squareSet_js__WEBPACK_IMPORTED_MODULE_2__.SquareSet.empty(), h: _squareSet_js__WEBPACK_IMPORTED_MODULE_2__.SquareSet.empty() },\n        };\n        return castles;\n    }\n    clone() {\n        const castles = new Castles();\n        castles.castlingRights = this.castlingRights;\n        castles.rook = {\n            white: { a: this.rook.white.a, h: this.rook.white.h },\n            black: { a: this.rook.black.a, h: this.rook.black.h },\n        };\n        castles.path = {\n            white: { a: this.path.white.a, h: this.path.white.h },\n            black: { a: this.path.black.a, h: this.path.black.h },\n        };\n        return castles;\n    }\n    add(color, side, king, rook) {\n        const kingTo = (0,_util_js__WEBPACK_IMPORTED_MODULE_1__.kingCastlesTo)(color, side);\n        const rookTo = (0,_util_js__WEBPACK_IMPORTED_MODULE_1__.rookCastlesTo)(color, side);\n        this.castlingRights = this.castlingRights.with(rook);\n        this.rook[color][side] = rook;\n        this.path[color][side] = (0,_attacks_js__WEBPACK_IMPORTED_MODULE_0__.between)(rook, rookTo)\n            .with(rookTo)\n            .union((0,_attacks_js__WEBPACK_IMPORTED_MODULE_0__.between)(king, kingTo).with(kingTo))\n            .without(king)\n            .without(rook);\n    }\n    static fromSetup(setup) {\n        const castles = Castles.empty();\n        const rooks = setup.castlingRights.intersect(setup.board.rook);\n        for (const color of _types_js__WEBPACK_IMPORTED_MODULE_3__.COLORS) {\n            const backrank = _squareSet_js__WEBPACK_IMPORTED_MODULE_2__.SquareSet.backrank(color);\n            const king = setup.board.kingOf(color);\n            if (!(0,_util_js__WEBPACK_IMPORTED_MODULE_1__.defined)(king) || !backrank.has(king))\n                continue;\n            const side = rooks.intersect(setup.board[color]).intersect(backrank);\n            const aSide = side.first();\n            if ((0,_util_js__WEBPACK_IMPORTED_MODULE_1__.defined)(aSide) && aSide < king)\n                castles.add(color, 'a', king, aSide);\n            const hSide = side.last();\n            if ((0,_util_js__WEBPACK_IMPORTED_MODULE_1__.defined)(hSide) && king < hSide)\n                castles.add(color, 'h', king, hSide);\n        }\n        return castles;\n    }\n    discardRook(square) {\n        if (this.castlingRights.has(square)) {\n            this.castlingRights = this.castlingRights.without(square);\n            for (const color of _types_js__WEBPACK_IMPORTED_MODULE_3__.COLORS) {\n                for (const side of _types_js__WEBPACK_IMPORTED_MODULE_3__.CASTLING_SIDES) {\n                    if (this.rook[color][side] === square)\n                        this.rook[color][side] = undefined;\n                }\n            }\n        }\n    }\n    discardColor(color) {\n        this.castlingRights = this.castlingRights.diff(_squareSet_js__WEBPACK_IMPORTED_MODULE_2__.SquareSet.backrank(color));\n        this.rook[color].a = undefined;\n        this.rook[color].h = undefined;\n    }\n}\nclass Position {\n    constructor(rules) {\n        this.rules = rules;\n    }\n    reset() {\n        this.board = _board_js__WEBPACK_IMPORTED_MODULE_4__.Board.default();\n        this.pockets = undefined;\n        this.turn = 'white';\n        this.castles = Castles.default();\n        this.epSquare = undefined;\n        this.remainingChecks = undefined;\n        this.halfmoves = 0;\n        this.fullmoves = 1;\n    }\n    setupUnchecked(setup) {\n        this.board = setup.board.clone();\n        this.board.promoted = _squareSet_js__WEBPACK_IMPORTED_MODULE_2__.SquareSet.empty();\n        this.pockets = undefined;\n        this.turn = setup.turn;\n        this.castles = Castles.fromSetup(setup);\n        this.epSquare = validEpSquare(this, setup.epSquare);\n        this.remainingChecks = undefined;\n        this.halfmoves = setup.halfmoves;\n        this.fullmoves = setup.fullmoves;\n    }\n    // When subclassing overwrite at least:\n    //\n    // - static default()\n    // - static fromSetup()\n    // - static clone()\n    //\n    // - dests()\n    // - isVariantEnd()\n    // - variantOutcome()\n    // - hasInsufficientMaterial()\n    // - isStandardMaterial()\n    kingAttackers(square, attacker, occupied) {\n        return attacksTo(square, attacker, this.board, occupied);\n    }\n    playCaptureAt(square, captured) {\n        this.halfmoves = 0;\n        if (captured.role === 'rook')\n            this.castles.discardRook(square);\n        if (this.pockets)\n            this.pockets[(0,_util_js__WEBPACK_IMPORTED_MODULE_1__.opposite)(captured.color)][captured.promoted ? 'pawn' : captured.role]++;\n    }\n    ctx() {\n        const variantEnd = this.isVariantEnd();\n        const king = this.board.kingOf(this.turn);\n        if (!(0,_util_js__WEBPACK_IMPORTED_MODULE_1__.defined)(king)) {\n            return { king, blockers: _squareSet_js__WEBPACK_IMPORTED_MODULE_2__.SquareSet.empty(), checkers: _squareSet_js__WEBPACK_IMPORTED_MODULE_2__.SquareSet.empty(), variantEnd, mustCapture: false };\n        }\n        const snipers = (0,_attacks_js__WEBPACK_IMPORTED_MODULE_0__.rookAttacks)(king, _squareSet_js__WEBPACK_IMPORTED_MODULE_2__.SquareSet.empty())\n            .intersect(this.board.rooksAndQueens())\n            .union((0,_attacks_js__WEBPACK_IMPORTED_MODULE_0__.bishopAttacks)(king, _squareSet_js__WEBPACK_IMPORTED_MODULE_2__.SquareSet.empty()).intersect(this.board.bishopsAndQueens()))\n            .intersect(this.board[(0,_util_js__WEBPACK_IMPORTED_MODULE_1__.opposite)(this.turn)]);\n        let blockers = _squareSet_js__WEBPACK_IMPORTED_MODULE_2__.SquareSet.empty();\n        for (const sniper of snipers) {\n            const b = (0,_attacks_js__WEBPACK_IMPORTED_MODULE_0__.between)(king, sniper).intersect(this.board.occupied);\n            if (!b.moreThanOne())\n                blockers = blockers.union(b);\n        }\n        const checkers = this.kingAttackers(king, (0,_util_js__WEBPACK_IMPORTED_MODULE_1__.opposite)(this.turn), this.board.occupied);\n        return {\n            king,\n            blockers,\n            checkers,\n            variantEnd,\n            mustCapture: false,\n        };\n    }\n    clone() {\n        var _a, _b;\n        const pos = new this.constructor();\n        pos.board = this.board.clone();\n        pos.pockets = (_a = this.pockets) === null || _a === void 0 ? void 0 : _a.clone();\n        pos.turn = this.turn;\n        pos.castles = this.castles.clone();\n        pos.epSquare = this.epSquare;\n        pos.remainingChecks = (_b = this.remainingChecks) === null || _b === void 0 ? void 0 : _b.clone();\n        pos.halfmoves = this.halfmoves;\n        pos.fullmoves = this.fullmoves;\n        return pos;\n    }\n    validate() {\n        if (this.board.occupied.isEmpty())\n            return _badrap_result__WEBPACK_IMPORTED_MODULE_5__.Result.err(new PositionError(IllegalSetup.Empty));\n        if (this.board.king.size() !== 2)\n            return _badrap_result__WEBPACK_IMPORTED_MODULE_5__.Result.err(new PositionError(IllegalSetup.Kings));\n        if (!(0,_util_js__WEBPACK_IMPORTED_MODULE_1__.defined)(this.board.kingOf(this.turn)))\n            return _badrap_result__WEBPACK_IMPORTED_MODULE_5__.Result.err(new PositionError(IllegalSetup.Kings));\n        const otherKing = this.board.kingOf((0,_util_js__WEBPACK_IMPORTED_MODULE_1__.opposite)(this.turn));\n        if (!(0,_util_js__WEBPACK_IMPORTED_MODULE_1__.defined)(otherKing))\n            return _badrap_result__WEBPACK_IMPORTED_MODULE_5__.Result.err(new PositionError(IllegalSetup.Kings));\n        if (this.kingAttackers(otherKing, this.turn, this.board.occupied).nonEmpty()) {\n            return _badrap_result__WEBPACK_IMPORTED_MODULE_5__.Result.err(new PositionError(IllegalSetup.OppositeCheck));\n        }\n        if (_squareSet_js__WEBPACK_IMPORTED_MODULE_2__.SquareSet.backranks().intersects(this.board.pawn)) {\n            return _badrap_result__WEBPACK_IMPORTED_MODULE_5__.Result.err(new PositionError(IllegalSetup.PawnsOnBackrank));\n        }\n        return _badrap_result__WEBPACK_IMPORTED_MODULE_5__.Result.ok(undefined);\n    }\n    dropDests(_ctx) {\n        return _squareSet_js__WEBPACK_IMPORTED_MODULE_2__.SquareSet.empty();\n    }\n    dests(square, ctx) {\n        ctx = ctx || this.ctx();\n        if (ctx.variantEnd)\n            return _squareSet_js__WEBPACK_IMPORTED_MODULE_2__.SquareSet.empty();\n        const piece = this.board.get(square);\n        if (!piece || piece.color !== this.turn)\n            return _squareSet_js__WEBPACK_IMPORTED_MODULE_2__.SquareSet.empty();\n        let pseudo, legal;\n        if (piece.role === 'pawn') {\n            pseudo = (0,_attacks_js__WEBPACK_IMPORTED_MODULE_0__.pawnAttacks)(this.turn, square).intersect(this.board[(0,_util_js__WEBPACK_IMPORTED_MODULE_1__.opposite)(this.turn)]);\n            const delta = this.turn === 'white' ? 8 : -8;\n            const step = square + delta;\n            if (0 <= step && step < 64 && !this.board.occupied.has(step)) {\n                pseudo = pseudo.with(step);\n                const canDoubleStep = this.turn === 'white' ? square < 16 : square >= 64 - 16;\n                const doubleStep = step + delta;\n                if (canDoubleStep && !this.board.occupied.has(doubleStep)) {\n                    pseudo = pseudo.with(doubleStep);\n                }\n            }\n            if ((0,_util_js__WEBPACK_IMPORTED_MODULE_1__.defined)(this.epSquare) && canCaptureEp(this, square, ctx)) {\n                legal = _squareSet_js__WEBPACK_IMPORTED_MODULE_2__.SquareSet.fromSquare(this.epSquare);\n            }\n        }\n        else if (piece.role === 'bishop')\n            pseudo = (0,_attacks_js__WEBPACK_IMPORTED_MODULE_0__.bishopAttacks)(square, this.board.occupied);\n        else if (piece.role === 'knight')\n            pseudo = (0,_attacks_js__WEBPACK_IMPORTED_MODULE_0__.knightAttacks)(square);\n        else if (piece.role === 'rook')\n            pseudo = (0,_attacks_js__WEBPACK_IMPORTED_MODULE_0__.rookAttacks)(square, this.board.occupied);\n        else if (piece.role === 'queen')\n            pseudo = (0,_attacks_js__WEBPACK_IMPORTED_MODULE_0__.queenAttacks)(square, this.board.occupied);\n        else\n            pseudo = (0,_attacks_js__WEBPACK_IMPORTED_MODULE_0__.kingAttacks)(square);\n        pseudo = pseudo.diff(this.board[this.turn]);\n        if ((0,_util_js__WEBPACK_IMPORTED_MODULE_1__.defined)(ctx.king)) {\n            if (piece.role === 'king') {\n                const occ = this.board.occupied.without(square);\n                for (const to of pseudo) {\n                    if (this.kingAttackers(to, (0,_util_js__WEBPACK_IMPORTED_MODULE_1__.opposite)(this.turn), occ).nonEmpty())\n                        pseudo = pseudo.without(to);\n                }\n                return pseudo.union(castlingDest(this, 'a', ctx)).union(castlingDest(this, 'h', ctx));\n            }\n            if (ctx.checkers.nonEmpty()) {\n                const checker = ctx.checkers.singleSquare();\n                if (!(0,_util_js__WEBPACK_IMPORTED_MODULE_1__.defined)(checker))\n                    return _squareSet_js__WEBPACK_IMPORTED_MODULE_2__.SquareSet.empty();\n                pseudo = pseudo.intersect((0,_attacks_js__WEBPACK_IMPORTED_MODULE_0__.between)(checker, ctx.king).with(checker));\n            }\n            if (ctx.blockers.has(square))\n                pseudo = pseudo.intersect((0,_attacks_js__WEBPACK_IMPORTED_MODULE_0__.ray)(square, ctx.king));\n        }\n        if (legal)\n            pseudo = pseudo.union(legal);\n        return pseudo;\n    }\n    isVariantEnd() {\n        return false;\n    }\n    variantOutcome(_ctx) {\n        return;\n    }\n    hasInsufficientMaterial(color) {\n        if (this.board[color].intersect(this.board.pawn.union(this.board.rooksAndQueens())).nonEmpty())\n            return false;\n        if (this.board[color].intersects(this.board.knight)) {\n            return (this.board[color].size() <= 2\n                && this.board[(0,_util_js__WEBPACK_IMPORTED_MODULE_1__.opposite)(color)].diff(this.board.king).diff(this.board.queen).isEmpty());\n        }\n        if (this.board[color].intersects(this.board.bishop)) {\n            const sameColor = !this.board.bishop.intersects(_squareSet_js__WEBPACK_IMPORTED_MODULE_2__.SquareSet.darkSquares())\n                || !this.board.bishop.intersects(_squareSet_js__WEBPACK_IMPORTED_MODULE_2__.SquareSet.lightSquares());\n            return sameColor && this.board.pawn.isEmpty() && this.board.knight.isEmpty();\n        }\n        return true;\n    }\n    // The following should be identical in all subclasses\n    toSetup() {\n        var _a, _b;\n        return {\n            board: this.board.clone(),\n            pockets: (_a = this.pockets) === null || _a === void 0 ? void 0 : _a.clone(),\n            turn: this.turn,\n            castlingRights: this.castles.castlingRights,\n            epSquare: legalEpSquare(this),\n            remainingChecks: (_b = this.remainingChecks) === null || _b === void 0 ? void 0 : _b.clone(),\n            halfmoves: Math.min(this.halfmoves, 150),\n            fullmoves: Math.min(Math.max(this.fullmoves, 1), 9999),\n        };\n    }\n    isInsufficientMaterial() {\n        return _types_js__WEBPACK_IMPORTED_MODULE_3__.COLORS.every(color => this.hasInsufficientMaterial(color));\n    }\n    hasDests(ctx) {\n        ctx = ctx || this.ctx();\n        for (const square of this.board[this.turn]) {\n            if (this.dests(square, ctx).nonEmpty())\n                return true;\n        }\n        return this.dropDests(ctx).nonEmpty();\n    }\n    isLegal(move, ctx) {\n        if ((0,_types_js__WEBPACK_IMPORTED_MODULE_3__.isDrop)(move)) {\n            if (!this.pockets || this.pockets[this.turn][move.role] <= 0)\n                return false;\n            if (move.role === 'pawn' && _squareSet_js__WEBPACK_IMPORTED_MODULE_2__.SquareSet.backranks().has(move.to))\n                return false;\n            return this.dropDests(ctx).has(move.to);\n        }\n        else {\n            if (move.promotion === 'pawn')\n                return false;\n            if (move.promotion === 'king' && this.rules !== 'antichess')\n                return false;\n            if (!!move.promotion !== (this.board.pawn.has(move.from) && _squareSet_js__WEBPACK_IMPORTED_MODULE_2__.SquareSet.backranks().has(move.to)))\n                return false;\n            const dests = this.dests(move.from, ctx);\n            return dests.has(move.to) || dests.has(normalizeMove(this, move).to);\n        }\n    }\n    isCheck() {\n        const king = this.board.kingOf(this.turn);\n        return (0,_util_js__WEBPACK_IMPORTED_MODULE_1__.defined)(king) && this.kingAttackers(king, (0,_util_js__WEBPACK_IMPORTED_MODULE_1__.opposite)(this.turn), this.board.occupied).nonEmpty();\n    }\n    isEnd(ctx) {\n        if (ctx ? ctx.variantEnd : this.isVariantEnd())\n            return true;\n        return this.isInsufficientMaterial() || !this.hasDests(ctx);\n    }\n    isCheckmate(ctx) {\n        ctx = ctx || this.ctx();\n        return !ctx.variantEnd && ctx.checkers.nonEmpty() && !this.hasDests(ctx);\n    }\n    isStalemate(ctx) {\n        ctx = ctx || this.ctx();\n        return !ctx.variantEnd && ctx.checkers.isEmpty() && !this.hasDests(ctx);\n    }\n    outcome(ctx) {\n        const variantOutcome = this.variantOutcome(ctx);\n        if (variantOutcome)\n            return variantOutcome;\n        ctx = ctx || this.ctx();\n        if (this.isCheckmate(ctx))\n            return { winner: (0,_util_js__WEBPACK_IMPORTED_MODULE_1__.opposite)(this.turn) };\n        else if (this.isInsufficientMaterial() || this.isStalemate(ctx))\n            return { winner: undefined };\n        else\n            return;\n    }\n    allDests(ctx) {\n        ctx = ctx || this.ctx();\n        const d = new Map();\n        if (ctx.variantEnd)\n            return d;\n        for (const square of this.board[this.turn]) {\n            d.set(square, this.dests(square, ctx));\n        }\n        return d;\n    }\n    play(move) {\n        const turn = this.turn;\n        const epSquare = this.epSquare;\n        const castling = castlingSide(this, move);\n        this.epSquare = undefined;\n        this.halfmoves += 1;\n        if (turn === 'black')\n            this.fullmoves += 1;\n        this.turn = (0,_util_js__WEBPACK_IMPORTED_MODULE_1__.opposite)(turn);\n        if ((0,_types_js__WEBPACK_IMPORTED_MODULE_3__.isDrop)(move)) {\n            this.board.set(move.to, { role: move.role, color: turn });\n            if (this.pockets)\n                this.pockets[turn][move.role]--;\n            if (move.role === 'pawn')\n                this.halfmoves = 0;\n        }\n        else {\n            const piece = this.board.take(move.from);\n            if (!piece)\n                return;\n            let epCapture;\n            if (piece.role === 'pawn') {\n                this.halfmoves = 0;\n                if (move.to === epSquare) {\n                    epCapture = this.board.take(move.to + (turn === 'white' ? -8 : 8));\n                }\n                const delta = move.from - move.to;\n                if (Math.abs(delta) === 16 && 8 <= move.from && move.from <= 55) {\n                    this.epSquare = (move.from + move.to) >> 1;\n                }\n                if (move.promotion) {\n                    piece.role = move.promotion;\n                    piece.promoted = !!this.pockets;\n                }\n            }\n            else if (piece.role === 'rook') {\n                this.castles.discardRook(move.from);\n            }\n            else if (piece.role === 'king') {\n                if (castling) {\n                    const rookFrom = this.castles.rook[turn][castling];\n                    if ((0,_util_js__WEBPACK_IMPORTED_MODULE_1__.defined)(rookFrom)) {\n                        const rook = this.board.take(rookFrom);\n                        this.board.set((0,_util_js__WEBPACK_IMPORTED_MODULE_1__.kingCastlesTo)(turn, castling), piece);\n                        if (rook)\n                            this.board.set((0,_util_js__WEBPACK_IMPORTED_MODULE_1__.rookCastlesTo)(turn, castling), rook);\n                    }\n                }\n                this.castles.discardColor(turn);\n            }\n            if (!castling) {\n                const capture = this.board.set(move.to, piece) || epCapture;\n                if (capture)\n                    this.playCaptureAt(move.to, capture);\n            }\n        }\n        if (this.remainingChecks) {\n            if (this.isCheck())\n                this.remainingChecks[turn] = Math.max(this.remainingChecks[turn] - 1, 0);\n        }\n    }\n}\nclass Chess extends Position {\n    constructor() {\n        super('chess');\n    }\n    static default() {\n        const pos = new this();\n        pos.reset();\n        return pos;\n    }\n    static fromSetup(setup) {\n        const pos = new this();\n        pos.setupUnchecked(setup);\n        return pos.validate().map(_ => pos);\n    }\n    clone() {\n        return super.clone();\n    }\n}\nconst validEpSquare = (pos, square) => {\n    if (!(0,_util_js__WEBPACK_IMPORTED_MODULE_1__.defined)(square))\n        return;\n    const epRank = pos.turn === 'white' ? 5 : 2;\n    const forward = pos.turn === 'white' ? 8 : -8;\n    if ((0,_util_js__WEBPACK_IMPORTED_MODULE_1__.squareRank)(square) !== epRank)\n        return;\n    if (pos.board.occupied.has(square + forward))\n        return;\n    const pawn = square - forward;\n    if (!pos.board.pawn.has(pawn) || !pos.board[(0,_util_js__WEBPACK_IMPORTED_MODULE_1__.opposite)(pos.turn)].has(pawn))\n        return;\n    return square;\n};\nconst legalEpSquare = (pos) => {\n    if (!(0,_util_js__WEBPACK_IMPORTED_MODULE_1__.defined)(pos.epSquare))\n        return;\n    const ctx = pos.ctx();\n    const ourPawns = pos.board.pieces(pos.turn, 'pawn');\n    const candidates = ourPawns.intersect((0,_attacks_js__WEBPACK_IMPORTED_MODULE_0__.pawnAttacks)((0,_util_js__WEBPACK_IMPORTED_MODULE_1__.opposite)(pos.turn), pos.epSquare));\n    for (const candidate of candidates) {\n        if (pos.dests(candidate, ctx).has(pos.epSquare))\n            return pos.epSquare;\n    }\n    return;\n};\nconst canCaptureEp = (pos, pawnFrom, ctx) => {\n    if (!(0,_util_js__WEBPACK_IMPORTED_MODULE_1__.defined)(pos.epSquare))\n        return false;\n    if (!(0,_attacks_js__WEBPACK_IMPORTED_MODULE_0__.pawnAttacks)(pos.turn, pawnFrom).has(pos.epSquare))\n        return false;\n    if (!(0,_util_js__WEBPACK_IMPORTED_MODULE_1__.defined)(ctx.king))\n        return true;\n    const delta = pos.turn === 'white' ? 8 : -8;\n    const captured = pos.epSquare - delta;\n    return pos\n        .kingAttackers(ctx.king, (0,_util_js__WEBPACK_IMPORTED_MODULE_1__.opposite)(pos.turn), pos.board.occupied.toggle(pawnFrom).toggle(captured).with(pos.epSquare))\n        .without(captured)\n        .isEmpty();\n};\nconst castlingDest = (pos, side, ctx) => {\n    if (!(0,_util_js__WEBPACK_IMPORTED_MODULE_1__.defined)(ctx.king) || ctx.checkers.nonEmpty())\n        return _squareSet_js__WEBPACK_IMPORTED_MODULE_2__.SquareSet.empty();\n    const rook = pos.castles.rook[pos.turn][side];\n    if (!(0,_util_js__WEBPACK_IMPORTED_MODULE_1__.defined)(rook))\n        return _squareSet_js__WEBPACK_IMPORTED_MODULE_2__.SquareSet.empty();\n    if (pos.castles.path[pos.turn][side].intersects(pos.board.occupied))\n        return _squareSet_js__WEBPACK_IMPORTED_MODULE_2__.SquareSet.empty();\n    const kingTo = (0,_util_js__WEBPACK_IMPORTED_MODULE_1__.kingCastlesTo)(pos.turn, side);\n    const kingPath = (0,_attacks_js__WEBPACK_IMPORTED_MODULE_0__.between)(ctx.king, kingTo);\n    const occ = pos.board.occupied.without(ctx.king);\n    for (const sq of kingPath) {\n        if (pos.kingAttackers(sq, (0,_util_js__WEBPACK_IMPORTED_MODULE_1__.opposite)(pos.turn), occ).nonEmpty())\n            return _squareSet_js__WEBPACK_IMPORTED_MODULE_2__.SquareSet.empty();\n    }\n    const rookTo = (0,_util_js__WEBPACK_IMPORTED_MODULE_1__.rookCastlesTo)(pos.turn, side);\n    const after = pos.board.occupied.toggle(ctx.king).toggle(rook).toggle(rookTo);\n    if (pos.kingAttackers(kingTo, (0,_util_js__WEBPACK_IMPORTED_MODULE_1__.opposite)(pos.turn), after).nonEmpty())\n        return _squareSet_js__WEBPACK_IMPORTED_MODULE_2__.SquareSet.empty();\n    return _squareSet_js__WEBPACK_IMPORTED_MODULE_2__.SquareSet.fromSquare(rook);\n};\nconst pseudoDests = (pos, square, ctx) => {\n    if (ctx.variantEnd)\n        return _squareSet_js__WEBPACK_IMPORTED_MODULE_2__.SquareSet.empty();\n    const piece = pos.board.get(square);\n    if (!piece || piece.color !== pos.turn)\n        return _squareSet_js__WEBPACK_IMPORTED_MODULE_2__.SquareSet.empty();\n    let pseudo = (0,_attacks_js__WEBPACK_IMPORTED_MODULE_0__.attacks)(piece, square, pos.board.occupied);\n    if (piece.role === 'pawn') {\n        let captureTargets = pos.board[(0,_util_js__WEBPACK_IMPORTED_MODULE_1__.opposite)(pos.turn)];\n        if ((0,_util_js__WEBPACK_IMPORTED_MODULE_1__.defined)(pos.epSquare))\n            captureTargets = captureTargets.with(pos.epSquare);\n        pseudo = pseudo.intersect(captureTargets);\n        const delta = pos.turn === 'white' ? 8 : -8;\n        const step = square + delta;\n        if (0 <= step && step < 64 && !pos.board.occupied.has(step)) {\n            pseudo = pseudo.with(step);\n            const canDoubleStep = pos.turn === 'white' ? square < 16 : square >= 64 - 16;\n            const doubleStep = step + delta;\n            if (canDoubleStep && !pos.board.occupied.has(doubleStep)) {\n                pseudo = pseudo.with(doubleStep);\n            }\n        }\n        return pseudo;\n    }\n    else {\n        pseudo = pseudo.diff(pos.board[pos.turn]);\n    }\n    if (square === ctx.king)\n        return pseudo.union(castlingDest(pos, 'a', ctx)).union(castlingDest(pos, 'h', ctx));\n    else\n        return pseudo;\n};\nconst equalsIgnoreMoves = (left, right) => {\n    var _a, _b;\n    return left.rules === right.rules\n        && (0,_board_js__WEBPACK_IMPORTED_MODULE_4__.boardEquals)(left.board, right.board)\n        && ((right.pockets && ((_a = left.pockets) === null || _a === void 0 ? void 0 : _a.equals(right.pockets))) || (!left.pockets && !right.pockets))\n        && left.turn === right.turn\n        && left.castles.castlingRights.equals(right.castles.castlingRights)\n        && legalEpSquare(left) === legalEpSquare(right)\n        && ((right.remainingChecks && ((_b = left.remainingChecks) === null || _b === void 0 ? void 0 : _b.equals(right.remainingChecks)))\n            || (!left.remainingChecks && !right.remainingChecks));\n};\nconst castlingSide = (pos, move) => {\n    if ((0,_types_js__WEBPACK_IMPORTED_MODULE_3__.isDrop)(move))\n        return;\n    const delta = move.to - move.from;\n    if (Math.abs(delta) !== 2 && !pos.board[pos.turn].has(move.to))\n        return;\n    if (!pos.board.king.has(move.from))\n        return;\n    return delta > 0 ? 'h' : 'a';\n};\nconst normalizeMove = (pos, move) => {\n    const side = castlingSide(pos, move);\n    if (!side)\n        return move;\n    const rookFrom = pos.castles.rook[pos.turn][side];\n    return {\n        from: move.from,\n        to: (0,_util_js__WEBPACK_IMPORTED_MODULE_1__.defined)(rookFrom) ? rookFrom : move.to,\n    };\n};\nconst isStandardMaterialSide = (board, color) => {\n    const promoted = Math.max(board.pieces(color, 'queen').size() - 1, 0)\n        + Math.max(board.pieces(color, 'rook').size() - 2, 0)\n        + Math.max(board.pieces(color, 'knight').size() - 2, 0)\n        + Math.max(board.pieces(color, 'bishop').intersect(_squareSet_js__WEBPACK_IMPORTED_MODULE_2__.SquareSet.lightSquares()).size() - 1, 0)\n        + Math.max(board.pieces(color, 'bishop').intersect(_squareSet_js__WEBPACK_IMPORTED_MODULE_2__.SquareSet.darkSquares()).size() - 1, 0);\n    return board.pieces(color, 'pawn').size() + promoted <= 8;\n};\nconst isStandardMaterial = (pos) => _types_js__WEBPACK_IMPORTED_MODULE_3__.COLORS.every(color => isStandardMaterialSide(pos.board, color));\nconst isImpossibleCheck = (pos) => {\n    const ourKing = pos.board.kingOf(pos.turn);\n    if (!(0,_util_js__WEBPACK_IMPORTED_MODULE_1__.defined)(ourKing))\n        return false;\n    const checkers = pos.kingAttackers(ourKing, (0,_util_js__WEBPACK_IMPORTED_MODULE_1__.opposite)(pos.turn), pos.board.occupied);\n    if (checkers.isEmpty())\n        return false;\n    if ((0,_util_js__WEBPACK_IMPORTED_MODULE_1__.defined)(pos.epSquare)) {\n        // The pushed pawn must be the only checker, or it has uncovered\n        // check by a single sliding piece.\n        const pushedTo = pos.epSquare ^ 8;\n        const pushedFrom = pos.epSquare ^ 24;\n        return (checkers.moreThanOne()\n            || (checkers.first() !== pushedTo\n                && pos\n                    .kingAttackers(ourKing, (0,_util_js__WEBPACK_IMPORTED_MODULE_1__.opposite)(pos.turn), pos.board.occupied.without(pushedTo).with(pushedFrom))\n                    .nonEmpty()));\n    }\n    else if (pos.rules === 'atomic') {\n        // Other king moving away can cause many checks to be given at the same\n        // time. Not checking details, or even that the king is close enough.\n        return false;\n    }\n    else {\n        // Sliding checkers aligned with king.\n        return checkers.size() > 2\n            || (checkers.size() === 2 && (0,_attacks_js__WEBPACK_IMPORTED_MODULE_0__.ray)(checkers.first(), checkers.last()).has(ourKing)) // Sliding checkers aligned with king\n            || checkers.intersect(pos.board.steppers()).moreThanOne();\n    }\n};\n//# sourceMappingURL=chess.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvY2hlc3NvcHMvZGlzdC9lc20vY2hlc3MuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQXdDO0FBQ2lHO0FBQ3pGO0FBQ0w7QUFDa0I7QUFDMkI7QUFDakY7QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDLG9DQUFvQztBQUM5QjtBQUNQO0FBQ0EsbUZBQW1GLHdEQUFXO0FBQzlGO0FBQ0EsV0FBVywwREFBYTtBQUN4QixXQUFXLDBEQUFhO0FBQ3hCLFdBQVcsd0RBQVc7QUFDdEIsV0FBVyx3REFBVyxDQUFDLGtEQUFRO0FBQ3hCO0FBQ1A7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDLG9EQUFTO0FBQzFDO0FBQ0EscUJBQXFCLFlBQVk7QUFDakMscUJBQXFCLGNBQWM7QUFDbkM7QUFDQTtBQUNBLHFCQUFxQixPQUFPLG9EQUFTLGlCQUFpQixvREFBUyxXQUFXO0FBQzFFLHFCQUFxQixPQUFPLG9EQUFTLHdCQUF3QixvREFBUyxpQkFBaUI7QUFDdkY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQyxvREFBUztBQUMxQztBQUNBLHFCQUFxQiw0QkFBNEI7QUFDakQscUJBQXFCLDRCQUE0QjtBQUNqRDtBQUNBO0FBQ0EscUJBQXFCLEdBQUcsb0RBQVMsYUFBYSxvREFBUyxVQUFVO0FBQ2pFLHFCQUFxQixHQUFHLG9EQUFTLGFBQWEsb0RBQVMsVUFBVTtBQUNqRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQiw0Q0FBNEM7QUFDakUscUJBQXFCLDRDQUE0QztBQUNqRTtBQUNBO0FBQ0EscUJBQXFCLDRDQUE0QztBQUNqRSxxQkFBcUIsNENBQTRDO0FBQ2pFO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLHVEQUFhO0FBQ3BDLHVCQUF1Qix1REFBYTtBQUNwQztBQUNBO0FBQ0EsaUNBQWlDLG9EQUFPO0FBQ3hDO0FBQ0EsbUJBQW1CLG9EQUFPO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0Qiw2Q0FBTTtBQUNsQyw2QkFBNkIsb0RBQVM7QUFDdEM7QUFDQSxpQkFBaUIsaURBQU87QUFDeEI7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLGlEQUFPO0FBQ3ZCO0FBQ0E7QUFDQSxnQkFBZ0IsaURBQU87QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0MsNkNBQU07QUFDdEMsbUNBQW1DLHFEQUFjO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdURBQXVELG9EQUFTO0FBQ2hFO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQiw0Q0FBSztBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhCQUE4QixvREFBUztBQUN2QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUIsa0RBQVE7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhLGlEQUFPO0FBQ3BCLHFCQUFxQixnQkFBZ0Isb0RBQVMsb0JBQW9CLG9EQUFTO0FBQzNFO0FBQ0Esd0JBQXdCLHdEQUFXLE9BQU8sb0RBQVM7QUFDbkQ7QUFDQSxtQkFBbUIsMERBQWEsT0FBTyxvREFBUztBQUNoRCxrQ0FBa0Msa0RBQVE7QUFDMUMsdUJBQXVCLG9EQUFTO0FBQ2hDO0FBQ0Esc0JBQXNCLG9EQUFPO0FBQzdCO0FBQ0E7QUFDQTtBQUNBLGtEQUFrRCxrREFBUTtBQUMxRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CLGtEQUFNO0FBQ3pCO0FBQ0EsbUJBQW1CLGtEQUFNO0FBQ3pCLGFBQWEsaURBQU87QUFDcEIsbUJBQW1CLGtEQUFNO0FBQ3pCLDRDQUE0QyxrREFBUTtBQUNwRCxhQUFhLGlEQUFPO0FBQ3BCLG1CQUFtQixrREFBTTtBQUN6QjtBQUNBLG1CQUFtQixrREFBTTtBQUN6QjtBQUNBLFlBQVksb0RBQVM7QUFDckIsbUJBQW1CLGtEQUFNO0FBQ3pCO0FBQ0EsZUFBZSxrREFBTTtBQUNyQjtBQUNBO0FBQ0EsZUFBZSxvREFBUztBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQixvREFBUztBQUM1QjtBQUNBO0FBQ0EsbUJBQW1CLG9EQUFTO0FBQzVCO0FBQ0E7QUFDQSxxQkFBcUIsd0RBQVcseUNBQXlDLGtEQUFRO0FBQ2pGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLGlEQUFPO0FBQ3ZCLHdCQUF3QixvREFBUztBQUNqQztBQUNBO0FBQ0E7QUFDQSxxQkFBcUIsMERBQWE7QUFDbEM7QUFDQSxxQkFBcUIsMERBQWE7QUFDbEM7QUFDQSxxQkFBcUIsd0RBQVc7QUFDaEM7QUFDQSxxQkFBcUIseURBQVk7QUFDakM7QUFDQSxxQkFBcUIsd0RBQVc7QUFDaEM7QUFDQSxZQUFZLGlEQUFPO0FBQ25CO0FBQ0E7QUFDQTtBQUNBLCtDQUErQyxrREFBUTtBQUN2RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUIsaURBQU87QUFDNUIsMkJBQTJCLG9EQUFTO0FBQ3BDLDBDQUEwQyxvREFBTztBQUNqRDtBQUNBO0FBQ0EsMENBQTBDLGdEQUFHO0FBQzdDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEJBQThCLGtEQUFRO0FBQ3RDO0FBQ0E7QUFDQSw0REFBNEQsb0RBQVM7QUFDckUsaURBQWlELG9EQUFTO0FBQzFEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZSw2Q0FBTTtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksaURBQU07QUFDbEI7QUFDQTtBQUNBLHdDQUF3QyxvREFBUztBQUNqRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0VBQXdFLG9EQUFTO0FBQ2pGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZSxpREFBTyxtQ0FBbUMsa0RBQVE7QUFDakU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQixRQUFRLGtEQUFRO0FBQ3JDO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixrREFBUTtBQUM1QixZQUFZLGlEQUFNO0FBQ2xCLHNDQUFzQyw4QkFBOEI7QUFDcEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGlEQUFPO0FBQy9CO0FBQ0EsdUNBQXVDLHVEQUFhO0FBQ3BEO0FBQ0EsMkNBQTJDLHVEQUFhO0FBQ3hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTLGlEQUFPO0FBQ2hCO0FBQ0E7QUFDQTtBQUNBLFFBQVEsb0RBQVU7QUFDbEI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnREFBZ0Qsa0RBQVE7QUFDeEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTLGlEQUFPO0FBQ2hCO0FBQ0E7QUFDQTtBQUNBLDBDQUEwQyx3REFBVyxDQUFDLGtEQUFRO0FBQzlEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUyxpREFBTztBQUNoQjtBQUNBLFNBQVMsd0RBQVc7QUFDcEI7QUFDQSxTQUFTLGlEQUFPO0FBQ2hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDLGtEQUFRO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUyxpREFBTztBQUNoQixlQUFlLG9EQUFTO0FBQ3hCO0FBQ0EsU0FBUyxpREFBTztBQUNoQixlQUFlLG9EQUFTO0FBQ3hCO0FBQ0EsZUFBZSxvREFBUztBQUN4QixtQkFBbUIsdURBQWE7QUFDaEMscUJBQXFCLG9EQUFPO0FBQzVCO0FBQ0E7QUFDQSxrQ0FBa0Msa0RBQVE7QUFDMUMsbUJBQW1CLG9EQUFTO0FBQzVCO0FBQ0EsbUJBQW1CLHVEQUFhO0FBQ2hDO0FBQ0Esa0NBQWtDLGtEQUFRO0FBQzFDLGVBQWUsb0RBQVM7QUFDeEIsV0FBVyxvREFBUztBQUNwQjtBQUNPO0FBQ1A7QUFDQSxlQUFlLG9EQUFTO0FBQ3hCO0FBQ0E7QUFDQSxlQUFlLG9EQUFTO0FBQ3hCLGlCQUFpQixvREFBTztBQUN4QjtBQUNBLHVDQUF1QyxrREFBUTtBQUMvQyxZQUFZLGlEQUFPO0FBQ25CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0EsV0FBVyxzREFBVztBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPO0FBQ1AsUUFBUSxpREFBTTtBQUNkO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksaURBQU87QUFDbkI7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ0EsMkRBQTJELG9EQUFTO0FBQ3BFLDJEQUEyRCxvREFBUztBQUNwRTtBQUNBO0FBQ08sb0NBQW9DLDZDQUFNO0FBQzFDO0FBQ1A7QUFDQSxTQUFTLGlEQUFPO0FBQ2hCO0FBQ0EsZ0RBQWdELGtEQUFRO0FBQ3hEO0FBQ0E7QUFDQSxRQUFRLGlEQUFPO0FBQ2Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0Q0FBNEMsa0RBQVE7QUFDcEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5Q0FBeUMsZ0RBQUc7QUFDNUM7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIi9Vc2Vycy9yYWtzaGl0L3dvcmtzcGFjZS9hcmNoaXZlcy9yZXBvcy9jaGVzcy9ldmFsLWJhci9ub2RlX21vZHVsZXMvY2hlc3NvcHMvZGlzdC9lc20vY2hlc3MuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUmVzdWx0IH0gZnJvbSAnQGJhZHJhcC9yZXN1bHQnO1xuaW1wb3J0IHsgYXR0YWNrcywgYmV0d2VlbiwgYmlzaG9wQXR0YWNrcywga2luZ0F0dGFja3MsIGtuaWdodEF0dGFja3MsIHBhd25BdHRhY2tzLCBxdWVlbkF0dGFja3MsIHJheSwgcm9va0F0dGFja3MsIH0gZnJvbSAnLi9hdHRhY2tzLmpzJztcbmltcG9ydCB7IEJvYXJkLCBib2FyZEVxdWFscyB9IGZyb20gJy4vYm9hcmQuanMnO1xuaW1wb3J0IHsgU3F1YXJlU2V0IH0gZnJvbSAnLi9zcXVhcmVTZXQuanMnO1xuaW1wb3J0IHsgQ0FTVExJTkdfU0lERVMsIENPTE9SUywgaXNEcm9wLCB9IGZyb20gJy4vdHlwZXMuanMnO1xuaW1wb3J0IHsgZGVmaW5lZCwga2luZ0Nhc3RsZXNUbywgb3Bwb3NpdGUsIHJvb2tDYXN0bGVzVG8sIHNxdWFyZVJhbmsgfSBmcm9tICcuL3V0aWwuanMnO1xuZXhwb3J0IHZhciBJbGxlZ2FsU2V0dXA7XG4oZnVuY3Rpb24gKElsbGVnYWxTZXR1cCkge1xuICAgIElsbGVnYWxTZXR1cFtcIkVtcHR5XCJdID0gXCJFUlJfRU1QVFlcIjtcbiAgICBJbGxlZ2FsU2V0dXBbXCJPcHBvc2l0ZUNoZWNrXCJdID0gXCJFUlJfT1BQT1NJVEVfQ0hFQ0tcIjtcbiAgICBJbGxlZ2FsU2V0dXBbXCJQYXduc09uQmFja3JhbmtcIl0gPSBcIkVSUl9QQVdOU19PTl9CQUNLUkFOS1wiO1xuICAgIElsbGVnYWxTZXR1cFtcIktpbmdzXCJdID0gXCJFUlJfS0lOR1NcIjtcbiAgICBJbGxlZ2FsU2V0dXBbXCJWYXJpYW50XCJdID0gXCJFUlJfVkFSSUFOVFwiO1xufSkoSWxsZWdhbFNldHVwIHx8IChJbGxlZ2FsU2V0dXAgPSB7fSkpO1xuZXhwb3J0IGNsYXNzIFBvc2l0aW9uRXJyb3IgZXh0ZW5kcyBFcnJvciB7XG59XG5jb25zdCBhdHRhY2tzVG8gPSAoc3F1YXJlLCBhdHRhY2tlciwgYm9hcmQsIG9jY3VwaWVkKSA9PiBib2FyZFthdHRhY2tlcl0uaW50ZXJzZWN0KHJvb2tBdHRhY2tzKHNxdWFyZSwgb2NjdXBpZWQpXG4gICAgLmludGVyc2VjdChib2FyZC5yb29rc0FuZFF1ZWVucygpKVxuICAgIC51bmlvbihiaXNob3BBdHRhY2tzKHNxdWFyZSwgb2NjdXBpZWQpLmludGVyc2VjdChib2FyZC5iaXNob3BzQW5kUXVlZW5zKCkpKVxuICAgIC51bmlvbihrbmlnaHRBdHRhY2tzKHNxdWFyZSkuaW50ZXJzZWN0KGJvYXJkLmtuaWdodCkpXG4gICAgLnVuaW9uKGtpbmdBdHRhY2tzKHNxdWFyZSkuaW50ZXJzZWN0KGJvYXJkLmtpbmcpKVxuICAgIC51bmlvbihwYXduQXR0YWNrcyhvcHBvc2l0ZShhdHRhY2tlciksIHNxdWFyZSkuaW50ZXJzZWN0KGJvYXJkLnBhd24pKSk7XG5leHBvcnQgY2xhc3MgQ2FzdGxlcyB7XG4gICAgY29uc3RydWN0b3IoKSB7IH1cbiAgICBzdGF0aWMgZGVmYXVsdCgpIHtcbiAgICAgICAgY29uc3QgY2FzdGxlcyA9IG5ldyBDYXN0bGVzKCk7XG4gICAgICAgIGNhc3RsZXMuY2FzdGxpbmdSaWdodHMgPSBTcXVhcmVTZXQuY29ybmVycygpO1xuICAgICAgICBjYXN0bGVzLnJvb2sgPSB7XG4gICAgICAgICAgICB3aGl0ZTogeyBhOiAwLCBoOiA3IH0sXG4gICAgICAgICAgICBibGFjazogeyBhOiA1NiwgaDogNjMgfSxcbiAgICAgICAgfTtcbiAgICAgICAgY2FzdGxlcy5wYXRoID0ge1xuICAgICAgICAgICAgd2hpdGU6IHsgYTogbmV3IFNxdWFyZVNldCgweGUsIDApLCBoOiBuZXcgU3F1YXJlU2V0KDB4NjAsIDApIH0sXG4gICAgICAgICAgICBibGFjazogeyBhOiBuZXcgU3F1YXJlU2V0KDAsIDB4MGUwMDAwMDApLCBoOiBuZXcgU3F1YXJlU2V0KDAsIDB4NjAwMDAwMDApIH0sXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBjYXN0bGVzO1xuICAgIH1cbiAgICBzdGF0aWMgZW1wdHkoKSB7XG4gICAgICAgIGNvbnN0IGNhc3RsZXMgPSBuZXcgQ2FzdGxlcygpO1xuICAgICAgICBjYXN0bGVzLmNhc3RsaW5nUmlnaHRzID0gU3F1YXJlU2V0LmVtcHR5KCk7XG4gICAgICAgIGNhc3RsZXMucm9vayA9IHtcbiAgICAgICAgICAgIHdoaXRlOiB7IGE6IHVuZGVmaW5lZCwgaDogdW5kZWZpbmVkIH0sXG4gICAgICAgICAgICBibGFjazogeyBhOiB1bmRlZmluZWQsIGg6IHVuZGVmaW5lZCB9LFxuICAgICAgICB9O1xuICAgICAgICBjYXN0bGVzLnBhdGggPSB7XG4gICAgICAgICAgICB3aGl0ZTogeyBhOiBTcXVhcmVTZXQuZW1wdHkoKSwgaDogU3F1YXJlU2V0LmVtcHR5KCkgfSxcbiAgICAgICAgICAgIGJsYWNrOiB7IGE6IFNxdWFyZVNldC5lbXB0eSgpLCBoOiBTcXVhcmVTZXQuZW1wdHkoKSB9LFxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gY2FzdGxlcztcbiAgICB9XG4gICAgY2xvbmUoKSB7XG4gICAgICAgIGNvbnN0IGNhc3RsZXMgPSBuZXcgQ2FzdGxlcygpO1xuICAgICAgICBjYXN0bGVzLmNhc3RsaW5nUmlnaHRzID0gdGhpcy5jYXN0bGluZ1JpZ2h0cztcbiAgICAgICAgY2FzdGxlcy5yb29rID0ge1xuICAgICAgICAgICAgd2hpdGU6IHsgYTogdGhpcy5yb29rLndoaXRlLmEsIGg6IHRoaXMucm9vay53aGl0ZS5oIH0sXG4gICAgICAgICAgICBibGFjazogeyBhOiB0aGlzLnJvb2suYmxhY2suYSwgaDogdGhpcy5yb29rLmJsYWNrLmggfSxcbiAgICAgICAgfTtcbiAgICAgICAgY2FzdGxlcy5wYXRoID0ge1xuICAgICAgICAgICAgd2hpdGU6IHsgYTogdGhpcy5wYXRoLndoaXRlLmEsIGg6IHRoaXMucGF0aC53aGl0ZS5oIH0sXG4gICAgICAgICAgICBibGFjazogeyBhOiB0aGlzLnBhdGguYmxhY2suYSwgaDogdGhpcy5wYXRoLmJsYWNrLmggfSxcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIGNhc3RsZXM7XG4gICAgfVxuICAgIGFkZChjb2xvciwgc2lkZSwga2luZywgcm9vaykge1xuICAgICAgICBjb25zdCBraW5nVG8gPSBraW5nQ2FzdGxlc1RvKGNvbG9yLCBzaWRlKTtcbiAgICAgICAgY29uc3Qgcm9va1RvID0gcm9va0Nhc3RsZXNUbyhjb2xvciwgc2lkZSk7XG4gICAgICAgIHRoaXMuY2FzdGxpbmdSaWdodHMgPSB0aGlzLmNhc3RsaW5nUmlnaHRzLndpdGgocm9vayk7XG4gICAgICAgIHRoaXMucm9va1tjb2xvcl1bc2lkZV0gPSByb29rO1xuICAgICAgICB0aGlzLnBhdGhbY29sb3JdW3NpZGVdID0gYmV0d2Vlbihyb29rLCByb29rVG8pXG4gICAgICAgICAgICAud2l0aChyb29rVG8pXG4gICAgICAgICAgICAudW5pb24oYmV0d2VlbihraW5nLCBraW5nVG8pLndpdGgoa2luZ1RvKSlcbiAgICAgICAgICAgIC53aXRob3V0KGtpbmcpXG4gICAgICAgICAgICAud2l0aG91dChyb29rKTtcbiAgICB9XG4gICAgc3RhdGljIGZyb21TZXR1cChzZXR1cCkge1xuICAgICAgICBjb25zdCBjYXN0bGVzID0gQ2FzdGxlcy5lbXB0eSgpO1xuICAgICAgICBjb25zdCByb29rcyA9IHNldHVwLmNhc3RsaW5nUmlnaHRzLmludGVyc2VjdChzZXR1cC5ib2FyZC5yb29rKTtcbiAgICAgICAgZm9yIChjb25zdCBjb2xvciBvZiBDT0xPUlMpIHtcbiAgICAgICAgICAgIGNvbnN0IGJhY2tyYW5rID0gU3F1YXJlU2V0LmJhY2tyYW5rKGNvbG9yKTtcbiAgICAgICAgICAgIGNvbnN0IGtpbmcgPSBzZXR1cC5ib2FyZC5raW5nT2YoY29sb3IpO1xuICAgICAgICAgICAgaWYgKCFkZWZpbmVkKGtpbmcpIHx8ICFiYWNrcmFuay5oYXMoa2luZykpXG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICBjb25zdCBzaWRlID0gcm9va3MuaW50ZXJzZWN0KHNldHVwLmJvYXJkW2NvbG9yXSkuaW50ZXJzZWN0KGJhY2tyYW5rKTtcbiAgICAgICAgICAgIGNvbnN0IGFTaWRlID0gc2lkZS5maXJzdCgpO1xuICAgICAgICAgICAgaWYgKGRlZmluZWQoYVNpZGUpICYmIGFTaWRlIDwga2luZylcbiAgICAgICAgICAgICAgICBjYXN0bGVzLmFkZChjb2xvciwgJ2EnLCBraW5nLCBhU2lkZSk7XG4gICAgICAgICAgICBjb25zdCBoU2lkZSA9IHNpZGUubGFzdCgpO1xuICAgICAgICAgICAgaWYgKGRlZmluZWQoaFNpZGUpICYmIGtpbmcgPCBoU2lkZSlcbiAgICAgICAgICAgICAgICBjYXN0bGVzLmFkZChjb2xvciwgJ2gnLCBraW5nLCBoU2lkZSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNhc3RsZXM7XG4gICAgfVxuICAgIGRpc2NhcmRSb29rKHNxdWFyZSkge1xuICAgICAgICBpZiAodGhpcy5jYXN0bGluZ1JpZ2h0cy5oYXMoc3F1YXJlKSkge1xuICAgICAgICAgICAgdGhpcy5jYXN0bGluZ1JpZ2h0cyA9IHRoaXMuY2FzdGxpbmdSaWdodHMud2l0aG91dChzcXVhcmUpO1xuICAgICAgICAgICAgZm9yIChjb25zdCBjb2xvciBvZiBDT0xPUlMpIHtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHNpZGUgb2YgQ0FTVExJTkdfU0lERVMpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucm9va1tjb2xvcl1bc2lkZV0gPT09IHNxdWFyZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucm9va1tjb2xvcl1bc2lkZV0gPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGRpc2NhcmRDb2xvcihjb2xvcikge1xuICAgICAgICB0aGlzLmNhc3RsaW5nUmlnaHRzID0gdGhpcy5jYXN0bGluZ1JpZ2h0cy5kaWZmKFNxdWFyZVNldC5iYWNrcmFuayhjb2xvcikpO1xuICAgICAgICB0aGlzLnJvb2tbY29sb3JdLmEgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMucm9va1tjb2xvcl0uaCA9IHVuZGVmaW5lZDtcbiAgICB9XG59XG5leHBvcnQgY2xhc3MgUG9zaXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKHJ1bGVzKSB7XG4gICAgICAgIHRoaXMucnVsZXMgPSBydWxlcztcbiAgICB9XG4gICAgcmVzZXQoKSB7XG4gICAgICAgIHRoaXMuYm9hcmQgPSBCb2FyZC5kZWZhdWx0KCk7XG4gICAgICAgIHRoaXMucG9ja2V0cyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy50dXJuID0gJ3doaXRlJztcbiAgICAgICAgdGhpcy5jYXN0bGVzID0gQ2FzdGxlcy5kZWZhdWx0KCk7XG4gICAgICAgIHRoaXMuZXBTcXVhcmUgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMucmVtYWluaW5nQ2hlY2tzID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmhhbGZtb3ZlcyA9IDA7XG4gICAgICAgIHRoaXMuZnVsbG1vdmVzID0gMTtcbiAgICB9XG4gICAgc2V0dXBVbmNoZWNrZWQoc2V0dXApIHtcbiAgICAgICAgdGhpcy5ib2FyZCA9IHNldHVwLmJvYXJkLmNsb25lKCk7XG4gICAgICAgIHRoaXMuYm9hcmQucHJvbW90ZWQgPSBTcXVhcmVTZXQuZW1wdHkoKTtcbiAgICAgICAgdGhpcy5wb2NrZXRzID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnR1cm4gPSBzZXR1cC50dXJuO1xuICAgICAgICB0aGlzLmNhc3RsZXMgPSBDYXN0bGVzLmZyb21TZXR1cChzZXR1cCk7XG4gICAgICAgIHRoaXMuZXBTcXVhcmUgPSB2YWxpZEVwU3F1YXJlKHRoaXMsIHNldHVwLmVwU3F1YXJlKTtcbiAgICAgICAgdGhpcy5yZW1haW5pbmdDaGVja3MgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuaGFsZm1vdmVzID0gc2V0dXAuaGFsZm1vdmVzO1xuICAgICAgICB0aGlzLmZ1bGxtb3ZlcyA9IHNldHVwLmZ1bGxtb3ZlcztcbiAgICB9XG4gICAgLy8gV2hlbiBzdWJjbGFzc2luZyBvdmVyd3JpdGUgYXQgbGVhc3Q6XG4gICAgLy9cbiAgICAvLyAtIHN0YXRpYyBkZWZhdWx0KClcbiAgICAvLyAtIHN0YXRpYyBmcm9tU2V0dXAoKVxuICAgIC8vIC0gc3RhdGljIGNsb25lKClcbiAgICAvL1xuICAgIC8vIC0gZGVzdHMoKVxuICAgIC8vIC0gaXNWYXJpYW50RW5kKClcbiAgICAvLyAtIHZhcmlhbnRPdXRjb21lKClcbiAgICAvLyAtIGhhc0luc3VmZmljaWVudE1hdGVyaWFsKClcbiAgICAvLyAtIGlzU3RhbmRhcmRNYXRlcmlhbCgpXG4gICAga2luZ0F0dGFja2VycyhzcXVhcmUsIGF0dGFja2VyLCBvY2N1cGllZCkge1xuICAgICAgICByZXR1cm4gYXR0YWNrc1RvKHNxdWFyZSwgYXR0YWNrZXIsIHRoaXMuYm9hcmQsIG9jY3VwaWVkKTtcbiAgICB9XG4gICAgcGxheUNhcHR1cmVBdChzcXVhcmUsIGNhcHR1cmVkKSB7XG4gICAgICAgIHRoaXMuaGFsZm1vdmVzID0gMDtcbiAgICAgICAgaWYgKGNhcHR1cmVkLnJvbGUgPT09ICdyb29rJylcbiAgICAgICAgICAgIHRoaXMuY2FzdGxlcy5kaXNjYXJkUm9vayhzcXVhcmUpO1xuICAgICAgICBpZiAodGhpcy5wb2NrZXRzKVxuICAgICAgICAgICAgdGhpcy5wb2NrZXRzW29wcG9zaXRlKGNhcHR1cmVkLmNvbG9yKV1bY2FwdHVyZWQucHJvbW90ZWQgPyAncGF3bicgOiBjYXB0dXJlZC5yb2xlXSsrO1xuICAgIH1cbiAgICBjdHgoKSB7XG4gICAgICAgIGNvbnN0IHZhcmlhbnRFbmQgPSB0aGlzLmlzVmFyaWFudEVuZCgpO1xuICAgICAgICBjb25zdCBraW5nID0gdGhpcy5ib2FyZC5raW5nT2YodGhpcy50dXJuKTtcbiAgICAgICAgaWYgKCFkZWZpbmVkKGtpbmcpKSB7XG4gICAgICAgICAgICByZXR1cm4geyBraW5nLCBibG9ja2VyczogU3F1YXJlU2V0LmVtcHR5KCksIGNoZWNrZXJzOiBTcXVhcmVTZXQuZW1wdHkoKSwgdmFyaWFudEVuZCwgbXVzdENhcHR1cmU6IGZhbHNlIH07XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgc25pcGVycyA9IHJvb2tBdHRhY2tzKGtpbmcsIFNxdWFyZVNldC5lbXB0eSgpKVxuICAgICAgICAgICAgLmludGVyc2VjdCh0aGlzLmJvYXJkLnJvb2tzQW5kUXVlZW5zKCkpXG4gICAgICAgICAgICAudW5pb24oYmlzaG9wQXR0YWNrcyhraW5nLCBTcXVhcmVTZXQuZW1wdHkoKSkuaW50ZXJzZWN0KHRoaXMuYm9hcmQuYmlzaG9wc0FuZFF1ZWVucygpKSlcbiAgICAgICAgICAgIC5pbnRlcnNlY3QodGhpcy5ib2FyZFtvcHBvc2l0ZSh0aGlzLnR1cm4pXSk7XG4gICAgICAgIGxldCBibG9ja2VycyA9IFNxdWFyZVNldC5lbXB0eSgpO1xuICAgICAgICBmb3IgKGNvbnN0IHNuaXBlciBvZiBzbmlwZXJzKSB7XG4gICAgICAgICAgICBjb25zdCBiID0gYmV0d2VlbihraW5nLCBzbmlwZXIpLmludGVyc2VjdCh0aGlzLmJvYXJkLm9jY3VwaWVkKTtcbiAgICAgICAgICAgIGlmICghYi5tb3JlVGhhbk9uZSgpKVxuICAgICAgICAgICAgICAgIGJsb2NrZXJzID0gYmxvY2tlcnMudW5pb24oYik7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY2hlY2tlcnMgPSB0aGlzLmtpbmdBdHRhY2tlcnMoa2luZywgb3Bwb3NpdGUodGhpcy50dXJuKSwgdGhpcy5ib2FyZC5vY2N1cGllZCk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBraW5nLFxuICAgICAgICAgICAgYmxvY2tlcnMsXG4gICAgICAgICAgICBjaGVja2VycyxcbiAgICAgICAgICAgIHZhcmlhbnRFbmQsXG4gICAgICAgICAgICBtdXN0Q2FwdHVyZTogZmFsc2UsXG4gICAgICAgIH07XG4gICAgfVxuICAgIGNsb25lKCkge1xuICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICBjb25zdCBwb3MgPSBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpO1xuICAgICAgICBwb3MuYm9hcmQgPSB0aGlzLmJvYXJkLmNsb25lKCk7XG4gICAgICAgIHBvcy5wb2NrZXRzID0gKF9hID0gdGhpcy5wb2NrZXRzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuY2xvbmUoKTtcbiAgICAgICAgcG9zLnR1cm4gPSB0aGlzLnR1cm47XG4gICAgICAgIHBvcy5jYXN0bGVzID0gdGhpcy5jYXN0bGVzLmNsb25lKCk7XG4gICAgICAgIHBvcy5lcFNxdWFyZSA9IHRoaXMuZXBTcXVhcmU7XG4gICAgICAgIHBvcy5yZW1haW5pbmdDaGVja3MgPSAoX2IgPSB0aGlzLnJlbWFpbmluZ0NoZWNrcykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmNsb25lKCk7XG4gICAgICAgIHBvcy5oYWxmbW92ZXMgPSB0aGlzLmhhbGZtb3ZlcztcbiAgICAgICAgcG9zLmZ1bGxtb3ZlcyA9IHRoaXMuZnVsbG1vdmVzO1xuICAgICAgICByZXR1cm4gcG9zO1xuICAgIH1cbiAgICB2YWxpZGF0ZSgpIHtcbiAgICAgICAgaWYgKHRoaXMuYm9hcmQub2NjdXBpZWQuaXNFbXB0eSgpKVxuICAgICAgICAgICAgcmV0dXJuIFJlc3VsdC5lcnIobmV3IFBvc2l0aW9uRXJyb3IoSWxsZWdhbFNldHVwLkVtcHR5KSk7XG4gICAgICAgIGlmICh0aGlzLmJvYXJkLmtpbmcuc2l6ZSgpICE9PSAyKVxuICAgICAgICAgICAgcmV0dXJuIFJlc3VsdC5lcnIobmV3IFBvc2l0aW9uRXJyb3IoSWxsZWdhbFNldHVwLktpbmdzKSk7XG4gICAgICAgIGlmICghZGVmaW5lZCh0aGlzLmJvYXJkLmtpbmdPZih0aGlzLnR1cm4pKSlcbiAgICAgICAgICAgIHJldHVybiBSZXN1bHQuZXJyKG5ldyBQb3NpdGlvbkVycm9yKElsbGVnYWxTZXR1cC5LaW5ncykpO1xuICAgICAgICBjb25zdCBvdGhlcktpbmcgPSB0aGlzLmJvYXJkLmtpbmdPZihvcHBvc2l0ZSh0aGlzLnR1cm4pKTtcbiAgICAgICAgaWYgKCFkZWZpbmVkKG90aGVyS2luZykpXG4gICAgICAgICAgICByZXR1cm4gUmVzdWx0LmVycihuZXcgUG9zaXRpb25FcnJvcihJbGxlZ2FsU2V0dXAuS2luZ3MpKTtcbiAgICAgICAgaWYgKHRoaXMua2luZ0F0dGFja2VycyhvdGhlcktpbmcsIHRoaXMudHVybiwgdGhpcy5ib2FyZC5vY2N1cGllZCkubm9uRW1wdHkoKSkge1xuICAgICAgICAgICAgcmV0dXJuIFJlc3VsdC5lcnIobmV3IFBvc2l0aW9uRXJyb3IoSWxsZWdhbFNldHVwLk9wcG9zaXRlQ2hlY2spKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoU3F1YXJlU2V0LmJhY2tyYW5rcygpLmludGVyc2VjdHModGhpcy5ib2FyZC5wYXduKSkge1xuICAgICAgICAgICAgcmV0dXJuIFJlc3VsdC5lcnIobmV3IFBvc2l0aW9uRXJyb3IoSWxsZWdhbFNldHVwLlBhd25zT25CYWNrcmFuaykpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBSZXN1bHQub2sodW5kZWZpbmVkKTtcbiAgICB9XG4gICAgZHJvcERlc3RzKF9jdHgpIHtcbiAgICAgICAgcmV0dXJuIFNxdWFyZVNldC5lbXB0eSgpO1xuICAgIH1cbiAgICBkZXN0cyhzcXVhcmUsIGN0eCkge1xuICAgICAgICBjdHggPSBjdHggfHwgdGhpcy5jdHgoKTtcbiAgICAgICAgaWYgKGN0eC52YXJpYW50RW5kKVxuICAgICAgICAgICAgcmV0dXJuIFNxdWFyZVNldC5lbXB0eSgpO1xuICAgICAgICBjb25zdCBwaWVjZSA9IHRoaXMuYm9hcmQuZ2V0KHNxdWFyZSk7XG4gICAgICAgIGlmICghcGllY2UgfHwgcGllY2UuY29sb3IgIT09IHRoaXMudHVybilcbiAgICAgICAgICAgIHJldHVybiBTcXVhcmVTZXQuZW1wdHkoKTtcbiAgICAgICAgbGV0IHBzZXVkbywgbGVnYWw7XG4gICAgICAgIGlmIChwaWVjZS5yb2xlID09PSAncGF3bicpIHtcbiAgICAgICAgICAgIHBzZXVkbyA9IHBhd25BdHRhY2tzKHRoaXMudHVybiwgc3F1YXJlKS5pbnRlcnNlY3QodGhpcy5ib2FyZFtvcHBvc2l0ZSh0aGlzLnR1cm4pXSk7XG4gICAgICAgICAgICBjb25zdCBkZWx0YSA9IHRoaXMudHVybiA9PT0gJ3doaXRlJyA/IDggOiAtODtcbiAgICAgICAgICAgIGNvbnN0IHN0ZXAgPSBzcXVhcmUgKyBkZWx0YTtcbiAgICAgICAgICAgIGlmICgwIDw9IHN0ZXAgJiYgc3RlcCA8IDY0ICYmICF0aGlzLmJvYXJkLm9jY3VwaWVkLmhhcyhzdGVwKSkge1xuICAgICAgICAgICAgICAgIHBzZXVkbyA9IHBzZXVkby53aXRoKHN0ZXApO1xuICAgICAgICAgICAgICAgIGNvbnN0IGNhbkRvdWJsZVN0ZXAgPSB0aGlzLnR1cm4gPT09ICd3aGl0ZScgPyBzcXVhcmUgPCAxNiA6IHNxdWFyZSA+PSA2NCAtIDE2O1xuICAgICAgICAgICAgICAgIGNvbnN0IGRvdWJsZVN0ZXAgPSBzdGVwICsgZGVsdGE7XG4gICAgICAgICAgICAgICAgaWYgKGNhbkRvdWJsZVN0ZXAgJiYgIXRoaXMuYm9hcmQub2NjdXBpZWQuaGFzKGRvdWJsZVN0ZXApKSB7XG4gICAgICAgICAgICAgICAgICAgIHBzZXVkbyA9IHBzZXVkby53aXRoKGRvdWJsZVN0ZXApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChkZWZpbmVkKHRoaXMuZXBTcXVhcmUpICYmIGNhbkNhcHR1cmVFcCh0aGlzLCBzcXVhcmUsIGN0eCkpIHtcbiAgICAgICAgICAgICAgICBsZWdhbCA9IFNxdWFyZVNldC5mcm9tU3F1YXJlKHRoaXMuZXBTcXVhcmUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHBpZWNlLnJvbGUgPT09ICdiaXNob3AnKVxuICAgICAgICAgICAgcHNldWRvID0gYmlzaG9wQXR0YWNrcyhzcXVhcmUsIHRoaXMuYm9hcmQub2NjdXBpZWQpO1xuICAgICAgICBlbHNlIGlmIChwaWVjZS5yb2xlID09PSAna25pZ2h0JylcbiAgICAgICAgICAgIHBzZXVkbyA9IGtuaWdodEF0dGFja3Moc3F1YXJlKTtcbiAgICAgICAgZWxzZSBpZiAocGllY2Uucm9sZSA9PT0gJ3Jvb2snKVxuICAgICAgICAgICAgcHNldWRvID0gcm9va0F0dGFja3Moc3F1YXJlLCB0aGlzLmJvYXJkLm9jY3VwaWVkKTtcbiAgICAgICAgZWxzZSBpZiAocGllY2Uucm9sZSA9PT0gJ3F1ZWVuJylcbiAgICAgICAgICAgIHBzZXVkbyA9IHF1ZWVuQXR0YWNrcyhzcXVhcmUsIHRoaXMuYm9hcmQub2NjdXBpZWQpO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICBwc2V1ZG8gPSBraW5nQXR0YWNrcyhzcXVhcmUpO1xuICAgICAgICBwc2V1ZG8gPSBwc2V1ZG8uZGlmZih0aGlzLmJvYXJkW3RoaXMudHVybl0pO1xuICAgICAgICBpZiAoZGVmaW5lZChjdHgua2luZykpIHtcbiAgICAgICAgICAgIGlmIChwaWVjZS5yb2xlID09PSAna2luZycpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBvY2MgPSB0aGlzLmJvYXJkLm9jY3VwaWVkLndpdGhvdXQoc3F1YXJlKTtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHRvIG9mIHBzZXVkbykge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5raW5nQXR0YWNrZXJzKHRvLCBvcHBvc2l0ZSh0aGlzLnR1cm4pLCBvY2MpLm5vbkVtcHR5KCkpXG4gICAgICAgICAgICAgICAgICAgICAgICBwc2V1ZG8gPSBwc2V1ZG8ud2l0aG91dCh0byk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBwc2V1ZG8udW5pb24oY2FzdGxpbmdEZXN0KHRoaXMsICdhJywgY3R4KSkudW5pb24oY2FzdGxpbmdEZXN0KHRoaXMsICdoJywgY3R4KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoY3R4LmNoZWNrZXJzLm5vbkVtcHR5KCkpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBjaGVja2VyID0gY3R4LmNoZWNrZXJzLnNpbmdsZVNxdWFyZSgpO1xuICAgICAgICAgICAgICAgIGlmICghZGVmaW5lZChjaGVja2VyKSlcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFNxdWFyZVNldC5lbXB0eSgpO1xuICAgICAgICAgICAgICAgIHBzZXVkbyA9IHBzZXVkby5pbnRlcnNlY3QoYmV0d2VlbihjaGVja2VyLCBjdHgua2luZykud2l0aChjaGVja2VyKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoY3R4LmJsb2NrZXJzLmhhcyhzcXVhcmUpKVxuICAgICAgICAgICAgICAgIHBzZXVkbyA9IHBzZXVkby5pbnRlcnNlY3QocmF5KHNxdWFyZSwgY3R4LmtpbmcpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobGVnYWwpXG4gICAgICAgICAgICBwc2V1ZG8gPSBwc2V1ZG8udW5pb24obGVnYWwpO1xuICAgICAgICByZXR1cm4gcHNldWRvO1xuICAgIH1cbiAgICBpc1ZhcmlhbnRFbmQoKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgdmFyaWFudE91dGNvbWUoX2N0eCkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGhhc0luc3VmZmljaWVudE1hdGVyaWFsKGNvbG9yKSB7XG4gICAgICAgIGlmICh0aGlzLmJvYXJkW2NvbG9yXS5pbnRlcnNlY3QodGhpcy5ib2FyZC5wYXduLnVuaW9uKHRoaXMuYm9hcmQucm9va3NBbmRRdWVlbnMoKSkpLm5vbkVtcHR5KCkpXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIGlmICh0aGlzLmJvYXJkW2NvbG9yXS5pbnRlcnNlY3RzKHRoaXMuYm9hcmQua25pZ2h0KSkge1xuICAgICAgICAgICAgcmV0dXJuICh0aGlzLmJvYXJkW2NvbG9yXS5zaXplKCkgPD0gMlxuICAgICAgICAgICAgICAgICYmIHRoaXMuYm9hcmRbb3Bwb3NpdGUoY29sb3IpXS5kaWZmKHRoaXMuYm9hcmQua2luZykuZGlmZih0aGlzLmJvYXJkLnF1ZWVuKS5pc0VtcHR5KCkpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmJvYXJkW2NvbG9yXS5pbnRlcnNlY3RzKHRoaXMuYm9hcmQuYmlzaG9wKSkge1xuICAgICAgICAgICAgY29uc3Qgc2FtZUNvbG9yID0gIXRoaXMuYm9hcmQuYmlzaG9wLmludGVyc2VjdHMoU3F1YXJlU2V0LmRhcmtTcXVhcmVzKCkpXG4gICAgICAgICAgICAgICAgfHwgIXRoaXMuYm9hcmQuYmlzaG9wLmludGVyc2VjdHMoU3F1YXJlU2V0LmxpZ2h0U3F1YXJlcygpKTtcbiAgICAgICAgICAgIHJldHVybiBzYW1lQ29sb3IgJiYgdGhpcy5ib2FyZC5wYXduLmlzRW1wdHkoKSAmJiB0aGlzLmJvYXJkLmtuaWdodC5pc0VtcHR5KCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIC8vIFRoZSBmb2xsb3dpbmcgc2hvdWxkIGJlIGlkZW50aWNhbCBpbiBhbGwgc3ViY2xhc3Nlc1xuICAgIHRvU2V0dXAoKSB7XG4gICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBib2FyZDogdGhpcy5ib2FyZC5jbG9uZSgpLFxuICAgICAgICAgICAgcG9ja2V0czogKF9hID0gdGhpcy5wb2NrZXRzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuY2xvbmUoKSxcbiAgICAgICAgICAgIHR1cm46IHRoaXMudHVybixcbiAgICAgICAgICAgIGNhc3RsaW5nUmlnaHRzOiB0aGlzLmNhc3RsZXMuY2FzdGxpbmdSaWdodHMsXG4gICAgICAgICAgICBlcFNxdWFyZTogbGVnYWxFcFNxdWFyZSh0aGlzKSxcbiAgICAgICAgICAgIHJlbWFpbmluZ0NoZWNrczogKF9iID0gdGhpcy5yZW1haW5pbmdDaGVja3MpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5jbG9uZSgpLFxuICAgICAgICAgICAgaGFsZm1vdmVzOiBNYXRoLm1pbih0aGlzLmhhbGZtb3ZlcywgMTUwKSxcbiAgICAgICAgICAgIGZ1bGxtb3ZlczogTWF0aC5taW4oTWF0aC5tYXgodGhpcy5mdWxsbW92ZXMsIDEpLCA5OTk5KSxcbiAgICAgICAgfTtcbiAgICB9XG4gICAgaXNJbnN1ZmZpY2llbnRNYXRlcmlhbCgpIHtcbiAgICAgICAgcmV0dXJuIENPTE9SUy5ldmVyeShjb2xvciA9PiB0aGlzLmhhc0luc3VmZmljaWVudE1hdGVyaWFsKGNvbG9yKSk7XG4gICAgfVxuICAgIGhhc0Rlc3RzKGN0eCkge1xuICAgICAgICBjdHggPSBjdHggfHwgdGhpcy5jdHgoKTtcbiAgICAgICAgZm9yIChjb25zdCBzcXVhcmUgb2YgdGhpcy5ib2FyZFt0aGlzLnR1cm5dKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5kZXN0cyhzcXVhcmUsIGN0eCkubm9uRW1wdHkoKSlcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5kcm9wRGVzdHMoY3R4KS5ub25FbXB0eSgpO1xuICAgIH1cbiAgICBpc0xlZ2FsKG1vdmUsIGN0eCkge1xuICAgICAgICBpZiAoaXNEcm9wKG1vdmUpKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMucG9ja2V0cyB8fCB0aGlzLnBvY2tldHNbdGhpcy50dXJuXVttb3ZlLnJvbGVdIDw9IDApXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgaWYgKG1vdmUucm9sZSA9PT0gJ3Bhd24nICYmIFNxdWFyZVNldC5iYWNrcmFua3MoKS5oYXMobW92ZS50bykpXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZHJvcERlc3RzKGN0eCkuaGFzKG1vdmUudG8pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYgKG1vdmUucHJvbW90aW9uID09PSAncGF3bicpXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgaWYgKG1vdmUucHJvbW90aW9uID09PSAna2luZycgJiYgdGhpcy5ydWxlcyAhPT0gJ2FudGljaGVzcycpXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgaWYgKCEhbW92ZS5wcm9tb3Rpb24gIT09ICh0aGlzLmJvYXJkLnBhd24uaGFzKG1vdmUuZnJvbSkgJiYgU3F1YXJlU2V0LmJhY2tyYW5rcygpLmhhcyhtb3ZlLnRvKSkpXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgY29uc3QgZGVzdHMgPSB0aGlzLmRlc3RzKG1vdmUuZnJvbSwgY3R4KTtcbiAgICAgICAgICAgIHJldHVybiBkZXN0cy5oYXMobW92ZS50bykgfHwgZGVzdHMuaGFzKG5vcm1hbGl6ZU1vdmUodGhpcywgbW92ZSkudG8pO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlzQ2hlY2soKSB7XG4gICAgICAgIGNvbnN0IGtpbmcgPSB0aGlzLmJvYXJkLmtpbmdPZih0aGlzLnR1cm4pO1xuICAgICAgICByZXR1cm4gZGVmaW5lZChraW5nKSAmJiB0aGlzLmtpbmdBdHRhY2tlcnMoa2luZywgb3Bwb3NpdGUodGhpcy50dXJuKSwgdGhpcy5ib2FyZC5vY2N1cGllZCkubm9uRW1wdHkoKTtcbiAgICB9XG4gICAgaXNFbmQoY3R4KSB7XG4gICAgICAgIGlmIChjdHggPyBjdHgudmFyaWFudEVuZCA6IHRoaXMuaXNWYXJpYW50RW5kKCkpXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgcmV0dXJuIHRoaXMuaXNJbnN1ZmZpY2llbnRNYXRlcmlhbCgpIHx8ICF0aGlzLmhhc0Rlc3RzKGN0eCk7XG4gICAgfVxuICAgIGlzQ2hlY2ttYXRlKGN0eCkge1xuICAgICAgICBjdHggPSBjdHggfHwgdGhpcy5jdHgoKTtcbiAgICAgICAgcmV0dXJuICFjdHgudmFyaWFudEVuZCAmJiBjdHguY2hlY2tlcnMubm9uRW1wdHkoKSAmJiAhdGhpcy5oYXNEZXN0cyhjdHgpO1xuICAgIH1cbiAgICBpc1N0YWxlbWF0ZShjdHgpIHtcbiAgICAgICAgY3R4ID0gY3R4IHx8IHRoaXMuY3R4KCk7XG4gICAgICAgIHJldHVybiAhY3R4LnZhcmlhbnRFbmQgJiYgY3R4LmNoZWNrZXJzLmlzRW1wdHkoKSAmJiAhdGhpcy5oYXNEZXN0cyhjdHgpO1xuICAgIH1cbiAgICBvdXRjb21lKGN0eCkge1xuICAgICAgICBjb25zdCB2YXJpYW50T3V0Y29tZSA9IHRoaXMudmFyaWFudE91dGNvbWUoY3R4KTtcbiAgICAgICAgaWYgKHZhcmlhbnRPdXRjb21lKVxuICAgICAgICAgICAgcmV0dXJuIHZhcmlhbnRPdXRjb21lO1xuICAgICAgICBjdHggPSBjdHggfHwgdGhpcy5jdHgoKTtcbiAgICAgICAgaWYgKHRoaXMuaXNDaGVja21hdGUoY3R4KSlcbiAgICAgICAgICAgIHJldHVybiB7IHdpbm5lcjogb3Bwb3NpdGUodGhpcy50dXJuKSB9O1xuICAgICAgICBlbHNlIGlmICh0aGlzLmlzSW5zdWZmaWNpZW50TWF0ZXJpYWwoKSB8fCB0aGlzLmlzU3RhbGVtYXRlKGN0eCkpXG4gICAgICAgICAgICByZXR1cm4geyB3aW5uZXI6IHVuZGVmaW5lZCB9O1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGFsbERlc3RzKGN0eCkge1xuICAgICAgICBjdHggPSBjdHggfHwgdGhpcy5jdHgoKTtcbiAgICAgICAgY29uc3QgZCA9IG5ldyBNYXAoKTtcbiAgICAgICAgaWYgKGN0eC52YXJpYW50RW5kKVxuICAgICAgICAgICAgcmV0dXJuIGQ7XG4gICAgICAgIGZvciAoY29uc3Qgc3F1YXJlIG9mIHRoaXMuYm9hcmRbdGhpcy50dXJuXSkge1xuICAgICAgICAgICAgZC5zZXQoc3F1YXJlLCB0aGlzLmRlc3RzKHNxdWFyZSwgY3R4KSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGQ7XG4gICAgfVxuICAgIHBsYXkobW92ZSkge1xuICAgICAgICBjb25zdCB0dXJuID0gdGhpcy50dXJuO1xuICAgICAgICBjb25zdCBlcFNxdWFyZSA9IHRoaXMuZXBTcXVhcmU7XG4gICAgICAgIGNvbnN0IGNhc3RsaW5nID0gY2FzdGxpbmdTaWRlKHRoaXMsIG1vdmUpO1xuICAgICAgICB0aGlzLmVwU3F1YXJlID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmhhbGZtb3ZlcyArPSAxO1xuICAgICAgICBpZiAodHVybiA9PT0gJ2JsYWNrJylcbiAgICAgICAgICAgIHRoaXMuZnVsbG1vdmVzICs9IDE7XG4gICAgICAgIHRoaXMudHVybiA9IG9wcG9zaXRlKHR1cm4pO1xuICAgICAgICBpZiAoaXNEcm9wKG1vdmUpKSB7XG4gICAgICAgICAgICB0aGlzLmJvYXJkLnNldChtb3ZlLnRvLCB7IHJvbGU6IG1vdmUucm9sZSwgY29sb3I6IHR1cm4gfSk7XG4gICAgICAgICAgICBpZiAodGhpcy5wb2NrZXRzKVxuICAgICAgICAgICAgICAgIHRoaXMucG9ja2V0c1t0dXJuXVttb3ZlLnJvbGVdLS07XG4gICAgICAgICAgICBpZiAobW92ZS5yb2xlID09PSAncGF3bicpXG4gICAgICAgICAgICAgICAgdGhpcy5oYWxmbW92ZXMgPSAwO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgcGllY2UgPSB0aGlzLmJvYXJkLnRha2UobW92ZS5mcm9tKTtcbiAgICAgICAgICAgIGlmICghcGllY2UpXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgbGV0IGVwQ2FwdHVyZTtcbiAgICAgICAgICAgIGlmIChwaWVjZS5yb2xlID09PSAncGF3bicpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmhhbGZtb3ZlcyA9IDA7XG4gICAgICAgICAgICAgICAgaWYgKG1vdmUudG8gPT09IGVwU3F1YXJlKSB7XG4gICAgICAgICAgICAgICAgICAgIGVwQ2FwdHVyZSA9IHRoaXMuYm9hcmQudGFrZShtb3ZlLnRvICsgKHR1cm4gPT09ICd3aGl0ZScgPyAtOCA6IDgpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uc3QgZGVsdGEgPSBtb3ZlLmZyb20gLSBtb3ZlLnRvO1xuICAgICAgICAgICAgICAgIGlmIChNYXRoLmFicyhkZWx0YSkgPT09IDE2ICYmIDggPD0gbW92ZS5mcm9tICYmIG1vdmUuZnJvbSA8PSA1NSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmVwU3F1YXJlID0gKG1vdmUuZnJvbSArIG1vdmUudG8pID4+IDE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChtb3ZlLnByb21vdGlvbikge1xuICAgICAgICAgICAgICAgICAgICBwaWVjZS5yb2xlID0gbW92ZS5wcm9tb3Rpb247XG4gICAgICAgICAgICAgICAgICAgIHBpZWNlLnByb21vdGVkID0gISF0aGlzLnBvY2tldHM7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAocGllY2Uucm9sZSA9PT0gJ3Jvb2snKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jYXN0bGVzLmRpc2NhcmRSb29rKG1vdmUuZnJvbSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChwaWVjZS5yb2xlID09PSAna2luZycpIHtcbiAgICAgICAgICAgICAgICBpZiAoY2FzdGxpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgcm9va0Zyb20gPSB0aGlzLmNhc3RsZXMucm9va1t0dXJuXVtjYXN0bGluZ107XG4gICAgICAgICAgICAgICAgICAgIGlmIChkZWZpbmVkKHJvb2tGcm9tKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgcm9vayA9IHRoaXMuYm9hcmQudGFrZShyb29rRnJvbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmJvYXJkLnNldChraW5nQ2FzdGxlc1RvKHR1cm4sIGNhc3RsaW5nKSwgcGllY2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJvb2spXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5ib2FyZC5zZXQocm9va0Nhc3RsZXNUbyh0dXJuLCBjYXN0bGluZyksIHJvb2spO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuY2FzdGxlcy5kaXNjYXJkQ29sb3IodHVybik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIWNhc3RsaW5nKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgY2FwdHVyZSA9IHRoaXMuYm9hcmQuc2V0KG1vdmUudG8sIHBpZWNlKSB8fCBlcENhcHR1cmU7XG4gICAgICAgICAgICAgICAgaWYgKGNhcHR1cmUpXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGxheUNhcHR1cmVBdChtb3ZlLnRvLCBjYXB0dXJlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5yZW1haW5pbmdDaGVja3MpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzQ2hlY2soKSlcbiAgICAgICAgICAgICAgICB0aGlzLnJlbWFpbmluZ0NoZWNrc1t0dXJuXSA9IE1hdGgubWF4KHRoaXMucmVtYWluaW5nQ2hlY2tzW3R1cm5dIC0gMSwgMCk7XG4gICAgICAgIH1cbiAgICB9XG59XG5leHBvcnQgY2xhc3MgQ2hlc3MgZXh0ZW5kcyBQb3NpdGlvbiB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKCdjaGVzcycpO1xuICAgIH1cbiAgICBzdGF0aWMgZGVmYXVsdCgpIHtcbiAgICAgICAgY29uc3QgcG9zID0gbmV3IHRoaXMoKTtcbiAgICAgICAgcG9zLnJlc2V0KCk7XG4gICAgICAgIHJldHVybiBwb3M7XG4gICAgfVxuICAgIHN0YXRpYyBmcm9tU2V0dXAoc2V0dXApIHtcbiAgICAgICAgY29uc3QgcG9zID0gbmV3IHRoaXMoKTtcbiAgICAgICAgcG9zLnNldHVwVW5jaGVja2VkKHNldHVwKTtcbiAgICAgICAgcmV0dXJuIHBvcy52YWxpZGF0ZSgpLm1hcChfID0+IHBvcyk7XG4gICAgfVxuICAgIGNsb25lKCkge1xuICAgICAgICByZXR1cm4gc3VwZXIuY2xvbmUoKTtcbiAgICB9XG59XG5jb25zdCB2YWxpZEVwU3F1YXJlID0gKHBvcywgc3F1YXJlKSA9PiB7XG4gICAgaWYgKCFkZWZpbmVkKHNxdWFyZSkpXG4gICAgICAgIHJldHVybjtcbiAgICBjb25zdCBlcFJhbmsgPSBwb3MudHVybiA9PT0gJ3doaXRlJyA/IDUgOiAyO1xuICAgIGNvbnN0IGZvcndhcmQgPSBwb3MudHVybiA9PT0gJ3doaXRlJyA/IDggOiAtODtcbiAgICBpZiAoc3F1YXJlUmFuayhzcXVhcmUpICE9PSBlcFJhbmspXG4gICAgICAgIHJldHVybjtcbiAgICBpZiAocG9zLmJvYXJkLm9jY3VwaWVkLmhhcyhzcXVhcmUgKyBmb3J3YXJkKSlcbiAgICAgICAgcmV0dXJuO1xuICAgIGNvbnN0IHBhd24gPSBzcXVhcmUgLSBmb3J3YXJkO1xuICAgIGlmICghcG9zLmJvYXJkLnBhd24uaGFzKHBhd24pIHx8ICFwb3MuYm9hcmRbb3Bwb3NpdGUocG9zLnR1cm4pXS5oYXMocGF3bikpXG4gICAgICAgIHJldHVybjtcbiAgICByZXR1cm4gc3F1YXJlO1xufTtcbmNvbnN0IGxlZ2FsRXBTcXVhcmUgPSAocG9zKSA9PiB7XG4gICAgaWYgKCFkZWZpbmVkKHBvcy5lcFNxdWFyZSkpXG4gICAgICAgIHJldHVybjtcbiAgICBjb25zdCBjdHggPSBwb3MuY3R4KCk7XG4gICAgY29uc3Qgb3VyUGF3bnMgPSBwb3MuYm9hcmQucGllY2VzKHBvcy50dXJuLCAncGF3bicpO1xuICAgIGNvbnN0IGNhbmRpZGF0ZXMgPSBvdXJQYXducy5pbnRlcnNlY3QocGF3bkF0dGFja3Mob3Bwb3NpdGUocG9zLnR1cm4pLCBwb3MuZXBTcXVhcmUpKTtcbiAgICBmb3IgKGNvbnN0IGNhbmRpZGF0ZSBvZiBjYW5kaWRhdGVzKSB7XG4gICAgICAgIGlmIChwb3MuZGVzdHMoY2FuZGlkYXRlLCBjdHgpLmhhcyhwb3MuZXBTcXVhcmUpKVxuICAgICAgICAgICAgcmV0dXJuIHBvcy5lcFNxdWFyZTtcbiAgICB9XG4gICAgcmV0dXJuO1xufTtcbmNvbnN0IGNhbkNhcHR1cmVFcCA9IChwb3MsIHBhd25Gcm9tLCBjdHgpID0+IHtcbiAgICBpZiAoIWRlZmluZWQocG9zLmVwU3F1YXJlKSlcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGlmICghcGF3bkF0dGFja3MocG9zLnR1cm4sIHBhd25Gcm9tKS5oYXMocG9zLmVwU3F1YXJlKSlcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGlmICghZGVmaW5lZChjdHgua2luZykpXG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIGNvbnN0IGRlbHRhID0gcG9zLnR1cm4gPT09ICd3aGl0ZScgPyA4IDogLTg7XG4gICAgY29uc3QgY2FwdHVyZWQgPSBwb3MuZXBTcXVhcmUgLSBkZWx0YTtcbiAgICByZXR1cm4gcG9zXG4gICAgICAgIC5raW5nQXR0YWNrZXJzKGN0eC5raW5nLCBvcHBvc2l0ZShwb3MudHVybiksIHBvcy5ib2FyZC5vY2N1cGllZC50b2dnbGUocGF3bkZyb20pLnRvZ2dsZShjYXB0dXJlZCkud2l0aChwb3MuZXBTcXVhcmUpKVxuICAgICAgICAud2l0aG91dChjYXB0dXJlZClcbiAgICAgICAgLmlzRW1wdHkoKTtcbn07XG5jb25zdCBjYXN0bGluZ0Rlc3QgPSAocG9zLCBzaWRlLCBjdHgpID0+IHtcbiAgICBpZiAoIWRlZmluZWQoY3R4LmtpbmcpIHx8IGN0eC5jaGVja2Vycy5ub25FbXB0eSgpKVxuICAgICAgICByZXR1cm4gU3F1YXJlU2V0LmVtcHR5KCk7XG4gICAgY29uc3Qgcm9vayA9IHBvcy5jYXN0bGVzLnJvb2tbcG9zLnR1cm5dW3NpZGVdO1xuICAgIGlmICghZGVmaW5lZChyb29rKSlcbiAgICAgICAgcmV0dXJuIFNxdWFyZVNldC5lbXB0eSgpO1xuICAgIGlmIChwb3MuY2FzdGxlcy5wYXRoW3Bvcy50dXJuXVtzaWRlXS5pbnRlcnNlY3RzKHBvcy5ib2FyZC5vY2N1cGllZCkpXG4gICAgICAgIHJldHVybiBTcXVhcmVTZXQuZW1wdHkoKTtcbiAgICBjb25zdCBraW5nVG8gPSBraW5nQ2FzdGxlc1RvKHBvcy50dXJuLCBzaWRlKTtcbiAgICBjb25zdCBraW5nUGF0aCA9IGJldHdlZW4oY3R4LmtpbmcsIGtpbmdUbyk7XG4gICAgY29uc3Qgb2NjID0gcG9zLmJvYXJkLm9jY3VwaWVkLndpdGhvdXQoY3R4LmtpbmcpO1xuICAgIGZvciAoY29uc3Qgc3Egb2Yga2luZ1BhdGgpIHtcbiAgICAgICAgaWYgKHBvcy5raW5nQXR0YWNrZXJzKHNxLCBvcHBvc2l0ZShwb3MudHVybiksIG9jYykubm9uRW1wdHkoKSlcbiAgICAgICAgICAgIHJldHVybiBTcXVhcmVTZXQuZW1wdHkoKTtcbiAgICB9XG4gICAgY29uc3Qgcm9va1RvID0gcm9va0Nhc3RsZXNUbyhwb3MudHVybiwgc2lkZSk7XG4gICAgY29uc3QgYWZ0ZXIgPSBwb3MuYm9hcmQub2NjdXBpZWQudG9nZ2xlKGN0eC5raW5nKS50b2dnbGUocm9vaykudG9nZ2xlKHJvb2tUbyk7XG4gICAgaWYgKHBvcy5raW5nQXR0YWNrZXJzKGtpbmdUbywgb3Bwb3NpdGUocG9zLnR1cm4pLCBhZnRlcikubm9uRW1wdHkoKSlcbiAgICAgICAgcmV0dXJuIFNxdWFyZVNldC5lbXB0eSgpO1xuICAgIHJldHVybiBTcXVhcmVTZXQuZnJvbVNxdWFyZShyb29rKTtcbn07XG5leHBvcnQgY29uc3QgcHNldWRvRGVzdHMgPSAocG9zLCBzcXVhcmUsIGN0eCkgPT4ge1xuICAgIGlmIChjdHgudmFyaWFudEVuZClcbiAgICAgICAgcmV0dXJuIFNxdWFyZVNldC5lbXB0eSgpO1xuICAgIGNvbnN0IHBpZWNlID0gcG9zLmJvYXJkLmdldChzcXVhcmUpO1xuICAgIGlmICghcGllY2UgfHwgcGllY2UuY29sb3IgIT09IHBvcy50dXJuKVxuICAgICAgICByZXR1cm4gU3F1YXJlU2V0LmVtcHR5KCk7XG4gICAgbGV0IHBzZXVkbyA9IGF0dGFja3MocGllY2UsIHNxdWFyZSwgcG9zLmJvYXJkLm9jY3VwaWVkKTtcbiAgICBpZiAocGllY2Uucm9sZSA9PT0gJ3Bhd24nKSB7XG4gICAgICAgIGxldCBjYXB0dXJlVGFyZ2V0cyA9IHBvcy5ib2FyZFtvcHBvc2l0ZShwb3MudHVybildO1xuICAgICAgICBpZiAoZGVmaW5lZChwb3MuZXBTcXVhcmUpKVxuICAgICAgICAgICAgY2FwdHVyZVRhcmdldHMgPSBjYXB0dXJlVGFyZ2V0cy53aXRoKHBvcy5lcFNxdWFyZSk7XG4gICAgICAgIHBzZXVkbyA9IHBzZXVkby5pbnRlcnNlY3QoY2FwdHVyZVRhcmdldHMpO1xuICAgICAgICBjb25zdCBkZWx0YSA9IHBvcy50dXJuID09PSAnd2hpdGUnID8gOCA6IC04O1xuICAgICAgICBjb25zdCBzdGVwID0gc3F1YXJlICsgZGVsdGE7XG4gICAgICAgIGlmICgwIDw9IHN0ZXAgJiYgc3RlcCA8IDY0ICYmICFwb3MuYm9hcmQub2NjdXBpZWQuaGFzKHN0ZXApKSB7XG4gICAgICAgICAgICBwc2V1ZG8gPSBwc2V1ZG8ud2l0aChzdGVwKTtcbiAgICAgICAgICAgIGNvbnN0IGNhbkRvdWJsZVN0ZXAgPSBwb3MudHVybiA9PT0gJ3doaXRlJyA/IHNxdWFyZSA8IDE2IDogc3F1YXJlID49IDY0IC0gMTY7XG4gICAgICAgICAgICBjb25zdCBkb3VibGVTdGVwID0gc3RlcCArIGRlbHRhO1xuICAgICAgICAgICAgaWYgKGNhbkRvdWJsZVN0ZXAgJiYgIXBvcy5ib2FyZC5vY2N1cGllZC5oYXMoZG91YmxlU3RlcCkpIHtcbiAgICAgICAgICAgICAgICBwc2V1ZG8gPSBwc2V1ZG8ud2l0aChkb3VibGVTdGVwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcHNldWRvO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcHNldWRvID0gcHNldWRvLmRpZmYocG9zLmJvYXJkW3Bvcy50dXJuXSk7XG4gICAgfVxuICAgIGlmIChzcXVhcmUgPT09IGN0eC5raW5nKVxuICAgICAgICByZXR1cm4gcHNldWRvLnVuaW9uKGNhc3RsaW5nRGVzdChwb3MsICdhJywgY3R4KSkudW5pb24oY2FzdGxpbmdEZXN0KHBvcywgJ2gnLCBjdHgpKTtcbiAgICBlbHNlXG4gICAgICAgIHJldHVybiBwc2V1ZG87XG59O1xuZXhwb3J0IGNvbnN0IGVxdWFsc0lnbm9yZU1vdmVzID0gKGxlZnQsIHJpZ2h0KSA9PiB7XG4gICAgdmFyIF9hLCBfYjtcbiAgICByZXR1cm4gbGVmdC5ydWxlcyA9PT0gcmlnaHQucnVsZXNcbiAgICAgICAgJiYgYm9hcmRFcXVhbHMobGVmdC5ib2FyZCwgcmlnaHQuYm9hcmQpXG4gICAgICAgICYmICgocmlnaHQucG9ja2V0cyAmJiAoKF9hID0gbGVmdC5wb2NrZXRzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZXF1YWxzKHJpZ2h0LnBvY2tldHMpKSkgfHwgKCFsZWZ0LnBvY2tldHMgJiYgIXJpZ2h0LnBvY2tldHMpKVxuICAgICAgICAmJiBsZWZ0LnR1cm4gPT09IHJpZ2h0LnR1cm5cbiAgICAgICAgJiYgbGVmdC5jYXN0bGVzLmNhc3RsaW5nUmlnaHRzLmVxdWFscyhyaWdodC5jYXN0bGVzLmNhc3RsaW5nUmlnaHRzKVxuICAgICAgICAmJiBsZWdhbEVwU3F1YXJlKGxlZnQpID09PSBsZWdhbEVwU3F1YXJlKHJpZ2h0KVxuICAgICAgICAmJiAoKHJpZ2h0LnJlbWFpbmluZ0NoZWNrcyAmJiAoKF9iID0gbGVmdC5yZW1haW5pbmdDaGVja3MpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5lcXVhbHMocmlnaHQucmVtYWluaW5nQ2hlY2tzKSkpXG4gICAgICAgICAgICB8fCAoIWxlZnQucmVtYWluaW5nQ2hlY2tzICYmICFyaWdodC5yZW1haW5pbmdDaGVja3MpKTtcbn07XG5leHBvcnQgY29uc3QgY2FzdGxpbmdTaWRlID0gKHBvcywgbW92ZSkgPT4ge1xuICAgIGlmIChpc0Ryb3AobW92ZSkpXG4gICAgICAgIHJldHVybjtcbiAgICBjb25zdCBkZWx0YSA9IG1vdmUudG8gLSBtb3ZlLmZyb207XG4gICAgaWYgKE1hdGguYWJzKGRlbHRhKSAhPT0gMiAmJiAhcG9zLmJvYXJkW3Bvcy50dXJuXS5oYXMobW92ZS50bykpXG4gICAgICAgIHJldHVybjtcbiAgICBpZiAoIXBvcy5ib2FyZC5raW5nLmhhcyhtb3ZlLmZyb20pKVxuICAgICAgICByZXR1cm47XG4gICAgcmV0dXJuIGRlbHRhID4gMCA/ICdoJyA6ICdhJztcbn07XG5leHBvcnQgY29uc3Qgbm9ybWFsaXplTW92ZSA9IChwb3MsIG1vdmUpID0+IHtcbiAgICBjb25zdCBzaWRlID0gY2FzdGxpbmdTaWRlKHBvcywgbW92ZSk7XG4gICAgaWYgKCFzaWRlKVxuICAgICAgICByZXR1cm4gbW92ZTtcbiAgICBjb25zdCByb29rRnJvbSA9IHBvcy5jYXN0bGVzLnJvb2tbcG9zLnR1cm5dW3NpZGVdO1xuICAgIHJldHVybiB7XG4gICAgICAgIGZyb206IG1vdmUuZnJvbSxcbiAgICAgICAgdG86IGRlZmluZWQocm9va0Zyb20pID8gcm9va0Zyb20gOiBtb3ZlLnRvLFxuICAgIH07XG59O1xuZXhwb3J0IGNvbnN0IGlzU3RhbmRhcmRNYXRlcmlhbFNpZGUgPSAoYm9hcmQsIGNvbG9yKSA9PiB7XG4gICAgY29uc3QgcHJvbW90ZWQgPSBNYXRoLm1heChib2FyZC5waWVjZXMoY29sb3IsICdxdWVlbicpLnNpemUoKSAtIDEsIDApXG4gICAgICAgICsgTWF0aC5tYXgoYm9hcmQucGllY2VzKGNvbG9yLCAncm9vaycpLnNpemUoKSAtIDIsIDApXG4gICAgICAgICsgTWF0aC5tYXgoYm9hcmQucGllY2VzKGNvbG9yLCAna25pZ2h0Jykuc2l6ZSgpIC0gMiwgMClcbiAgICAgICAgKyBNYXRoLm1heChib2FyZC5waWVjZXMoY29sb3IsICdiaXNob3AnKS5pbnRlcnNlY3QoU3F1YXJlU2V0LmxpZ2h0U3F1YXJlcygpKS5zaXplKCkgLSAxLCAwKVxuICAgICAgICArIE1hdGgubWF4KGJvYXJkLnBpZWNlcyhjb2xvciwgJ2Jpc2hvcCcpLmludGVyc2VjdChTcXVhcmVTZXQuZGFya1NxdWFyZXMoKSkuc2l6ZSgpIC0gMSwgMCk7XG4gICAgcmV0dXJuIGJvYXJkLnBpZWNlcyhjb2xvciwgJ3Bhd24nKS5zaXplKCkgKyBwcm9tb3RlZCA8PSA4O1xufTtcbmV4cG9ydCBjb25zdCBpc1N0YW5kYXJkTWF0ZXJpYWwgPSAocG9zKSA9PiBDT0xPUlMuZXZlcnkoY29sb3IgPT4gaXNTdGFuZGFyZE1hdGVyaWFsU2lkZShwb3MuYm9hcmQsIGNvbG9yKSk7XG5leHBvcnQgY29uc3QgaXNJbXBvc3NpYmxlQ2hlY2sgPSAocG9zKSA9PiB7XG4gICAgY29uc3Qgb3VyS2luZyA9IHBvcy5ib2FyZC5raW5nT2YocG9zLnR1cm4pO1xuICAgIGlmICghZGVmaW5lZChvdXJLaW5nKSlcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIGNvbnN0IGNoZWNrZXJzID0gcG9zLmtpbmdBdHRhY2tlcnMob3VyS2luZywgb3Bwb3NpdGUocG9zLnR1cm4pLCBwb3MuYm9hcmQub2NjdXBpZWQpO1xuICAgIGlmIChjaGVja2Vycy5pc0VtcHR5KCkpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBpZiAoZGVmaW5lZChwb3MuZXBTcXVhcmUpKSB7XG4gICAgICAgIC8vIFRoZSBwdXNoZWQgcGF3biBtdXN0IGJlIHRoZSBvbmx5IGNoZWNrZXIsIG9yIGl0IGhhcyB1bmNvdmVyZWRcbiAgICAgICAgLy8gY2hlY2sgYnkgYSBzaW5nbGUgc2xpZGluZyBwaWVjZS5cbiAgICAgICAgY29uc3QgcHVzaGVkVG8gPSBwb3MuZXBTcXVhcmUgXiA4O1xuICAgICAgICBjb25zdCBwdXNoZWRGcm9tID0gcG9zLmVwU3F1YXJlIF4gMjQ7XG4gICAgICAgIHJldHVybiAoY2hlY2tlcnMubW9yZVRoYW5PbmUoKVxuICAgICAgICAgICAgfHwgKGNoZWNrZXJzLmZpcnN0KCkgIT09IHB1c2hlZFRvXG4gICAgICAgICAgICAgICAgJiYgcG9zXG4gICAgICAgICAgICAgICAgICAgIC5raW5nQXR0YWNrZXJzKG91cktpbmcsIG9wcG9zaXRlKHBvcy50dXJuKSwgcG9zLmJvYXJkLm9jY3VwaWVkLndpdGhvdXQocHVzaGVkVG8pLndpdGgocHVzaGVkRnJvbSkpXG4gICAgICAgICAgICAgICAgICAgIC5ub25FbXB0eSgpKSk7XG4gICAgfVxuICAgIGVsc2UgaWYgKHBvcy5ydWxlcyA9PT0gJ2F0b21pYycpIHtcbiAgICAgICAgLy8gT3RoZXIga2luZyBtb3ZpbmcgYXdheSBjYW4gY2F1c2UgbWFueSBjaGVja3MgdG8gYmUgZ2l2ZW4gYXQgdGhlIHNhbWVcbiAgICAgICAgLy8gdGltZS4gTm90IGNoZWNraW5nIGRldGFpbHMsIG9yIGV2ZW4gdGhhdCB0aGUga2luZyBpcyBjbG9zZSBlbm91Z2guXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIC8vIFNsaWRpbmcgY2hlY2tlcnMgYWxpZ25lZCB3aXRoIGtpbmcuXG4gICAgICAgIHJldHVybiBjaGVja2Vycy5zaXplKCkgPiAyXG4gICAgICAgICAgICB8fCAoY2hlY2tlcnMuc2l6ZSgpID09PSAyICYmIHJheShjaGVja2Vycy5maXJzdCgpLCBjaGVja2Vycy5sYXN0KCkpLmhhcyhvdXJLaW5nKSkgLy8gU2xpZGluZyBjaGVja2VycyBhbGlnbmVkIHdpdGgga2luZ1xuICAgICAgICAgICAgfHwgY2hlY2tlcnMuaW50ZXJzZWN0KHBvcy5ib2FyZC5zdGVwcGVycygpKS5tb3JlVGhhbk9uZSgpO1xuICAgIH1cbn07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1jaGVzcy5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/chessops/dist/esm/chess.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/chessops/dist/esm/fen.js":
/*!***********************************************!*\
  !*** ./node_modules/chessops/dist/esm/fen.js ***!
  \***********************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   EMPTY_BOARD_FEN: () => (/* binding */ EMPTY_BOARD_FEN),\n/* harmony export */   EMPTY_EPD: () => (/* binding */ EMPTY_EPD),\n/* harmony export */   EMPTY_FEN: () => (/* binding */ EMPTY_FEN),\n/* harmony export */   FenError: () => (/* binding */ FenError),\n/* harmony export */   INITIAL_BOARD_FEN: () => (/* binding */ INITIAL_BOARD_FEN),\n/* harmony export */   INITIAL_EPD: () => (/* binding */ INITIAL_EPD),\n/* harmony export */   INITIAL_FEN: () => (/* binding */ INITIAL_FEN),\n/* harmony export */   InvalidFen: () => (/* binding */ InvalidFen),\n/* harmony export */   makeBoardFen: () => (/* binding */ makeBoardFen),\n/* harmony export */   makeCastlingFen: () => (/* binding */ makeCastlingFen),\n/* harmony export */   makeFen: () => (/* binding */ makeFen),\n/* harmony export */   makePiece: () => (/* binding */ makePiece),\n/* harmony export */   makePocket: () => (/* binding */ makePocket),\n/* harmony export */   makePockets: () => (/* binding */ makePockets),\n/* harmony export */   makeRemainingChecks: () => (/* binding */ makeRemainingChecks),\n/* harmony export */   parseBoardFen: () => (/* binding */ parseBoardFen),\n/* harmony export */   parseCastlingFen: () => (/* binding */ parseCastlingFen),\n/* harmony export */   parseFen: () => (/* binding */ parseFen),\n/* harmony export */   parsePiece: () => (/* binding */ parsePiece),\n/* harmony export */   parsePockets: () => (/* binding */ parsePockets),\n/* harmony export */   parseRemainingChecks: () => (/* binding */ parseRemainingChecks)\n/* harmony export */ });\n/* harmony import */ var _badrap_result__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @badrap/result */ \"(ssr)/./node_modules/@badrap/result/dist/node-mjs/index.mjs\");\n/* harmony import */ var _board_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./board.js */ \"(ssr)/./node_modules/chessops/dist/esm/board.js\");\n/* harmony import */ var _setup_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./setup.js */ \"(ssr)/./node_modules/chessops/dist/esm/setup.js\");\n/* harmony import */ var _squareSet_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./squareSet.js */ \"(ssr)/./node_modules/chessops/dist/esm/squareSet.js\");\n/* harmony import */ var _types_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./types.js */ \"(ssr)/./node_modules/chessops/dist/esm/types.js\");\n/* harmony import */ var _util_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./util.js */ \"(ssr)/./node_modules/chessops/dist/esm/util.js\");\n\n\n\n\n\n\nconst INITIAL_BOARD_FEN = 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR';\nconst INITIAL_EPD = INITIAL_BOARD_FEN + ' w KQkq -';\nconst INITIAL_FEN = INITIAL_EPD + ' 0 1';\nconst EMPTY_BOARD_FEN = '8/8/8/8/8/8/8/8';\nconst EMPTY_EPD = EMPTY_BOARD_FEN + ' w - -';\nconst EMPTY_FEN = EMPTY_EPD + ' 0 1';\nvar InvalidFen;\n(function (InvalidFen) {\n    InvalidFen[\"Fen\"] = \"ERR_FEN\";\n    InvalidFen[\"Board\"] = \"ERR_BOARD\";\n    InvalidFen[\"Pockets\"] = \"ERR_POCKETS\";\n    InvalidFen[\"Turn\"] = \"ERR_TURN\";\n    InvalidFen[\"Castling\"] = \"ERR_CASTLING\";\n    InvalidFen[\"EpSquare\"] = \"ERR_EP_SQUARE\";\n    InvalidFen[\"RemainingChecks\"] = \"ERR_REMAINING_CHECKS\";\n    InvalidFen[\"Halfmoves\"] = \"ERR_HALFMOVES\";\n    InvalidFen[\"Fullmoves\"] = \"ERR_FULLMOVES\";\n})(InvalidFen || (InvalidFen = {}));\nclass FenError extends Error {\n}\nconst nthIndexOf = (haystack, needle, n) => {\n    let index = haystack.indexOf(needle);\n    while (n-- > 0) {\n        if (index === -1)\n            break;\n        index = haystack.indexOf(needle, index + needle.length);\n    }\n    return index;\n};\nconst parseSmallUint = (str) => (/^\\d{1,4}$/.test(str) ? parseInt(str, 10) : undefined);\nconst charToPiece = (ch) => {\n    const role = (0,_util_js__WEBPACK_IMPORTED_MODULE_0__.charToRole)(ch);\n    return role && { role, color: ch.toLowerCase() === ch ? 'black' : 'white' };\n};\nconst parseBoardFen = (boardPart) => {\n    const board = _board_js__WEBPACK_IMPORTED_MODULE_1__.Board.empty();\n    let rank = 7;\n    let file = 0;\n    for (let i = 0; i < boardPart.length; i++) {\n        const c = boardPart[i];\n        if (c === '/' && file === 8) {\n            file = 0;\n            rank--;\n        }\n        else {\n            const step = parseInt(c, 10);\n            if (step > 0)\n                file += step;\n            else {\n                if (file >= 8 || rank < 0)\n                    return _badrap_result__WEBPACK_IMPORTED_MODULE_2__.Result.err(new FenError(InvalidFen.Board));\n                const square = file + rank * 8;\n                const piece = charToPiece(c);\n                if (!piece)\n                    return _badrap_result__WEBPACK_IMPORTED_MODULE_2__.Result.err(new FenError(InvalidFen.Board));\n                if (boardPart[i + 1] === '~') {\n                    piece.promoted = true;\n                    i++;\n                }\n                board.set(square, piece);\n                file++;\n            }\n        }\n    }\n    if (rank !== 0 || file !== 8)\n        return _badrap_result__WEBPACK_IMPORTED_MODULE_2__.Result.err(new FenError(InvalidFen.Board));\n    return _badrap_result__WEBPACK_IMPORTED_MODULE_2__.Result.ok(board);\n};\nconst parsePockets = (pocketPart) => {\n    if (pocketPart.length > 64)\n        return _badrap_result__WEBPACK_IMPORTED_MODULE_2__.Result.err(new FenError(InvalidFen.Pockets));\n    const pockets = _setup_js__WEBPACK_IMPORTED_MODULE_3__.Material.empty();\n    for (const c of pocketPart) {\n        const piece = charToPiece(c);\n        if (!piece)\n            return _badrap_result__WEBPACK_IMPORTED_MODULE_2__.Result.err(new FenError(InvalidFen.Pockets));\n        pockets[piece.color][piece.role]++;\n    }\n    return _badrap_result__WEBPACK_IMPORTED_MODULE_2__.Result.ok(pockets);\n};\nconst parseCastlingFen = (board, castlingPart) => {\n    let castlingRights = _squareSet_js__WEBPACK_IMPORTED_MODULE_4__.SquareSet.empty();\n    if (castlingPart === '-')\n        return _badrap_result__WEBPACK_IMPORTED_MODULE_2__.Result.ok(castlingRights);\n    for (const c of castlingPart) {\n        const lower = c.toLowerCase();\n        const color = c === lower ? 'black' : 'white';\n        const rank = color === 'white' ? 0 : 7;\n        if ('a' <= lower && lower <= 'h') {\n            castlingRights = castlingRights.with((0,_util_js__WEBPACK_IMPORTED_MODULE_0__.squareFromCoords)(lower.charCodeAt(0) - 'a'.charCodeAt(0), rank));\n        }\n        else if (lower === 'k' || lower === 'q') {\n            const rooksAndKings = board[color].intersect(_squareSet_js__WEBPACK_IMPORTED_MODULE_4__.SquareSet.backrank(color)).intersect(board.rook.union(board.king));\n            const candidate = lower === 'k' ? rooksAndKings.last() : rooksAndKings.first();\n            castlingRights = castlingRights.with((0,_util_js__WEBPACK_IMPORTED_MODULE_0__.defined)(candidate) && board.rook.has(candidate) ? candidate : (0,_util_js__WEBPACK_IMPORTED_MODULE_0__.squareFromCoords)(lower === 'k' ? 7 : 0, rank));\n        }\n        else\n            return _badrap_result__WEBPACK_IMPORTED_MODULE_2__.Result.err(new FenError(InvalidFen.Castling));\n    }\n    if (_types_js__WEBPACK_IMPORTED_MODULE_5__.COLORS.some(color => _squareSet_js__WEBPACK_IMPORTED_MODULE_4__.SquareSet.backrank(color).intersect(castlingRights).size() > 2)) {\n        return _badrap_result__WEBPACK_IMPORTED_MODULE_2__.Result.err(new FenError(InvalidFen.Castling));\n    }\n    return _badrap_result__WEBPACK_IMPORTED_MODULE_2__.Result.ok(castlingRights);\n};\nconst parseRemainingChecks = (part) => {\n    const parts = part.split('+');\n    if (parts.length === 3 && parts[0] === '') {\n        const white = parseSmallUint(parts[1]);\n        const black = parseSmallUint(parts[2]);\n        if (!(0,_util_js__WEBPACK_IMPORTED_MODULE_0__.defined)(white) || white > 3 || !(0,_util_js__WEBPACK_IMPORTED_MODULE_0__.defined)(black) || black > 3) {\n            return _badrap_result__WEBPACK_IMPORTED_MODULE_2__.Result.err(new FenError(InvalidFen.RemainingChecks));\n        }\n        return _badrap_result__WEBPACK_IMPORTED_MODULE_2__.Result.ok(new _setup_js__WEBPACK_IMPORTED_MODULE_3__.RemainingChecks(3 - white, 3 - black));\n    }\n    else if (parts.length === 2) {\n        const white = parseSmallUint(parts[0]);\n        const black = parseSmallUint(parts[1]);\n        if (!(0,_util_js__WEBPACK_IMPORTED_MODULE_0__.defined)(white) || white > 3 || !(0,_util_js__WEBPACK_IMPORTED_MODULE_0__.defined)(black) || black > 3) {\n            return _badrap_result__WEBPACK_IMPORTED_MODULE_2__.Result.err(new FenError(InvalidFen.RemainingChecks));\n        }\n        return _badrap_result__WEBPACK_IMPORTED_MODULE_2__.Result.ok(new _setup_js__WEBPACK_IMPORTED_MODULE_3__.RemainingChecks(white, black));\n    }\n    else\n        return _badrap_result__WEBPACK_IMPORTED_MODULE_2__.Result.err(new FenError(InvalidFen.RemainingChecks));\n};\nconst parseFen = (fen) => {\n    const parts = fen.split(/[\\s_]+/);\n    const boardPart = parts.shift();\n    // Board and pockets\n    let board;\n    let pockets = _badrap_result__WEBPACK_IMPORTED_MODULE_2__.Result.ok(undefined);\n    if (boardPart.endsWith(']')) {\n        const pocketStart = boardPart.indexOf('[');\n        if (pocketStart === -1)\n            return _badrap_result__WEBPACK_IMPORTED_MODULE_2__.Result.err(new FenError(InvalidFen.Fen));\n        board = parseBoardFen(boardPart.slice(0, pocketStart));\n        pockets = parsePockets(boardPart.slice(pocketStart + 1, -1));\n    }\n    else {\n        const pocketStart = nthIndexOf(boardPart, '/', 7);\n        if (pocketStart === -1)\n            board = parseBoardFen(boardPart);\n        else {\n            board = parseBoardFen(boardPart.slice(0, pocketStart));\n            pockets = parsePockets(boardPart.slice(pocketStart + 1));\n        }\n    }\n    // Turn\n    let turn;\n    const turnPart = parts.shift();\n    if (!(0,_util_js__WEBPACK_IMPORTED_MODULE_0__.defined)(turnPart) || turnPart === 'w')\n        turn = 'white';\n    else if (turnPart === 'b')\n        turn = 'black';\n    else\n        return _badrap_result__WEBPACK_IMPORTED_MODULE_2__.Result.err(new FenError(InvalidFen.Turn));\n    return board.chain(board => {\n        // Castling\n        const castlingPart = parts.shift();\n        const castlingRights = (0,_util_js__WEBPACK_IMPORTED_MODULE_0__.defined)(castlingPart) ? parseCastlingFen(board, castlingPart) : _badrap_result__WEBPACK_IMPORTED_MODULE_2__.Result.ok(_squareSet_js__WEBPACK_IMPORTED_MODULE_4__.SquareSet.empty());\n        // En passant square\n        const epPart = parts.shift();\n        let epSquare;\n        if ((0,_util_js__WEBPACK_IMPORTED_MODULE_0__.defined)(epPart) && epPart !== '-') {\n            epSquare = (0,_util_js__WEBPACK_IMPORTED_MODULE_0__.parseSquare)(epPart);\n            if (!(0,_util_js__WEBPACK_IMPORTED_MODULE_0__.defined)(epSquare))\n                return _badrap_result__WEBPACK_IMPORTED_MODULE_2__.Result.err(new FenError(InvalidFen.EpSquare));\n        }\n        // Halfmoves or remaining checks\n        let halfmovePart = parts.shift();\n        let earlyRemainingChecks;\n        if ((0,_util_js__WEBPACK_IMPORTED_MODULE_0__.defined)(halfmovePart) && halfmovePart.includes('+')) {\n            earlyRemainingChecks = parseRemainingChecks(halfmovePart);\n            halfmovePart = parts.shift();\n        }\n        const halfmoves = (0,_util_js__WEBPACK_IMPORTED_MODULE_0__.defined)(halfmovePart) ? parseSmallUint(halfmovePart) : 0;\n        if (!(0,_util_js__WEBPACK_IMPORTED_MODULE_0__.defined)(halfmoves))\n            return _badrap_result__WEBPACK_IMPORTED_MODULE_2__.Result.err(new FenError(InvalidFen.Halfmoves));\n        const fullmovesPart = parts.shift();\n        const fullmoves = (0,_util_js__WEBPACK_IMPORTED_MODULE_0__.defined)(fullmovesPart) ? parseSmallUint(fullmovesPart) : 1;\n        if (!(0,_util_js__WEBPACK_IMPORTED_MODULE_0__.defined)(fullmoves))\n            return _badrap_result__WEBPACK_IMPORTED_MODULE_2__.Result.err(new FenError(InvalidFen.Fullmoves));\n        const remainingChecksPart = parts.shift();\n        let remainingChecks = _badrap_result__WEBPACK_IMPORTED_MODULE_2__.Result.ok(undefined);\n        if ((0,_util_js__WEBPACK_IMPORTED_MODULE_0__.defined)(remainingChecksPart)) {\n            if ((0,_util_js__WEBPACK_IMPORTED_MODULE_0__.defined)(earlyRemainingChecks))\n                return _badrap_result__WEBPACK_IMPORTED_MODULE_2__.Result.err(new FenError(InvalidFen.RemainingChecks));\n            remainingChecks = parseRemainingChecks(remainingChecksPart);\n        }\n        else if ((0,_util_js__WEBPACK_IMPORTED_MODULE_0__.defined)(earlyRemainingChecks)) {\n            remainingChecks = earlyRemainingChecks;\n        }\n        if (parts.length > 0)\n            return _badrap_result__WEBPACK_IMPORTED_MODULE_2__.Result.err(new FenError(InvalidFen.Fen));\n        return pockets.chain(pockets => castlingRights.chain(castlingRights => remainingChecks.map(remainingChecks => {\n            return {\n                board,\n                pockets,\n                turn,\n                castlingRights,\n                remainingChecks,\n                epSquare,\n                halfmoves,\n                fullmoves: Math.max(1, fullmoves),\n            };\n        })));\n    });\n};\nconst parsePiece = (str) => {\n    if (!str)\n        return;\n    const piece = charToPiece(str[0]);\n    if (!piece)\n        return;\n    if (str.length === 2 && str[1] === '~')\n        piece.promoted = true;\n    else if (str.length > 1)\n        return;\n    return piece;\n};\nconst makePiece = (piece) => {\n    let r = (0,_util_js__WEBPACK_IMPORTED_MODULE_0__.roleToChar)(piece.role);\n    if (piece.color === 'white')\n        r = r.toUpperCase();\n    if (piece.promoted)\n        r += '~';\n    return r;\n};\nconst makeBoardFen = (board) => {\n    let fen = '';\n    let empty = 0;\n    for (let rank = 7; rank >= 0; rank--) {\n        for (let file = 0; file < 8; file++) {\n            const square = file + rank * 8;\n            const piece = board.get(square);\n            if (!piece)\n                empty++;\n            else {\n                if (empty > 0) {\n                    fen += empty;\n                    empty = 0;\n                }\n                fen += makePiece(piece);\n            }\n            if (file === 7) {\n                if (empty > 0) {\n                    fen += empty;\n                    empty = 0;\n                }\n                if (rank !== 0)\n                    fen += '/';\n            }\n        }\n    }\n    return fen;\n};\nconst makePocket = (material) => _types_js__WEBPACK_IMPORTED_MODULE_5__.ROLES.map(role => (0,_util_js__WEBPACK_IMPORTED_MODULE_0__.roleToChar)(role).repeat(material[role])).join('');\nconst makePockets = (pocket) => makePocket(pocket.white).toUpperCase() + makePocket(pocket.black);\nconst makeCastlingFen = (board, castlingRights) => {\n    let fen = '';\n    for (const color of _types_js__WEBPACK_IMPORTED_MODULE_5__.COLORS) {\n        const backrank = _squareSet_js__WEBPACK_IMPORTED_MODULE_4__.SquareSet.backrank(color);\n        let king = board.kingOf(color);\n        if ((0,_util_js__WEBPACK_IMPORTED_MODULE_0__.defined)(king) && !backrank.has(king))\n            king = undefined;\n        const candidates = board.pieces(color, 'rook').intersect(backrank);\n        for (const rook of castlingRights.intersect(backrank).reversed()) {\n            if (rook === candidates.first() && (0,_util_js__WEBPACK_IMPORTED_MODULE_0__.defined)(king) && rook < king) {\n                fen += color === 'white' ? 'Q' : 'q';\n            }\n            else if (rook === candidates.last() && (0,_util_js__WEBPACK_IMPORTED_MODULE_0__.defined)(king) && king < rook) {\n                fen += color === 'white' ? 'K' : 'k';\n            }\n            else {\n                const file = _types_js__WEBPACK_IMPORTED_MODULE_5__.FILE_NAMES[(0,_util_js__WEBPACK_IMPORTED_MODULE_0__.squareFile)(rook)];\n                fen += color === 'white' ? file.toUpperCase() : file;\n            }\n        }\n    }\n    return fen || '-';\n};\nconst makeRemainingChecks = (checks) => `${checks.white}+${checks.black}`;\nconst makeFen = (setup, opts) => [\n    makeBoardFen(setup.board) + (setup.pockets ? `[${makePockets(setup.pockets)}]` : ''),\n    setup.turn[0],\n    makeCastlingFen(setup.board, setup.castlingRights),\n    (0,_util_js__WEBPACK_IMPORTED_MODULE_0__.defined)(setup.epSquare) ? (0,_util_js__WEBPACK_IMPORTED_MODULE_0__.makeSquare)(setup.epSquare) : '-',\n    ...(setup.remainingChecks ? [makeRemainingChecks(setup.remainingChecks)] : []),\n    ...((opts === null || opts === void 0 ? void 0 : opts.epd) ? [] : [Math.max(0, Math.min(setup.halfmoves, 9999)), Math.max(1, Math.min(setup.fullmoves, 9999))]),\n].join(' ');\n//# sourceMappingURL=fen.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvY2hlc3NvcHMvZGlzdC9lc20vZmVuLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUF3QztBQUNMO0FBQ29CO0FBQ1o7QUFDWTtBQUM0RDtBQUM1RztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQyxnQ0FBZ0M7QUFDMUI7QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNDQUFzQyxJQUFJO0FBQzFDO0FBQ0EsaUJBQWlCLG9EQUFVO0FBQzNCLHFCQUFxQjtBQUNyQjtBQUNPO0FBQ1Asa0JBQWtCLDRDQUFLO0FBQ3ZCO0FBQ0E7QUFDQSxvQkFBb0Isc0JBQXNCO0FBQzFDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsa0RBQU07QUFDakM7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLGtEQUFNO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZSxrREFBTTtBQUNyQixXQUFXLGtEQUFNO0FBQ2pCO0FBQ087QUFDUDtBQUNBLGVBQWUsa0RBQU07QUFDckIsb0JBQW9CLCtDQUFRO0FBQzVCO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQixrREFBTTtBQUN6QjtBQUNBO0FBQ0EsV0FBVyxrREFBTTtBQUNqQjtBQUNPO0FBQ1AseUJBQXlCLG9EQUFTO0FBQ2xDO0FBQ0EsZUFBZSxrREFBTTtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaURBQWlELDBEQUFnQjtBQUNqRTtBQUNBO0FBQ0EseURBQXlELG9EQUFTO0FBQ2xFO0FBQ0EsaURBQWlELGlEQUFPLHVEQUF1RCwwREFBZ0I7QUFDL0g7QUFDQTtBQUNBLG1CQUFtQixrREFBTTtBQUN6QjtBQUNBLFFBQVEsNkNBQU0sZUFBZSxvREFBUztBQUN0QyxlQUFlLGtEQUFNO0FBQ3JCO0FBQ0EsV0FBVyxrREFBTTtBQUNqQjtBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhLGlEQUFPLHlCQUF5QixpREFBTztBQUNwRCxtQkFBbUIsa0RBQU07QUFDekI7QUFDQSxlQUFlLGtEQUFNLFFBQVEsc0RBQWU7QUFDNUM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhLGlEQUFPLHlCQUF5QixpREFBTztBQUNwRCxtQkFBbUIsa0RBQU07QUFDekI7QUFDQSxlQUFlLGtEQUFNLFFBQVEsc0RBQWU7QUFDNUM7QUFDQTtBQUNBLGVBQWUsa0RBQU07QUFDckI7QUFDTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLGtEQUFNO0FBQ3hCO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQixrREFBTTtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTLGlEQUFPO0FBQ2hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZSxrREFBTTtBQUNyQjtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsaURBQU8seURBQXlELGtEQUFNLElBQUksb0RBQVM7QUFDbEg7QUFDQTtBQUNBO0FBQ0EsWUFBWSxpREFBTztBQUNuQix1QkFBdUIscURBQVc7QUFDbEMsaUJBQWlCLGlEQUFPO0FBQ3hCLHVCQUF1QixrREFBTTtBQUM3QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksaURBQU87QUFDbkI7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCLGlEQUFPO0FBQ2pDLGFBQWEsaURBQU87QUFDcEIsbUJBQW1CLGtEQUFNO0FBQ3pCO0FBQ0EsMEJBQTBCLGlEQUFPO0FBQ2pDLGFBQWEsaURBQU87QUFDcEIsbUJBQW1CLGtEQUFNO0FBQ3pCO0FBQ0EsOEJBQThCLGtEQUFNO0FBQ3BDLFlBQVksaURBQU87QUFDbkIsZ0JBQWdCLGlEQUFPO0FBQ3ZCLHVCQUF1QixrREFBTTtBQUM3QjtBQUNBO0FBQ0EsaUJBQWlCLGlEQUFPO0FBQ3hCO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQixrREFBTTtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULEtBQUs7QUFDTDtBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPO0FBQ1AsWUFBWSxvREFBVTtBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDTztBQUNQO0FBQ0E7QUFDQSx1QkFBdUIsV0FBVztBQUNsQywyQkFBMkIsVUFBVTtBQUNyQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ08saUNBQWlDLDRDQUFLLGFBQWEsb0RBQVU7QUFDN0Q7QUFDQTtBQUNQO0FBQ0Esd0JBQXdCLDZDQUFNO0FBQzlCLHlCQUF5QixvREFBUztBQUNsQztBQUNBLFlBQVksaURBQU87QUFDbkI7QUFDQTtBQUNBO0FBQ0EsK0NBQStDLGlEQUFPO0FBQ3REO0FBQ0E7QUFDQSxtREFBbUQsaURBQU87QUFDMUQ7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCLGlEQUFVLENBQUMsb0RBQVU7QUFDbEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ08sMkNBQTJDLGFBQWEsR0FBRyxhQUFhO0FBQ3hFO0FBQ1AscURBQXFELDJCQUEyQjtBQUNoRjtBQUNBO0FBQ0EsSUFBSSxpREFBTyxtQkFBbUIsb0RBQVU7QUFDeEM7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIi9Vc2Vycy9yYWtzaGl0L3dvcmtzcGFjZS9hcmNoaXZlcy9yZXBvcy9jaGVzcy9ldmFsLWJhci9ub2RlX21vZHVsZXMvY2hlc3NvcHMvZGlzdC9lc20vZmVuLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJlc3VsdCB9IGZyb20gJ0BiYWRyYXAvcmVzdWx0JztcbmltcG9ydCB7IEJvYXJkIH0gZnJvbSAnLi9ib2FyZC5qcyc7XG5pbXBvcnQgeyBNYXRlcmlhbCwgUmVtYWluaW5nQ2hlY2tzIH0gZnJvbSAnLi9zZXR1cC5qcyc7XG5pbXBvcnQgeyBTcXVhcmVTZXQgfSBmcm9tICcuL3NxdWFyZVNldC5qcyc7XG5pbXBvcnQgeyBDT0xPUlMsIEZJTEVfTkFNRVMsIFJPTEVTIH0gZnJvbSAnLi90eXBlcy5qcyc7XG5pbXBvcnQgeyBjaGFyVG9Sb2xlLCBkZWZpbmVkLCBtYWtlU3F1YXJlLCBwYXJzZVNxdWFyZSwgcm9sZVRvQ2hhciwgc3F1YXJlRmlsZSwgc3F1YXJlRnJvbUNvb3JkcyB9IGZyb20gJy4vdXRpbC5qcyc7XG5leHBvcnQgY29uc3QgSU5JVElBTF9CT0FSRF9GRU4gPSAncm5icWtibnIvcHBwcHBwcHAvOC84LzgvOC9QUFBQUFBQUC9STkJRS0JOUic7XG5leHBvcnQgY29uc3QgSU5JVElBTF9FUEQgPSBJTklUSUFMX0JPQVJEX0ZFTiArICcgdyBLUWtxIC0nO1xuZXhwb3J0IGNvbnN0IElOSVRJQUxfRkVOID0gSU5JVElBTF9FUEQgKyAnIDAgMSc7XG5leHBvcnQgY29uc3QgRU1QVFlfQk9BUkRfRkVOID0gJzgvOC84LzgvOC84LzgvOCc7XG5leHBvcnQgY29uc3QgRU1QVFlfRVBEID0gRU1QVFlfQk9BUkRfRkVOICsgJyB3IC0gLSc7XG5leHBvcnQgY29uc3QgRU1QVFlfRkVOID0gRU1QVFlfRVBEICsgJyAwIDEnO1xuZXhwb3J0IHZhciBJbnZhbGlkRmVuO1xuKGZ1bmN0aW9uIChJbnZhbGlkRmVuKSB7XG4gICAgSW52YWxpZEZlbltcIkZlblwiXSA9IFwiRVJSX0ZFTlwiO1xuICAgIEludmFsaWRGZW5bXCJCb2FyZFwiXSA9IFwiRVJSX0JPQVJEXCI7XG4gICAgSW52YWxpZEZlbltcIlBvY2tldHNcIl0gPSBcIkVSUl9QT0NLRVRTXCI7XG4gICAgSW52YWxpZEZlbltcIlR1cm5cIl0gPSBcIkVSUl9UVVJOXCI7XG4gICAgSW52YWxpZEZlbltcIkNhc3RsaW5nXCJdID0gXCJFUlJfQ0FTVExJTkdcIjtcbiAgICBJbnZhbGlkRmVuW1wiRXBTcXVhcmVcIl0gPSBcIkVSUl9FUF9TUVVBUkVcIjtcbiAgICBJbnZhbGlkRmVuW1wiUmVtYWluaW5nQ2hlY2tzXCJdID0gXCJFUlJfUkVNQUlOSU5HX0NIRUNLU1wiO1xuICAgIEludmFsaWRGZW5bXCJIYWxmbW92ZXNcIl0gPSBcIkVSUl9IQUxGTU9WRVNcIjtcbiAgICBJbnZhbGlkRmVuW1wiRnVsbG1vdmVzXCJdID0gXCJFUlJfRlVMTE1PVkVTXCI7XG59KShJbnZhbGlkRmVuIHx8IChJbnZhbGlkRmVuID0ge30pKTtcbmV4cG9ydCBjbGFzcyBGZW5FcnJvciBleHRlbmRzIEVycm9yIHtcbn1cbmNvbnN0IG50aEluZGV4T2YgPSAoaGF5c3RhY2ssIG5lZWRsZSwgbikgPT4ge1xuICAgIGxldCBpbmRleCA9IGhheXN0YWNrLmluZGV4T2YobmVlZGxlKTtcbiAgICB3aGlsZSAobi0tID4gMCkge1xuICAgICAgICBpZiAoaW5kZXggPT09IC0xKVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGluZGV4ID0gaGF5c3RhY2suaW5kZXhPZihuZWVkbGUsIGluZGV4ICsgbmVlZGxlLmxlbmd0aCk7XG4gICAgfVxuICAgIHJldHVybiBpbmRleDtcbn07XG5jb25zdCBwYXJzZVNtYWxsVWludCA9IChzdHIpID0+ICgvXlxcZHsxLDR9JC8udGVzdChzdHIpID8gcGFyc2VJbnQoc3RyLCAxMCkgOiB1bmRlZmluZWQpO1xuY29uc3QgY2hhclRvUGllY2UgPSAoY2gpID0+IHtcbiAgICBjb25zdCByb2xlID0gY2hhclRvUm9sZShjaCk7XG4gICAgcmV0dXJuIHJvbGUgJiYgeyByb2xlLCBjb2xvcjogY2gudG9Mb3dlckNhc2UoKSA9PT0gY2ggPyAnYmxhY2snIDogJ3doaXRlJyB9O1xufTtcbmV4cG9ydCBjb25zdCBwYXJzZUJvYXJkRmVuID0gKGJvYXJkUGFydCkgPT4ge1xuICAgIGNvbnN0IGJvYXJkID0gQm9hcmQuZW1wdHkoKTtcbiAgICBsZXQgcmFuayA9IDc7XG4gICAgbGV0IGZpbGUgPSAwO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYm9hcmRQYXJ0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IGMgPSBib2FyZFBhcnRbaV07XG4gICAgICAgIGlmIChjID09PSAnLycgJiYgZmlsZSA9PT0gOCkge1xuICAgICAgICAgICAgZmlsZSA9IDA7XG4gICAgICAgICAgICByYW5rLS07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBzdGVwID0gcGFyc2VJbnQoYywgMTApO1xuICAgICAgICAgICAgaWYgKHN0ZXAgPiAwKVxuICAgICAgICAgICAgICAgIGZpbGUgKz0gc3RlcDtcbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChmaWxlID49IDggfHwgcmFuayA8IDApXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBSZXN1bHQuZXJyKG5ldyBGZW5FcnJvcihJbnZhbGlkRmVuLkJvYXJkKSk7XG4gICAgICAgICAgICAgICAgY29uc3Qgc3F1YXJlID0gZmlsZSArIHJhbmsgKiA4O1xuICAgICAgICAgICAgICAgIGNvbnN0IHBpZWNlID0gY2hhclRvUGllY2UoYyk7XG4gICAgICAgICAgICAgICAgaWYgKCFwaWVjZSlcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFJlc3VsdC5lcnIobmV3IEZlbkVycm9yKEludmFsaWRGZW4uQm9hcmQpKTtcbiAgICAgICAgICAgICAgICBpZiAoYm9hcmRQYXJ0W2kgKyAxXSA9PT0gJ34nKSB7XG4gICAgICAgICAgICAgICAgICAgIHBpZWNlLnByb21vdGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgaSsrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBib2FyZC5zZXQoc3F1YXJlLCBwaWVjZSk7XG4gICAgICAgICAgICAgICAgZmlsZSsrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGlmIChyYW5rICE9PSAwIHx8IGZpbGUgIT09IDgpXG4gICAgICAgIHJldHVybiBSZXN1bHQuZXJyKG5ldyBGZW5FcnJvcihJbnZhbGlkRmVuLkJvYXJkKSk7XG4gICAgcmV0dXJuIFJlc3VsdC5vayhib2FyZCk7XG59O1xuZXhwb3J0IGNvbnN0IHBhcnNlUG9ja2V0cyA9IChwb2NrZXRQYXJ0KSA9PiB7XG4gICAgaWYgKHBvY2tldFBhcnQubGVuZ3RoID4gNjQpXG4gICAgICAgIHJldHVybiBSZXN1bHQuZXJyKG5ldyBGZW5FcnJvcihJbnZhbGlkRmVuLlBvY2tldHMpKTtcbiAgICBjb25zdCBwb2NrZXRzID0gTWF0ZXJpYWwuZW1wdHkoKTtcbiAgICBmb3IgKGNvbnN0IGMgb2YgcG9ja2V0UGFydCkge1xuICAgICAgICBjb25zdCBwaWVjZSA9IGNoYXJUb1BpZWNlKGMpO1xuICAgICAgICBpZiAoIXBpZWNlKVxuICAgICAgICAgICAgcmV0dXJuIFJlc3VsdC5lcnIobmV3IEZlbkVycm9yKEludmFsaWRGZW4uUG9ja2V0cykpO1xuICAgICAgICBwb2NrZXRzW3BpZWNlLmNvbG9yXVtwaWVjZS5yb2xlXSsrO1xuICAgIH1cbiAgICByZXR1cm4gUmVzdWx0Lm9rKHBvY2tldHMpO1xufTtcbmV4cG9ydCBjb25zdCBwYXJzZUNhc3RsaW5nRmVuID0gKGJvYXJkLCBjYXN0bGluZ1BhcnQpID0+IHtcbiAgICBsZXQgY2FzdGxpbmdSaWdodHMgPSBTcXVhcmVTZXQuZW1wdHkoKTtcbiAgICBpZiAoY2FzdGxpbmdQYXJ0ID09PSAnLScpXG4gICAgICAgIHJldHVybiBSZXN1bHQub2soY2FzdGxpbmdSaWdodHMpO1xuICAgIGZvciAoY29uc3QgYyBvZiBjYXN0bGluZ1BhcnQpIHtcbiAgICAgICAgY29uc3QgbG93ZXIgPSBjLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIGNvbnN0IGNvbG9yID0gYyA9PT0gbG93ZXIgPyAnYmxhY2snIDogJ3doaXRlJztcbiAgICAgICAgY29uc3QgcmFuayA9IGNvbG9yID09PSAnd2hpdGUnID8gMCA6IDc7XG4gICAgICAgIGlmICgnYScgPD0gbG93ZXIgJiYgbG93ZXIgPD0gJ2gnKSB7XG4gICAgICAgICAgICBjYXN0bGluZ1JpZ2h0cyA9IGNhc3RsaW5nUmlnaHRzLndpdGgoc3F1YXJlRnJvbUNvb3Jkcyhsb3dlci5jaGFyQ29kZUF0KDApIC0gJ2EnLmNoYXJDb2RlQXQoMCksIHJhbmspKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChsb3dlciA9PT0gJ2snIHx8IGxvd2VyID09PSAncScpIHtcbiAgICAgICAgICAgIGNvbnN0IHJvb2tzQW5kS2luZ3MgPSBib2FyZFtjb2xvcl0uaW50ZXJzZWN0KFNxdWFyZVNldC5iYWNrcmFuayhjb2xvcikpLmludGVyc2VjdChib2FyZC5yb29rLnVuaW9uKGJvYXJkLmtpbmcpKTtcbiAgICAgICAgICAgIGNvbnN0IGNhbmRpZGF0ZSA9IGxvd2VyID09PSAnaycgPyByb29rc0FuZEtpbmdzLmxhc3QoKSA6IHJvb2tzQW5kS2luZ3MuZmlyc3QoKTtcbiAgICAgICAgICAgIGNhc3RsaW5nUmlnaHRzID0gY2FzdGxpbmdSaWdodHMud2l0aChkZWZpbmVkKGNhbmRpZGF0ZSkgJiYgYm9hcmQucm9vay5oYXMoY2FuZGlkYXRlKSA/IGNhbmRpZGF0ZSA6IHNxdWFyZUZyb21Db29yZHMobG93ZXIgPT09ICdrJyA/IDcgOiAwLCByYW5rKSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgcmV0dXJuIFJlc3VsdC5lcnIobmV3IEZlbkVycm9yKEludmFsaWRGZW4uQ2FzdGxpbmcpKTtcbiAgICB9XG4gICAgaWYgKENPTE9SUy5zb21lKGNvbG9yID0+IFNxdWFyZVNldC5iYWNrcmFuayhjb2xvcikuaW50ZXJzZWN0KGNhc3RsaW5nUmlnaHRzKS5zaXplKCkgPiAyKSkge1xuICAgICAgICByZXR1cm4gUmVzdWx0LmVycihuZXcgRmVuRXJyb3IoSW52YWxpZEZlbi5DYXN0bGluZykpO1xuICAgIH1cbiAgICByZXR1cm4gUmVzdWx0Lm9rKGNhc3RsaW5nUmlnaHRzKTtcbn07XG5leHBvcnQgY29uc3QgcGFyc2VSZW1haW5pbmdDaGVja3MgPSAocGFydCkgPT4ge1xuICAgIGNvbnN0IHBhcnRzID0gcGFydC5zcGxpdCgnKycpO1xuICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDMgJiYgcGFydHNbMF0gPT09ICcnKSB7XG4gICAgICAgIGNvbnN0IHdoaXRlID0gcGFyc2VTbWFsbFVpbnQocGFydHNbMV0pO1xuICAgICAgICBjb25zdCBibGFjayA9IHBhcnNlU21hbGxVaW50KHBhcnRzWzJdKTtcbiAgICAgICAgaWYgKCFkZWZpbmVkKHdoaXRlKSB8fCB3aGl0ZSA+IDMgfHwgIWRlZmluZWQoYmxhY2spIHx8IGJsYWNrID4gMykge1xuICAgICAgICAgICAgcmV0dXJuIFJlc3VsdC5lcnIobmV3IEZlbkVycm9yKEludmFsaWRGZW4uUmVtYWluaW5nQ2hlY2tzKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFJlc3VsdC5vayhuZXcgUmVtYWluaW5nQ2hlY2tzKDMgLSB3aGl0ZSwgMyAtIGJsYWNrKSk7XG4gICAgfVxuICAgIGVsc2UgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMikge1xuICAgICAgICBjb25zdCB3aGl0ZSA9IHBhcnNlU21hbGxVaW50KHBhcnRzWzBdKTtcbiAgICAgICAgY29uc3QgYmxhY2sgPSBwYXJzZVNtYWxsVWludChwYXJ0c1sxXSk7XG4gICAgICAgIGlmICghZGVmaW5lZCh3aGl0ZSkgfHwgd2hpdGUgPiAzIHx8ICFkZWZpbmVkKGJsYWNrKSB8fCBibGFjayA+IDMpIHtcbiAgICAgICAgICAgIHJldHVybiBSZXN1bHQuZXJyKG5ldyBGZW5FcnJvcihJbnZhbGlkRmVuLlJlbWFpbmluZ0NoZWNrcykpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBSZXN1bHQub2sobmV3IFJlbWFpbmluZ0NoZWNrcyh3aGl0ZSwgYmxhY2spKTtcbiAgICB9XG4gICAgZWxzZVxuICAgICAgICByZXR1cm4gUmVzdWx0LmVycihuZXcgRmVuRXJyb3IoSW52YWxpZEZlbi5SZW1haW5pbmdDaGVja3MpKTtcbn07XG5leHBvcnQgY29uc3QgcGFyc2VGZW4gPSAoZmVuKSA9PiB7XG4gICAgY29uc3QgcGFydHMgPSBmZW4uc3BsaXQoL1tcXHNfXSsvKTtcbiAgICBjb25zdCBib2FyZFBhcnQgPSBwYXJ0cy5zaGlmdCgpO1xuICAgIC8vIEJvYXJkIGFuZCBwb2NrZXRzXG4gICAgbGV0IGJvYXJkO1xuICAgIGxldCBwb2NrZXRzID0gUmVzdWx0Lm9rKHVuZGVmaW5lZCk7XG4gICAgaWYgKGJvYXJkUGFydC5lbmRzV2l0aCgnXScpKSB7XG4gICAgICAgIGNvbnN0IHBvY2tldFN0YXJ0ID0gYm9hcmRQYXJ0LmluZGV4T2YoJ1snKTtcbiAgICAgICAgaWYgKHBvY2tldFN0YXJ0ID09PSAtMSlcbiAgICAgICAgICAgIHJldHVybiBSZXN1bHQuZXJyKG5ldyBGZW5FcnJvcihJbnZhbGlkRmVuLkZlbikpO1xuICAgICAgICBib2FyZCA9IHBhcnNlQm9hcmRGZW4oYm9hcmRQYXJ0LnNsaWNlKDAsIHBvY2tldFN0YXJ0KSk7XG4gICAgICAgIHBvY2tldHMgPSBwYXJzZVBvY2tldHMoYm9hcmRQYXJ0LnNsaWNlKHBvY2tldFN0YXJ0ICsgMSwgLTEpKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGNvbnN0IHBvY2tldFN0YXJ0ID0gbnRoSW5kZXhPZihib2FyZFBhcnQsICcvJywgNyk7XG4gICAgICAgIGlmIChwb2NrZXRTdGFydCA9PT0gLTEpXG4gICAgICAgICAgICBib2FyZCA9IHBhcnNlQm9hcmRGZW4oYm9hcmRQYXJ0KTtcbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBib2FyZCA9IHBhcnNlQm9hcmRGZW4oYm9hcmRQYXJ0LnNsaWNlKDAsIHBvY2tldFN0YXJ0KSk7XG4gICAgICAgICAgICBwb2NrZXRzID0gcGFyc2VQb2NrZXRzKGJvYXJkUGFydC5zbGljZShwb2NrZXRTdGFydCArIDEpKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvLyBUdXJuXG4gICAgbGV0IHR1cm47XG4gICAgY29uc3QgdHVyblBhcnQgPSBwYXJ0cy5zaGlmdCgpO1xuICAgIGlmICghZGVmaW5lZCh0dXJuUGFydCkgfHwgdHVyblBhcnQgPT09ICd3JylcbiAgICAgICAgdHVybiA9ICd3aGl0ZSc7XG4gICAgZWxzZSBpZiAodHVyblBhcnQgPT09ICdiJylcbiAgICAgICAgdHVybiA9ICdibGFjayc7XG4gICAgZWxzZVxuICAgICAgICByZXR1cm4gUmVzdWx0LmVycihuZXcgRmVuRXJyb3IoSW52YWxpZEZlbi5UdXJuKSk7XG4gICAgcmV0dXJuIGJvYXJkLmNoYWluKGJvYXJkID0+IHtcbiAgICAgICAgLy8gQ2FzdGxpbmdcbiAgICAgICAgY29uc3QgY2FzdGxpbmdQYXJ0ID0gcGFydHMuc2hpZnQoKTtcbiAgICAgICAgY29uc3QgY2FzdGxpbmdSaWdodHMgPSBkZWZpbmVkKGNhc3RsaW5nUGFydCkgPyBwYXJzZUNhc3RsaW5nRmVuKGJvYXJkLCBjYXN0bGluZ1BhcnQpIDogUmVzdWx0Lm9rKFNxdWFyZVNldC5lbXB0eSgpKTtcbiAgICAgICAgLy8gRW4gcGFzc2FudCBzcXVhcmVcbiAgICAgICAgY29uc3QgZXBQYXJ0ID0gcGFydHMuc2hpZnQoKTtcbiAgICAgICAgbGV0IGVwU3F1YXJlO1xuICAgICAgICBpZiAoZGVmaW5lZChlcFBhcnQpICYmIGVwUGFydCAhPT0gJy0nKSB7XG4gICAgICAgICAgICBlcFNxdWFyZSA9IHBhcnNlU3F1YXJlKGVwUGFydCk7XG4gICAgICAgICAgICBpZiAoIWRlZmluZWQoZXBTcXVhcmUpKVxuICAgICAgICAgICAgICAgIHJldHVybiBSZXN1bHQuZXJyKG5ldyBGZW5FcnJvcihJbnZhbGlkRmVuLkVwU3F1YXJlKSk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gSGFsZm1vdmVzIG9yIHJlbWFpbmluZyBjaGVja3NcbiAgICAgICAgbGV0IGhhbGZtb3ZlUGFydCA9IHBhcnRzLnNoaWZ0KCk7XG4gICAgICAgIGxldCBlYXJseVJlbWFpbmluZ0NoZWNrcztcbiAgICAgICAgaWYgKGRlZmluZWQoaGFsZm1vdmVQYXJ0KSAmJiBoYWxmbW92ZVBhcnQuaW5jbHVkZXMoJysnKSkge1xuICAgICAgICAgICAgZWFybHlSZW1haW5pbmdDaGVja3MgPSBwYXJzZVJlbWFpbmluZ0NoZWNrcyhoYWxmbW92ZVBhcnQpO1xuICAgICAgICAgICAgaGFsZm1vdmVQYXJ0ID0gcGFydHMuc2hpZnQoKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBoYWxmbW92ZXMgPSBkZWZpbmVkKGhhbGZtb3ZlUGFydCkgPyBwYXJzZVNtYWxsVWludChoYWxmbW92ZVBhcnQpIDogMDtcbiAgICAgICAgaWYgKCFkZWZpbmVkKGhhbGZtb3ZlcykpXG4gICAgICAgICAgICByZXR1cm4gUmVzdWx0LmVycihuZXcgRmVuRXJyb3IoSW52YWxpZEZlbi5IYWxmbW92ZXMpKTtcbiAgICAgICAgY29uc3QgZnVsbG1vdmVzUGFydCA9IHBhcnRzLnNoaWZ0KCk7XG4gICAgICAgIGNvbnN0IGZ1bGxtb3ZlcyA9IGRlZmluZWQoZnVsbG1vdmVzUGFydCkgPyBwYXJzZVNtYWxsVWludChmdWxsbW92ZXNQYXJ0KSA6IDE7XG4gICAgICAgIGlmICghZGVmaW5lZChmdWxsbW92ZXMpKVxuICAgICAgICAgICAgcmV0dXJuIFJlc3VsdC5lcnIobmV3IEZlbkVycm9yKEludmFsaWRGZW4uRnVsbG1vdmVzKSk7XG4gICAgICAgIGNvbnN0IHJlbWFpbmluZ0NoZWNrc1BhcnQgPSBwYXJ0cy5zaGlmdCgpO1xuICAgICAgICBsZXQgcmVtYWluaW5nQ2hlY2tzID0gUmVzdWx0Lm9rKHVuZGVmaW5lZCk7XG4gICAgICAgIGlmIChkZWZpbmVkKHJlbWFpbmluZ0NoZWNrc1BhcnQpKSB7XG4gICAgICAgICAgICBpZiAoZGVmaW5lZChlYXJseVJlbWFpbmluZ0NoZWNrcykpXG4gICAgICAgICAgICAgICAgcmV0dXJuIFJlc3VsdC5lcnIobmV3IEZlbkVycm9yKEludmFsaWRGZW4uUmVtYWluaW5nQ2hlY2tzKSk7XG4gICAgICAgICAgICByZW1haW5pbmdDaGVja3MgPSBwYXJzZVJlbWFpbmluZ0NoZWNrcyhyZW1haW5pbmdDaGVja3NQYXJ0KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChkZWZpbmVkKGVhcmx5UmVtYWluaW5nQ2hlY2tzKSkge1xuICAgICAgICAgICAgcmVtYWluaW5nQ2hlY2tzID0gZWFybHlSZW1haW5pbmdDaGVja3M7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA+IDApXG4gICAgICAgICAgICByZXR1cm4gUmVzdWx0LmVycihuZXcgRmVuRXJyb3IoSW52YWxpZEZlbi5GZW4pKTtcbiAgICAgICAgcmV0dXJuIHBvY2tldHMuY2hhaW4ocG9ja2V0cyA9PiBjYXN0bGluZ1JpZ2h0cy5jaGFpbihjYXN0bGluZ1JpZ2h0cyA9PiByZW1haW5pbmdDaGVja3MubWFwKHJlbWFpbmluZ0NoZWNrcyA9PiB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGJvYXJkLFxuICAgICAgICAgICAgICAgIHBvY2tldHMsXG4gICAgICAgICAgICAgICAgdHVybixcbiAgICAgICAgICAgICAgICBjYXN0bGluZ1JpZ2h0cyxcbiAgICAgICAgICAgICAgICByZW1haW5pbmdDaGVja3MsXG4gICAgICAgICAgICAgICAgZXBTcXVhcmUsXG4gICAgICAgICAgICAgICAgaGFsZm1vdmVzLFxuICAgICAgICAgICAgICAgIGZ1bGxtb3ZlczogTWF0aC5tYXgoMSwgZnVsbG1vdmVzKSxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pKSk7XG4gICAgfSk7XG59O1xuZXhwb3J0IGNvbnN0IHBhcnNlUGllY2UgPSAoc3RyKSA9PiB7XG4gICAgaWYgKCFzdHIpXG4gICAgICAgIHJldHVybjtcbiAgICBjb25zdCBwaWVjZSA9IGNoYXJUb1BpZWNlKHN0clswXSk7XG4gICAgaWYgKCFwaWVjZSlcbiAgICAgICAgcmV0dXJuO1xuICAgIGlmIChzdHIubGVuZ3RoID09PSAyICYmIHN0clsxXSA9PT0gJ34nKVxuICAgICAgICBwaWVjZS5wcm9tb3RlZCA9IHRydWU7XG4gICAgZWxzZSBpZiAoc3RyLmxlbmd0aCA+IDEpXG4gICAgICAgIHJldHVybjtcbiAgICByZXR1cm4gcGllY2U7XG59O1xuZXhwb3J0IGNvbnN0IG1ha2VQaWVjZSA9IChwaWVjZSkgPT4ge1xuICAgIGxldCByID0gcm9sZVRvQ2hhcihwaWVjZS5yb2xlKTtcbiAgICBpZiAocGllY2UuY29sb3IgPT09ICd3aGl0ZScpXG4gICAgICAgIHIgPSByLnRvVXBwZXJDYXNlKCk7XG4gICAgaWYgKHBpZWNlLnByb21vdGVkKVxuICAgICAgICByICs9ICd+JztcbiAgICByZXR1cm4gcjtcbn07XG5leHBvcnQgY29uc3QgbWFrZUJvYXJkRmVuID0gKGJvYXJkKSA9PiB7XG4gICAgbGV0IGZlbiA9ICcnO1xuICAgIGxldCBlbXB0eSA9IDA7XG4gICAgZm9yIChsZXQgcmFuayA9IDc7IHJhbmsgPj0gMDsgcmFuay0tKSB7XG4gICAgICAgIGZvciAobGV0IGZpbGUgPSAwOyBmaWxlIDwgODsgZmlsZSsrKSB7XG4gICAgICAgICAgICBjb25zdCBzcXVhcmUgPSBmaWxlICsgcmFuayAqIDg7XG4gICAgICAgICAgICBjb25zdCBwaWVjZSA9IGJvYXJkLmdldChzcXVhcmUpO1xuICAgICAgICAgICAgaWYgKCFwaWVjZSlcbiAgICAgICAgICAgICAgICBlbXB0eSsrO1xuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKGVtcHR5ID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBmZW4gKz0gZW1wdHk7XG4gICAgICAgICAgICAgICAgICAgIGVtcHR5ID0gMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZmVuICs9IG1ha2VQaWVjZShwaWVjZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZmlsZSA9PT0gNykge1xuICAgICAgICAgICAgICAgIGlmIChlbXB0eSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgZmVuICs9IGVtcHR5O1xuICAgICAgICAgICAgICAgICAgICBlbXB0eSA9IDA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChyYW5rICE9PSAwKVxuICAgICAgICAgICAgICAgICAgICBmZW4gKz0gJy8nO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmZW47XG59O1xuZXhwb3J0IGNvbnN0IG1ha2VQb2NrZXQgPSAobWF0ZXJpYWwpID0+IFJPTEVTLm1hcChyb2xlID0+IHJvbGVUb0NoYXIocm9sZSkucmVwZWF0KG1hdGVyaWFsW3JvbGVdKSkuam9pbignJyk7XG5leHBvcnQgY29uc3QgbWFrZVBvY2tldHMgPSAocG9ja2V0KSA9PiBtYWtlUG9ja2V0KHBvY2tldC53aGl0ZSkudG9VcHBlckNhc2UoKSArIG1ha2VQb2NrZXQocG9ja2V0LmJsYWNrKTtcbmV4cG9ydCBjb25zdCBtYWtlQ2FzdGxpbmdGZW4gPSAoYm9hcmQsIGNhc3RsaW5nUmlnaHRzKSA9PiB7XG4gICAgbGV0IGZlbiA9ICcnO1xuICAgIGZvciAoY29uc3QgY29sb3Igb2YgQ09MT1JTKSB7XG4gICAgICAgIGNvbnN0IGJhY2tyYW5rID0gU3F1YXJlU2V0LmJhY2tyYW5rKGNvbG9yKTtcbiAgICAgICAgbGV0IGtpbmcgPSBib2FyZC5raW5nT2YoY29sb3IpO1xuICAgICAgICBpZiAoZGVmaW5lZChraW5nKSAmJiAhYmFja3JhbmsuaGFzKGtpbmcpKVxuICAgICAgICAgICAga2luZyA9IHVuZGVmaW5lZDtcbiAgICAgICAgY29uc3QgY2FuZGlkYXRlcyA9IGJvYXJkLnBpZWNlcyhjb2xvciwgJ3Jvb2snKS5pbnRlcnNlY3QoYmFja3JhbmspO1xuICAgICAgICBmb3IgKGNvbnN0IHJvb2sgb2YgY2FzdGxpbmdSaWdodHMuaW50ZXJzZWN0KGJhY2tyYW5rKS5yZXZlcnNlZCgpKSB7XG4gICAgICAgICAgICBpZiAocm9vayA9PT0gY2FuZGlkYXRlcy5maXJzdCgpICYmIGRlZmluZWQoa2luZykgJiYgcm9vayA8IGtpbmcpIHtcbiAgICAgICAgICAgICAgICBmZW4gKz0gY29sb3IgPT09ICd3aGl0ZScgPyAnUScgOiAncSc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChyb29rID09PSBjYW5kaWRhdGVzLmxhc3QoKSAmJiBkZWZpbmVkKGtpbmcpICYmIGtpbmcgPCByb29rKSB7XG4gICAgICAgICAgICAgICAgZmVuICs9IGNvbG9yID09PSAnd2hpdGUnID8gJ0snIDogJ2snO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZmlsZSA9IEZJTEVfTkFNRVNbc3F1YXJlRmlsZShyb29rKV07XG4gICAgICAgICAgICAgICAgZmVuICs9IGNvbG9yID09PSAnd2hpdGUnID8gZmlsZS50b1VwcGVyQ2FzZSgpIDogZmlsZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZmVuIHx8ICctJztcbn07XG5leHBvcnQgY29uc3QgbWFrZVJlbWFpbmluZ0NoZWNrcyA9IChjaGVja3MpID0+IGAke2NoZWNrcy53aGl0ZX0rJHtjaGVja3MuYmxhY2t9YDtcbmV4cG9ydCBjb25zdCBtYWtlRmVuID0gKHNldHVwLCBvcHRzKSA9PiBbXG4gICAgbWFrZUJvYXJkRmVuKHNldHVwLmJvYXJkKSArIChzZXR1cC5wb2NrZXRzID8gYFske21ha2VQb2NrZXRzKHNldHVwLnBvY2tldHMpfV1gIDogJycpLFxuICAgIHNldHVwLnR1cm5bMF0sXG4gICAgbWFrZUNhc3RsaW5nRmVuKHNldHVwLmJvYXJkLCBzZXR1cC5jYXN0bGluZ1JpZ2h0cyksXG4gICAgZGVmaW5lZChzZXR1cC5lcFNxdWFyZSkgPyBtYWtlU3F1YXJlKHNldHVwLmVwU3F1YXJlKSA6ICctJyxcbiAgICAuLi4oc2V0dXAucmVtYWluaW5nQ2hlY2tzID8gW21ha2VSZW1haW5pbmdDaGVja3Moc2V0dXAucmVtYWluaW5nQ2hlY2tzKV0gOiBbXSksXG4gICAgLi4uKChvcHRzID09PSBudWxsIHx8IG9wdHMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9wdHMuZXBkKSA/IFtdIDogW01hdGgubWF4KDAsIE1hdGgubWluKHNldHVwLmhhbGZtb3ZlcywgOTk5OSkpLCBNYXRoLm1heCgxLCBNYXRoLm1pbihzZXR1cC5mdWxsbW92ZXMsIDk5OTkpKV0pLFxuXS5qb2luKCcgJyk7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1mZW4uanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/chessops/dist/esm/fen.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/chessops/dist/esm/pgn.js":
/*!***********************************************!*\
  !*** ./node_modules/chessops/dist/esm/pgn.js ***!
  \***********************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Box: () => (/* binding */ Box),\n/* harmony export */   ChildNode: () => (/* binding */ ChildNode),\n/* harmony export */   Node: () => (/* binding */ Node),\n/* harmony export */   PgnError: () => (/* binding */ PgnError),\n/* harmony export */   PgnParser: () => (/* binding */ PgnParser),\n/* harmony export */   defaultGame: () => (/* binding */ defaultGame),\n/* harmony export */   defaultHeaders: () => (/* binding */ defaultHeaders),\n/* harmony export */   emptyHeaders: () => (/* binding */ emptyHeaders),\n/* harmony export */   extend: () => (/* binding */ extend),\n/* harmony export */   isChildNode: () => (/* binding */ isChildNode),\n/* harmony export */   isMate: () => (/* binding */ isMate),\n/* harmony export */   isPawns: () => (/* binding */ isPawns),\n/* harmony export */   makeComment: () => (/* binding */ makeComment),\n/* harmony export */   makeOutcome: () => (/* binding */ makeOutcome),\n/* harmony export */   makePgn: () => (/* binding */ makePgn),\n/* harmony export */   makeVariant: () => (/* binding */ makeVariant),\n/* harmony export */   parseComment: () => (/* binding */ parseComment),\n/* harmony export */   parseOutcome: () => (/* binding */ parseOutcome),\n/* harmony export */   parsePgn: () => (/* binding */ parsePgn),\n/* harmony export */   parseVariant: () => (/* binding */ parseVariant),\n/* harmony export */   setStartingPosition: () => (/* binding */ setStartingPosition),\n/* harmony export */   startingPosition: () => (/* binding */ startingPosition),\n/* harmony export */   transform: () => (/* binding */ transform),\n/* harmony export */   walk: () => (/* binding */ walk)\n/* harmony export */ });\n/* harmony import */ var _badrap_result__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @badrap/result */ \"(ssr)/./node_modules/@badrap/result/dist/node-mjs/index.mjs\");\n/* harmony import */ var _chess_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./chess.js */ \"(ssr)/./node_modules/chessops/dist/esm/chess.js\");\n/* harmony import */ var _fen_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./fen.js */ \"(ssr)/./node_modules/chessops/dist/esm/fen.js\");\n/* harmony import */ var _util_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./util.js */ \"(ssr)/./node_modules/chessops/dist/esm/util.js\");\n/* harmony import */ var _variant_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./variant.js */ \"(ssr)/./node_modules/chessops/dist/esm/variant.js\");\n/**\n * Parse, transform and write PGN.\n *\n * ## Parser\n *\n * The parser will interpret any input as a PGN, creating a tree of\n * syntactically valid (but not necessarily legal) moves, skipping any invalid\n * tokens.\n *\n * ```ts\n * import { parsePgn, startingPosition } from 'chessops/pgn';\n * import { parseSan } from 'chessops/san';\n *\n * const pgn = '1. d4 d5 *';\n * const games = parsePgn(pgn);\n * for (const game of games) {\n *   const pos = startingPosition(game.headers).unwrap();\n *   for (const node of game.moves.mainline()) {\n *     const move = parseSan(pos, node.san);\n *     if (!move) break; // Illegal move\n *     pos.play(move);\n *   }\n * }\n * ```\n *\n * ## Streaming parser\n *\n * The module also provides a denial-of-service resistant streaming parser.\n * It can be configured with a budget for reasonable complexity of a single\n * game, fed with chunks of text, and will yield parsed games as they are\n * completed.\n *\n * ```ts\n *\n * import { createReadStream } from 'fs';\n * import { PgnParser } from 'chessops/pgn';\n *\n * const stream = createReadStream('games.pgn', { encoding: 'utf-8' });\n *\n * const parser = new PgnParser((game, err) => {\n *   if (err) {\n *     // Budget exceeded.\n *     stream.destroy(err);\n *   }\n *\n *   // Use game ...\n * });\n *\n * await new Promise<void>(resolve =>\n *   stream\n *     .on('data', (chunk: string) => parser.parse(chunk, { stream: true }))\n *     .on('close', () => {\n *       parser.parse('');\n *       resolve();\n *     })\n * );\n * ```\n *\n * ## Augmenting the game tree\n *\n * You can use `walk` to visit all nodes in the game tree, or `transform`\n * to augment it with user data.\n *\n * Both allow you to provide context. You update the context inside the\n * callback, and it is automatically `clone()`-ed at each fork.\n * In the example below, the current position `pos` is provided as context.\n *\n * ```ts\n * import { transform } from 'chessops/pgn';\n * import { makeFen } from 'chessops/fen';\n * import { parseSan, makeSanAndPlay } from 'chessops/san';\n *\n * const pos = startingPosition(game.headers).unwrap();\n * game.moves = transform(game.moves, pos, (pos, node) => {\n *   const move = parseSan(pos, node.san);\n *   if (!move) {\n *     // Illegal move. Returning undefined cuts off the tree here.\n *     return;\n *   }\n *\n *   const san = makeSanAndPlay(pos, move); // Mutating pos!\n *\n *   return {\n *     ...node, // Keep comments and annotation glyphs\n *     san, // Normalized SAN\n *     fen: makeFen(pos.toSetup()), // Add arbitrary user data to node\n *   };\n * });\n * ```\n *\n * ## Writing\n *\n * Requires each node to at least have a `san` property.\n *\n * ```\n * import { makePgn } from 'chessops/pgn';\n *\n * const rewrittenPgn = makePgn(game);\n * ```\n *\n * @packageDocumentation\n */\n\n\n\n\n\nconst defaultGame = (initHeaders = defaultHeaders) => ({\n    headers: initHeaders(),\n    moves: new Node(),\n});\nclass Node {\n    constructor() {\n        this.children = [];\n    }\n    *mainlineNodes() {\n        let node = this;\n        while (node.children.length) {\n            const child = node.children[0];\n            yield child;\n            node = child;\n        }\n    }\n    *mainline() {\n        for (const child of this.mainlineNodes())\n            yield child.data;\n    }\n    end() {\n        let node = this;\n        while (node.children.length)\n            node = node.children[0];\n        return node;\n    }\n}\nclass ChildNode extends Node {\n    constructor(data) {\n        super();\n        this.data = data;\n    }\n}\nconst isChildNode = (node) => node instanceof ChildNode;\nconst extend = (node, data) => {\n    for (const d of data) {\n        const child = new ChildNode(d);\n        node.children.push(child);\n        node = child;\n    }\n    return node;\n};\nclass Box {\n    constructor(value) {\n        this.value = value;\n    }\n    clone() {\n        return new Box(this.value);\n    }\n}\nconst transform = (node, ctx, f) => {\n    const root = new Node();\n    const stack = [\n        {\n            before: node,\n            after: root,\n            ctx,\n        },\n    ];\n    let frame;\n    while ((frame = stack.pop())) {\n        for (let childIndex = 0; childIndex < frame.before.children.length; childIndex++) {\n            const ctx = childIndex < frame.before.children.length - 1 ? frame.ctx.clone() : frame.ctx;\n            const childBefore = frame.before.children[childIndex];\n            const data = f(ctx, childBefore.data, childIndex);\n            if ((0,_util_js__WEBPACK_IMPORTED_MODULE_0__.defined)(data)) {\n                const childAfter = new ChildNode(data);\n                frame.after.children.push(childAfter);\n                stack.push({\n                    before: childBefore,\n                    after: childAfter,\n                    ctx,\n                });\n            }\n        }\n    }\n    return root;\n};\nconst walk = (node, ctx, f) => {\n    const stack = [{ node, ctx }];\n    let frame;\n    while ((frame = stack.pop())) {\n        for (let childIndex = 0; childIndex < frame.node.children.length; childIndex++) {\n            const ctx = childIndex < frame.node.children.length - 1 ? frame.ctx.clone() : frame.ctx;\n            const child = frame.node.children[childIndex];\n            if (f(ctx, child.data, childIndex) !== false)\n                stack.push({ node: child, ctx });\n        }\n    }\n};\nconst makeOutcome = (outcome) => {\n    if (!outcome)\n        return '*';\n    else if (outcome.winner === 'white')\n        return '1-0';\n    else if (outcome.winner === 'black')\n        return '0-1';\n    else\n        return '1/2-1/2';\n};\nconst parseOutcome = (s) => {\n    if (s === '1-0' || s === '10' || s === '10')\n        return { winner: 'white' };\n    else if (s === '0-1' || s === '01' || s === '01')\n        return { winner: 'black' };\n    else if (s === '1/2-1/2' || s === '1/21/2' || s === '1/21/2')\n        return { winner: undefined };\n    else\n        return;\n};\nconst escapeHeader = (value) => value.replace(/\\\\/g, '\\\\\\\\').replace(/\"/g, '\\\\\"');\nconst safeComment = (comment) => comment.replace(/\\}/g, '');\nconst makePgn = (game) => {\n    const builder = [], tokens = [];\n    if (game.headers.size) {\n        for (const [key, value] of game.headers.entries()) {\n            builder.push('[', key, ' \"', escapeHeader(value), '\"]\\n');\n        }\n        builder.push('\\n');\n    }\n    for (const comment of game.comments || [])\n        tokens.push('{', safeComment(comment), '}');\n    const fen = game.headers.get('FEN');\n    const initialPly = fen\n        ? (0,_fen_js__WEBPACK_IMPORTED_MODULE_1__.parseFen)(fen).unwrap(setup => (setup.fullmoves - 1) * 2 + (setup.turn === 'white' ? 0 : 1), _ => 0)\n        : 0;\n    const stack = [];\n    const variations = game.moves.children[Symbol.iterator]();\n    const firstVariation = variations.next();\n    if (!firstVariation.done) {\n        stack.push({\n            state: 0 /* MakePgnState.Pre */,\n            ply: initialPly,\n            node: firstVariation.value,\n            sidelines: variations,\n            startsVariation: false,\n            inVariation: false,\n        });\n    }\n    let forceMoveNumber = true;\n    while (stack.length) {\n        const frame = stack[stack.length - 1];\n        if (frame.inVariation) {\n            tokens.push(')');\n            frame.inVariation = false;\n            forceMoveNumber = true;\n        }\n        switch (frame.state) {\n            case 0 /* MakePgnState.Pre */:\n                for (const comment of frame.node.data.startingComments || []) {\n                    tokens.push('{', safeComment(comment), '}');\n                    forceMoveNumber = true;\n                }\n                if (forceMoveNumber || frame.ply % 2 === 0) {\n                    tokens.push(Math.floor(frame.ply / 2) + 1 + (frame.ply % 2 ? '...' : '.'));\n                    forceMoveNumber = false;\n                }\n                tokens.push(frame.node.data.san);\n                for (const nag of frame.node.data.nags || []) {\n                    tokens.push('$' + nag);\n                    forceMoveNumber = true;\n                }\n                for (const comment of frame.node.data.comments || []) {\n                    tokens.push('{', safeComment(comment), '}');\n                }\n                frame.state = 1 /* MakePgnState.Sidelines */; // fall through\n            case 1 /* MakePgnState.Sidelines */: {\n                const child = frame.sidelines.next();\n                if (child.done) {\n                    const variations = frame.node.children[Symbol.iterator]();\n                    const firstVariation = variations.next();\n                    if (!firstVariation.done) {\n                        stack.push({\n                            state: 0 /* MakePgnState.Pre */,\n                            ply: frame.ply + 1,\n                            node: firstVariation.value,\n                            sidelines: variations,\n                            startsVariation: false,\n                            inVariation: false,\n                        });\n                    }\n                    frame.state = 2 /* MakePgnState.End */;\n                }\n                else {\n                    tokens.push('(');\n                    forceMoveNumber = true;\n                    stack.push({\n                        state: 0 /* MakePgnState.Pre */,\n                        ply: frame.ply,\n                        node: child.value,\n                        sidelines: [][Symbol.iterator](),\n                        startsVariation: true,\n                        inVariation: false,\n                    });\n                    frame.inVariation = true;\n                }\n                break;\n            }\n            case 2 /* MakePgnState.End */:\n                stack.pop();\n        }\n    }\n    tokens.push(makeOutcome(parseOutcome(game.headers.get('Result'))));\n    builder.push(tokens.join(' '), '\\n');\n    return builder.join('');\n};\nconst defaultHeaders = () => new Map([\n    ['Event', '?'],\n    ['Site', '?'],\n    ['Date', '????.??.??'],\n    ['Round', '?'],\n    ['White', '?'],\n    ['Black', '?'],\n    ['Result', '*'],\n]);\nconst emptyHeaders = () => new Map();\nconst BOM = '\\ufeff';\nconst isWhitespace = (line) => /^\\s*$/.test(line);\nconst isCommentLine = (line) => line.startsWith('%');\nclass PgnError extends Error {\n}\nclass PgnParser {\n    constructor(emitGame, initHeaders = defaultHeaders, maxBudget = 1000000) {\n        this.emitGame = emitGame;\n        this.initHeaders = initHeaders;\n        this.maxBudget = maxBudget;\n        this.lineBuf = [];\n        this.resetGame();\n        this.state = 0 /* ParserState.Bom */;\n    }\n    resetGame() {\n        this.budget = this.maxBudget;\n        this.found = false;\n        this.state = 1 /* ParserState.Pre */;\n        this.game = defaultGame(this.initHeaders);\n        this.stack = [{ parent: this.game.moves, root: true }];\n        this.commentBuf = [];\n    }\n    consumeBudget(cost) {\n        this.budget -= cost;\n        if (this.budget < 0)\n            throw new PgnError('ERR_PGN_BUDGET');\n    }\n    parse(data, options) {\n        if (this.budget < 0)\n            return;\n        try {\n            let idx = 0;\n            for (;;) {\n                const nlIdx = data.indexOf('\\n', idx);\n                if (nlIdx === -1) {\n                    break;\n                }\n                const crIdx = nlIdx > idx && data[nlIdx - 1] === '\\r' ? nlIdx - 1 : nlIdx;\n                this.consumeBudget(nlIdx - idx);\n                this.lineBuf.push(data.slice(idx, crIdx));\n                idx = nlIdx + 1;\n                this.handleLine();\n            }\n            this.consumeBudget(data.length - idx);\n            this.lineBuf.push(data.slice(idx));\n            if (!(options === null || options === void 0 ? void 0 : options.stream)) {\n                this.handleLine();\n                this.emit(undefined);\n            }\n        }\n        catch (err) {\n            this.emit(err);\n        }\n    }\n    handleLine() {\n        let freshLine = true;\n        let line = this.lineBuf.join('');\n        this.lineBuf = [];\n        continuedLine: for (;;) {\n            switch (this.state) {\n                case 0 /* ParserState.Bom */:\n                    if (line.startsWith(BOM))\n                        line = line.slice(BOM.length);\n                    this.state = 1 /* ParserState.Pre */; // fall through\n                case 1 /* ParserState.Pre */:\n                    if (isWhitespace(line) || isCommentLine(line))\n                        return;\n                    this.found = true;\n                    this.state = 2 /* ParserState.Headers */; // fall through\n                case 2 /* ParserState.Headers */: {\n                    if (isCommentLine(line))\n                        return;\n                    let moreHeaders = true;\n                    while (moreHeaders) {\n                        moreHeaders = false;\n                        line = line.replace(/^\\s*\\[([A-Za-z0-9][A-Za-z0-9_+#=:-]*)\\s+\"((?:[^\"\\\\]|\\\\\"|\\\\\\\\)*)\"\\]/, (_match, headerName, headerValue) => {\n                            this.consumeBudget(200);\n                            this.handleHeader(headerName, headerValue.replace(/\\\\\"/g, '\"').replace(/\\\\\\\\/g, '\\\\'));\n                            moreHeaders = true;\n                            freshLine = false;\n                            return '';\n                        });\n                    }\n                    if (isWhitespace(line))\n                        return;\n                    this.state = 3 /* ParserState.Moves */; // fall through\n                }\n                case 3 /* ParserState.Moves */: {\n                    if (freshLine) {\n                        if (isCommentLine(line))\n                            return;\n                        if (isWhitespace(line))\n                            return this.emit(undefined);\n                    }\n                    const tokenRegex = /(?:[NBKRQ]?[a-h]?[1-8]?[-x]?[a-h][1-8](?:=?[nbrqkNBRQK])?|[pnbrqkPNBRQK]?@[a-h][1-8]|[O0o][-][O0o](?:[-][O0o])?)[+#]?|--|Z0|0000|@@@@|{|;|\\$\\d{1,4}|[?!]{1,2}|\\(|\\)|\\*|1[-]0|0[-]1|1\\/2[-]1\\/2/g;\n                    let match;\n                    while ((match = tokenRegex.exec(line))) {\n                        const frame = this.stack[this.stack.length - 1];\n                        let token = match[0];\n                        if (token === ';')\n                            return;\n                        else if (token.startsWith('$'))\n                            this.handleNag(parseInt(token.slice(1), 10));\n                        else if (token === '!')\n                            this.handleNag(1);\n                        else if (token === '?')\n                            this.handleNag(2);\n                        else if (token === '!!')\n                            this.handleNag(3);\n                        else if (token === '??')\n                            this.handleNag(4);\n                        else if (token === '!?')\n                            this.handleNag(5);\n                        else if (token === '?!')\n                            this.handleNag(6);\n                        else if (token === '1-0' || token === '10' || token === '10'\n                            || token === '0-1' || token === '01' || token === '01'\n                            || token === '1/2-1/2' || token === '1/21/2' || token === '1/21/2'\n                            || token === '*') {\n                            if (this.stack.length === 1 && token !== '*')\n                                this.handleHeader('Result', token);\n                        }\n                        else if (token === '(') {\n                            this.consumeBudget(100);\n                            this.stack.push({ parent: frame.parent, root: false });\n                        }\n                        else if (token === ')') {\n                            if (this.stack.length > 1)\n                                this.stack.pop();\n                        }\n                        else if (token === '{') {\n                            const openIndex = tokenRegex.lastIndex;\n                            const beginIndex = line[openIndex] === ' ' ? openIndex + 1 : openIndex;\n                            line = line.slice(beginIndex);\n                            this.state = 4 /* ParserState.Comment */;\n                            continue continuedLine;\n                        }\n                        else {\n                            this.consumeBudget(100);\n                            if (token.startsWith('O') || token.startsWith('0') || token.startsWith('o')) {\n                                token = token.replace(/[0o]/g, 'O').replace(/[]/g, '-');\n                            }\n                            else if (token === 'Z0' || token === '0000' || token === '@@@@')\n                                token = '--';\n                            if (frame.node)\n                                frame.parent = frame.node;\n                            frame.node = new ChildNode({\n                                san: token,\n                                startingComments: frame.startingComments,\n                            });\n                            frame.startingComments = undefined;\n                            frame.root = false;\n                            frame.parent.children.push(frame.node);\n                        }\n                    }\n                    return;\n                }\n                case 4 /* ParserState.Comment */: {\n                    const closeIndex = line.indexOf('}');\n                    if (closeIndex === -1) {\n                        this.commentBuf.push(line);\n                        return;\n                    }\n                    else {\n                        const endIndex = closeIndex > 0 && line[closeIndex - 1] === ' ' ? closeIndex - 1 : closeIndex;\n                        this.commentBuf.push(line.slice(0, endIndex));\n                        this.handleComment();\n                        line = line.slice(closeIndex);\n                        this.state = 3 /* ParserState.Moves */;\n                        freshLine = false;\n                    }\n                }\n            }\n        }\n    }\n    handleHeader(name, value) {\n        this.game.headers.set(name, name === 'Result' ? makeOutcome(parseOutcome(value)) : value);\n    }\n    handleNag(nag) {\n        var _a;\n        this.consumeBudget(50);\n        const frame = this.stack[this.stack.length - 1];\n        if (frame.node) {\n            (_a = frame.node.data).nags || (_a.nags = []);\n            frame.node.data.nags.push(nag);\n        }\n    }\n    handleComment() {\n        var _a, _b;\n        this.consumeBudget(100);\n        const frame = this.stack[this.stack.length - 1];\n        const comment = this.commentBuf.join('\\n');\n        this.commentBuf = [];\n        if (frame.node) {\n            (_a = frame.node.data).comments || (_a.comments = []);\n            frame.node.data.comments.push(comment);\n        }\n        else if (frame.root) {\n            (_b = this.game).comments || (_b.comments = []);\n            this.game.comments.push(comment);\n        }\n        else {\n            frame.startingComments || (frame.startingComments = []);\n            frame.startingComments.push(comment);\n        }\n    }\n    emit(err) {\n        if (this.state === 4 /* ParserState.Comment */)\n            this.handleComment();\n        if (err)\n            return this.emitGame(this.game, err);\n        if (this.found)\n            this.emitGame(this.game, undefined);\n        this.resetGame();\n    }\n}\nconst parsePgn = (pgn, initHeaders = defaultHeaders) => {\n    const games = [];\n    new PgnParser(game => games.push(game), initHeaders, NaN).parse(pgn);\n    return games;\n};\nconst parseVariant = (variant) => {\n    switch ((variant || 'chess').toLowerCase()) {\n        case 'chess':\n        case 'chess960':\n        case 'chess 960':\n        case 'standard':\n        case 'from position':\n        case 'classical':\n        case 'normal':\n        case 'fischerandom': // Cute Chess\n        case 'fischerrandom':\n        case 'fischer random':\n        case 'wild/0':\n        case 'wild/1':\n        case 'wild/2':\n        case 'wild/3':\n        case 'wild/4':\n        case 'wild/5':\n        case 'wild/6':\n        case 'wild/7':\n        case 'wild/8':\n        case 'wild/8a':\n            return 'chess';\n        case 'crazyhouse':\n        case 'crazy house':\n        case 'house':\n        case 'zh':\n            return 'crazyhouse';\n        case 'king of the hill':\n        case 'koth':\n        case 'kingofthehill':\n            return 'kingofthehill';\n        case 'three-check':\n        case 'three check':\n        case 'threecheck':\n        case 'three check chess':\n        case '3-check':\n        case '3 check':\n        case '3check':\n            return '3check';\n        case 'antichess':\n        case 'anti chess':\n        case 'anti':\n            return 'antichess';\n        case 'atomic':\n        case 'atom':\n        case 'atomic chess':\n            return 'atomic';\n        case 'horde':\n        case 'horde chess':\n            return 'horde';\n        case 'racing kings':\n        case 'racingkings':\n        case 'racing':\n        case 'race':\n            return 'racingkings';\n        default:\n            return;\n    }\n};\nconst makeVariant = (rules) => {\n    switch (rules) {\n        case 'chess':\n            return;\n        case 'crazyhouse':\n            return 'Crazyhouse';\n        case 'racingkings':\n            return 'Racing Kings';\n        case 'horde':\n            return 'Horde';\n        case 'atomic':\n            return 'Atomic';\n        case 'antichess':\n            return 'Antichess';\n        case '3check':\n            return 'Three-check';\n        case 'kingofthehill':\n            return 'King of the Hill';\n    }\n};\nconst startingPosition = (headers) => {\n    const rules = parseVariant(headers.get('Variant'));\n    if (!rules)\n        return _badrap_result__WEBPACK_IMPORTED_MODULE_2__.Result.err(new _chess_js__WEBPACK_IMPORTED_MODULE_3__.PositionError(_chess_js__WEBPACK_IMPORTED_MODULE_3__.IllegalSetup.Variant));\n    const fen = headers.get('FEN');\n    if (fen)\n        return (0,_fen_js__WEBPACK_IMPORTED_MODULE_1__.parseFen)(fen).chain(setup => (0,_variant_js__WEBPACK_IMPORTED_MODULE_4__.setupPosition)(rules, setup));\n    else\n        return _badrap_result__WEBPACK_IMPORTED_MODULE_2__.Result.ok((0,_variant_js__WEBPACK_IMPORTED_MODULE_4__.defaultPosition)(rules));\n};\nconst setStartingPosition = (headers, pos) => {\n    const variant = makeVariant(pos.rules);\n    if (variant)\n        headers.set('Variant', variant);\n    else\n        headers.delete('Variant');\n    const fen = (0,_fen_js__WEBPACK_IMPORTED_MODULE_1__.makeFen)(pos.toSetup());\n    const defaultFen = (0,_fen_js__WEBPACK_IMPORTED_MODULE_1__.makeFen)((0,_variant_js__WEBPACK_IMPORTED_MODULE_4__.defaultPosition)(pos.rules).toSetup());\n    if (fen !== defaultFen)\n        headers.set('FEN', fen);\n    else\n        headers.delete('FEN');\n};\nconst isPawns = (ev) => 'pawns' in ev;\nconst isMate = (ev) => 'mate' in ev;\nconst makeClk = (seconds) => {\n    seconds = Math.max(0, seconds);\n    const hours = Math.floor(seconds / 3600);\n    const minutes = Math.floor((seconds % 3600) / 60);\n    seconds = (seconds % 3600) % 60;\n    return `${hours}:${minutes.toString().padStart(2, '0')}:${seconds.toLocaleString('en', {\n        minimumIntegerDigits: 2,\n        maximumFractionDigits: 3,\n    })}`;\n};\nconst makeCommentShapeColor = (color) => {\n    switch (color) {\n        case 'green':\n            return 'G';\n        case 'red':\n            return 'R';\n        case 'yellow':\n            return 'Y';\n        case 'blue':\n            return 'B';\n    }\n};\nfunction parseCommentShapeColor(str) {\n    switch (str) {\n        case 'G':\n            return 'green';\n        case 'R':\n            return 'red';\n        case 'Y':\n            return 'yellow';\n        case 'B':\n            return 'blue';\n        default:\n            return;\n    }\n}\nconst makeCommentShape = (shape) => shape.to === shape.from\n    ? `${makeCommentShapeColor(shape.color)}${(0,_util_js__WEBPACK_IMPORTED_MODULE_0__.makeSquare)(shape.to)}`\n    : `${makeCommentShapeColor(shape.color)}${(0,_util_js__WEBPACK_IMPORTED_MODULE_0__.makeSquare)(shape.from)}${(0,_util_js__WEBPACK_IMPORTED_MODULE_0__.makeSquare)(shape.to)}`;\nconst parseCommentShape = (str) => {\n    const color = parseCommentShapeColor(str.slice(0, 1));\n    const from = (0,_util_js__WEBPACK_IMPORTED_MODULE_0__.parseSquare)(str.slice(1, 3));\n    const to = (0,_util_js__WEBPACK_IMPORTED_MODULE_0__.parseSquare)(str.slice(3, 5));\n    if (!color || !(0,_util_js__WEBPACK_IMPORTED_MODULE_0__.defined)(from))\n        return;\n    if (str.length === 3)\n        return { color, from, to: from };\n    if (str.length === 5 && (0,_util_js__WEBPACK_IMPORTED_MODULE_0__.defined)(to))\n        return { color, from, to };\n    return;\n};\nconst makeEval = (ev) => {\n    const str = isMate(ev) ? '#' + ev.mate : ev.pawns.toFixed(2);\n    return (0,_util_js__WEBPACK_IMPORTED_MODULE_0__.defined)(ev.depth) ? str + ',' + ev.depth : str;\n};\nconst makeComment = (comment) => {\n    const builder = [];\n    if ((0,_util_js__WEBPACK_IMPORTED_MODULE_0__.defined)(comment.text))\n        builder.push(comment.text);\n    const circles = (comment.shapes || []).filter(shape => shape.to === shape.from).map(makeCommentShape);\n    if (circles.length)\n        builder.push(`[%csl ${circles.join(',')}]`);\n    const arrows = (comment.shapes || []).filter(shape => shape.to !== shape.from).map(makeCommentShape);\n    if (arrows.length)\n        builder.push(`[%cal ${arrows.join(',')}]`);\n    if (comment.evaluation)\n        builder.push(`[%eval ${makeEval(comment.evaluation)}]`);\n    if ((0,_util_js__WEBPACK_IMPORTED_MODULE_0__.defined)(comment.emt))\n        builder.push(`[%emt ${makeClk(comment.emt)}]`);\n    if ((0,_util_js__WEBPACK_IMPORTED_MODULE_0__.defined)(comment.clock))\n        builder.push(`[%clk ${makeClk(comment.clock)}]`);\n    return builder.join(' ');\n};\nconst parseComment = (comment) => {\n    let emt, clock, evaluation;\n    const shapes = [];\n    const text = comment\n        .replace(/\\s?\\[%(emt|clk)\\s(\\d{1,5}):(\\d{1,2}):(\\d{1,2}(?:\\.\\d{0,3})?)\\]\\s?/g, (_, annotation, hours, minutes, seconds) => {\n        const value = parseInt(hours, 10) * 3600 + parseInt(minutes, 10) * 60 + parseFloat(seconds);\n        if (annotation === 'emt')\n            emt = value;\n        else if (annotation === 'clk')\n            clock = value;\n        return '  ';\n    })\n        .replace(/\\s?\\[%(?:csl|cal)\\s([RGYB][a-h][1-8](?:[a-h][1-8])?(?:,[RGYB][a-h][1-8](?:[a-h][1-8])?)*)\\]\\s?/g, (_, arrows) => {\n        for (const arrow of arrows.split(',')) {\n            shapes.push(parseCommentShape(arrow));\n        }\n        return '  ';\n    })\n        .replace(/\\s?\\[%eval\\s(?:#([+-]?\\d{1,5})|([+-]?(?:\\d{1,5}|\\d{0,5}\\.\\d{1,2})))(?:,(\\d{1,5}))?\\]\\s?/g, (_, mate, pawns, d) => {\n        const depth = d && parseInt(d, 10);\n        evaluation = mate ? { mate: parseInt(mate, 10), depth } : { pawns: parseFloat(pawns), depth };\n        return '  ';\n    })\n        .trim();\n    return {\n        text,\n        shapes,\n        emt,\n        clock,\n        evaluation,\n    };\n};\n//# sourceMappingURL=pgn.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvY2hlc3NvcHMvZGlzdC9lc20vcGduLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLDZCQUE2QjtBQUN6QyxZQUFZLFdBQVc7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksbUJBQW1CO0FBQy9CLFlBQVksWUFBWTtBQUN4QjtBQUNBLGtEQUFrRCxtQkFBbUI7QUFDckU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQSw0REFBNEQsY0FBYztBQUMxRTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLFlBQVk7QUFDeEIsWUFBWSxVQUFVO0FBQ3RCLFlBQVksMkJBQTJCO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRDQUE0QztBQUM1QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLFVBQVU7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ3dDO0FBQ2lCO0FBQ1o7QUFDZ0I7QUFDQztBQUN2RDtBQUNQO0FBQ0E7QUFDQSxDQUFDO0FBQ007QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPO0FBQ0E7QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxpQ0FBaUMsMkNBQTJDO0FBQzVFO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixpREFBTztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPO0FBQ1AscUJBQXFCLFdBQVc7QUFDaEM7QUFDQTtBQUNBLGlDQUFpQyx5Q0FBeUM7QUFDMUU7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCLGtCQUFrQjtBQUMvQztBQUNBO0FBQ0E7QUFDTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPO0FBQ1A7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvREFBb0Q7QUFDN0M7QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCLDJCQUEyQjtBQUNqRDtBQUNBO0FBQ0EsVUFBVSxpREFBUTtBQUNsQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0NBQWtDLDJCQUEyQjtBQUM3RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0MsMkJBQTJCO0FBQzdEO0FBQ0EsOERBQThEO0FBQzlEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IscUNBQXFDO0FBQzdEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQjtBQUNuQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhCQUE4QjtBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBEQUEwRDtBQUMxRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhEQUE4RDtBQUM5RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0EsNERBQTREO0FBQzVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtTEFBbUwsRUFBRSxNQUFNLElBQUksTUFBTSxJQUFJO0FBQ3pNO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0NBQXdDO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhDQUE4QyxtQ0FBbUM7QUFDakY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZDQUE2QztBQUM3QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkI7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNEQUFzRDtBQUN0RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNBLGVBQWUsa0RBQU0sU0FBUyxvREFBYSxDQUFDLG1EQUFZO0FBQ3hEO0FBQ0E7QUFDQSxlQUFlLGlEQUFRLHFCQUFxQiwwREFBYTtBQUN6RDtBQUNBLGVBQWUsa0RBQU0sSUFBSSw0REFBZTtBQUN4QztBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixnREFBTztBQUN2Qix1QkFBdUIsZ0RBQU8sQ0FBQyw0REFBZTtBQUM5QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDQTtBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjLE1BQU0sR0FBRyxvQ0FBb0MsR0FBRztBQUM5RDtBQUNBO0FBQ0EsS0FBSyxFQUFFO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTLG1DQUFtQyxFQUFFLG9EQUFVLFdBQVc7QUFDbkUsU0FBUyxtQ0FBbUMsRUFBRSxvREFBVSxhQUFhLEVBQUUsb0RBQVUsV0FBVztBQUM1RjtBQUNBO0FBQ0EsaUJBQWlCLHFEQUFXO0FBQzVCLGVBQWUscURBQVc7QUFDMUIsbUJBQW1CLGlEQUFPO0FBQzFCO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakIsNEJBQTRCLGlEQUFPO0FBQ25DLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVcsaURBQU87QUFDbEI7QUFDTztBQUNQO0FBQ0EsUUFBUSxpREFBTztBQUNmO0FBQ0E7QUFDQTtBQUNBLDhCQUE4QixrQkFBa0I7QUFDaEQ7QUFDQTtBQUNBLDhCQUE4QixpQkFBaUI7QUFDL0M7QUFDQSwrQkFBK0IsNkJBQTZCO0FBQzVELFFBQVEsaURBQU87QUFDZiw4QkFBOEIscUJBQXFCO0FBQ25ELFFBQVEsaURBQU87QUFDZiw4QkFBOEIsdUJBQXVCO0FBQ3JEO0FBQ0E7QUFDTztBQUNQO0FBQ0E7QUFDQTtBQUNBLHVDQUF1QyxJQUFJLE1BQU0sSUFBSSxNQUFNLElBQUksUUFBUSxJQUFJO0FBQzNFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLDJDQUEyQyxJQUFJLGNBQWMsSUFBSSxJQUFJLElBQUksS0FBSyxJQUFJLFdBQVcsSUFBSTtBQUNqRztBQUNBLDhCQUE4QixrQ0FBa0MsSUFBSTtBQUNwRTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsiL1VzZXJzL3Jha3NoaXQvd29ya3NwYWNlL2FyY2hpdmVzL3JlcG9zL2NoZXNzL2V2YWwtYmFyL25vZGVfbW9kdWxlcy9jaGVzc29wcy9kaXN0L2VzbS9wZ24uanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBQYXJzZSwgdHJhbnNmb3JtIGFuZCB3cml0ZSBQR04uXG4gKlxuICogIyMgUGFyc2VyXG4gKlxuICogVGhlIHBhcnNlciB3aWxsIGludGVycHJldCBhbnkgaW5wdXQgYXMgYSBQR04sIGNyZWF0aW5nIGEgdHJlZSBvZlxuICogc3ludGFjdGljYWxseSB2YWxpZCAoYnV0IG5vdCBuZWNlc3NhcmlseSBsZWdhbCkgbW92ZXMsIHNraXBwaW5nIGFueSBpbnZhbGlkXG4gKiB0b2tlbnMuXG4gKlxuICogYGBgdHNcbiAqIGltcG9ydCB7IHBhcnNlUGduLCBzdGFydGluZ1Bvc2l0aW9uIH0gZnJvbSAnY2hlc3NvcHMvcGduJztcbiAqIGltcG9ydCB7IHBhcnNlU2FuIH0gZnJvbSAnY2hlc3NvcHMvc2FuJztcbiAqXG4gKiBjb25zdCBwZ24gPSAnMS4gZDQgZDUgKic7XG4gKiBjb25zdCBnYW1lcyA9IHBhcnNlUGduKHBnbik7XG4gKiBmb3IgKGNvbnN0IGdhbWUgb2YgZ2FtZXMpIHtcbiAqICAgY29uc3QgcG9zID0gc3RhcnRpbmdQb3NpdGlvbihnYW1lLmhlYWRlcnMpLnVud3JhcCgpO1xuICogICBmb3IgKGNvbnN0IG5vZGUgb2YgZ2FtZS5tb3Zlcy5tYWlubGluZSgpKSB7XG4gKiAgICAgY29uc3QgbW92ZSA9IHBhcnNlU2FuKHBvcywgbm9kZS5zYW4pO1xuICogICAgIGlmICghbW92ZSkgYnJlYWs7IC8vIElsbGVnYWwgbW92ZVxuICogICAgIHBvcy5wbGF5KG1vdmUpO1xuICogICB9XG4gKiB9XG4gKiBgYGBcbiAqXG4gKiAjIyBTdHJlYW1pbmcgcGFyc2VyXG4gKlxuICogVGhlIG1vZHVsZSBhbHNvIHByb3ZpZGVzIGEgZGVuaWFsLW9mLXNlcnZpY2UgcmVzaXN0YW50IHN0cmVhbWluZyBwYXJzZXIuXG4gKiBJdCBjYW4gYmUgY29uZmlndXJlZCB3aXRoIGEgYnVkZ2V0IGZvciByZWFzb25hYmxlIGNvbXBsZXhpdHkgb2YgYSBzaW5nbGVcbiAqIGdhbWUsIGZlZCB3aXRoIGNodW5rcyBvZiB0ZXh0LCBhbmQgd2lsbCB5aWVsZCBwYXJzZWQgZ2FtZXMgYXMgdGhleSBhcmVcbiAqIGNvbXBsZXRlZC5cbiAqXG4gKiBgYGB0c1xuICpcbiAqIGltcG9ydCB7IGNyZWF0ZVJlYWRTdHJlYW0gfSBmcm9tICdmcyc7XG4gKiBpbXBvcnQgeyBQZ25QYXJzZXIgfSBmcm9tICdjaGVzc29wcy9wZ24nO1xuICpcbiAqIGNvbnN0IHN0cmVhbSA9IGNyZWF0ZVJlYWRTdHJlYW0oJ2dhbWVzLnBnbicsIHsgZW5jb2Rpbmc6ICd1dGYtOCcgfSk7XG4gKlxuICogY29uc3QgcGFyc2VyID0gbmV3IFBnblBhcnNlcigoZ2FtZSwgZXJyKSA9PiB7XG4gKiAgIGlmIChlcnIpIHtcbiAqICAgICAvLyBCdWRnZXQgZXhjZWVkZWQuXG4gKiAgICAgc3RyZWFtLmRlc3Ryb3koZXJyKTtcbiAqICAgfVxuICpcbiAqICAgLy8gVXNlIGdhbWUgLi4uXG4gKiB9KTtcbiAqXG4gKiBhd2FpdCBuZXcgUHJvbWlzZTx2b2lkPihyZXNvbHZlID0+XG4gKiAgIHN0cmVhbVxuICogICAgIC5vbignZGF0YScsIChjaHVuazogc3RyaW5nKSA9PiBwYXJzZXIucGFyc2UoY2h1bmssIHsgc3RyZWFtOiB0cnVlIH0pKVxuICogICAgIC5vbignY2xvc2UnLCAoKSA9PiB7XG4gKiAgICAgICBwYXJzZXIucGFyc2UoJycpO1xuICogICAgICAgcmVzb2x2ZSgpO1xuICogICAgIH0pXG4gKiApO1xuICogYGBgXG4gKlxuICogIyMgQXVnbWVudGluZyB0aGUgZ2FtZSB0cmVlXG4gKlxuICogWW91IGNhbiB1c2UgYHdhbGtgIHRvIHZpc2l0IGFsbCBub2RlcyBpbiB0aGUgZ2FtZSB0cmVlLCBvciBgdHJhbnNmb3JtYFxuICogdG8gYXVnbWVudCBpdCB3aXRoIHVzZXIgZGF0YS5cbiAqXG4gKiBCb3RoIGFsbG93IHlvdSB0byBwcm92aWRlIGNvbnRleHQuIFlvdSB1cGRhdGUgdGhlIGNvbnRleHQgaW5zaWRlIHRoZVxuICogY2FsbGJhY2ssIGFuZCBpdCBpcyBhdXRvbWF0aWNhbGx5IGBjbG9uZSgpYC1lZCBhdCBlYWNoIGZvcmsuXG4gKiBJbiB0aGUgZXhhbXBsZSBiZWxvdywgdGhlIGN1cnJlbnQgcG9zaXRpb24gYHBvc2AgaXMgcHJvdmlkZWQgYXMgY29udGV4dC5cbiAqXG4gKiBgYGB0c1xuICogaW1wb3J0IHsgdHJhbnNmb3JtIH0gZnJvbSAnY2hlc3NvcHMvcGduJztcbiAqIGltcG9ydCB7IG1ha2VGZW4gfSBmcm9tICdjaGVzc29wcy9mZW4nO1xuICogaW1wb3J0IHsgcGFyc2VTYW4sIG1ha2VTYW5BbmRQbGF5IH0gZnJvbSAnY2hlc3NvcHMvc2FuJztcbiAqXG4gKiBjb25zdCBwb3MgPSBzdGFydGluZ1Bvc2l0aW9uKGdhbWUuaGVhZGVycykudW53cmFwKCk7XG4gKiBnYW1lLm1vdmVzID0gdHJhbnNmb3JtKGdhbWUubW92ZXMsIHBvcywgKHBvcywgbm9kZSkgPT4ge1xuICogICBjb25zdCBtb3ZlID0gcGFyc2VTYW4ocG9zLCBub2RlLnNhbik7XG4gKiAgIGlmICghbW92ZSkge1xuICogICAgIC8vIElsbGVnYWwgbW92ZS4gUmV0dXJuaW5nIHVuZGVmaW5lZCBjdXRzIG9mZiB0aGUgdHJlZSBoZXJlLlxuICogICAgIHJldHVybjtcbiAqICAgfVxuICpcbiAqICAgY29uc3Qgc2FuID0gbWFrZVNhbkFuZFBsYXkocG9zLCBtb3ZlKTsgLy8gTXV0YXRpbmcgcG9zIVxuICpcbiAqICAgcmV0dXJuIHtcbiAqICAgICAuLi5ub2RlLCAvLyBLZWVwIGNvbW1lbnRzIGFuZCBhbm5vdGF0aW9uIGdseXBoc1xuICogICAgIHNhbiwgLy8gTm9ybWFsaXplZCBTQU5cbiAqICAgICBmZW46IG1ha2VGZW4ocG9zLnRvU2V0dXAoKSksIC8vIEFkZCBhcmJpdHJhcnkgdXNlciBkYXRhIHRvIG5vZGVcbiAqICAgfTtcbiAqIH0pO1xuICogYGBgXG4gKlxuICogIyMgV3JpdGluZ1xuICpcbiAqIFJlcXVpcmVzIGVhY2ggbm9kZSB0byBhdCBsZWFzdCBoYXZlIGEgYHNhbmAgcHJvcGVydHkuXG4gKlxuICogYGBgXG4gKiBpbXBvcnQgeyBtYWtlUGduIH0gZnJvbSAnY2hlc3NvcHMvcGduJztcbiAqXG4gKiBjb25zdCByZXdyaXR0ZW5QZ24gPSBtYWtlUGduKGdhbWUpO1xuICogYGBgXG4gKlxuICogQHBhY2thZ2VEb2N1bWVudGF0aW9uXG4gKi9cbmltcG9ydCB7IFJlc3VsdCB9IGZyb20gJ0BiYWRyYXAvcmVzdWx0JztcbmltcG9ydCB7IElsbGVnYWxTZXR1cCwgUG9zaXRpb25FcnJvciB9IGZyb20gJy4vY2hlc3MuanMnO1xuaW1wb3J0IHsgbWFrZUZlbiwgcGFyc2VGZW4gfSBmcm9tICcuL2Zlbi5qcyc7XG5pbXBvcnQgeyBkZWZpbmVkLCBtYWtlU3F1YXJlLCBwYXJzZVNxdWFyZSB9IGZyb20gJy4vdXRpbC5qcyc7XG5pbXBvcnQgeyBkZWZhdWx0UG9zaXRpb24sIHNldHVwUG9zaXRpb24gfSBmcm9tICcuL3ZhcmlhbnQuanMnO1xuZXhwb3J0IGNvbnN0IGRlZmF1bHRHYW1lID0gKGluaXRIZWFkZXJzID0gZGVmYXVsdEhlYWRlcnMpID0+ICh7XG4gICAgaGVhZGVyczogaW5pdEhlYWRlcnMoKSxcbiAgICBtb3ZlczogbmV3IE5vZGUoKSxcbn0pO1xuZXhwb3J0IGNsYXNzIE5vZGUge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLmNoaWxkcmVuID0gW107XG4gICAgfVxuICAgICptYWlubGluZU5vZGVzKCkge1xuICAgICAgICBsZXQgbm9kZSA9IHRoaXM7XG4gICAgICAgIHdoaWxlIChub2RlLmNoaWxkcmVuLmxlbmd0aCkge1xuICAgICAgICAgICAgY29uc3QgY2hpbGQgPSBub2RlLmNoaWxkcmVuWzBdO1xuICAgICAgICAgICAgeWllbGQgY2hpbGQ7XG4gICAgICAgICAgICBub2RlID0gY2hpbGQ7XG4gICAgICAgIH1cbiAgICB9XG4gICAgKm1haW5saW5lKCkge1xuICAgICAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIHRoaXMubWFpbmxpbmVOb2RlcygpKVxuICAgICAgICAgICAgeWllbGQgY2hpbGQuZGF0YTtcbiAgICB9XG4gICAgZW5kKCkge1xuICAgICAgICBsZXQgbm9kZSA9IHRoaXM7XG4gICAgICAgIHdoaWxlIChub2RlLmNoaWxkcmVuLmxlbmd0aClcbiAgICAgICAgICAgIG5vZGUgPSBub2RlLmNoaWxkcmVuWzBdO1xuICAgICAgICByZXR1cm4gbm9kZTtcbiAgICB9XG59XG5leHBvcnQgY2xhc3MgQ2hpbGROb2RlIGV4dGVuZHMgTm9kZSB7XG4gICAgY29uc3RydWN0b3IoZGF0YSkge1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICB0aGlzLmRhdGEgPSBkYXRhO1xuICAgIH1cbn1cbmV4cG9ydCBjb25zdCBpc0NoaWxkTm9kZSA9IChub2RlKSA9PiBub2RlIGluc3RhbmNlb2YgQ2hpbGROb2RlO1xuZXhwb3J0IGNvbnN0IGV4dGVuZCA9IChub2RlLCBkYXRhKSA9PiB7XG4gICAgZm9yIChjb25zdCBkIG9mIGRhdGEpIHtcbiAgICAgICAgY29uc3QgY2hpbGQgPSBuZXcgQ2hpbGROb2RlKGQpO1xuICAgICAgICBub2RlLmNoaWxkcmVuLnB1c2goY2hpbGQpO1xuICAgICAgICBub2RlID0gY2hpbGQ7XG4gICAgfVxuICAgIHJldHVybiBub2RlO1xufTtcbmV4cG9ydCBjbGFzcyBCb3gge1xuICAgIGNvbnN0cnVjdG9yKHZhbHVlKSB7XG4gICAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTtcbiAgICB9XG4gICAgY2xvbmUoKSB7XG4gICAgICAgIHJldHVybiBuZXcgQm94KHRoaXMudmFsdWUpO1xuICAgIH1cbn1cbmV4cG9ydCBjb25zdCB0cmFuc2Zvcm0gPSAobm9kZSwgY3R4LCBmKSA9PiB7XG4gICAgY29uc3Qgcm9vdCA9IG5ldyBOb2RlKCk7XG4gICAgY29uc3Qgc3RhY2sgPSBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGJlZm9yZTogbm9kZSxcbiAgICAgICAgICAgIGFmdGVyOiByb290LFxuICAgICAgICAgICAgY3R4LFxuICAgICAgICB9LFxuICAgIF07XG4gICAgbGV0IGZyYW1lO1xuICAgIHdoaWxlICgoZnJhbWUgPSBzdGFjay5wb3AoKSkpIHtcbiAgICAgICAgZm9yIChsZXQgY2hpbGRJbmRleCA9IDA7IGNoaWxkSW5kZXggPCBmcmFtZS5iZWZvcmUuY2hpbGRyZW4ubGVuZ3RoOyBjaGlsZEluZGV4KyspIHtcbiAgICAgICAgICAgIGNvbnN0IGN0eCA9IGNoaWxkSW5kZXggPCBmcmFtZS5iZWZvcmUuY2hpbGRyZW4ubGVuZ3RoIC0gMSA/IGZyYW1lLmN0eC5jbG9uZSgpIDogZnJhbWUuY3R4O1xuICAgICAgICAgICAgY29uc3QgY2hpbGRCZWZvcmUgPSBmcmFtZS5iZWZvcmUuY2hpbGRyZW5bY2hpbGRJbmRleF07XG4gICAgICAgICAgICBjb25zdCBkYXRhID0gZihjdHgsIGNoaWxkQmVmb3JlLmRhdGEsIGNoaWxkSW5kZXgpO1xuICAgICAgICAgICAgaWYgKGRlZmluZWQoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBjaGlsZEFmdGVyID0gbmV3IENoaWxkTm9kZShkYXRhKTtcbiAgICAgICAgICAgICAgICBmcmFtZS5hZnRlci5jaGlsZHJlbi5wdXNoKGNoaWxkQWZ0ZXIpO1xuICAgICAgICAgICAgICAgIHN0YWNrLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBiZWZvcmU6IGNoaWxkQmVmb3JlLFxuICAgICAgICAgICAgICAgICAgICBhZnRlcjogY2hpbGRBZnRlcixcbiAgICAgICAgICAgICAgICAgICAgY3R4LFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiByb290O1xufTtcbmV4cG9ydCBjb25zdCB3YWxrID0gKG5vZGUsIGN0eCwgZikgPT4ge1xuICAgIGNvbnN0IHN0YWNrID0gW3sgbm9kZSwgY3R4IH1dO1xuICAgIGxldCBmcmFtZTtcbiAgICB3aGlsZSAoKGZyYW1lID0gc3RhY2sucG9wKCkpKSB7XG4gICAgICAgIGZvciAobGV0IGNoaWxkSW5kZXggPSAwOyBjaGlsZEluZGV4IDwgZnJhbWUubm9kZS5jaGlsZHJlbi5sZW5ndGg7IGNoaWxkSW5kZXgrKykge1xuICAgICAgICAgICAgY29uc3QgY3R4ID0gY2hpbGRJbmRleCA8IGZyYW1lLm5vZGUuY2hpbGRyZW4ubGVuZ3RoIC0gMSA/IGZyYW1lLmN0eC5jbG9uZSgpIDogZnJhbWUuY3R4O1xuICAgICAgICAgICAgY29uc3QgY2hpbGQgPSBmcmFtZS5ub2RlLmNoaWxkcmVuW2NoaWxkSW5kZXhdO1xuICAgICAgICAgICAgaWYgKGYoY3R4LCBjaGlsZC5kYXRhLCBjaGlsZEluZGV4KSAhPT0gZmFsc2UpXG4gICAgICAgICAgICAgICAgc3RhY2sucHVzaCh7IG5vZGU6IGNoaWxkLCBjdHggfSk7XG4gICAgICAgIH1cbiAgICB9XG59O1xuZXhwb3J0IGNvbnN0IG1ha2VPdXRjb21lID0gKG91dGNvbWUpID0+IHtcbiAgICBpZiAoIW91dGNvbWUpXG4gICAgICAgIHJldHVybiAnKic7XG4gICAgZWxzZSBpZiAob3V0Y29tZS53aW5uZXIgPT09ICd3aGl0ZScpXG4gICAgICAgIHJldHVybiAnMS0wJztcbiAgICBlbHNlIGlmIChvdXRjb21lLndpbm5lciA9PT0gJ2JsYWNrJylcbiAgICAgICAgcmV0dXJuICcwLTEnO1xuICAgIGVsc2VcbiAgICAgICAgcmV0dXJuICcxLzItMS8yJztcbn07XG5leHBvcnQgY29uc3QgcGFyc2VPdXRjb21lID0gKHMpID0+IHtcbiAgICBpZiAocyA9PT0gJzEtMCcgfHwgcyA9PT0gJzHigJMwJyB8fCBzID09PSAnMeKAlDAnKVxuICAgICAgICByZXR1cm4geyB3aW5uZXI6ICd3aGl0ZScgfTtcbiAgICBlbHNlIGlmIChzID09PSAnMC0xJyB8fCBzID09PSAnMOKAkzEnIHx8IHMgPT09ICcw4oCUMScpXG4gICAgICAgIHJldHVybiB7IHdpbm5lcjogJ2JsYWNrJyB9O1xuICAgIGVsc2UgaWYgKHMgPT09ICcxLzItMS8yJyB8fCBzID09PSAnMS8y4oCTMS8yJyB8fCBzID09PSAnMS8y4oCUMS8yJylcbiAgICAgICAgcmV0dXJuIHsgd2lubmVyOiB1bmRlZmluZWQgfTtcbiAgICBlbHNlXG4gICAgICAgIHJldHVybjtcbn07XG5jb25zdCBlc2NhcGVIZWFkZXIgPSAodmFsdWUpID0+IHZhbHVlLnJlcGxhY2UoL1xcXFwvZywgJ1xcXFxcXFxcJykucmVwbGFjZSgvXCIvZywgJ1xcXFxcIicpO1xuY29uc3Qgc2FmZUNvbW1lbnQgPSAoY29tbWVudCkgPT4gY29tbWVudC5yZXBsYWNlKC9cXH0vZywgJycpO1xuZXhwb3J0IGNvbnN0IG1ha2VQZ24gPSAoZ2FtZSkgPT4ge1xuICAgIGNvbnN0IGJ1aWxkZXIgPSBbXSwgdG9rZW5zID0gW107XG4gICAgaWYgKGdhbWUuaGVhZGVycy5zaXplKSB7XG4gICAgICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIGdhbWUuaGVhZGVycy5lbnRyaWVzKCkpIHtcbiAgICAgICAgICAgIGJ1aWxkZXIucHVzaCgnWycsIGtleSwgJyBcIicsIGVzY2FwZUhlYWRlcih2YWx1ZSksICdcIl1cXG4nKTtcbiAgICAgICAgfVxuICAgICAgICBidWlsZGVyLnB1c2goJ1xcbicpO1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IGNvbW1lbnQgb2YgZ2FtZS5jb21tZW50cyB8fCBbXSlcbiAgICAgICAgdG9rZW5zLnB1c2goJ3snLCBzYWZlQ29tbWVudChjb21tZW50KSwgJ30nKTtcbiAgICBjb25zdCBmZW4gPSBnYW1lLmhlYWRlcnMuZ2V0KCdGRU4nKTtcbiAgICBjb25zdCBpbml0aWFsUGx5ID0gZmVuXG4gICAgICAgID8gcGFyc2VGZW4oZmVuKS51bndyYXAoc2V0dXAgPT4gKHNldHVwLmZ1bGxtb3ZlcyAtIDEpICogMiArIChzZXR1cC50dXJuID09PSAnd2hpdGUnID8gMCA6IDEpLCBfID0+IDApXG4gICAgICAgIDogMDtcbiAgICBjb25zdCBzdGFjayA9IFtdO1xuICAgIGNvbnN0IHZhcmlhdGlvbnMgPSBnYW1lLm1vdmVzLmNoaWxkcmVuW1N5bWJvbC5pdGVyYXRvcl0oKTtcbiAgICBjb25zdCBmaXJzdFZhcmlhdGlvbiA9IHZhcmlhdGlvbnMubmV4dCgpO1xuICAgIGlmICghZmlyc3RWYXJpYXRpb24uZG9uZSkge1xuICAgICAgICBzdGFjay5wdXNoKHtcbiAgICAgICAgICAgIHN0YXRlOiAwIC8qIE1ha2VQZ25TdGF0ZS5QcmUgKi8sXG4gICAgICAgICAgICBwbHk6IGluaXRpYWxQbHksXG4gICAgICAgICAgICBub2RlOiBmaXJzdFZhcmlhdGlvbi52YWx1ZSxcbiAgICAgICAgICAgIHNpZGVsaW5lczogdmFyaWF0aW9ucyxcbiAgICAgICAgICAgIHN0YXJ0c1ZhcmlhdGlvbjogZmFsc2UsXG4gICAgICAgICAgICBpblZhcmlhdGlvbjogZmFsc2UsXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBsZXQgZm9yY2VNb3ZlTnVtYmVyID0gdHJ1ZTtcbiAgICB3aGlsZSAoc3RhY2subGVuZ3RoKSB7XG4gICAgICAgIGNvbnN0IGZyYW1lID0gc3RhY2tbc3RhY2subGVuZ3RoIC0gMV07XG4gICAgICAgIGlmIChmcmFtZS5pblZhcmlhdGlvbikge1xuICAgICAgICAgICAgdG9rZW5zLnB1c2goJyknKTtcbiAgICAgICAgICAgIGZyYW1lLmluVmFyaWF0aW9uID0gZmFsc2U7XG4gICAgICAgICAgICBmb3JjZU1vdmVOdW1iZXIgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHN3aXRjaCAoZnJhbWUuc3RhdGUpIHtcbiAgICAgICAgICAgIGNhc2UgMCAvKiBNYWtlUGduU3RhdGUuUHJlICovOlxuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgY29tbWVudCBvZiBmcmFtZS5ub2RlLmRhdGEuc3RhcnRpbmdDb21tZW50cyB8fCBbXSkge1xuICAgICAgICAgICAgICAgICAgICB0b2tlbnMucHVzaCgneycsIHNhZmVDb21tZW50KGNvbW1lbnQpLCAnfScpO1xuICAgICAgICAgICAgICAgICAgICBmb3JjZU1vdmVOdW1iZXIgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoZm9yY2VNb3ZlTnVtYmVyIHx8IGZyYW1lLnBseSAlIDIgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdG9rZW5zLnB1c2goTWF0aC5mbG9vcihmcmFtZS5wbHkgLyAyKSArIDEgKyAoZnJhbWUucGx5ICUgMiA/ICcuLi4nIDogJy4nKSk7XG4gICAgICAgICAgICAgICAgICAgIGZvcmNlTW92ZU51bWJlciA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0b2tlbnMucHVzaChmcmFtZS5ub2RlLmRhdGEuc2FuKTtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IG5hZyBvZiBmcmFtZS5ub2RlLmRhdGEubmFncyB8fCBbXSkge1xuICAgICAgICAgICAgICAgICAgICB0b2tlbnMucHVzaCgnJCcgKyBuYWcpO1xuICAgICAgICAgICAgICAgICAgICBmb3JjZU1vdmVOdW1iZXIgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGNvbW1lbnQgb2YgZnJhbWUubm9kZS5kYXRhLmNvbW1lbnRzIHx8IFtdKSB7XG4gICAgICAgICAgICAgICAgICAgIHRva2Vucy5wdXNoKCd7Jywgc2FmZUNvbW1lbnQoY29tbWVudCksICd9Jyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGZyYW1lLnN0YXRlID0gMSAvKiBNYWtlUGduU3RhdGUuU2lkZWxpbmVzICovOyAvLyBmYWxsIHRocm91Z2hcbiAgICAgICAgICAgIGNhc2UgMSAvKiBNYWtlUGduU3RhdGUuU2lkZWxpbmVzICovOiB7XG4gICAgICAgICAgICAgICAgY29uc3QgY2hpbGQgPSBmcmFtZS5zaWRlbGluZXMubmV4dCgpO1xuICAgICAgICAgICAgICAgIGlmIChjaGlsZC5kb25lKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhcmlhdGlvbnMgPSBmcmFtZS5ub2RlLmNoaWxkcmVuW1N5bWJvbC5pdGVyYXRvcl0oKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZmlyc3RWYXJpYXRpb24gPSB2YXJpYXRpb25zLm5leHQoKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFmaXJzdFZhcmlhdGlvbi5kb25lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdGFjay5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZTogMCAvKiBNYWtlUGduU3RhdGUuUHJlICovLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBseTogZnJhbWUucGx5ICsgMSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2RlOiBmaXJzdFZhcmlhdGlvbi52YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaWRlbGluZXM6IHZhcmlhdGlvbnMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRzVmFyaWF0aW9uOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpblZhcmlhdGlvbjogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBmcmFtZS5zdGF0ZSA9IDIgLyogTWFrZVBnblN0YXRlLkVuZCAqLztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRva2Vucy5wdXNoKCcoJyk7XG4gICAgICAgICAgICAgICAgICAgIGZvcmNlTW92ZU51bWJlciA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHN0YWNrLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGU6IDAgLyogTWFrZVBnblN0YXRlLlByZSAqLyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBseTogZnJhbWUucGx5LFxuICAgICAgICAgICAgICAgICAgICAgICAgbm9kZTogY2hpbGQudmFsdWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBzaWRlbGluZXM6IFtdW1N5bWJvbC5pdGVyYXRvcl0oKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0c1ZhcmlhdGlvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGluVmFyaWF0aW9uOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGZyYW1lLmluVmFyaWF0aW9uID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXNlIDIgLyogTWFrZVBnblN0YXRlLkVuZCAqLzpcbiAgICAgICAgICAgICAgICBzdGFjay5wb3AoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICB0b2tlbnMucHVzaChtYWtlT3V0Y29tZShwYXJzZU91dGNvbWUoZ2FtZS5oZWFkZXJzLmdldCgnUmVzdWx0JykpKSk7XG4gICAgYnVpbGRlci5wdXNoKHRva2Vucy5qb2luKCcgJyksICdcXG4nKTtcbiAgICByZXR1cm4gYnVpbGRlci5qb2luKCcnKTtcbn07XG5leHBvcnQgY29uc3QgZGVmYXVsdEhlYWRlcnMgPSAoKSA9PiBuZXcgTWFwKFtcbiAgICBbJ0V2ZW50JywgJz8nXSxcbiAgICBbJ1NpdGUnLCAnPyddLFxuICAgIFsnRGF0ZScsICc/Pz8/Lj8/Lj8/J10sXG4gICAgWydSb3VuZCcsICc/J10sXG4gICAgWydXaGl0ZScsICc/J10sXG4gICAgWydCbGFjaycsICc/J10sXG4gICAgWydSZXN1bHQnLCAnKiddLFxuXSk7XG5leHBvcnQgY29uc3QgZW1wdHlIZWFkZXJzID0gKCkgPT4gbmV3IE1hcCgpO1xuY29uc3QgQk9NID0gJ1xcdWZlZmYnO1xuY29uc3QgaXNXaGl0ZXNwYWNlID0gKGxpbmUpID0+IC9eXFxzKiQvLnRlc3QobGluZSk7XG5jb25zdCBpc0NvbW1lbnRMaW5lID0gKGxpbmUpID0+IGxpbmUuc3RhcnRzV2l0aCgnJScpO1xuZXhwb3J0IGNsYXNzIFBnbkVycm9yIGV4dGVuZHMgRXJyb3Ige1xufVxuZXhwb3J0IGNsYXNzIFBnblBhcnNlciB7XG4gICAgY29uc3RydWN0b3IoZW1pdEdhbWUsIGluaXRIZWFkZXJzID0gZGVmYXVsdEhlYWRlcnMsIG1heEJ1ZGdldCA9IDEwMDAwMDApIHtcbiAgICAgICAgdGhpcy5lbWl0R2FtZSA9IGVtaXRHYW1lO1xuICAgICAgICB0aGlzLmluaXRIZWFkZXJzID0gaW5pdEhlYWRlcnM7XG4gICAgICAgIHRoaXMubWF4QnVkZ2V0ID0gbWF4QnVkZ2V0O1xuICAgICAgICB0aGlzLmxpbmVCdWYgPSBbXTtcbiAgICAgICAgdGhpcy5yZXNldEdhbWUoKTtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IDAgLyogUGFyc2VyU3RhdGUuQm9tICovO1xuICAgIH1cbiAgICByZXNldEdhbWUoKSB7XG4gICAgICAgIHRoaXMuYnVkZ2V0ID0gdGhpcy5tYXhCdWRnZXQ7XG4gICAgICAgIHRoaXMuZm91bmQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IDEgLyogUGFyc2VyU3RhdGUuUHJlICovO1xuICAgICAgICB0aGlzLmdhbWUgPSBkZWZhdWx0R2FtZSh0aGlzLmluaXRIZWFkZXJzKTtcbiAgICAgICAgdGhpcy5zdGFjayA9IFt7IHBhcmVudDogdGhpcy5nYW1lLm1vdmVzLCByb290OiB0cnVlIH1dO1xuICAgICAgICB0aGlzLmNvbW1lbnRCdWYgPSBbXTtcbiAgICB9XG4gICAgY29uc3VtZUJ1ZGdldChjb3N0KSB7XG4gICAgICAgIHRoaXMuYnVkZ2V0IC09IGNvc3Q7XG4gICAgICAgIGlmICh0aGlzLmJ1ZGdldCA8IDApXG4gICAgICAgICAgICB0aHJvdyBuZXcgUGduRXJyb3IoJ0VSUl9QR05fQlVER0VUJyk7XG4gICAgfVxuICAgIHBhcnNlKGRhdGEsIG9wdGlvbnMpIHtcbiAgICAgICAgaWYgKHRoaXMuYnVkZ2V0IDwgMClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGxldCBpZHggPSAwO1xuICAgICAgICAgICAgZm9yICg7Oykge1xuICAgICAgICAgICAgICAgIGNvbnN0IG5sSWR4ID0gZGF0YS5pbmRleE9mKCdcXG4nLCBpZHgpO1xuICAgICAgICAgICAgICAgIGlmIChubElkeCA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnN0IGNySWR4ID0gbmxJZHggPiBpZHggJiYgZGF0YVtubElkeCAtIDFdID09PSAnXFxyJyA/IG5sSWR4IC0gMSA6IG5sSWR4O1xuICAgICAgICAgICAgICAgIHRoaXMuY29uc3VtZUJ1ZGdldChubElkeCAtIGlkeCk7XG4gICAgICAgICAgICAgICAgdGhpcy5saW5lQnVmLnB1c2goZGF0YS5zbGljZShpZHgsIGNySWR4KSk7XG4gICAgICAgICAgICAgICAgaWR4ID0gbmxJZHggKyAxO1xuICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlTGluZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5jb25zdW1lQnVkZ2V0KGRhdGEubGVuZ3RoIC0gaWR4KTtcbiAgICAgICAgICAgIHRoaXMubGluZUJ1Zi5wdXNoKGRhdGEuc2xpY2UoaWR4KSk7XG4gICAgICAgICAgICBpZiAoIShvcHRpb25zID09PSBudWxsIHx8IG9wdGlvbnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9wdGlvbnMuc3RyZWFtKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlTGluZSgpO1xuICAgICAgICAgICAgICAgIHRoaXMuZW1pdCh1bmRlZmluZWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIHRoaXMuZW1pdChlcnIpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGhhbmRsZUxpbmUoKSB7XG4gICAgICAgIGxldCBmcmVzaExpbmUgPSB0cnVlO1xuICAgICAgICBsZXQgbGluZSA9IHRoaXMubGluZUJ1Zi5qb2luKCcnKTtcbiAgICAgICAgdGhpcy5saW5lQnVmID0gW107XG4gICAgICAgIGNvbnRpbnVlZExpbmU6IGZvciAoOzspIHtcbiAgICAgICAgICAgIHN3aXRjaCAodGhpcy5zdGF0ZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgMCAvKiBQYXJzZXJTdGF0ZS5Cb20gKi86XG4gICAgICAgICAgICAgICAgICAgIGlmIChsaW5lLnN0YXJ0c1dpdGgoQk9NKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmUgPSBsaW5lLnNsaWNlKEJPTS5sZW5ndGgpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXRlID0gMSAvKiBQYXJzZXJTdGF0ZS5QcmUgKi87IC8vIGZhbGwgdGhyb3VnaFxuICAgICAgICAgICAgICAgIGNhc2UgMSAvKiBQYXJzZXJTdGF0ZS5QcmUgKi86XG4gICAgICAgICAgICAgICAgICAgIGlmIChpc1doaXRlc3BhY2UobGluZSkgfHwgaXNDb21tZW50TGluZShsaW5lKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mb3VuZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhdGUgPSAyIC8qIFBhcnNlclN0YXRlLkhlYWRlcnMgKi87IC8vIGZhbGwgdGhyb3VnaFxuICAgICAgICAgICAgICAgIGNhc2UgMiAvKiBQYXJzZXJTdGF0ZS5IZWFkZXJzICovOiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpc0NvbW1lbnRMaW5lKGxpbmUpKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICBsZXQgbW9yZUhlYWRlcnMgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB3aGlsZSAobW9yZUhlYWRlcnMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1vcmVIZWFkZXJzID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5lID0gbGluZS5yZXBsYWNlKC9eXFxzKlxcWyhbQS1aYS16MC05XVtBLVphLXowLTlfKyM9Oi1dKilcXHMrXCIoKD86W15cIlxcXFxdfFxcXFxcInxcXFxcXFxcXCkqKVwiXFxdLywgKF9tYXRjaCwgaGVhZGVyTmFtZSwgaGVhZGVyVmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnN1bWVCdWRnZXQoMjAwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZUhlYWRlcihoZWFkZXJOYW1lLCBoZWFkZXJWYWx1ZS5yZXBsYWNlKC9cXFxcXCIvZywgJ1wiJykucmVwbGFjZSgvXFxcXFxcXFwvZywgJ1xcXFwnKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9yZUhlYWRlcnMgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyZXNoTGluZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChpc1doaXRlc3BhY2UobGluZSkpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhdGUgPSAzIC8qIFBhcnNlclN0YXRlLk1vdmVzICovOyAvLyBmYWxsIHRocm91Z2hcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2FzZSAzIC8qIFBhcnNlclN0YXRlLk1vdmVzICovOiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmcmVzaExpbmUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc0NvbW1lbnRMaW5lKGxpbmUpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc1doaXRlc3BhY2UobGluZSkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZW1pdCh1bmRlZmluZWQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHRva2VuUmVnZXggPSAvKD86W05CS1JRXT9bYS1oXT9bMS04XT9bLXhdP1thLWhdWzEtOF0oPzo9P1tuYnJxa05CUlFLXSk/fFtwbmJycWtQTkJSUUtdP0BbYS1oXVsxLThdfFtPMG9dWy3igJPigJRdW08wb10oPzpbLeKAk+KAlF1bTzBvXSk/KVsrI10/fC0tfFowfDAwMDB8QEBAQHx7fDt8XFwkXFxkezEsNH18Wz8hXXsxLDJ9fFxcKHxcXCl8XFwqfDFbLeKAk+KAlF0wfDBbLeKAk+KAlF0xfDFcXC8yWy3igJPigJRdMVxcLzIvZztcbiAgICAgICAgICAgICAgICAgICAgbGV0IG1hdGNoO1xuICAgICAgICAgICAgICAgICAgICB3aGlsZSAoKG1hdGNoID0gdG9rZW5SZWdleC5leGVjKGxpbmUpKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZnJhbWUgPSB0aGlzLnN0YWNrW3RoaXMuc3RhY2subGVuZ3RoIC0gMV07XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgdG9rZW4gPSBtYXRjaFswXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0b2tlbiA9PT0gJzsnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHRva2VuLnN0YXJ0c1dpdGgoJyQnKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZU5hZyhwYXJzZUludCh0b2tlbi5zbGljZSgxKSwgMTApKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHRva2VuID09PSAnIScpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVOYWcoMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0b2tlbiA9PT0gJz8nKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlTmFnKDIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodG9rZW4gPT09ICchIScpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVOYWcoMyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0b2tlbiA9PT0gJz8/JylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZU5hZyg0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHRva2VuID09PSAnIT8nKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlTmFnKDUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodG9rZW4gPT09ICc/IScpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVOYWcoNik7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0b2tlbiA9PT0gJzEtMCcgfHwgdG9rZW4gPT09ICcx4oCTMCcgfHwgdG9rZW4gPT09ICcx4oCUMCdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB8fCB0b2tlbiA9PT0gJzAtMScgfHwgdG9rZW4gPT09ICcw4oCTMScgfHwgdG9rZW4gPT09ICcw4oCUMSdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB8fCB0b2tlbiA9PT0gJzEvMi0xLzInIHx8IHRva2VuID09PSAnMS8y4oCTMS8yJyB8fCB0b2tlbiA9PT0gJzEvMuKAlDEvMidcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB8fCB0b2tlbiA9PT0gJyonKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc3RhY2subGVuZ3RoID09PSAxICYmIHRva2VuICE9PSAnKicpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlSGVhZGVyKCdSZXN1bHQnLCB0b2tlbik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0b2tlbiA9PT0gJygnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25zdW1lQnVkZ2V0KDEwMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGFjay5wdXNoKHsgcGFyZW50OiBmcmFtZS5wYXJlbnQsIHJvb3Q6IGZhbHNlIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodG9rZW4gPT09ICcpJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YWNrLmxlbmd0aCA+IDEpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhY2sucG9wKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0b2tlbiA9PT0gJ3snKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3BlbkluZGV4ID0gdG9rZW5SZWdleC5sYXN0SW5kZXg7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYmVnaW5JbmRleCA9IGxpbmVbb3BlbkluZGV4XSA9PT0gJyAnID8gb3BlbkluZGV4ICsgMSA6IG9wZW5JbmRleDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lID0gbGluZS5zbGljZShiZWdpbkluZGV4KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXRlID0gNCAvKiBQYXJzZXJTdGF0ZS5Db21tZW50ICovO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlIGNvbnRpbnVlZExpbmU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnN1bWVCdWRnZXQoMTAwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodG9rZW4uc3RhcnRzV2l0aCgnTycpIHx8IHRva2VuLnN0YXJ0c1dpdGgoJzAnKSB8fCB0b2tlbi5zdGFydHNXaXRoKCdvJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW4gPSB0b2tlbi5yZXBsYWNlKC9bMG9dL2csICdPJykucmVwbGFjZSgvW+KAk+KAlF0vZywgJy0nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodG9rZW4gPT09ICdaMCcgfHwgdG9rZW4gPT09ICcwMDAwJyB8fCB0b2tlbiA9PT0gJ0BAQEAnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbiA9ICctLSc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZyYW1lLm5vZGUpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyYW1lLnBhcmVudCA9IGZyYW1lLm5vZGU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZnJhbWUubm9kZSA9IG5ldyBDaGlsZE5vZGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYW46IHRva2VuLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydGluZ0NvbW1lbnRzOiBmcmFtZS5zdGFydGluZ0NvbW1lbnRzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyYW1lLnN0YXJ0aW5nQ29tbWVudHMgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZnJhbWUucm9vdCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyYW1lLnBhcmVudC5jaGlsZHJlbi5wdXNoKGZyYW1lLm5vZGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2FzZSA0IC8qIFBhcnNlclN0YXRlLkNvbW1lbnQgKi86IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2xvc2VJbmRleCA9IGxpbmUuaW5kZXhPZignfScpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoY2xvc2VJbmRleCA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29tbWVudEJ1Zi5wdXNoKGxpbmUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZW5kSW5kZXggPSBjbG9zZUluZGV4ID4gMCAmJiBsaW5lW2Nsb3NlSW5kZXggLSAxXSA9PT0gJyAnID8gY2xvc2VJbmRleCAtIDEgOiBjbG9zZUluZGV4O1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb21tZW50QnVmLnB1c2gobGluZS5zbGljZSgwLCBlbmRJbmRleCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVDb21tZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5lID0gbGluZS5zbGljZShjbG9zZUluZGV4KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhdGUgPSAzIC8qIFBhcnNlclN0YXRlLk1vdmVzICovO1xuICAgICAgICAgICAgICAgICAgICAgICAgZnJlc2hMaW5lID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgaGFuZGxlSGVhZGVyKG5hbWUsIHZhbHVlKSB7XG4gICAgICAgIHRoaXMuZ2FtZS5oZWFkZXJzLnNldChuYW1lLCBuYW1lID09PSAnUmVzdWx0JyA/IG1ha2VPdXRjb21lKHBhcnNlT3V0Y29tZSh2YWx1ZSkpIDogdmFsdWUpO1xuICAgIH1cbiAgICBoYW5kbGVOYWcobmFnKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgdGhpcy5jb25zdW1lQnVkZ2V0KDUwKTtcbiAgICAgICAgY29uc3QgZnJhbWUgPSB0aGlzLnN0YWNrW3RoaXMuc3RhY2subGVuZ3RoIC0gMV07XG4gICAgICAgIGlmIChmcmFtZS5ub2RlKSB7XG4gICAgICAgICAgICAoX2EgPSBmcmFtZS5ub2RlLmRhdGEpLm5hZ3MgfHwgKF9hLm5hZ3MgPSBbXSk7XG4gICAgICAgICAgICBmcmFtZS5ub2RlLmRhdGEubmFncy5wdXNoKG5hZyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaGFuZGxlQ29tbWVudCgpIHtcbiAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgdGhpcy5jb25zdW1lQnVkZ2V0KDEwMCk7XG4gICAgICAgIGNvbnN0IGZyYW1lID0gdGhpcy5zdGFja1t0aGlzLnN0YWNrLmxlbmd0aCAtIDFdO1xuICAgICAgICBjb25zdCBjb21tZW50ID0gdGhpcy5jb21tZW50QnVmLmpvaW4oJ1xcbicpO1xuICAgICAgICB0aGlzLmNvbW1lbnRCdWYgPSBbXTtcbiAgICAgICAgaWYgKGZyYW1lLm5vZGUpIHtcbiAgICAgICAgICAgIChfYSA9IGZyYW1lLm5vZGUuZGF0YSkuY29tbWVudHMgfHwgKF9hLmNvbW1lbnRzID0gW10pO1xuICAgICAgICAgICAgZnJhbWUubm9kZS5kYXRhLmNvbW1lbnRzLnB1c2goY29tbWVudCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoZnJhbWUucm9vdCkge1xuICAgICAgICAgICAgKF9iID0gdGhpcy5nYW1lKS5jb21tZW50cyB8fCAoX2IuY29tbWVudHMgPSBbXSk7XG4gICAgICAgICAgICB0aGlzLmdhbWUuY29tbWVudHMucHVzaChjb21tZW50KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGZyYW1lLnN0YXJ0aW5nQ29tbWVudHMgfHwgKGZyYW1lLnN0YXJ0aW5nQ29tbWVudHMgPSBbXSk7XG4gICAgICAgICAgICBmcmFtZS5zdGFydGluZ0NvbW1lbnRzLnB1c2goY29tbWVudCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZW1pdChlcnIpIHtcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUgPT09IDQgLyogUGFyc2VyU3RhdGUuQ29tbWVudCAqLylcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlQ29tbWVudCgpO1xuICAgICAgICBpZiAoZXJyKVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZW1pdEdhbWUodGhpcy5nYW1lLCBlcnIpO1xuICAgICAgICBpZiAodGhpcy5mb3VuZClcbiAgICAgICAgICAgIHRoaXMuZW1pdEdhbWUodGhpcy5nYW1lLCB1bmRlZmluZWQpO1xuICAgICAgICB0aGlzLnJlc2V0R2FtZSgpO1xuICAgIH1cbn1cbmV4cG9ydCBjb25zdCBwYXJzZVBnbiA9IChwZ24sIGluaXRIZWFkZXJzID0gZGVmYXVsdEhlYWRlcnMpID0+IHtcbiAgICBjb25zdCBnYW1lcyA9IFtdO1xuICAgIG5ldyBQZ25QYXJzZXIoZ2FtZSA9PiBnYW1lcy5wdXNoKGdhbWUpLCBpbml0SGVhZGVycywgTmFOKS5wYXJzZShwZ24pO1xuICAgIHJldHVybiBnYW1lcztcbn07XG5leHBvcnQgY29uc3QgcGFyc2VWYXJpYW50ID0gKHZhcmlhbnQpID0+IHtcbiAgICBzd2l0Y2ggKCh2YXJpYW50IHx8ICdjaGVzcycpLnRvTG93ZXJDYXNlKCkpIHtcbiAgICAgICAgY2FzZSAnY2hlc3MnOlxuICAgICAgICBjYXNlICdjaGVzczk2MCc6XG4gICAgICAgIGNhc2UgJ2NoZXNzIDk2MCc6XG4gICAgICAgIGNhc2UgJ3N0YW5kYXJkJzpcbiAgICAgICAgY2FzZSAnZnJvbSBwb3NpdGlvbic6XG4gICAgICAgIGNhc2UgJ2NsYXNzaWNhbCc6XG4gICAgICAgIGNhc2UgJ25vcm1hbCc6XG4gICAgICAgIGNhc2UgJ2Zpc2NoZXJhbmRvbSc6IC8vIEN1dGUgQ2hlc3NcbiAgICAgICAgY2FzZSAnZmlzY2hlcnJhbmRvbSc6XG4gICAgICAgIGNhc2UgJ2Zpc2NoZXIgcmFuZG9tJzpcbiAgICAgICAgY2FzZSAnd2lsZC8wJzpcbiAgICAgICAgY2FzZSAnd2lsZC8xJzpcbiAgICAgICAgY2FzZSAnd2lsZC8yJzpcbiAgICAgICAgY2FzZSAnd2lsZC8zJzpcbiAgICAgICAgY2FzZSAnd2lsZC80JzpcbiAgICAgICAgY2FzZSAnd2lsZC81JzpcbiAgICAgICAgY2FzZSAnd2lsZC82JzpcbiAgICAgICAgY2FzZSAnd2lsZC83JzpcbiAgICAgICAgY2FzZSAnd2lsZC84JzpcbiAgICAgICAgY2FzZSAnd2lsZC84YSc6XG4gICAgICAgICAgICByZXR1cm4gJ2NoZXNzJztcbiAgICAgICAgY2FzZSAnY3Jhenlob3VzZSc6XG4gICAgICAgIGNhc2UgJ2NyYXp5IGhvdXNlJzpcbiAgICAgICAgY2FzZSAnaG91c2UnOlxuICAgICAgICBjYXNlICd6aCc6XG4gICAgICAgICAgICByZXR1cm4gJ2NyYXp5aG91c2UnO1xuICAgICAgICBjYXNlICdraW5nIG9mIHRoZSBoaWxsJzpcbiAgICAgICAgY2FzZSAna290aCc6XG4gICAgICAgIGNhc2UgJ2tpbmdvZnRoZWhpbGwnOlxuICAgICAgICAgICAgcmV0dXJuICdraW5nb2Z0aGVoaWxsJztcbiAgICAgICAgY2FzZSAndGhyZWUtY2hlY2snOlxuICAgICAgICBjYXNlICd0aHJlZSBjaGVjayc6XG4gICAgICAgIGNhc2UgJ3RocmVlY2hlY2snOlxuICAgICAgICBjYXNlICd0aHJlZSBjaGVjayBjaGVzcyc6XG4gICAgICAgIGNhc2UgJzMtY2hlY2snOlxuICAgICAgICBjYXNlICczIGNoZWNrJzpcbiAgICAgICAgY2FzZSAnM2NoZWNrJzpcbiAgICAgICAgICAgIHJldHVybiAnM2NoZWNrJztcbiAgICAgICAgY2FzZSAnYW50aWNoZXNzJzpcbiAgICAgICAgY2FzZSAnYW50aSBjaGVzcyc6XG4gICAgICAgIGNhc2UgJ2FudGknOlxuICAgICAgICAgICAgcmV0dXJuICdhbnRpY2hlc3MnO1xuICAgICAgICBjYXNlICdhdG9taWMnOlxuICAgICAgICBjYXNlICdhdG9tJzpcbiAgICAgICAgY2FzZSAnYXRvbWljIGNoZXNzJzpcbiAgICAgICAgICAgIHJldHVybiAnYXRvbWljJztcbiAgICAgICAgY2FzZSAnaG9yZGUnOlxuICAgICAgICBjYXNlICdob3JkZSBjaGVzcyc6XG4gICAgICAgICAgICByZXR1cm4gJ2hvcmRlJztcbiAgICAgICAgY2FzZSAncmFjaW5nIGtpbmdzJzpcbiAgICAgICAgY2FzZSAncmFjaW5na2luZ3MnOlxuICAgICAgICBjYXNlICdyYWNpbmcnOlxuICAgICAgICBjYXNlICdyYWNlJzpcbiAgICAgICAgICAgIHJldHVybiAncmFjaW5na2luZ3MnO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgcmV0dXJuO1xuICAgIH1cbn07XG5leHBvcnQgY29uc3QgbWFrZVZhcmlhbnQgPSAocnVsZXMpID0+IHtcbiAgICBzd2l0Y2ggKHJ1bGVzKSB7XG4gICAgICAgIGNhc2UgJ2NoZXNzJzpcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgY2FzZSAnY3Jhenlob3VzZSc6XG4gICAgICAgICAgICByZXR1cm4gJ0NyYXp5aG91c2UnO1xuICAgICAgICBjYXNlICdyYWNpbmdraW5ncyc6XG4gICAgICAgICAgICByZXR1cm4gJ1JhY2luZyBLaW5ncyc7XG4gICAgICAgIGNhc2UgJ2hvcmRlJzpcbiAgICAgICAgICAgIHJldHVybiAnSG9yZGUnO1xuICAgICAgICBjYXNlICdhdG9taWMnOlxuICAgICAgICAgICAgcmV0dXJuICdBdG9taWMnO1xuICAgICAgICBjYXNlICdhbnRpY2hlc3MnOlxuICAgICAgICAgICAgcmV0dXJuICdBbnRpY2hlc3MnO1xuICAgICAgICBjYXNlICczY2hlY2snOlxuICAgICAgICAgICAgcmV0dXJuICdUaHJlZS1jaGVjayc7XG4gICAgICAgIGNhc2UgJ2tpbmdvZnRoZWhpbGwnOlxuICAgICAgICAgICAgcmV0dXJuICdLaW5nIG9mIHRoZSBIaWxsJztcbiAgICB9XG59O1xuZXhwb3J0IGNvbnN0IHN0YXJ0aW5nUG9zaXRpb24gPSAoaGVhZGVycykgPT4ge1xuICAgIGNvbnN0IHJ1bGVzID0gcGFyc2VWYXJpYW50KGhlYWRlcnMuZ2V0KCdWYXJpYW50JykpO1xuICAgIGlmICghcnVsZXMpXG4gICAgICAgIHJldHVybiBSZXN1bHQuZXJyKG5ldyBQb3NpdGlvbkVycm9yKElsbGVnYWxTZXR1cC5WYXJpYW50KSk7XG4gICAgY29uc3QgZmVuID0gaGVhZGVycy5nZXQoJ0ZFTicpO1xuICAgIGlmIChmZW4pXG4gICAgICAgIHJldHVybiBwYXJzZUZlbihmZW4pLmNoYWluKHNldHVwID0+IHNldHVwUG9zaXRpb24ocnVsZXMsIHNldHVwKSk7XG4gICAgZWxzZVxuICAgICAgICByZXR1cm4gUmVzdWx0Lm9rKGRlZmF1bHRQb3NpdGlvbihydWxlcykpO1xufTtcbmV4cG9ydCBjb25zdCBzZXRTdGFydGluZ1Bvc2l0aW9uID0gKGhlYWRlcnMsIHBvcykgPT4ge1xuICAgIGNvbnN0IHZhcmlhbnQgPSBtYWtlVmFyaWFudChwb3MucnVsZXMpO1xuICAgIGlmICh2YXJpYW50KVxuICAgICAgICBoZWFkZXJzLnNldCgnVmFyaWFudCcsIHZhcmlhbnQpO1xuICAgIGVsc2VcbiAgICAgICAgaGVhZGVycy5kZWxldGUoJ1ZhcmlhbnQnKTtcbiAgICBjb25zdCBmZW4gPSBtYWtlRmVuKHBvcy50b1NldHVwKCkpO1xuICAgIGNvbnN0IGRlZmF1bHRGZW4gPSBtYWtlRmVuKGRlZmF1bHRQb3NpdGlvbihwb3MucnVsZXMpLnRvU2V0dXAoKSk7XG4gICAgaWYgKGZlbiAhPT0gZGVmYXVsdEZlbilcbiAgICAgICAgaGVhZGVycy5zZXQoJ0ZFTicsIGZlbik7XG4gICAgZWxzZVxuICAgICAgICBoZWFkZXJzLmRlbGV0ZSgnRkVOJyk7XG59O1xuZXhwb3J0IGNvbnN0IGlzUGF3bnMgPSAoZXYpID0+ICdwYXducycgaW4gZXY7XG5leHBvcnQgY29uc3QgaXNNYXRlID0gKGV2KSA9PiAnbWF0ZScgaW4gZXY7XG5jb25zdCBtYWtlQ2xrID0gKHNlY29uZHMpID0+IHtcbiAgICBzZWNvbmRzID0gTWF0aC5tYXgoMCwgc2Vjb25kcyk7XG4gICAgY29uc3QgaG91cnMgPSBNYXRoLmZsb29yKHNlY29uZHMgLyAzNjAwKTtcbiAgICBjb25zdCBtaW51dGVzID0gTWF0aC5mbG9vcigoc2Vjb25kcyAlIDM2MDApIC8gNjApO1xuICAgIHNlY29uZHMgPSAoc2Vjb25kcyAlIDM2MDApICUgNjA7XG4gICAgcmV0dXJuIGAke2hvdXJzfToke21pbnV0ZXMudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpfToke3NlY29uZHMudG9Mb2NhbGVTdHJpbmcoJ2VuJywge1xuICAgICAgICBtaW5pbXVtSW50ZWdlckRpZ2l0czogMixcbiAgICAgICAgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiAzLFxuICAgIH0pfWA7XG59O1xuY29uc3QgbWFrZUNvbW1lbnRTaGFwZUNvbG9yID0gKGNvbG9yKSA9PiB7XG4gICAgc3dpdGNoIChjb2xvcikge1xuICAgICAgICBjYXNlICdncmVlbic6XG4gICAgICAgICAgICByZXR1cm4gJ0cnO1xuICAgICAgICBjYXNlICdyZWQnOlxuICAgICAgICAgICAgcmV0dXJuICdSJztcbiAgICAgICAgY2FzZSAneWVsbG93JzpcbiAgICAgICAgICAgIHJldHVybiAnWSc7XG4gICAgICAgIGNhc2UgJ2JsdWUnOlxuICAgICAgICAgICAgcmV0dXJuICdCJztcbiAgICB9XG59O1xuZnVuY3Rpb24gcGFyc2VDb21tZW50U2hhcGVDb2xvcihzdHIpIHtcbiAgICBzd2l0Y2ggKHN0cikge1xuICAgICAgICBjYXNlICdHJzpcbiAgICAgICAgICAgIHJldHVybiAnZ3JlZW4nO1xuICAgICAgICBjYXNlICdSJzpcbiAgICAgICAgICAgIHJldHVybiAncmVkJztcbiAgICAgICAgY2FzZSAnWSc6XG4gICAgICAgICAgICByZXR1cm4gJ3llbGxvdyc7XG4gICAgICAgIGNhc2UgJ0InOlxuICAgICAgICAgICAgcmV0dXJuICdibHVlJztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHJldHVybjtcbiAgICB9XG59XG5jb25zdCBtYWtlQ29tbWVudFNoYXBlID0gKHNoYXBlKSA9PiBzaGFwZS50byA9PT0gc2hhcGUuZnJvbVxuICAgID8gYCR7bWFrZUNvbW1lbnRTaGFwZUNvbG9yKHNoYXBlLmNvbG9yKX0ke21ha2VTcXVhcmUoc2hhcGUudG8pfWBcbiAgICA6IGAke21ha2VDb21tZW50U2hhcGVDb2xvcihzaGFwZS5jb2xvcil9JHttYWtlU3F1YXJlKHNoYXBlLmZyb20pfSR7bWFrZVNxdWFyZShzaGFwZS50byl9YDtcbmNvbnN0IHBhcnNlQ29tbWVudFNoYXBlID0gKHN0cikgPT4ge1xuICAgIGNvbnN0IGNvbG9yID0gcGFyc2VDb21tZW50U2hhcGVDb2xvcihzdHIuc2xpY2UoMCwgMSkpO1xuICAgIGNvbnN0IGZyb20gPSBwYXJzZVNxdWFyZShzdHIuc2xpY2UoMSwgMykpO1xuICAgIGNvbnN0IHRvID0gcGFyc2VTcXVhcmUoc3RyLnNsaWNlKDMsIDUpKTtcbiAgICBpZiAoIWNvbG9yIHx8ICFkZWZpbmVkKGZyb20pKVxuICAgICAgICByZXR1cm47XG4gICAgaWYgKHN0ci5sZW5ndGggPT09IDMpXG4gICAgICAgIHJldHVybiB7IGNvbG9yLCBmcm9tLCB0bzogZnJvbSB9O1xuICAgIGlmIChzdHIubGVuZ3RoID09PSA1ICYmIGRlZmluZWQodG8pKVxuICAgICAgICByZXR1cm4geyBjb2xvciwgZnJvbSwgdG8gfTtcbiAgICByZXR1cm47XG59O1xuY29uc3QgbWFrZUV2YWwgPSAoZXYpID0+IHtcbiAgICBjb25zdCBzdHIgPSBpc01hdGUoZXYpID8gJyMnICsgZXYubWF0ZSA6IGV2LnBhd25zLnRvRml4ZWQoMik7XG4gICAgcmV0dXJuIGRlZmluZWQoZXYuZGVwdGgpID8gc3RyICsgJywnICsgZXYuZGVwdGggOiBzdHI7XG59O1xuZXhwb3J0IGNvbnN0IG1ha2VDb21tZW50ID0gKGNvbW1lbnQpID0+IHtcbiAgICBjb25zdCBidWlsZGVyID0gW107XG4gICAgaWYgKGRlZmluZWQoY29tbWVudC50ZXh0KSlcbiAgICAgICAgYnVpbGRlci5wdXNoKGNvbW1lbnQudGV4dCk7XG4gICAgY29uc3QgY2lyY2xlcyA9IChjb21tZW50LnNoYXBlcyB8fCBbXSkuZmlsdGVyKHNoYXBlID0+IHNoYXBlLnRvID09PSBzaGFwZS5mcm9tKS5tYXAobWFrZUNvbW1lbnRTaGFwZSk7XG4gICAgaWYgKGNpcmNsZXMubGVuZ3RoKVxuICAgICAgICBidWlsZGVyLnB1c2goYFslY3NsICR7Y2lyY2xlcy5qb2luKCcsJyl9XWApO1xuICAgIGNvbnN0IGFycm93cyA9IChjb21tZW50LnNoYXBlcyB8fCBbXSkuZmlsdGVyKHNoYXBlID0+IHNoYXBlLnRvICE9PSBzaGFwZS5mcm9tKS5tYXAobWFrZUNvbW1lbnRTaGFwZSk7XG4gICAgaWYgKGFycm93cy5sZW5ndGgpXG4gICAgICAgIGJ1aWxkZXIucHVzaChgWyVjYWwgJHthcnJvd3Muam9pbignLCcpfV1gKTtcbiAgICBpZiAoY29tbWVudC5ldmFsdWF0aW9uKVxuICAgICAgICBidWlsZGVyLnB1c2goYFslZXZhbCAke21ha2VFdmFsKGNvbW1lbnQuZXZhbHVhdGlvbil9XWApO1xuICAgIGlmIChkZWZpbmVkKGNvbW1lbnQuZW10KSlcbiAgICAgICAgYnVpbGRlci5wdXNoKGBbJWVtdCAke21ha2VDbGsoY29tbWVudC5lbXQpfV1gKTtcbiAgICBpZiAoZGVmaW5lZChjb21tZW50LmNsb2NrKSlcbiAgICAgICAgYnVpbGRlci5wdXNoKGBbJWNsayAke21ha2VDbGsoY29tbWVudC5jbG9jayl9XWApO1xuICAgIHJldHVybiBidWlsZGVyLmpvaW4oJyAnKTtcbn07XG5leHBvcnQgY29uc3QgcGFyc2VDb21tZW50ID0gKGNvbW1lbnQpID0+IHtcbiAgICBsZXQgZW10LCBjbG9jaywgZXZhbHVhdGlvbjtcbiAgICBjb25zdCBzaGFwZXMgPSBbXTtcbiAgICBjb25zdCB0ZXh0ID0gY29tbWVudFxuICAgICAgICAucmVwbGFjZSgvXFxzP1xcWyUoZW10fGNsaylcXHMoXFxkezEsNX0pOihcXGR7MSwyfSk6KFxcZHsxLDJ9KD86XFwuXFxkezAsM30pPylcXF1cXHM/L2csIChfLCBhbm5vdGF0aW9uLCBob3VycywgbWludXRlcywgc2Vjb25kcykgPT4ge1xuICAgICAgICBjb25zdCB2YWx1ZSA9IHBhcnNlSW50KGhvdXJzLCAxMCkgKiAzNjAwICsgcGFyc2VJbnQobWludXRlcywgMTApICogNjAgKyBwYXJzZUZsb2F0KHNlY29uZHMpO1xuICAgICAgICBpZiAoYW5ub3RhdGlvbiA9PT0gJ2VtdCcpXG4gICAgICAgICAgICBlbXQgPSB2YWx1ZTtcbiAgICAgICAgZWxzZSBpZiAoYW5ub3RhdGlvbiA9PT0gJ2NsaycpXG4gICAgICAgICAgICBjbG9jayA9IHZhbHVlO1xuICAgICAgICByZXR1cm4gJyAgJztcbiAgICB9KVxuICAgICAgICAucmVwbGFjZSgvXFxzP1xcWyUoPzpjc2x8Y2FsKVxccyhbUkdZQl1bYS1oXVsxLThdKD86W2EtaF1bMS04XSk/KD86LFtSR1lCXVthLWhdWzEtOF0oPzpbYS1oXVsxLThdKT8pKilcXF1cXHM/L2csIChfLCBhcnJvd3MpID0+IHtcbiAgICAgICAgZm9yIChjb25zdCBhcnJvdyBvZiBhcnJvd3Muc3BsaXQoJywnKSkge1xuICAgICAgICAgICAgc2hhcGVzLnB1c2gocGFyc2VDb21tZW50U2hhcGUoYXJyb3cpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gJyAgJztcbiAgICB9KVxuICAgICAgICAucmVwbGFjZSgvXFxzP1xcWyVldmFsXFxzKD86IyhbKy1dP1xcZHsxLDV9KXwoWystXT8oPzpcXGR7MSw1fXxcXGR7MCw1fVxcLlxcZHsxLDJ9KSkpKD86LChcXGR7MSw1fSkpP1xcXVxccz8vZywgKF8sIG1hdGUsIHBhd25zLCBkKSA9PiB7XG4gICAgICAgIGNvbnN0IGRlcHRoID0gZCAmJiBwYXJzZUludChkLCAxMCk7XG4gICAgICAgIGV2YWx1YXRpb24gPSBtYXRlID8geyBtYXRlOiBwYXJzZUludChtYXRlLCAxMCksIGRlcHRoIH0gOiB7IHBhd25zOiBwYXJzZUZsb2F0KHBhd25zKSwgZGVwdGggfTtcbiAgICAgICAgcmV0dXJuICcgICc7XG4gICAgfSlcbiAgICAgICAgLnRyaW0oKTtcbiAgICByZXR1cm4ge1xuICAgICAgICB0ZXh0LFxuICAgICAgICBzaGFwZXMsXG4gICAgICAgIGVtdCxcbiAgICAgICAgY2xvY2ssXG4gICAgICAgIGV2YWx1YXRpb24sXG4gICAgfTtcbn07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1wZ24uanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/chessops/dist/esm/pgn.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/chessops/dist/esm/san.js":
/*!***********************************************!*\
  !*** ./node_modules/chessops/dist/esm/san.js ***!
  \***********************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   makeSan: () => (/* binding */ makeSan),\n/* harmony export */   makeSanAndPlay: () => (/* binding */ makeSanAndPlay),\n/* harmony export */   makeSanVariation: () => (/* binding */ makeSanVariation),\n/* harmony export */   parseSan: () => (/* binding */ parseSan)\n/* harmony export */ });\n/* harmony import */ var _attacks_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./attacks.js */ \"(ssr)/./node_modules/chessops/dist/esm/attacks.js\");\n/* harmony import */ var _squareSet_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./squareSet.js */ \"(ssr)/./node_modules/chessops/dist/esm/squareSet.js\");\n/* harmony import */ var _types_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./types.js */ \"(ssr)/./node_modules/chessops/dist/esm/types.js\");\n/* harmony import */ var _util_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./util.js */ \"(ssr)/./node_modules/chessops/dist/esm/util.js\");\n\n\n\n\nconst makeSanWithoutSuffix = (pos, move) => {\n    let san = '';\n    if ((0,_types_js__WEBPACK_IMPORTED_MODULE_0__.isDrop)(move)) {\n        if (move.role !== 'pawn')\n            san = (0,_util_js__WEBPACK_IMPORTED_MODULE_1__.roleToChar)(move.role).toUpperCase();\n        san += '@' + (0,_util_js__WEBPACK_IMPORTED_MODULE_1__.makeSquare)(move.to);\n    }\n    else {\n        const role = pos.board.getRole(move.from);\n        if (!role)\n            return '--';\n        if (role === 'king' && (pos.board[pos.turn].has(move.to) || Math.abs(move.to - move.from) === 2)) {\n            san = move.to > move.from ? 'O-O' : 'O-O-O';\n        }\n        else {\n            const capture = pos.board.occupied.has(move.to)\n                || (role === 'pawn' && (0,_util_js__WEBPACK_IMPORTED_MODULE_1__.squareFile)(move.from) !== (0,_util_js__WEBPACK_IMPORTED_MODULE_1__.squareFile)(move.to));\n            if (role !== 'pawn') {\n                san = (0,_util_js__WEBPACK_IMPORTED_MODULE_1__.roleToChar)(role).toUpperCase();\n                // Disambiguation\n                let others;\n                if (role === 'king')\n                    others = (0,_attacks_js__WEBPACK_IMPORTED_MODULE_2__.kingAttacks)(move.to).intersect(pos.board.king);\n                else if (role === 'queen')\n                    others = (0,_attacks_js__WEBPACK_IMPORTED_MODULE_2__.queenAttacks)(move.to, pos.board.occupied).intersect(pos.board.queen);\n                else if (role === 'rook')\n                    others = (0,_attacks_js__WEBPACK_IMPORTED_MODULE_2__.rookAttacks)(move.to, pos.board.occupied).intersect(pos.board.rook);\n                else if (role === 'bishop')\n                    others = (0,_attacks_js__WEBPACK_IMPORTED_MODULE_2__.bishopAttacks)(move.to, pos.board.occupied).intersect(pos.board.bishop);\n                else\n                    others = (0,_attacks_js__WEBPACK_IMPORTED_MODULE_2__.knightAttacks)(move.to).intersect(pos.board.knight);\n                others = others.intersect(pos.board[pos.turn]).without(move.from);\n                if (others.nonEmpty()) {\n                    const ctx = pos.ctx();\n                    for (const from of others) {\n                        if (!pos.dests(from, ctx).has(move.to))\n                            others = others.without(from);\n                    }\n                    if (others.nonEmpty()) {\n                        let row = false;\n                        let column = others.intersects(_squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet.fromRank((0,_util_js__WEBPACK_IMPORTED_MODULE_1__.squareRank)(move.from)));\n                        if (others.intersects(_squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet.fromFile((0,_util_js__WEBPACK_IMPORTED_MODULE_1__.squareFile)(move.from))))\n                            row = true;\n                        else\n                            column = true;\n                        if (column)\n                            san += _types_js__WEBPACK_IMPORTED_MODULE_0__.FILE_NAMES[(0,_util_js__WEBPACK_IMPORTED_MODULE_1__.squareFile)(move.from)];\n                        if (row)\n                            san += _types_js__WEBPACK_IMPORTED_MODULE_0__.RANK_NAMES[(0,_util_js__WEBPACK_IMPORTED_MODULE_1__.squareRank)(move.from)];\n                    }\n                }\n            }\n            else if (capture)\n                san = _types_js__WEBPACK_IMPORTED_MODULE_0__.FILE_NAMES[(0,_util_js__WEBPACK_IMPORTED_MODULE_1__.squareFile)(move.from)];\n            if (capture)\n                san += 'x';\n            san += (0,_util_js__WEBPACK_IMPORTED_MODULE_1__.makeSquare)(move.to);\n            if (move.promotion)\n                san += '=' + (0,_util_js__WEBPACK_IMPORTED_MODULE_1__.roleToChar)(move.promotion).toUpperCase();\n        }\n    }\n    return san;\n};\nconst makeSanAndPlay = (pos, move) => {\n    var _a;\n    const san = makeSanWithoutSuffix(pos, move);\n    pos.play(move);\n    if ((_a = pos.outcome()) === null || _a === void 0 ? void 0 : _a.winner)\n        return san + '#';\n    if (pos.isCheck())\n        return san + '+';\n    return san;\n};\nconst makeSanVariation = (pos, variation) => {\n    var _a;\n    pos = pos.clone();\n    const line = [];\n    for (let i = 0; i < variation.length; i++) {\n        if (i !== 0)\n            line.push(' ');\n        if (pos.turn === 'white')\n            line.push(pos.fullmoves, '. ');\n        else if (i === 0)\n            line.push(pos.fullmoves, '... ');\n        const san = makeSanWithoutSuffix(pos, variation[i]);\n        pos.play(variation[i]);\n        line.push(san);\n        if (san === '--')\n            return line.join('');\n        if (i === variation.length - 1 && ((_a = pos.outcome()) === null || _a === void 0 ? void 0 : _a.winner))\n            line.push('#');\n        else if (pos.isCheck())\n            line.push('+');\n    }\n    return line.join('');\n};\nconst makeSan = (pos, move) => makeSanAndPlay(pos.clone(), move);\nconst parseSan = (pos, san) => {\n    const ctx = pos.ctx();\n    // Normal move\n    const match = san.match(/^([NBRQK])?([a-h])?([1-8])?[-x]?([a-h][1-8])(?:=?([nbrqkNBRQK]))?[+#]?$/);\n    if (!match) {\n        // Castling\n        let castlingSide;\n        if (san === 'O-O' || san === 'O-O+' || san === 'O-O#')\n            castlingSide = 'h';\n        else if (san === 'O-O-O' || san === 'O-O-O+' || san === 'O-O-O#')\n            castlingSide = 'a';\n        if (castlingSide) {\n            const rook = pos.castles.rook[pos.turn][castlingSide];\n            if (!(0,_util_js__WEBPACK_IMPORTED_MODULE_1__.defined)(ctx.king) || !(0,_util_js__WEBPACK_IMPORTED_MODULE_1__.defined)(rook) || !pos.dests(ctx.king, ctx).has(rook))\n                return;\n            return {\n                from: ctx.king,\n                to: rook,\n            };\n        }\n        // Drop\n        const match = san.match(/^([pnbrqkPNBRQK])?@([a-h][1-8])[+#]?$/);\n        if (!match)\n            return;\n        const move = {\n            role: match[1] ? (0,_util_js__WEBPACK_IMPORTED_MODULE_1__.charToRole)(match[1]) : 'pawn',\n            to: (0,_util_js__WEBPACK_IMPORTED_MODULE_1__.parseSquare)(match[2]),\n        };\n        return pos.isLegal(move, ctx) ? move : undefined;\n    }\n    const role = match[1] ? (0,_util_js__WEBPACK_IMPORTED_MODULE_1__.charToRole)(match[1]) : 'pawn';\n    const to = (0,_util_js__WEBPACK_IMPORTED_MODULE_1__.parseSquare)(match[4]);\n    const promotion = match[5] ? (0,_util_js__WEBPACK_IMPORTED_MODULE_1__.charToRole)(match[5]) : undefined;\n    if (!!promotion !== (role === 'pawn' && _squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet.backranks().has(to)))\n        return;\n    if (promotion === 'king' && pos.rules !== 'antichess')\n        return;\n    let candidates = pos.board.pieces(pos.turn, role);\n    if (role === 'pawn' && !match[2])\n        candidates = candidates.intersect(_squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet.fromFile((0,_util_js__WEBPACK_IMPORTED_MODULE_1__.squareFile)(to)));\n    else if (match[2])\n        candidates = candidates.intersect(_squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet.fromFile(match[2].charCodeAt(0) - 'a'.charCodeAt(0)));\n    if (match[3])\n        candidates = candidates.intersect(_squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet.fromRank(match[3].charCodeAt(0) - '1'.charCodeAt(0)));\n    // Optimization: Reduce set of candidates\n    const pawnAdvance = role === 'pawn' ? _squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet.fromFile((0,_util_js__WEBPACK_IMPORTED_MODULE_1__.squareFile)(to)) : _squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet.empty();\n    candidates = candidates.intersect(pawnAdvance.union((0,_attacks_js__WEBPACK_IMPORTED_MODULE_2__.attacks)({ color: (0,_util_js__WEBPACK_IMPORTED_MODULE_1__.opposite)(pos.turn), role }, to, pos.board.occupied)));\n    // Check uniqueness and legality\n    let from;\n    for (const candidate of candidates) {\n        if (pos.dests(candidate, ctx).has(to)) {\n            if ((0,_util_js__WEBPACK_IMPORTED_MODULE_1__.defined)(from))\n                return; // Ambiguous\n            from = candidate;\n        }\n    }\n    if (!(0,_util_js__WEBPACK_IMPORTED_MODULE_1__.defined)(from))\n        return; // Illegal\n    return {\n        from,\n        to,\n        promotion,\n    };\n};\n//# sourceMappingURL=san.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvY2hlc3NvcHMvZGlzdC9lc20vc2FuLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQTZHO0FBQ2xFO0FBQ2lCO0FBQzJEO0FBQ3ZIO0FBQ0E7QUFDQSxRQUFRLGlEQUFNO0FBQ2Q7QUFDQSxrQkFBa0Isb0RBQVU7QUFDNUIscUJBQXFCLG9EQUFVO0FBQy9CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUNBQXVDLG9EQUFVLGdCQUFnQixvREFBVTtBQUMzRTtBQUNBLHNCQUFzQixvREFBVTtBQUNoQztBQUNBO0FBQ0E7QUFDQSw2QkFBNkIsd0RBQVc7QUFDeEM7QUFDQSw2QkFBNkIseURBQVk7QUFDekM7QUFDQSw2QkFBNkIsd0RBQVc7QUFDeEM7QUFDQSw2QkFBNkIsMERBQWE7QUFDMUM7QUFDQSw2QkFBNkIsMERBQWE7QUFDMUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdURBQXVELG9EQUFTLFVBQVUsb0RBQVU7QUFDcEYsOENBQThDLG9EQUFTLFVBQVUsb0RBQVU7QUFDM0U7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQ0FBbUMsaURBQVUsQ0FBQyxvREFBVTtBQUN4RDtBQUNBLG1DQUFtQyxpREFBVSxDQUFDLG9EQUFVO0FBQ3hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCLGlEQUFVLENBQUMsb0RBQVU7QUFDM0M7QUFDQTtBQUNBLG1CQUFtQixvREFBVTtBQUM3QjtBQUNBLDZCQUE2QixvREFBVTtBQUN2QztBQUNBO0FBQ0E7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQSxvQkFBb0Isc0JBQXNCO0FBQzFDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPO0FBQ0E7QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUIsaURBQU8sZUFBZSxpREFBTztBQUM5QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCLG9EQUFVO0FBQ3ZDLGdCQUFnQixxREFBVztBQUMzQjtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsb0RBQVU7QUFDdEMsZUFBZSxxREFBVztBQUMxQixpQ0FBaUMsb0RBQVU7QUFDM0MsNENBQTRDLG9EQUFTO0FBQ3JEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQ0FBMEMsb0RBQVMsVUFBVSxvREFBVTtBQUN2RTtBQUNBLDBDQUEwQyxvREFBUztBQUNuRDtBQUNBLDBDQUEwQyxvREFBUztBQUNuRDtBQUNBLDBDQUEwQyxvREFBUyxVQUFVLG9EQUFVLFFBQVEsb0RBQVM7QUFDeEYsd0RBQXdELG9EQUFPLEdBQUcsT0FBTyxrREFBUSxrQkFBa0I7QUFDbkc7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsaURBQU87QUFDdkIsd0JBQXdCO0FBQ3hCO0FBQ0E7QUFDQTtBQUNBLFNBQVMsaURBQU87QUFDaEIsZ0JBQWdCO0FBQ2hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyIvVXNlcnMvcmFrc2hpdC93b3Jrc3BhY2UvYXJjaGl2ZXMvcmVwb3MvY2hlc3MvZXZhbC1iYXIvbm9kZV9tb2R1bGVzL2NoZXNzb3BzL2Rpc3QvZXNtL3Nhbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBhdHRhY2tzLCBiaXNob3BBdHRhY2tzLCBraW5nQXR0YWNrcywga25pZ2h0QXR0YWNrcywgcXVlZW5BdHRhY2tzLCByb29rQXR0YWNrcyB9IGZyb20gJy4vYXR0YWNrcy5qcyc7XG5pbXBvcnQgeyBTcXVhcmVTZXQgfSBmcm9tICcuL3NxdWFyZVNldC5qcyc7XG5pbXBvcnQgeyBGSUxFX05BTUVTLCBpc0Ryb3AsIFJBTktfTkFNRVMgfSBmcm9tICcuL3R5cGVzLmpzJztcbmltcG9ydCB7IGNoYXJUb1JvbGUsIGRlZmluZWQsIG1ha2VTcXVhcmUsIG9wcG9zaXRlLCBwYXJzZVNxdWFyZSwgcm9sZVRvQ2hhciwgc3F1YXJlRmlsZSwgc3F1YXJlUmFuayB9IGZyb20gJy4vdXRpbC5qcyc7XG5jb25zdCBtYWtlU2FuV2l0aG91dFN1ZmZpeCA9IChwb3MsIG1vdmUpID0+IHtcbiAgICBsZXQgc2FuID0gJyc7XG4gICAgaWYgKGlzRHJvcChtb3ZlKSkge1xuICAgICAgICBpZiAobW92ZS5yb2xlICE9PSAncGF3bicpXG4gICAgICAgICAgICBzYW4gPSByb2xlVG9DaGFyKG1vdmUucm9sZSkudG9VcHBlckNhc2UoKTtcbiAgICAgICAgc2FuICs9ICdAJyArIG1ha2VTcXVhcmUobW92ZS50byk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBjb25zdCByb2xlID0gcG9zLmJvYXJkLmdldFJvbGUobW92ZS5mcm9tKTtcbiAgICAgICAgaWYgKCFyb2xlKVxuICAgICAgICAgICAgcmV0dXJuICctLSc7XG4gICAgICAgIGlmIChyb2xlID09PSAna2luZycgJiYgKHBvcy5ib2FyZFtwb3MudHVybl0uaGFzKG1vdmUudG8pIHx8IE1hdGguYWJzKG1vdmUudG8gLSBtb3ZlLmZyb20pID09PSAyKSkge1xuICAgICAgICAgICAgc2FuID0gbW92ZS50byA+IG1vdmUuZnJvbSA/ICdPLU8nIDogJ08tTy1PJztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IGNhcHR1cmUgPSBwb3MuYm9hcmQub2NjdXBpZWQuaGFzKG1vdmUudG8pXG4gICAgICAgICAgICAgICAgfHwgKHJvbGUgPT09ICdwYXduJyAmJiBzcXVhcmVGaWxlKG1vdmUuZnJvbSkgIT09IHNxdWFyZUZpbGUobW92ZS50bykpO1xuICAgICAgICAgICAgaWYgKHJvbGUgIT09ICdwYXduJykge1xuICAgICAgICAgICAgICAgIHNhbiA9IHJvbGVUb0NoYXIocm9sZSkudG9VcHBlckNhc2UoKTtcbiAgICAgICAgICAgICAgICAvLyBEaXNhbWJpZ3VhdGlvblxuICAgICAgICAgICAgICAgIGxldCBvdGhlcnM7XG4gICAgICAgICAgICAgICAgaWYgKHJvbGUgPT09ICdraW5nJylcbiAgICAgICAgICAgICAgICAgICAgb3RoZXJzID0ga2luZ0F0dGFja3MobW92ZS50bykuaW50ZXJzZWN0KHBvcy5ib2FyZC5raW5nKTtcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChyb2xlID09PSAncXVlZW4nKVxuICAgICAgICAgICAgICAgICAgICBvdGhlcnMgPSBxdWVlbkF0dGFja3MobW92ZS50bywgcG9zLmJvYXJkLm9jY3VwaWVkKS5pbnRlcnNlY3QocG9zLmJvYXJkLnF1ZWVuKTtcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChyb2xlID09PSAncm9vaycpXG4gICAgICAgICAgICAgICAgICAgIG90aGVycyA9IHJvb2tBdHRhY2tzKG1vdmUudG8sIHBvcy5ib2FyZC5vY2N1cGllZCkuaW50ZXJzZWN0KHBvcy5ib2FyZC5yb29rKTtcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChyb2xlID09PSAnYmlzaG9wJylcbiAgICAgICAgICAgICAgICAgICAgb3RoZXJzID0gYmlzaG9wQXR0YWNrcyhtb3ZlLnRvLCBwb3MuYm9hcmQub2NjdXBpZWQpLmludGVyc2VjdChwb3MuYm9hcmQuYmlzaG9wKTtcbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIG90aGVycyA9IGtuaWdodEF0dGFja3MobW92ZS50bykuaW50ZXJzZWN0KHBvcy5ib2FyZC5rbmlnaHQpO1xuICAgICAgICAgICAgICAgIG90aGVycyA9IG90aGVycy5pbnRlcnNlY3QocG9zLmJvYXJkW3Bvcy50dXJuXSkud2l0aG91dChtb3ZlLmZyb20pO1xuICAgICAgICAgICAgICAgIGlmIChvdGhlcnMubm9uRW1wdHkoKSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjdHggPSBwb3MuY3R4KCk7XG4gICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgZnJvbSBvZiBvdGhlcnMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcG9zLmRlc3RzKGZyb20sIGN0eCkuaGFzKG1vdmUudG8pKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG90aGVycyA9IG90aGVycy53aXRob3V0KGZyb20pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChvdGhlcnMubm9uRW1wdHkoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHJvdyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGNvbHVtbiA9IG90aGVycy5pbnRlcnNlY3RzKFNxdWFyZVNldC5mcm9tUmFuayhzcXVhcmVSYW5rKG1vdmUuZnJvbSkpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvdGhlcnMuaW50ZXJzZWN0cyhTcXVhcmVTZXQuZnJvbUZpbGUoc3F1YXJlRmlsZShtb3ZlLmZyb20pKSkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW4gPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbHVtbilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYW4gKz0gRklMRV9OQU1FU1tzcXVhcmVGaWxlKG1vdmUuZnJvbSldO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJvdylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYW4gKz0gUkFOS19OQU1FU1tzcXVhcmVSYW5rKG1vdmUuZnJvbSldO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoY2FwdHVyZSlcbiAgICAgICAgICAgICAgICBzYW4gPSBGSUxFX05BTUVTW3NxdWFyZUZpbGUobW92ZS5mcm9tKV07XG4gICAgICAgICAgICBpZiAoY2FwdHVyZSlcbiAgICAgICAgICAgICAgICBzYW4gKz0gJ3gnO1xuICAgICAgICAgICAgc2FuICs9IG1ha2VTcXVhcmUobW92ZS50byk7XG4gICAgICAgICAgICBpZiAobW92ZS5wcm9tb3Rpb24pXG4gICAgICAgICAgICAgICAgc2FuICs9ICc9JyArIHJvbGVUb0NoYXIobW92ZS5wcm9tb3Rpb24pLnRvVXBwZXJDYXNlKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHNhbjtcbn07XG5leHBvcnQgY29uc3QgbWFrZVNhbkFuZFBsYXkgPSAocG9zLCBtb3ZlKSA9PiB7XG4gICAgdmFyIF9hO1xuICAgIGNvbnN0IHNhbiA9IG1ha2VTYW5XaXRob3V0U3VmZml4KHBvcywgbW92ZSk7XG4gICAgcG9zLnBsYXkobW92ZSk7XG4gICAgaWYgKChfYSA9IHBvcy5vdXRjb21lKCkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS53aW5uZXIpXG4gICAgICAgIHJldHVybiBzYW4gKyAnIyc7XG4gICAgaWYgKHBvcy5pc0NoZWNrKCkpXG4gICAgICAgIHJldHVybiBzYW4gKyAnKyc7XG4gICAgcmV0dXJuIHNhbjtcbn07XG5leHBvcnQgY29uc3QgbWFrZVNhblZhcmlhdGlvbiA9IChwb3MsIHZhcmlhdGlvbikgPT4ge1xuICAgIHZhciBfYTtcbiAgICBwb3MgPSBwb3MuY2xvbmUoKTtcbiAgICBjb25zdCBsaW5lID0gW107XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB2YXJpYXRpb24ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYgKGkgIT09IDApXG4gICAgICAgICAgICBsaW5lLnB1c2goJyAnKTtcbiAgICAgICAgaWYgKHBvcy50dXJuID09PSAnd2hpdGUnKVxuICAgICAgICAgICAgbGluZS5wdXNoKHBvcy5mdWxsbW92ZXMsICcuICcpO1xuICAgICAgICBlbHNlIGlmIChpID09PSAwKVxuICAgICAgICAgICAgbGluZS5wdXNoKHBvcy5mdWxsbW92ZXMsICcuLi4gJyk7XG4gICAgICAgIGNvbnN0IHNhbiA9IG1ha2VTYW5XaXRob3V0U3VmZml4KHBvcywgdmFyaWF0aW9uW2ldKTtcbiAgICAgICAgcG9zLnBsYXkodmFyaWF0aW9uW2ldKTtcbiAgICAgICAgbGluZS5wdXNoKHNhbik7XG4gICAgICAgIGlmIChzYW4gPT09ICctLScpXG4gICAgICAgICAgICByZXR1cm4gbGluZS5qb2luKCcnKTtcbiAgICAgICAgaWYgKGkgPT09IHZhcmlhdGlvbi5sZW5ndGggLSAxICYmICgoX2EgPSBwb3Mub3V0Y29tZSgpKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Eud2lubmVyKSlcbiAgICAgICAgICAgIGxpbmUucHVzaCgnIycpO1xuICAgICAgICBlbHNlIGlmIChwb3MuaXNDaGVjaygpKVxuICAgICAgICAgICAgbGluZS5wdXNoKCcrJyk7XG4gICAgfVxuICAgIHJldHVybiBsaW5lLmpvaW4oJycpO1xufTtcbmV4cG9ydCBjb25zdCBtYWtlU2FuID0gKHBvcywgbW92ZSkgPT4gbWFrZVNhbkFuZFBsYXkocG9zLmNsb25lKCksIG1vdmUpO1xuZXhwb3J0IGNvbnN0IHBhcnNlU2FuID0gKHBvcywgc2FuKSA9PiB7XG4gICAgY29uc3QgY3R4ID0gcG9zLmN0eCgpO1xuICAgIC8vIE5vcm1hbCBtb3ZlXG4gICAgY29uc3QgbWF0Y2ggPSBzYW4ubWF0Y2goL14oW05CUlFLXSk/KFthLWhdKT8oWzEtOF0pP1steF0/KFthLWhdWzEtOF0pKD86PT8oW25icnFrTkJSUUtdKSk/WysjXT8kLyk7XG4gICAgaWYgKCFtYXRjaCkge1xuICAgICAgICAvLyBDYXN0bGluZ1xuICAgICAgICBsZXQgY2FzdGxpbmdTaWRlO1xuICAgICAgICBpZiAoc2FuID09PSAnTy1PJyB8fCBzYW4gPT09ICdPLU8rJyB8fCBzYW4gPT09ICdPLU8jJylcbiAgICAgICAgICAgIGNhc3RsaW5nU2lkZSA9ICdoJztcbiAgICAgICAgZWxzZSBpZiAoc2FuID09PSAnTy1PLU8nIHx8IHNhbiA9PT0gJ08tTy1PKycgfHwgc2FuID09PSAnTy1PLU8jJylcbiAgICAgICAgICAgIGNhc3RsaW5nU2lkZSA9ICdhJztcbiAgICAgICAgaWYgKGNhc3RsaW5nU2lkZSkge1xuICAgICAgICAgICAgY29uc3Qgcm9vayA9IHBvcy5jYXN0bGVzLnJvb2tbcG9zLnR1cm5dW2Nhc3RsaW5nU2lkZV07XG4gICAgICAgICAgICBpZiAoIWRlZmluZWQoY3R4LmtpbmcpIHx8ICFkZWZpbmVkKHJvb2spIHx8ICFwb3MuZGVzdHMoY3R4LmtpbmcsIGN0eCkuaGFzKHJvb2spKVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgZnJvbTogY3R4LmtpbmcsXG4gICAgICAgICAgICAgICAgdG86IHJvb2ssXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIC8vIERyb3BcbiAgICAgICAgY29uc3QgbWF0Y2ggPSBzYW4ubWF0Y2goL14oW3BuYnJxa1BOQlJRS10pP0AoW2EtaF1bMS04XSlbKyNdPyQvKTtcbiAgICAgICAgaWYgKCFtYXRjaClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgY29uc3QgbW92ZSA9IHtcbiAgICAgICAgICAgIHJvbGU6IG1hdGNoWzFdID8gY2hhclRvUm9sZShtYXRjaFsxXSkgOiAncGF3bicsXG4gICAgICAgICAgICB0bzogcGFyc2VTcXVhcmUobWF0Y2hbMl0pLFxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gcG9zLmlzTGVnYWwobW92ZSwgY3R4KSA/IG1vdmUgOiB1bmRlZmluZWQ7XG4gICAgfVxuICAgIGNvbnN0IHJvbGUgPSBtYXRjaFsxXSA/IGNoYXJUb1JvbGUobWF0Y2hbMV0pIDogJ3Bhd24nO1xuICAgIGNvbnN0IHRvID0gcGFyc2VTcXVhcmUobWF0Y2hbNF0pO1xuICAgIGNvbnN0IHByb21vdGlvbiA9IG1hdGNoWzVdID8gY2hhclRvUm9sZShtYXRjaFs1XSkgOiB1bmRlZmluZWQ7XG4gICAgaWYgKCEhcHJvbW90aW9uICE9PSAocm9sZSA9PT0gJ3Bhd24nICYmIFNxdWFyZVNldC5iYWNrcmFua3MoKS5oYXModG8pKSlcbiAgICAgICAgcmV0dXJuO1xuICAgIGlmIChwcm9tb3Rpb24gPT09ICdraW5nJyAmJiBwb3MucnVsZXMgIT09ICdhbnRpY2hlc3MnKVxuICAgICAgICByZXR1cm47XG4gICAgbGV0IGNhbmRpZGF0ZXMgPSBwb3MuYm9hcmQucGllY2VzKHBvcy50dXJuLCByb2xlKTtcbiAgICBpZiAocm9sZSA9PT0gJ3Bhd24nICYmICFtYXRjaFsyXSlcbiAgICAgICAgY2FuZGlkYXRlcyA9IGNhbmRpZGF0ZXMuaW50ZXJzZWN0KFNxdWFyZVNldC5mcm9tRmlsZShzcXVhcmVGaWxlKHRvKSkpO1xuICAgIGVsc2UgaWYgKG1hdGNoWzJdKVxuICAgICAgICBjYW5kaWRhdGVzID0gY2FuZGlkYXRlcy5pbnRlcnNlY3QoU3F1YXJlU2V0LmZyb21GaWxlKG1hdGNoWzJdLmNoYXJDb2RlQXQoMCkgLSAnYScuY2hhckNvZGVBdCgwKSkpO1xuICAgIGlmIChtYXRjaFszXSlcbiAgICAgICAgY2FuZGlkYXRlcyA9IGNhbmRpZGF0ZXMuaW50ZXJzZWN0KFNxdWFyZVNldC5mcm9tUmFuayhtYXRjaFszXS5jaGFyQ29kZUF0KDApIC0gJzEnLmNoYXJDb2RlQXQoMCkpKTtcbiAgICAvLyBPcHRpbWl6YXRpb246IFJlZHVjZSBzZXQgb2YgY2FuZGlkYXRlc1xuICAgIGNvbnN0IHBhd25BZHZhbmNlID0gcm9sZSA9PT0gJ3Bhd24nID8gU3F1YXJlU2V0LmZyb21GaWxlKHNxdWFyZUZpbGUodG8pKSA6IFNxdWFyZVNldC5lbXB0eSgpO1xuICAgIGNhbmRpZGF0ZXMgPSBjYW5kaWRhdGVzLmludGVyc2VjdChwYXduQWR2YW5jZS51bmlvbihhdHRhY2tzKHsgY29sb3I6IG9wcG9zaXRlKHBvcy50dXJuKSwgcm9sZSB9LCB0bywgcG9zLmJvYXJkLm9jY3VwaWVkKSkpO1xuICAgIC8vIENoZWNrIHVuaXF1ZW5lc3MgYW5kIGxlZ2FsaXR5XG4gICAgbGV0IGZyb207XG4gICAgZm9yIChjb25zdCBjYW5kaWRhdGUgb2YgY2FuZGlkYXRlcykge1xuICAgICAgICBpZiAocG9zLmRlc3RzKGNhbmRpZGF0ZSwgY3R4KS5oYXModG8pKSB7XG4gICAgICAgICAgICBpZiAoZGVmaW5lZChmcm9tKSlcbiAgICAgICAgICAgICAgICByZXR1cm47IC8vIEFtYmlndW91c1xuICAgICAgICAgICAgZnJvbSA9IGNhbmRpZGF0ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpZiAoIWRlZmluZWQoZnJvbSkpXG4gICAgICAgIHJldHVybjsgLy8gSWxsZWdhbFxuICAgIHJldHVybiB7XG4gICAgICAgIGZyb20sXG4gICAgICAgIHRvLFxuICAgICAgICBwcm9tb3Rpb24sXG4gICAgfTtcbn07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1zYW4uanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/chessops/dist/esm/san.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/chessops/dist/esm/setup.js":
/*!*************************************************!*\
  !*** ./node_modules/chessops/dist/esm/setup.js ***!
  \*************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Material: () => (/* binding */ Material),\n/* harmony export */   MaterialSide: () => (/* binding */ MaterialSide),\n/* harmony export */   RemainingChecks: () => (/* binding */ RemainingChecks),\n/* harmony export */   defaultSetup: () => (/* binding */ defaultSetup),\n/* harmony export */   setupClone: () => (/* binding */ setupClone),\n/* harmony export */   setupEquals: () => (/* binding */ setupEquals)\n/* harmony export */ });\n/* harmony import */ var _board_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./board.js */ \"(ssr)/./node_modules/chessops/dist/esm/board.js\");\n/* harmony import */ var _squareSet_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./squareSet.js */ \"(ssr)/./node_modules/chessops/dist/esm/squareSet.js\");\n/* harmony import */ var _types_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./types.js */ \"(ssr)/./node_modules/chessops/dist/esm/types.js\");\n\n\n\nclass MaterialSide {\n    constructor() { }\n    static empty() {\n        const m = new MaterialSide();\n        for (const role of _types_js__WEBPACK_IMPORTED_MODULE_0__.ROLES)\n            m[role] = 0;\n        return m;\n    }\n    static fromBoard(board, color) {\n        const m = new MaterialSide();\n        for (const role of _types_js__WEBPACK_IMPORTED_MODULE_0__.ROLES)\n            m[role] = board.pieces(color, role).size();\n        return m;\n    }\n    clone() {\n        const m = new MaterialSide();\n        for (const role of _types_js__WEBPACK_IMPORTED_MODULE_0__.ROLES)\n            m[role] = this[role];\n        return m;\n    }\n    equals(other) {\n        return _types_js__WEBPACK_IMPORTED_MODULE_0__.ROLES.every(role => this[role] === other[role]);\n    }\n    add(other) {\n        const m = new MaterialSide();\n        for (const role of _types_js__WEBPACK_IMPORTED_MODULE_0__.ROLES)\n            m[role] = this[role] + other[role];\n        return m;\n    }\n    subtract(other) {\n        const m = new MaterialSide();\n        for (const role of _types_js__WEBPACK_IMPORTED_MODULE_0__.ROLES)\n            m[role] = this[role] - other[role];\n        return m;\n    }\n    nonEmpty() {\n        return _types_js__WEBPACK_IMPORTED_MODULE_0__.ROLES.some(role => this[role] > 0);\n    }\n    isEmpty() {\n        return !this.nonEmpty();\n    }\n    hasPawns() {\n        return this.pawn > 0;\n    }\n    hasNonPawns() {\n        return this.knight > 0 || this.bishop > 0 || this.rook > 0 || this.queen > 0 || this.king > 0;\n    }\n    size() {\n        return this.pawn + this.knight + this.bishop + this.rook + this.queen + this.king;\n    }\n}\nclass Material {\n    constructor(white, black) {\n        this.white = white;\n        this.black = black;\n    }\n    static empty() {\n        return new Material(MaterialSide.empty(), MaterialSide.empty());\n    }\n    static fromBoard(board) {\n        return new Material(MaterialSide.fromBoard(board, 'white'), MaterialSide.fromBoard(board, 'black'));\n    }\n    clone() {\n        return new Material(this.white.clone(), this.black.clone());\n    }\n    equals(other) {\n        return this.white.equals(other.white) && this.black.equals(other.black);\n    }\n    add(other) {\n        return new Material(this.white.add(other.white), this.black.add(other.black));\n    }\n    subtract(other) {\n        return new Material(this.white.subtract(other.white), this.black.subtract(other.black));\n    }\n    count(role) {\n        return this.white[role] + this.black[role];\n    }\n    size() {\n        return this.white.size() + this.black.size();\n    }\n    isEmpty() {\n        return this.white.isEmpty() && this.black.isEmpty();\n    }\n    nonEmpty() {\n        return !this.isEmpty();\n    }\n    hasPawns() {\n        return this.white.hasPawns() || this.black.hasPawns();\n    }\n    hasNonPawns() {\n        return this.white.hasNonPawns() || this.black.hasNonPawns();\n    }\n}\nclass RemainingChecks {\n    constructor(white, black) {\n        this.white = white;\n        this.black = black;\n    }\n    static default() {\n        return new RemainingChecks(3, 3);\n    }\n    clone() {\n        return new RemainingChecks(this.white, this.black);\n    }\n    equals(other) {\n        return this.white === other.white && this.black === other.black;\n    }\n}\nconst defaultSetup = () => ({\n    board: _board_js__WEBPACK_IMPORTED_MODULE_1__.Board.default(),\n    pockets: undefined,\n    turn: 'white',\n    castlingRights: _squareSet_js__WEBPACK_IMPORTED_MODULE_2__.SquareSet.corners(),\n    epSquare: undefined,\n    remainingChecks: undefined,\n    halfmoves: 0,\n    fullmoves: 1,\n});\nconst setupClone = (setup) => {\n    var _a, _b;\n    return ({\n        board: setup.board.clone(),\n        pockets: (_a = setup.pockets) === null || _a === void 0 ? void 0 : _a.clone(),\n        turn: setup.turn,\n        castlingRights: setup.castlingRights,\n        epSquare: setup.epSquare,\n        remainingChecks: (_b = setup.remainingChecks) === null || _b === void 0 ? void 0 : _b.clone(),\n        halfmoves: setup.halfmoves,\n        fullmoves: setup.fullmoves,\n    });\n};\nconst setupEquals = (left, right) => {\n    var _a, _b;\n    return (0,_board_js__WEBPACK_IMPORTED_MODULE_1__.boardEquals)(left.board, right.board)\n        && ((right.pockets && ((_a = left.pockets) === null || _a === void 0 ? void 0 : _a.equals(right.pockets))) || (!left.pockets && !right.pockets))\n        && left.turn === right.turn\n        && left.castlingRights.equals(right.castlingRights)\n        && left.epSquare === right.epSquare\n        && ((right.remainingChecks && ((_b = left.remainingChecks) === null || _b === void 0 ? void 0 : _b.equals(right.remainingChecks)))\n            || (!left.remainingChecks && !right.remainingChecks))\n        && left.halfmoves === right.halfmoves\n        && left.fullmoves === right.fullmoves;\n};\n//# sourceMappingURL=setup.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvY2hlc3NvcHMvZGlzdC9lc20vc2V0dXAuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBQWdEO0FBQ0w7QUFDUjtBQUM1QjtBQUNQO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQiw0Q0FBSztBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLDRDQUFLO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsNENBQUs7QUFDaEM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlLDRDQUFLO0FBQ3BCO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQiw0Q0FBSztBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLDRDQUFLO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZSw0Q0FBSztBQUNwQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUCxXQUFXLDRDQUFLO0FBQ2hCO0FBQ0E7QUFDQSxvQkFBb0Isb0RBQVM7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ007QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNPO0FBQ1A7QUFDQSxXQUFXLHNEQUFXO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyIvVXNlcnMvcmFrc2hpdC93b3Jrc3BhY2UvYXJjaGl2ZXMvcmVwb3MvY2hlc3MvZXZhbC1iYXIvbm9kZV9tb2R1bGVzL2NoZXNzb3BzL2Rpc3QvZXNtL3NldHVwLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEJvYXJkLCBib2FyZEVxdWFscyB9IGZyb20gJy4vYm9hcmQuanMnO1xuaW1wb3J0IHsgU3F1YXJlU2V0IH0gZnJvbSAnLi9zcXVhcmVTZXQuanMnO1xuaW1wb3J0IHsgUk9MRVMgfSBmcm9tICcuL3R5cGVzLmpzJztcbmV4cG9ydCBjbGFzcyBNYXRlcmlhbFNpZGUge1xuICAgIGNvbnN0cnVjdG9yKCkgeyB9XG4gICAgc3RhdGljIGVtcHR5KCkge1xuICAgICAgICBjb25zdCBtID0gbmV3IE1hdGVyaWFsU2lkZSgpO1xuICAgICAgICBmb3IgKGNvbnN0IHJvbGUgb2YgUk9MRVMpXG4gICAgICAgICAgICBtW3JvbGVdID0gMDtcbiAgICAgICAgcmV0dXJuIG07XG4gICAgfVxuICAgIHN0YXRpYyBmcm9tQm9hcmQoYm9hcmQsIGNvbG9yKSB7XG4gICAgICAgIGNvbnN0IG0gPSBuZXcgTWF0ZXJpYWxTaWRlKCk7XG4gICAgICAgIGZvciAoY29uc3Qgcm9sZSBvZiBST0xFUylcbiAgICAgICAgICAgIG1bcm9sZV0gPSBib2FyZC5waWVjZXMoY29sb3IsIHJvbGUpLnNpemUoKTtcbiAgICAgICAgcmV0dXJuIG07XG4gICAgfVxuICAgIGNsb25lKCkge1xuICAgICAgICBjb25zdCBtID0gbmV3IE1hdGVyaWFsU2lkZSgpO1xuICAgICAgICBmb3IgKGNvbnN0IHJvbGUgb2YgUk9MRVMpXG4gICAgICAgICAgICBtW3JvbGVdID0gdGhpc1tyb2xlXTtcbiAgICAgICAgcmV0dXJuIG07XG4gICAgfVxuICAgIGVxdWFscyhvdGhlcikge1xuICAgICAgICByZXR1cm4gUk9MRVMuZXZlcnkocm9sZSA9PiB0aGlzW3JvbGVdID09PSBvdGhlcltyb2xlXSk7XG4gICAgfVxuICAgIGFkZChvdGhlcikge1xuICAgICAgICBjb25zdCBtID0gbmV3IE1hdGVyaWFsU2lkZSgpO1xuICAgICAgICBmb3IgKGNvbnN0IHJvbGUgb2YgUk9MRVMpXG4gICAgICAgICAgICBtW3JvbGVdID0gdGhpc1tyb2xlXSArIG90aGVyW3JvbGVdO1xuICAgICAgICByZXR1cm4gbTtcbiAgICB9XG4gICAgc3VidHJhY3Qob3RoZXIpIHtcbiAgICAgICAgY29uc3QgbSA9IG5ldyBNYXRlcmlhbFNpZGUoKTtcbiAgICAgICAgZm9yIChjb25zdCByb2xlIG9mIFJPTEVTKVxuICAgICAgICAgICAgbVtyb2xlXSA9IHRoaXNbcm9sZV0gLSBvdGhlcltyb2xlXTtcbiAgICAgICAgcmV0dXJuIG07XG4gICAgfVxuICAgIG5vbkVtcHR5KCkge1xuICAgICAgICByZXR1cm4gUk9MRVMuc29tZShyb2xlID0+IHRoaXNbcm9sZV0gPiAwKTtcbiAgICB9XG4gICAgaXNFbXB0eSgpIHtcbiAgICAgICAgcmV0dXJuICF0aGlzLm5vbkVtcHR5KCk7XG4gICAgfVxuICAgIGhhc1Bhd25zKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wYXduID4gMDtcbiAgICB9XG4gICAgaGFzTm9uUGF3bnMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmtuaWdodCA+IDAgfHwgdGhpcy5iaXNob3AgPiAwIHx8IHRoaXMucm9vayA+IDAgfHwgdGhpcy5xdWVlbiA+IDAgfHwgdGhpcy5raW5nID4gMDtcbiAgICB9XG4gICAgc2l6ZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucGF3biArIHRoaXMua25pZ2h0ICsgdGhpcy5iaXNob3AgKyB0aGlzLnJvb2sgKyB0aGlzLnF1ZWVuICsgdGhpcy5raW5nO1xuICAgIH1cbn1cbmV4cG9ydCBjbGFzcyBNYXRlcmlhbCB7XG4gICAgY29uc3RydWN0b3Iod2hpdGUsIGJsYWNrKSB7XG4gICAgICAgIHRoaXMud2hpdGUgPSB3aGl0ZTtcbiAgICAgICAgdGhpcy5ibGFjayA9IGJsYWNrO1xuICAgIH1cbiAgICBzdGF0aWMgZW1wdHkoKSB7XG4gICAgICAgIHJldHVybiBuZXcgTWF0ZXJpYWwoTWF0ZXJpYWxTaWRlLmVtcHR5KCksIE1hdGVyaWFsU2lkZS5lbXB0eSgpKTtcbiAgICB9XG4gICAgc3RhdGljIGZyb21Cb2FyZChib2FyZCkge1xuICAgICAgICByZXR1cm4gbmV3IE1hdGVyaWFsKE1hdGVyaWFsU2lkZS5mcm9tQm9hcmQoYm9hcmQsICd3aGl0ZScpLCBNYXRlcmlhbFNpZGUuZnJvbUJvYXJkKGJvYXJkLCAnYmxhY2snKSk7XG4gICAgfVxuICAgIGNsb25lKCkge1xuICAgICAgICByZXR1cm4gbmV3IE1hdGVyaWFsKHRoaXMud2hpdGUuY2xvbmUoKSwgdGhpcy5ibGFjay5jbG9uZSgpKTtcbiAgICB9XG4gICAgZXF1YWxzKG90aGVyKSB7XG4gICAgICAgIHJldHVybiB0aGlzLndoaXRlLmVxdWFscyhvdGhlci53aGl0ZSkgJiYgdGhpcy5ibGFjay5lcXVhbHMob3RoZXIuYmxhY2spO1xuICAgIH1cbiAgICBhZGQob3RoZXIpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBNYXRlcmlhbCh0aGlzLndoaXRlLmFkZChvdGhlci53aGl0ZSksIHRoaXMuYmxhY2suYWRkKG90aGVyLmJsYWNrKSk7XG4gICAgfVxuICAgIHN1YnRyYWN0KG90aGVyKSB7XG4gICAgICAgIHJldHVybiBuZXcgTWF0ZXJpYWwodGhpcy53aGl0ZS5zdWJ0cmFjdChvdGhlci53aGl0ZSksIHRoaXMuYmxhY2suc3VidHJhY3Qob3RoZXIuYmxhY2spKTtcbiAgICB9XG4gICAgY291bnQocm9sZSkge1xuICAgICAgICByZXR1cm4gdGhpcy53aGl0ZVtyb2xlXSArIHRoaXMuYmxhY2tbcm9sZV07XG4gICAgfVxuICAgIHNpemUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLndoaXRlLnNpemUoKSArIHRoaXMuYmxhY2suc2l6ZSgpO1xuICAgIH1cbiAgICBpc0VtcHR5KCkge1xuICAgICAgICByZXR1cm4gdGhpcy53aGl0ZS5pc0VtcHR5KCkgJiYgdGhpcy5ibGFjay5pc0VtcHR5KCk7XG4gICAgfVxuICAgIG5vbkVtcHR5KCkge1xuICAgICAgICByZXR1cm4gIXRoaXMuaXNFbXB0eSgpO1xuICAgIH1cbiAgICBoYXNQYXducygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMud2hpdGUuaGFzUGF3bnMoKSB8fCB0aGlzLmJsYWNrLmhhc1Bhd25zKCk7XG4gICAgfVxuICAgIGhhc05vblBhd25zKCkge1xuICAgICAgICByZXR1cm4gdGhpcy53aGl0ZS5oYXNOb25QYXducygpIHx8IHRoaXMuYmxhY2suaGFzTm9uUGF3bnMoKTtcbiAgICB9XG59XG5leHBvcnQgY2xhc3MgUmVtYWluaW5nQ2hlY2tzIHtcbiAgICBjb25zdHJ1Y3Rvcih3aGl0ZSwgYmxhY2spIHtcbiAgICAgICAgdGhpcy53aGl0ZSA9IHdoaXRlO1xuICAgICAgICB0aGlzLmJsYWNrID0gYmxhY2s7XG4gICAgfVxuICAgIHN0YXRpYyBkZWZhdWx0KCkge1xuICAgICAgICByZXR1cm4gbmV3IFJlbWFpbmluZ0NoZWNrcygzLCAzKTtcbiAgICB9XG4gICAgY2xvbmUoKSB7XG4gICAgICAgIHJldHVybiBuZXcgUmVtYWluaW5nQ2hlY2tzKHRoaXMud2hpdGUsIHRoaXMuYmxhY2spO1xuICAgIH1cbiAgICBlcXVhbHMob3RoZXIpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMud2hpdGUgPT09IG90aGVyLndoaXRlICYmIHRoaXMuYmxhY2sgPT09IG90aGVyLmJsYWNrO1xuICAgIH1cbn1cbmV4cG9ydCBjb25zdCBkZWZhdWx0U2V0dXAgPSAoKSA9PiAoe1xuICAgIGJvYXJkOiBCb2FyZC5kZWZhdWx0KCksXG4gICAgcG9ja2V0czogdW5kZWZpbmVkLFxuICAgIHR1cm46ICd3aGl0ZScsXG4gICAgY2FzdGxpbmdSaWdodHM6IFNxdWFyZVNldC5jb3JuZXJzKCksXG4gICAgZXBTcXVhcmU6IHVuZGVmaW5lZCxcbiAgICByZW1haW5pbmdDaGVja3M6IHVuZGVmaW5lZCxcbiAgICBoYWxmbW92ZXM6IDAsXG4gICAgZnVsbG1vdmVzOiAxLFxufSk7XG5leHBvcnQgY29uc3Qgc2V0dXBDbG9uZSA9IChzZXR1cCkgPT4ge1xuICAgIHZhciBfYSwgX2I7XG4gICAgcmV0dXJuICh7XG4gICAgICAgIGJvYXJkOiBzZXR1cC5ib2FyZC5jbG9uZSgpLFxuICAgICAgICBwb2NrZXRzOiAoX2EgPSBzZXR1cC5wb2NrZXRzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuY2xvbmUoKSxcbiAgICAgICAgdHVybjogc2V0dXAudHVybixcbiAgICAgICAgY2FzdGxpbmdSaWdodHM6IHNldHVwLmNhc3RsaW5nUmlnaHRzLFxuICAgICAgICBlcFNxdWFyZTogc2V0dXAuZXBTcXVhcmUsXG4gICAgICAgIHJlbWFpbmluZ0NoZWNrczogKF9iID0gc2V0dXAucmVtYWluaW5nQ2hlY2tzKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuY2xvbmUoKSxcbiAgICAgICAgaGFsZm1vdmVzOiBzZXR1cC5oYWxmbW92ZXMsXG4gICAgICAgIGZ1bGxtb3Zlczogc2V0dXAuZnVsbG1vdmVzLFxuICAgIH0pO1xufTtcbmV4cG9ydCBjb25zdCBzZXR1cEVxdWFscyA9IChsZWZ0LCByaWdodCkgPT4ge1xuICAgIHZhciBfYSwgX2I7XG4gICAgcmV0dXJuIGJvYXJkRXF1YWxzKGxlZnQuYm9hcmQsIHJpZ2h0LmJvYXJkKVxuICAgICAgICAmJiAoKHJpZ2h0LnBvY2tldHMgJiYgKChfYSA9IGxlZnQucG9ja2V0cykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmVxdWFscyhyaWdodC5wb2NrZXRzKSkpIHx8ICghbGVmdC5wb2NrZXRzICYmICFyaWdodC5wb2NrZXRzKSlcbiAgICAgICAgJiYgbGVmdC50dXJuID09PSByaWdodC50dXJuXG4gICAgICAgICYmIGxlZnQuY2FzdGxpbmdSaWdodHMuZXF1YWxzKHJpZ2h0LmNhc3RsaW5nUmlnaHRzKVxuICAgICAgICAmJiBsZWZ0LmVwU3F1YXJlID09PSByaWdodC5lcFNxdWFyZVxuICAgICAgICAmJiAoKHJpZ2h0LnJlbWFpbmluZ0NoZWNrcyAmJiAoKF9iID0gbGVmdC5yZW1haW5pbmdDaGVja3MpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5lcXVhbHMocmlnaHQucmVtYWluaW5nQ2hlY2tzKSkpXG4gICAgICAgICAgICB8fCAoIWxlZnQucmVtYWluaW5nQ2hlY2tzICYmICFyaWdodC5yZW1haW5pbmdDaGVja3MpKVxuICAgICAgICAmJiBsZWZ0LmhhbGZtb3ZlcyA9PT0gcmlnaHQuaGFsZm1vdmVzXG4gICAgICAgICYmIGxlZnQuZnVsbG1vdmVzID09PSByaWdodC5mdWxsbW92ZXM7XG59O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9c2V0dXAuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/chessops/dist/esm/setup.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/chessops/dist/esm/squareSet.js":
/*!*****************************************************!*\
  !*** ./node_modules/chessops/dist/esm/squareSet.js ***!
  \*****************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   SquareSet: () => (/* binding */ SquareSet)\n/* harmony export */ });\nconst popcnt32 = (n) => {\n    n = n - ((n >>> 1) & 1431655765);\n    n = (n & 858993459) + ((n >>> 2) & 858993459);\n    return Math.imul((n + (n >>> 4)) & 252645135, 16843009) >> 24;\n};\nconst bswap32 = (n) => {\n    n = ((n >>> 8) & 16711935) | ((n & 16711935) << 8);\n    return ((n >>> 16) & 0xffff) | ((n & 0xffff) << 16);\n};\nconst rbit32 = (n) => {\n    n = ((n >>> 1) & 1431655765) | ((n & 1431655765) << 1);\n    n = ((n >>> 2) & 858993459) | ((n & 858993459) << 2);\n    n = ((n >>> 4) & 252645135) | ((n & 252645135) << 4);\n    return bswap32(n);\n};\n/**\n * An immutable set of squares, implemented as a bitboard.\n */\nclass SquareSet {\n    constructor(lo, hi) {\n        this.lo = lo | 0;\n        this.hi = hi | 0;\n    }\n    static fromSquare(square) {\n        return square >= 32 ? new SquareSet(0, 1 << (square - 32)) : new SquareSet(1 << square, 0);\n    }\n    static fromRank(rank) {\n        return new SquareSet(0xff, 0).shl64(8 * rank);\n    }\n    static fromFile(file) {\n        return new SquareSet(16843009 << file, 16843009 << file);\n    }\n    static empty() {\n        return new SquareSet(0, 0);\n    }\n    static full() {\n        return new SquareSet(4294967295, 4294967295);\n    }\n    static corners() {\n        return new SquareSet(0x81, 2164260864);\n    }\n    static center() {\n        return new SquareSet(402653184, 0x18);\n    }\n    static backranks() {\n        return new SquareSet(0xff, 4278190080);\n    }\n    static backrank(color) {\n        return color === 'white' ? new SquareSet(0xff, 0) : new SquareSet(0, 4278190080);\n    }\n    static lightSquares() {\n        return new SquareSet(1437226410, 1437226410);\n    }\n    static darkSquares() {\n        return new SquareSet(2857740885, 2857740885);\n    }\n    complement() {\n        return new SquareSet(~this.lo, ~this.hi);\n    }\n    xor(other) {\n        return new SquareSet(this.lo ^ other.lo, this.hi ^ other.hi);\n    }\n    union(other) {\n        return new SquareSet(this.lo | other.lo, this.hi | other.hi);\n    }\n    intersect(other) {\n        return new SquareSet(this.lo & other.lo, this.hi & other.hi);\n    }\n    diff(other) {\n        return new SquareSet(this.lo & ~other.lo, this.hi & ~other.hi);\n    }\n    intersects(other) {\n        return this.intersect(other).nonEmpty();\n    }\n    isDisjoint(other) {\n        return this.intersect(other).isEmpty();\n    }\n    supersetOf(other) {\n        return other.diff(this).isEmpty();\n    }\n    subsetOf(other) {\n        return this.diff(other).isEmpty();\n    }\n    shr64(shift) {\n        if (shift >= 64)\n            return SquareSet.empty();\n        if (shift >= 32)\n            return new SquareSet(this.hi >>> (shift - 32), 0);\n        if (shift > 0)\n            return new SquareSet((this.lo >>> shift) ^ (this.hi << (32 - shift)), this.hi >>> shift);\n        return this;\n    }\n    shl64(shift) {\n        if (shift >= 64)\n            return SquareSet.empty();\n        if (shift >= 32)\n            return new SquareSet(0, this.lo << (shift - 32));\n        if (shift > 0)\n            return new SquareSet(this.lo << shift, (this.hi << shift) ^ (this.lo >>> (32 - shift)));\n        return this;\n    }\n    bswap64() {\n        return new SquareSet(bswap32(this.hi), bswap32(this.lo));\n    }\n    rbit64() {\n        return new SquareSet(rbit32(this.hi), rbit32(this.lo));\n    }\n    minus64(other) {\n        const lo = this.lo - other.lo;\n        const c = ((lo & other.lo & 1) + (other.lo >>> 1) + (lo >>> 1)) >>> 31;\n        return new SquareSet(lo, this.hi - (other.hi + c));\n    }\n    equals(other) {\n        return this.lo === other.lo && this.hi === other.hi;\n    }\n    size() {\n        return popcnt32(this.lo) + popcnt32(this.hi);\n    }\n    isEmpty() {\n        return this.lo === 0 && this.hi === 0;\n    }\n    nonEmpty() {\n        return this.lo !== 0 || this.hi !== 0;\n    }\n    has(square) {\n        return (square >= 32 ? this.hi & (1 << (square - 32)) : this.lo & (1 << square)) !== 0;\n    }\n    set(square, on) {\n        return on ? this.with(square) : this.without(square);\n    }\n    with(square) {\n        return square >= 32\n            ? new SquareSet(this.lo, this.hi | (1 << (square - 32)))\n            : new SquareSet(this.lo | (1 << square), this.hi);\n    }\n    without(square) {\n        return square >= 32\n            ? new SquareSet(this.lo, this.hi & ~(1 << (square - 32)))\n            : new SquareSet(this.lo & ~(1 << square), this.hi);\n    }\n    toggle(square) {\n        return square >= 32\n            ? new SquareSet(this.lo, this.hi ^ (1 << (square - 32)))\n            : new SquareSet(this.lo ^ (1 << square), this.hi);\n    }\n    last() {\n        if (this.hi !== 0)\n            return 63 - Math.clz32(this.hi);\n        if (this.lo !== 0)\n            return 31 - Math.clz32(this.lo);\n        return;\n    }\n    first() {\n        if (this.lo !== 0)\n            return 31 - Math.clz32(this.lo & -this.lo);\n        if (this.hi !== 0)\n            return 63 - Math.clz32(this.hi & -this.hi);\n        return;\n    }\n    withoutFirst() {\n        if (this.lo !== 0)\n            return new SquareSet(this.lo & (this.lo - 1), this.hi);\n        return new SquareSet(0, this.hi & (this.hi - 1));\n    }\n    moreThanOne() {\n        return (this.hi !== 0 && this.lo !== 0) || (this.lo & (this.lo - 1)) !== 0 || (this.hi & (this.hi - 1)) !== 0;\n    }\n    singleSquare() {\n        return this.moreThanOne() ? undefined : this.last();\n    }\n    *[Symbol.iterator]() {\n        let lo = this.lo;\n        let hi = this.hi;\n        while (lo !== 0) {\n            const idx = 31 - Math.clz32(lo & -lo);\n            lo ^= 1 << idx;\n            yield idx;\n        }\n        while (hi !== 0) {\n            const idx = 31 - Math.clz32(hi & -hi);\n            hi ^= 1 << idx;\n            yield 32 + idx;\n        }\n    }\n    *reversed() {\n        let lo = this.lo;\n        let hi = this.hi;\n        while (hi !== 0) {\n            const idx = 31 - Math.clz32(hi);\n            hi ^= 1 << idx;\n            yield 32 + idx;\n        }\n        while (lo !== 0) {\n            const idx = 31 - Math.clz32(lo);\n            lo ^= 1 << idx;\n            yield idx;\n        }\n    }\n}\n//# sourceMappingURL=squareSet.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvY2hlc3NvcHMvZGlzdC9lc20vc3F1YXJlU2V0LmpzIiwibWFwcGluZ3MiOiI7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyIvVXNlcnMvcmFrc2hpdC93b3Jrc3BhY2UvYXJjaGl2ZXMvcmVwb3MvY2hlc3MvZXZhbC1iYXIvbm9kZV9tb2R1bGVzL2NoZXNzb3BzL2Rpc3QvZXNtL3NxdWFyZVNldC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBwb3BjbnQzMiA9IChuKSA9PiB7XG4gICAgbiA9IG4gLSAoKG4gPj4+IDEpICYgMTQzMTY1NTc2NSk7XG4gICAgbiA9IChuICYgODU4OTkzNDU5KSArICgobiA+Pj4gMikgJiA4NTg5OTM0NTkpO1xuICAgIHJldHVybiBNYXRoLmltdWwoKG4gKyAobiA+Pj4gNCkpICYgMjUyNjQ1MTM1LCAxNjg0MzAwOSkgPj4gMjQ7XG59O1xuY29uc3QgYnN3YXAzMiA9IChuKSA9PiB7XG4gICAgbiA9ICgobiA+Pj4gOCkgJiAxNjcxMTkzNSkgfCAoKG4gJiAxNjcxMTkzNSkgPDwgOCk7XG4gICAgcmV0dXJuICgobiA+Pj4gMTYpICYgMHhmZmZmKSB8ICgobiAmIDB4ZmZmZikgPDwgMTYpO1xufTtcbmNvbnN0IHJiaXQzMiA9IChuKSA9PiB7XG4gICAgbiA9ICgobiA+Pj4gMSkgJiAxNDMxNjU1NzY1KSB8ICgobiAmIDE0MzE2NTU3NjUpIDw8IDEpO1xuICAgIG4gPSAoKG4gPj4+IDIpICYgODU4OTkzNDU5KSB8ICgobiAmIDg1ODk5MzQ1OSkgPDwgMik7XG4gICAgbiA9ICgobiA+Pj4gNCkgJiAyNTI2NDUxMzUpIHwgKChuICYgMjUyNjQ1MTM1KSA8PCA0KTtcbiAgICByZXR1cm4gYnN3YXAzMihuKTtcbn07XG4vKipcbiAqIEFuIGltbXV0YWJsZSBzZXQgb2Ygc3F1YXJlcywgaW1wbGVtZW50ZWQgYXMgYSBiaXRib2FyZC5cbiAqL1xuZXhwb3J0IGNsYXNzIFNxdWFyZVNldCB7XG4gICAgY29uc3RydWN0b3IobG8sIGhpKSB7XG4gICAgICAgIHRoaXMubG8gPSBsbyB8IDA7XG4gICAgICAgIHRoaXMuaGkgPSBoaSB8IDA7XG4gICAgfVxuICAgIHN0YXRpYyBmcm9tU3F1YXJlKHNxdWFyZSkge1xuICAgICAgICByZXR1cm4gc3F1YXJlID49IDMyID8gbmV3IFNxdWFyZVNldCgwLCAxIDw8IChzcXVhcmUgLSAzMikpIDogbmV3IFNxdWFyZVNldCgxIDw8IHNxdWFyZSwgMCk7XG4gICAgfVxuICAgIHN0YXRpYyBmcm9tUmFuayhyYW5rKSB7XG4gICAgICAgIHJldHVybiBuZXcgU3F1YXJlU2V0KDB4ZmYsIDApLnNobDY0KDggKiByYW5rKTtcbiAgICB9XG4gICAgc3RhdGljIGZyb21GaWxlKGZpbGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBTcXVhcmVTZXQoMTY4NDMwMDkgPDwgZmlsZSwgMTY4NDMwMDkgPDwgZmlsZSk7XG4gICAgfVxuICAgIHN0YXRpYyBlbXB0eSgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBTcXVhcmVTZXQoMCwgMCk7XG4gICAgfVxuICAgIHN0YXRpYyBmdWxsKCkge1xuICAgICAgICByZXR1cm4gbmV3IFNxdWFyZVNldCg0Mjk0OTY3Mjk1LCA0Mjk0OTY3Mjk1KTtcbiAgICB9XG4gICAgc3RhdGljIGNvcm5lcnMoKSB7XG4gICAgICAgIHJldHVybiBuZXcgU3F1YXJlU2V0KDB4ODEsIDIxNjQyNjA4NjQpO1xuICAgIH1cbiAgICBzdGF0aWMgY2VudGVyKCkge1xuICAgICAgICByZXR1cm4gbmV3IFNxdWFyZVNldCg0MDI2NTMxODQsIDB4MTgpO1xuICAgIH1cbiAgICBzdGF0aWMgYmFja3JhbmtzKCkge1xuICAgICAgICByZXR1cm4gbmV3IFNxdWFyZVNldCgweGZmLCA0Mjc4MTkwMDgwKTtcbiAgICB9XG4gICAgc3RhdGljIGJhY2tyYW5rKGNvbG9yKSB7XG4gICAgICAgIHJldHVybiBjb2xvciA9PT0gJ3doaXRlJyA/IG5ldyBTcXVhcmVTZXQoMHhmZiwgMCkgOiBuZXcgU3F1YXJlU2V0KDAsIDQyNzgxOTAwODApO1xuICAgIH1cbiAgICBzdGF0aWMgbGlnaHRTcXVhcmVzKCkge1xuICAgICAgICByZXR1cm4gbmV3IFNxdWFyZVNldCgxNDM3MjI2NDEwLCAxNDM3MjI2NDEwKTtcbiAgICB9XG4gICAgc3RhdGljIGRhcmtTcXVhcmVzKCkge1xuICAgICAgICByZXR1cm4gbmV3IFNxdWFyZVNldCgyODU3NzQwODg1LCAyODU3NzQwODg1KTtcbiAgICB9XG4gICAgY29tcGxlbWVudCgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBTcXVhcmVTZXQofnRoaXMubG8sIH50aGlzLmhpKTtcbiAgICB9XG4gICAgeG9yKG90aGVyKSB7XG4gICAgICAgIHJldHVybiBuZXcgU3F1YXJlU2V0KHRoaXMubG8gXiBvdGhlci5sbywgdGhpcy5oaSBeIG90aGVyLmhpKTtcbiAgICB9XG4gICAgdW5pb24ob3RoZXIpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBTcXVhcmVTZXQodGhpcy5sbyB8IG90aGVyLmxvLCB0aGlzLmhpIHwgb3RoZXIuaGkpO1xuICAgIH1cbiAgICBpbnRlcnNlY3Qob3RoZXIpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBTcXVhcmVTZXQodGhpcy5sbyAmIG90aGVyLmxvLCB0aGlzLmhpICYgb3RoZXIuaGkpO1xuICAgIH1cbiAgICBkaWZmKG90aGVyKSB7XG4gICAgICAgIHJldHVybiBuZXcgU3F1YXJlU2V0KHRoaXMubG8gJiB+b3RoZXIubG8sIHRoaXMuaGkgJiB+b3RoZXIuaGkpO1xuICAgIH1cbiAgICBpbnRlcnNlY3RzKG90aGVyKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmludGVyc2VjdChvdGhlcikubm9uRW1wdHkoKTtcbiAgICB9XG4gICAgaXNEaXNqb2ludChvdGhlcikge1xuICAgICAgICByZXR1cm4gdGhpcy5pbnRlcnNlY3Qob3RoZXIpLmlzRW1wdHkoKTtcbiAgICB9XG4gICAgc3VwZXJzZXRPZihvdGhlcikge1xuICAgICAgICByZXR1cm4gb3RoZXIuZGlmZih0aGlzKS5pc0VtcHR5KCk7XG4gICAgfVxuICAgIHN1YnNldE9mKG90aGVyKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmRpZmYob3RoZXIpLmlzRW1wdHkoKTtcbiAgICB9XG4gICAgc2hyNjQoc2hpZnQpIHtcbiAgICAgICAgaWYgKHNoaWZ0ID49IDY0KVxuICAgICAgICAgICAgcmV0dXJuIFNxdWFyZVNldC5lbXB0eSgpO1xuICAgICAgICBpZiAoc2hpZnQgPj0gMzIpXG4gICAgICAgICAgICByZXR1cm4gbmV3IFNxdWFyZVNldCh0aGlzLmhpID4+PiAoc2hpZnQgLSAzMiksIDApO1xuICAgICAgICBpZiAoc2hpZnQgPiAwKVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBTcXVhcmVTZXQoKHRoaXMubG8gPj4+IHNoaWZ0KSBeICh0aGlzLmhpIDw8ICgzMiAtIHNoaWZ0KSksIHRoaXMuaGkgPj4+IHNoaWZ0KTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIHNobDY0KHNoaWZ0KSB7XG4gICAgICAgIGlmIChzaGlmdCA+PSA2NClcbiAgICAgICAgICAgIHJldHVybiBTcXVhcmVTZXQuZW1wdHkoKTtcbiAgICAgICAgaWYgKHNoaWZ0ID49IDMyKVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBTcXVhcmVTZXQoMCwgdGhpcy5sbyA8PCAoc2hpZnQgLSAzMikpO1xuICAgICAgICBpZiAoc2hpZnQgPiAwKVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBTcXVhcmVTZXQodGhpcy5sbyA8PCBzaGlmdCwgKHRoaXMuaGkgPDwgc2hpZnQpIF4gKHRoaXMubG8gPj4+ICgzMiAtIHNoaWZ0KSkpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgYnN3YXA2NCgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBTcXVhcmVTZXQoYnN3YXAzMih0aGlzLmhpKSwgYnN3YXAzMih0aGlzLmxvKSk7XG4gICAgfVxuICAgIHJiaXQ2NCgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBTcXVhcmVTZXQocmJpdDMyKHRoaXMuaGkpLCByYml0MzIodGhpcy5sbykpO1xuICAgIH1cbiAgICBtaW51czY0KG90aGVyKSB7XG4gICAgICAgIGNvbnN0IGxvID0gdGhpcy5sbyAtIG90aGVyLmxvO1xuICAgICAgICBjb25zdCBjID0gKChsbyAmIG90aGVyLmxvICYgMSkgKyAob3RoZXIubG8gPj4+IDEpICsgKGxvID4+PiAxKSkgPj4+IDMxO1xuICAgICAgICByZXR1cm4gbmV3IFNxdWFyZVNldChsbywgdGhpcy5oaSAtIChvdGhlci5oaSArIGMpKTtcbiAgICB9XG4gICAgZXF1YWxzKG90aGVyKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmxvID09PSBvdGhlci5sbyAmJiB0aGlzLmhpID09PSBvdGhlci5oaTtcbiAgICB9XG4gICAgc2l6ZSgpIHtcbiAgICAgICAgcmV0dXJuIHBvcGNudDMyKHRoaXMubG8pICsgcG9wY250MzIodGhpcy5oaSk7XG4gICAgfVxuICAgIGlzRW1wdHkoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmxvID09PSAwICYmIHRoaXMuaGkgPT09IDA7XG4gICAgfVxuICAgIG5vbkVtcHR5KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5sbyAhPT0gMCB8fCB0aGlzLmhpICE9PSAwO1xuICAgIH1cbiAgICBoYXMoc3F1YXJlKSB7XG4gICAgICAgIHJldHVybiAoc3F1YXJlID49IDMyID8gdGhpcy5oaSAmICgxIDw8IChzcXVhcmUgLSAzMikpIDogdGhpcy5sbyAmICgxIDw8IHNxdWFyZSkpICE9PSAwO1xuICAgIH1cbiAgICBzZXQoc3F1YXJlLCBvbikge1xuICAgICAgICByZXR1cm4gb24gPyB0aGlzLndpdGgoc3F1YXJlKSA6IHRoaXMud2l0aG91dChzcXVhcmUpO1xuICAgIH1cbiAgICB3aXRoKHNxdWFyZSkge1xuICAgICAgICByZXR1cm4gc3F1YXJlID49IDMyXG4gICAgICAgICAgICA/IG5ldyBTcXVhcmVTZXQodGhpcy5sbywgdGhpcy5oaSB8ICgxIDw8IChzcXVhcmUgLSAzMikpKVxuICAgICAgICAgICAgOiBuZXcgU3F1YXJlU2V0KHRoaXMubG8gfCAoMSA8PCBzcXVhcmUpLCB0aGlzLmhpKTtcbiAgICB9XG4gICAgd2l0aG91dChzcXVhcmUpIHtcbiAgICAgICAgcmV0dXJuIHNxdWFyZSA+PSAzMlxuICAgICAgICAgICAgPyBuZXcgU3F1YXJlU2V0KHRoaXMubG8sIHRoaXMuaGkgJiB+KDEgPDwgKHNxdWFyZSAtIDMyKSkpXG4gICAgICAgICAgICA6IG5ldyBTcXVhcmVTZXQodGhpcy5sbyAmIH4oMSA8PCBzcXVhcmUpLCB0aGlzLmhpKTtcbiAgICB9XG4gICAgdG9nZ2xlKHNxdWFyZSkge1xuICAgICAgICByZXR1cm4gc3F1YXJlID49IDMyXG4gICAgICAgICAgICA/IG5ldyBTcXVhcmVTZXQodGhpcy5sbywgdGhpcy5oaSBeICgxIDw8IChzcXVhcmUgLSAzMikpKVxuICAgICAgICAgICAgOiBuZXcgU3F1YXJlU2V0KHRoaXMubG8gXiAoMSA8PCBzcXVhcmUpLCB0aGlzLmhpKTtcbiAgICB9XG4gICAgbGFzdCgpIHtcbiAgICAgICAgaWYgKHRoaXMuaGkgIT09IDApXG4gICAgICAgICAgICByZXR1cm4gNjMgLSBNYXRoLmNsejMyKHRoaXMuaGkpO1xuICAgICAgICBpZiAodGhpcy5sbyAhPT0gMClcbiAgICAgICAgICAgIHJldHVybiAzMSAtIE1hdGguY2x6MzIodGhpcy5sbyk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgZmlyc3QoKSB7XG4gICAgICAgIGlmICh0aGlzLmxvICE9PSAwKVxuICAgICAgICAgICAgcmV0dXJuIDMxIC0gTWF0aC5jbHozMih0aGlzLmxvICYgLXRoaXMubG8pO1xuICAgICAgICBpZiAodGhpcy5oaSAhPT0gMClcbiAgICAgICAgICAgIHJldHVybiA2MyAtIE1hdGguY2x6MzIodGhpcy5oaSAmIC10aGlzLmhpKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB3aXRob3V0Rmlyc3QoKSB7XG4gICAgICAgIGlmICh0aGlzLmxvICE9PSAwKVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBTcXVhcmVTZXQodGhpcy5sbyAmICh0aGlzLmxvIC0gMSksIHRoaXMuaGkpO1xuICAgICAgICByZXR1cm4gbmV3IFNxdWFyZVNldCgwLCB0aGlzLmhpICYgKHRoaXMuaGkgLSAxKSk7XG4gICAgfVxuICAgIG1vcmVUaGFuT25lKCkge1xuICAgICAgICByZXR1cm4gKHRoaXMuaGkgIT09IDAgJiYgdGhpcy5sbyAhPT0gMCkgfHwgKHRoaXMubG8gJiAodGhpcy5sbyAtIDEpKSAhPT0gMCB8fCAodGhpcy5oaSAmICh0aGlzLmhpIC0gMSkpICE9PSAwO1xuICAgIH1cbiAgICBzaW5nbGVTcXVhcmUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm1vcmVUaGFuT25lKCkgPyB1bmRlZmluZWQgOiB0aGlzLmxhc3QoKTtcbiAgICB9XG4gICAgKltTeW1ib2wuaXRlcmF0b3JdKCkge1xuICAgICAgICBsZXQgbG8gPSB0aGlzLmxvO1xuICAgICAgICBsZXQgaGkgPSB0aGlzLmhpO1xuICAgICAgICB3aGlsZSAobG8gIT09IDApIHtcbiAgICAgICAgICAgIGNvbnN0IGlkeCA9IDMxIC0gTWF0aC5jbHozMihsbyAmIC1sbyk7XG4gICAgICAgICAgICBsbyBePSAxIDw8IGlkeDtcbiAgICAgICAgICAgIHlpZWxkIGlkeDtcbiAgICAgICAgfVxuICAgICAgICB3aGlsZSAoaGkgIT09IDApIHtcbiAgICAgICAgICAgIGNvbnN0IGlkeCA9IDMxIC0gTWF0aC5jbHozMihoaSAmIC1oaSk7XG4gICAgICAgICAgICBoaSBePSAxIDw8IGlkeDtcbiAgICAgICAgICAgIHlpZWxkIDMyICsgaWR4O1xuICAgICAgICB9XG4gICAgfVxuICAgICpyZXZlcnNlZCgpIHtcbiAgICAgICAgbGV0IGxvID0gdGhpcy5sbztcbiAgICAgICAgbGV0IGhpID0gdGhpcy5oaTtcbiAgICAgICAgd2hpbGUgKGhpICE9PSAwKSB7XG4gICAgICAgICAgICBjb25zdCBpZHggPSAzMSAtIE1hdGguY2x6MzIoaGkpO1xuICAgICAgICAgICAgaGkgXj0gMSA8PCBpZHg7XG4gICAgICAgICAgICB5aWVsZCAzMiArIGlkeDtcbiAgICAgICAgfVxuICAgICAgICB3aGlsZSAobG8gIT09IDApIHtcbiAgICAgICAgICAgIGNvbnN0IGlkeCA9IDMxIC0gTWF0aC5jbHozMihsbyk7XG4gICAgICAgICAgICBsbyBePSAxIDw8IGlkeDtcbiAgICAgICAgICAgIHlpZWxkIGlkeDtcbiAgICAgICAgfVxuICAgIH1cbn1cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXNxdWFyZVNldC5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/chessops/dist/esm/squareSet.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/chessops/dist/esm/types.js":
/*!*************************************************!*\
  !*** ./node_modules/chessops/dist/esm/types.js ***!
  \*************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   CASTLING_SIDES: () => (/* binding */ CASTLING_SIDES),\n/* harmony export */   COLORS: () => (/* binding */ COLORS),\n/* harmony export */   FILE_NAMES: () => (/* binding */ FILE_NAMES),\n/* harmony export */   RANK_NAMES: () => (/* binding */ RANK_NAMES),\n/* harmony export */   ROLES: () => (/* binding */ ROLES),\n/* harmony export */   ROLE_CHARS: () => (/* binding */ ROLE_CHARS),\n/* harmony export */   RULES: () => (/* binding */ RULES),\n/* harmony export */   isDrop: () => (/* binding */ isDrop),\n/* harmony export */   isNormal: () => (/* binding */ isNormal)\n/* harmony export */ });\nconst FILE_NAMES = ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h'];\nconst RANK_NAMES = ['1', '2', '3', '4', '5', '6', '7', '8'];\nconst ROLE_CHARS = ['q', 'n', 'r', 'b', 'p', 'k'];\nconst COLORS = ['white', 'black'];\nconst ROLES = ['pawn', 'knight', 'bishop', 'rook', 'queen', 'king'];\nconst CASTLING_SIDES = ['a', 'h'];\nconst isDrop = (v) => 'role' in v;\nconst isNormal = (v) => 'from' in v;\nconst RULES = [\n    'chess',\n    'antichess',\n    'kingofthehill',\n    '3check',\n    'atomic',\n    'horde',\n    'racingkings',\n    'crazyhouse',\n];\n//# sourceMappingURL=types.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvY2hlc3NvcHMvZGlzdC9lc20vdHlwZXMuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBQU87QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIi9Vc2Vycy9yYWtzaGl0L3dvcmtzcGFjZS9hcmNoaXZlcy9yZXBvcy9jaGVzcy9ldmFsLWJhci9ub2RlX21vZHVsZXMvY2hlc3NvcHMvZGlzdC9lc20vdHlwZXMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNvbnN0IEZJTEVfTkFNRVMgPSBbJ2EnLCAnYicsICdjJywgJ2QnLCAnZScsICdmJywgJ2cnLCAnaCddO1xuZXhwb3J0IGNvbnN0IFJBTktfTkFNRVMgPSBbJzEnLCAnMicsICczJywgJzQnLCAnNScsICc2JywgJzcnLCAnOCddO1xuZXhwb3J0IGNvbnN0IFJPTEVfQ0hBUlMgPSBbJ3EnLCAnbicsICdyJywgJ2InLCAncCcsICdrJ107XG5leHBvcnQgY29uc3QgQ09MT1JTID0gWyd3aGl0ZScsICdibGFjayddO1xuZXhwb3J0IGNvbnN0IFJPTEVTID0gWydwYXduJywgJ2tuaWdodCcsICdiaXNob3AnLCAncm9vaycsICdxdWVlbicsICdraW5nJ107XG5leHBvcnQgY29uc3QgQ0FTVExJTkdfU0lERVMgPSBbJ2EnLCAnaCddO1xuZXhwb3J0IGNvbnN0IGlzRHJvcCA9ICh2KSA9PiAncm9sZScgaW4gdjtcbmV4cG9ydCBjb25zdCBpc05vcm1hbCA9ICh2KSA9PiAnZnJvbScgaW4gdjtcbmV4cG9ydCBjb25zdCBSVUxFUyA9IFtcbiAgICAnY2hlc3MnLFxuICAgICdhbnRpY2hlc3MnLFxuICAgICdraW5nb2Z0aGVoaWxsJyxcbiAgICAnM2NoZWNrJyxcbiAgICAnYXRvbWljJyxcbiAgICAnaG9yZGUnLFxuICAgICdyYWNpbmdraW5ncycsXG4gICAgJ2NyYXp5aG91c2UnLFxuXTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXR5cGVzLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/chessops/dist/esm/types.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/chessops/dist/esm/util.js":
/*!************************************************!*\
  !*** ./node_modules/chessops/dist/esm/util.js ***!
  \************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   charToRole: () => (/* binding */ charToRole),\n/* harmony export */   defined: () => (/* binding */ defined),\n/* harmony export */   kingCastlesTo: () => (/* binding */ kingCastlesTo),\n/* harmony export */   makeSquare: () => (/* binding */ makeSquare),\n/* harmony export */   makeUci: () => (/* binding */ makeUci),\n/* harmony export */   moveEquals: () => (/* binding */ moveEquals),\n/* harmony export */   opposite: () => (/* binding */ opposite),\n/* harmony export */   parseSquare: () => (/* binding */ parseSquare),\n/* harmony export */   parseUci: () => (/* binding */ parseUci),\n/* harmony export */   roleToChar: () => (/* binding */ roleToChar),\n/* harmony export */   rookCastlesTo: () => (/* binding */ rookCastlesTo),\n/* harmony export */   squareFile: () => (/* binding */ squareFile),\n/* harmony export */   squareFromCoords: () => (/* binding */ squareFromCoords),\n/* harmony export */   squareRank: () => (/* binding */ squareRank)\n/* harmony export */ });\n/* harmony import */ var _types_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./types.js */ \"(ssr)/./node_modules/chessops/dist/esm/types.js\");\n\nconst defined = (v) => v !== undefined;\nconst opposite = (color) => (color === 'white' ? 'black' : 'white');\nconst squareRank = (square) => square >> 3;\nconst squareFile = (square) => square & 0x7;\nconst squareFromCoords = (file, rank) => 0 <= file && file < 8 && 0 <= rank && rank < 8 ? file + 8 * rank : undefined;\nconst roleToChar = (role) => {\n    switch (role) {\n        case 'pawn':\n            return 'p';\n        case 'knight':\n            return 'n';\n        case 'bishop':\n            return 'b';\n        case 'rook':\n            return 'r';\n        case 'queen':\n            return 'q';\n        case 'king':\n            return 'k';\n    }\n};\nfunction charToRole(ch) {\n    switch (ch.toLowerCase()) {\n        case 'p':\n            return 'pawn';\n        case 'n':\n            return 'knight';\n        case 'b':\n            return 'bishop';\n        case 'r':\n            return 'rook';\n        case 'q':\n            return 'queen';\n        case 'k':\n            return 'king';\n        default:\n            return;\n    }\n}\nfunction parseSquare(str) {\n    if (str.length !== 2)\n        return;\n    return squareFromCoords(str.charCodeAt(0) - 'a'.charCodeAt(0), str.charCodeAt(1) - '1'.charCodeAt(0));\n}\nconst makeSquare = (square) => (_types_js__WEBPACK_IMPORTED_MODULE_0__.FILE_NAMES[squareFile(square)] + _types_js__WEBPACK_IMPORTED_MODULE_0__.RANK_NAMES[squareRank(square)]);\nconst parseUci = (str) => {\n    if (str[1] === '@' && str.length === 4) {\n        const role = charToRole(str[0]);\n        const to = parseSquare(str.slice(2));\n        if (role && defined(to))\n            return { role, to };\n    }\n    else if (str.length === 4 || str.length === 5) {\n        const from = parseSquare(str.slice(0, 2));\n        const to = parseSquare(str.slice(2, 4));\n        let promotion;\n        if (str.length === 5) {\n            promotion = charToRole(str[4]);\n            if (!promotion)\n                return;\n        }\n        if (defined(from) && defined(to))\n            return { from, to, promotion };\n    }\n    return;\n};\nconst moveEquals = (left, right) => {\n    if (left.to !== right.to)\n        return false;\n    if ((0,_types_js__WEBPACK_IMPORTED_MODULE_0__.isDrop)(left))\n        return (0,_types_js__WEBPACK_IMPORTED_MODULE_0__.isDrop)(right) && left.role === right.role;\n    else\n        return (0,_types_js__WEBPACK_IMPORTED_MODULE_0__.isNormal)(right) && left.from === right.from && left.promotion === right.promotion;\n};\n/**\n * Converts a move to UCI notation, like `g1f3` for a normal move,\n * `a7a8q` for promotion to a queen, and `Q@f7` for a Crazyhouse drop.\n */\nconst makeUci = (move) => (0,_types_js__WEBPACK_IMPORTED_MODULE_0__.isDrop)(move)\n    ? `${roleToChar(move.role).toUpperCase()}@${makeSquare(move.to)}`\n    : makeSquare(move.from) + makeSquare(move.to) + (move.promotion ? roleToChar(move.promotion) : '');\nconst kingCastlesTo = (color, side) => color === 'white' ? (side === 'a' ? 2 : 6) : side === 'a' ? 58 : 62;\nconst rookCastlesTo = (color, side) => color === 'white' ? (side === 'a' ? 3 : 5) : side === 'a' ? 59 : 61;\n//# sourceMappingURL=util.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvY2hlc3NvcHMvZGlzdC9lc20vdXRpbC5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBdUU7QUFDaEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNPLGdDQUFnQyxpREFBVSx1QkFBdUIsaURBQVU7QUFDM0U7QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNBLFFBQVEsaURBQU07QUFDZCxlQUFlLGlEQUFNO0FBQ3JCO0FBQ0EsZUFBZSxtREFBUTtBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ08sMEJBQTBCLGlEQUFNO0FBQ3ZDLFNBQVMsb0NBQW9DLEdBQUcsb0JBQW9CO0FBQ3BFO0FBQ087QUFDQTtBQUNQIiwic291cmNlcyI6WyIvVXNlcnMvcmFrc2hpdC93b3Jrc3BhY2UvYXJjaGl2ZXMvcmVwb3MvY2hlc3MvZXZhbC1iYXIvbm9kZV9tb2R1bGVzL2NoZXNzb3BzL2Rpc3QvZXNtL3V0aWwuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRklMRV9OQU1FUywgaXNEcm9wLCBpc05vcm1hbCwgUkFOS19OQU1FUywgfSBmcm9tICcuL3R5cGVzLmpzJztcbmV4cG9ydCBjb25zdCBkZWZpbmVkID0gKHYpID0+IHYgIT09IHVuZGVmaW5lZDtcbmV4cG9ydCBjb25zdCBvcHBvc2l0ZSA9IChjb2xvcikgPT4gKGNvbG9yID09PSAnd2hpdGUnID8gJ2JsYWNrJyA6ICd3aGl0ZScpO1xuZXhwb3J0IGNvbnN0IHNxdWFyZVJhbmsgPSAoc3F1YXJlKSA9PiBzcXVhcmUgPj4gMztcbmV4cG9ydCBjb25zdCBzcXVhcmVGaWxlID0gKHNxdWFyZSkgPT4gc3F1YXJlICYgMHg3O1xuZXhwb3J0IGNvbnN0IHNxdWFyZUZyb21Db29yZHMgPSAoZmlsZSwgcmFuaykgPT4gMCA8PSBmaWxlICYmIGZpbGUgPCA4ICYmIDAgPD0gcmFuayAmJiByYW5rIDwgOCA/IGZpbGUgKyA4ICogcmFuayA6IHVuZGVmaW5lZDtcbmV4cG9ydCBjb25zdCByb2xlVG9DaGFyID0gKHJvbGUpID0+IHtcbiAgICBzd2l0Y2ggKHJvbGUpIHtcbiAgICAgICAgY2FzZSAncGF3bic6XG4gICAgICAgICAgICByZXR1cm4gJ3AnO1xuICAgICAgICBjYXNlICdrbmlnaHQnOlxuICAgICAgICAgICAgcmV0dXJuICduJztcbiAgICAgICAgY2FzZSAnYmlzaG9wJzpcbiAgICAgICAgICAgIHJldHVybiAnYic7XG4gICAgICAgIGNhc2UgJ3Jvb2snOlxuICAgICAgICAgICAgcmV0dXJuICdyJztcbiAgICAgICAgY2FzZSAncXVlZW4nOlxuICAgICAgICAgICAgcmV0dXJuICdxJztcbiAgICAgICAgY2FzZSAna2luZyc6XG4gICAgICAgICAgICByZXR1cm4gJ2snO1xuICAgIH1cbn07XG5leHBvcnQgZnVuY3Rpb24gY2hhclRvUm9sZShjaCkge1xuICAgIHN3aXRjaCAoY2gudG9Mb3dlckNhc2UoKSkge1xuICAgICAgICBjYXNlICdwJzpcbiAgICAgICAgICAgIHJldHVybiAncGF3bic7XG4gICAgICAgIGNhc2UgJ24nOlxuICAgICAgICAgICAgcmV0dXJuICdrbmlnaHQnO1xuICAgICAgICBjYXNlICdiJzpcbiAgICAgICAgICAgIHJldHVybiAnYmlzaG9wJztcbiAgICAgICAgY2FzZSAncic6XG4gICAgICAgICAgICByZXR1cm4gJ3Jvb2snO1xuICAgICAgICBjYXNlICdxJzpcbiAgICAgICAgICAgIHJldHVybiAncXVlZW4nO1xuICAgICAgICBjYXNlICdrJzpcbiAgICAgICAgICAgIHJldHVybiAna2luZyc7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICByZXR1cm47XG4gICAgfVxufVxuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlU3F1YXJlKHN0cikge1xuICAgIGlmIChzdHIubGVuZ3RoICE9PSAyKVxuICAgICAgICByZXR1cm47XG4gICAgcmV0dXJuIHNxdWFyZUZyb21Db29yZHMoc3RyLmNoYXJDb2RlQXQoMCkgLSAnYScuY2hhckNvZGVBdCgwKSwgc3RyLmNoYXJDb2RlQXQoMSkgLSAnMScuY2hhckNvZGVBdCgwKSk7XG59XG5leHBvcnQgY29uc3QgbWFrZVNxdWFyZSA9IChzcXVhcmUpID0+IChGSUxFX05BTUVTW3NxdWFyZUZpbGUoc3F1YXJlKV0gKyBSQU5LX05BTUVTW3NxdWFyZVJhbmsoc3F1YXJlKV0pO1xuZXhwb3J0IGNvbnN0IHBhcnNlVWNpID0gKHN0cikgPT4ge1xuICAgIGlmIChzdHJbMV0gPT09ICdAJyAmJiBzdHIubGVuZ3RoID09PSA0KSB7XG4gICAgICAgIGNvbnN0IHJvbGUgPSBjaGFyVG9Sb2xlKHN0clswXSk7XG4gICAgICAgIGNvbnN0IHRvID0gcGFyc2VTcXVhcmUoc3RyLnNsaWNlKDIpKTtcbiAgICAgICAgaWYgKHJvbGUgJiYgZGVmaW5lZCh0bykpXG4gICAgICAgICAgICByZXR1cm4geyByb2xlLCB0byB9O1xuICAgIH1cbiAgICBlbHNlIGlmIChzdHIubGVuZ3RoID09PSA0IHx8IHN0ci5sZW5ndGggPT09IDUpIHtcbiAgICAgICAgY29uc3QgZnJvbSA9IHBhcnNlU3F1YXJlKHN0ci5zbGljZSgwLCAyKSk7XG4gICAgICAgIGNvbnN0IHRvID0gcGFyc2VTcXVhcmUoc3RyLnNsaWNlKDIsIDQpKTtcbiAgICAgICAgbGV0IHByb21vdGlvbjtcbiAgICAgICAgaWYgKHN0ci5sZW5ndGggPT09IDUpIHtcbiAgICAgICAgICAgIHByb21vdGlvbiA9IGNoYXJUb1JvbGUoc3RyWzRdKTtcbiAgICAgICAgICAgIGlmICghcHJvbW90aW9uKVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZGVmaW5lZChmcm9tKSAmJiBkZWZpbmVkKHRvKSlcbiAgICAgICAgICAgIHJldHVybiB7IGZyb20sIHRvLCBwcm9tb3Rpb24gfTtcbiAgICB9XG4gICAgcmV0dXJuO1xufTtcbmV4cG9ydCBjb25zdCBtb3ZlRXF1YWxzID0gKGxlZnQsIHJpZ2h0KSA9PiB7XG4gICAgaWYgKGxlZnQudG8gIT09IHJpZ2h0LnRvKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgaWYgKGlzRHJvcChsZWZ0KSlcbiAgICAgICAgcmV0dXJuIGlzRHJvcChyaWdodCkgJiYgbGVmdC5yb2xlID09PSByaWdodC5yb2xlO1xuICAgIGVsc2VcbiAgICAgICAgcmV0dXJuIGlzTm9ybWFsKHJpZ2h0KSAmJiBsZWZ0LmZyb20gPT09IHJpZ2h0LmZyb20gJiYgbGVmdC5wcm9tb3Rpb24gPT09IHJpZ2h0LnByb21vdGlvbjtcbn07XG4vKipcbiAqIENvbnZlcnRzIGEgbW92ZSB0byBVQ0kgbm90YXRpb24sIGxpa2UgYGcxZjNgIGZvciBhIG5vcm1hbCBtb3ZlLFxuICogYGE3YThxYCBmb3IgcHJvbW90aW9uIHRvIGEgcXVlZW4sIGFuZCBgUUBmN2AgZm9yIGEgQ3Jhenlob3VzZSBkcm9wLlxuICovXG5leHBvcnQgY29uc3QgbWFrZVVjaSA9IChtb3ZlKSA9PiBpc0Ryb3AobW92ZSlcbiAgICA/IGAke3JvbGVUb0NoYXIobW92ZS5yb2xlKS50b1VwcGVyQ2FzZSgpfUAke21ha2VTcXVhcmUobW92ZS50byl9YFxuICAgIDogbWFrZVNxdWFyZShtb3ZlLmZyb20pICsgbWFrZVNxdWFyZShtb3ZlLnRvKSArIChtb3ZlLnByb21vdGlvbiA/IHJvbGVUb0NoYXIobW92ZS5wcm9tb3Rpb24pIDogJycpO1xuZXhwb3J0IGNvbnN0IGtpbmdDYXN0bGVzVG8gPSAoY29sb3IsIHNpZGUpID0+IGNvbG9yID09PSAnd2hpdGUnID8gKHNpZGUgPT09ICdhJyA/IDIgOiA2KSA6IHNpZGUgPT09ICdhJyA/IDU4IDogNjI7XG5leHBvcnQgY29uc3Qgcm9va0Nhc3RsZXNUbyA9IChjb2xvciwgc2lkZSkgPT4gY29sb3IgPT09ICd3aGl0ZScgPyAoc2lkZSA9PT0gJ2EnID8gMyA6IDUpIDogc2lkZSA9PT0gJ2EnID8gNTkgOiA2MTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXV0aWwuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/chessops/dist/esm/util.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/chessops/dist/esm/variant.js":
/*!***************************************************!*\
  !*** ./node_modules/chessops/dist/esm/variant.js ***!
  \***************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Antichess: () => (/* binding */ Antichess),\n/* harmony export */   Atomic: () => (/* binding */ Atomic),\n/* harmony export */   Castles: () => (/* reexport safe */ _chess_js__WEBPACK_IMPORTED_MODULE_0__.Castles),\n/* harmony export */   Chess: () => (/* reexport safe */ _chess_js__WEBPACK_IMPORTED_MODULE_0__.Chess),\n/* harmony export */   Crazyhouse: () => (/* binding */ Crazyhouse),\n/* harmony export */   Horde: () => (/* binding */ Horde),\n/* harmony export */   IllegalSetup: () => (/* reexport safe */ _chess_js__WEBPACK_IMPORTED_MODULE_0__.IllegalSetup),\n/* harmony export */   KingOfTheHill: () => (/* binding */ KingOfTheHill),\n/* harmony export */   Position: () => (/* reexport safe */ _chess_js__WEBPACK_IMPORTED_MODULE_0__.Position),\n/* harmony export */   PositionError: () => (/* reexport safe */ _chess_js__WEBPACK_IMPORTED_MODULE_0__.PositionError),\n/* harmony export */   RacingKings: () => (/* binding */ RacingKings),\n/* harmony export */   ThreeCheck: () => (/* binding */ ThreeCheck),\n/* harmony export */   castlingSide: () => (/* reexport safe */ _chess_js__WEBPACK_IMPORTED_MODULE_0__.castlingSide),\n/* harmony export */   defaultPosition: () => (/* binding */ defaultPosition),\n/* harmony export */   equalsIgnoreMoves: () => (/* reexport safe */ _chess_js__WEBPACK_IMPORTED_MODULE_0__.equalsIgnoreMoves),\n/* harmony export */   isImpossibleCheck: () => (/* reexport safe */ _chess_js__WEBPACK_IMPORTED_MODULE_0__.isImpossibleCheck),\n/* harmony export */   isStandardMaterial: () => (/* binding */ isStandardMaterial),\n/* harmony export */   normalizeMove: () => (/* reexport safe */ _chess_js__WEBPACK_IMPORTED_MODULE_0__.normalizeMove),\n/* harmony export */   setupPosition: () => (/* binding */ setupPosition)\n/* harmony export */ });\n/* harmony import */ var _badrap_result__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @badrap/result */ \"(ssr)/./node_modules/@badrap/result/dist/node-mjs/index.mjs\");\n/* harmony import */ var _attacks_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./attacks.js */ \"(ssr)/./node_modules/chessops/dist/esm/attacks.js\");\n/* harmony import */ var _board_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./board.js */ \"(ssr)/./node_modules/chessops/dist/esm/board.js\");\n/* harmony import */ var _chess_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./chess.js */ \"(ssr)/./node_modules/chessops/dist/esm/chess.js\");\n/* harmony import */ var _setup_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./setup.js */ \"(ssr)/./node_modules/chessops/dist/esm/setup.js\");\n/* harmony import */ var _squareSet_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./squareSet.js */ \"(ssr)/./node_modules/chessops/dist/esm/squareSet.js\");\n/* harmony import */ var _types_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./types.js */ \"(ssr)/./node_modules/chessops/dist/esm/types.js\");\n/* harmony import */ var _util_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./util.js */ \"(ssr)/./node_modules/chessops/dist/esm/util.js\");\n\n\n\n\n\n\n\n\n\nclass Crazyhouse extends _chess_js__WEBPACK_IMPORTED_MODULE_0__.Position {\n    constructor() {\n        super('crazyhouse');\n    }\n    reset() {\n        super.reset();\n        this.pockets = _setup_js__WEBPACK_IMPORTED_MODULE_1__.Material.empty();\n    }\n    setupUnchecked(setup) {\n        super.setupUnchecked(setup);\n        this.board.promoted = setup.board.promoted\n            .intersect(setup.board.occupied)\n            .diff(setup.board.king)\n            .diff(setup.board.pawn);\n        this.pockets = setup.pockets ? setup.pockets.clone() : _setup_js__WEBPACK_IMPORTED_MODULE_1__.Material.empty();\n    }\n    static default() {\n        const pos = new this();\n        pos.reset();\n        return pos;\n    }\n    static fromSetup(setup) {\n        const pos = new this();\n        pos.setupUnchecked(setup);\n        return pos.validate().map(_ => pos);\n    }\n    clone() {\n        return super.clone();\n    }\n    validate() {\n        return super.validate().chain(_ => {\n            var _a, _b;\n            if ((_a = this.pockets) === null || _a === void 0 ? void 0 : _a.count('king')) {\n                return _badrap_result__WEBPACK_IMPORTED_MODULE_2__.Result.err(new _chess_js__WEBPACK_IMPORTED_MODULE_0__.PositionError(_chess_js__WEBPACK_IMPORTED_MODULE_0__.IllegalSetup.Kings));\n            }\n            if ((((_b = this.pockets) === null || _b === void 0 ? void 0 : _b.size()) || 0) + this.board.occupied.size() > 64) {\n                return _badrap_result__WEBPACK_IMPORTED_MODULE_2__.Result.err(new _chess_js__WEBPACK_IMPORTED_MODULE_0__.PositionError(_chess_js__WEBPACK_IMPORTED_MODULE_0__.IllegalSetup.Variant));\n            }\n            return _badrap_result__WEBPACK_IMPORTED_MODULE_2__.Result.ok(undefined);\n        });\n    }\n    hasInsufficientMaterial(color) {\n        // No material can leave the game, but we can easily check this for\n        // custom positions.\n        if (!this.pockets)\n            return super.hasInsufficientMaterial(color);\n        return (this.board.occupied.size() + this.pockets.size() <= 3\n            && this.board.pawn.isEmpty()\n            && this.board.promoted.isEmpty()\n            && this.board.rooksAndQueens().isEmpty()\n            && this.pockets.count('pawn') <= 0\n            && this.pockets.count('rook') <= 0\n            && this.pockets.count('queen') <= 0);\n    }\n    dropDests(ctx) {\n        var _a, _b;\n        const mask = this.board.occupied\n            .complement()\n            .intersect(((_a = this.pockets) === null || _a === void 0 ? void 0 : _a[this.turn].hasNonPawns())\n            ? _squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet.full()\n            : ((_b = this.pockets) === null || _b === void 0 ? void 0 : _b[this.turn].hasPawns())\n                ? _squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet.backranks().complement()\n                : _squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet.empty());\n        ctx = ctx || this.ctx();\n        if ((0,_util_js__WEBPACK_IMPORTED_MODULE_4__.defined)(ctx.king) && ctx.checkers.nonEmpty()) {\n            const checker = ctx.checkers.singleSquare();\n            if (!(0,_util_js__WEBPACK_IMPORTED_MODULE_4__.defined)(checker))\n                return _squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet.empty();\n            return mask.intersect((0,_attacks_js__WEBPACK_IMPORTED_MODULE_5__.between)(checker, ctx.king));\n        }\n        else\n            return mask;\n    }\n}\nclass Atomic extends _chess_js__WEBPACK_IMPORTED_MODULE_0__.Position {\n    constructor() {\n        super('atomic');\n    }\n    static default() {\n        const pos = new this();\n        pos.reset();\n        return pos;\n    }\n    static fromSetup(setup) {\n        const pos = new this();\n        pos.setupUnchecked(setup);\n        return pos.validate().map(_ => pos);\n    }\n    clone() {\n        return super.clone();\n    }\n    validate() {\n        // Like chess, but allow our king to be missing.\n        if (this.board.occupied.isEmpty())\n            return _badrap_result__WEBPACK_IMPORTED_MODULE_2__.Result.err(new _chess_js__WEBPACK_IMPORTED_MODULE_0__.PositionError(_chess_js__WEBPACK_IMPORTED_MODULE_0__.IllegalSetup.Empty));\n        if (this.board.king.size() > 2)\n            return _badrap_result__WEBPACK_IMPORTED_MODULE_2__.Result.err(new _chess_js__WEBPACK_IMPORTED_MODULE_0__.PositionError(_chess_js__WEBPACK_IMPORTED_MODULE_0__.IllegalSetup.Kings));\n        const otherKing = this.board.kingOf((0,_util_js__WEBPACK_IMPORTED_MODULE_4__.opposite)(this.turn));\n        if (!(0,_util_js__WEBPACK_IMPORTED_MODULE_4__.defined)(otherKing))\n            return _badrap_result__WEBPACK_IMPORTED_MODULE_2__.Result.err(new _chess_js__WEBPACK_IMPORTED_MODULE_0__.PositionError(_chess_js__WEBPACK_IMPORTED_MODULE_0__.IllegalSetup.Kings));\n        if (this.kingAttackers(otherKing, this.turn, this.board.occupied).nonEmpty()) {\n            return _badrap_result__WEBPACK_IMPORTED_MODULE_2__.Result.err(new _chess_js__WEBPACK_IMPORTED_MODULE_0__.PositionError(_chess_js__WEBPACK_IMPORTED_MODULE_0__.IllegalSetup.OppositeCheck));\n        }\n        if (_squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet.backranks().intersects(this.board.pawn)) {\n            return _badrap_result__WEBPACK_IMPORTED_MODULE_2__.Result.err(new _chess_js__WEBPACK_IMPORTED_MODULE_0__.PositionError(_chess_js__WEBPACK_IMPORTED_MODULE_0__.IllegalSetup.PawnsOnBackrank));\n        }\n        return _badrap_result__WEBPACK_IMPORTED_MODULE_2__.Result.ok(undefined);\n    }\n    kingAttackers(square, attacker, occupied) {\n        const attackerKings = this.board.pieces(attacker, 'king');\n        if (attackerKings.isEmpty() || (0,_attacks_js__WEBPACK_IMPORTED_MODULE_5__.kingAttacks)(square).intersects(attackerKings)) {\n            return _squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet.empty();\n        }\n        return super.kingAttackers(square, attacker, occupied);\n    }\n    playCaptureAt(square, captured) {\n        super.playCaptureAt(square, captured);\n        this.board.take(square);\n        for (const explode of (0,_attacks_js__WEBPACK_IMPORTED_MODULE_5__.kingAttacks)(square).intersect(this.board.occupied).diff(this.board.pawn)) {\n            const piece = this.board.take(explode);\n            if ((piece === null || piece === void 0 ? void 0 : piece.role) === 'rook')\n                this.castles.discardRook(explode);\n            if ((piece === null || piece === void 0 ? void 0 : piece.role) === 'king')\n                this.castles.discardColor(piece.color);\n        }\n    }\n    hasInsufficientMaterial(color) {\n        // Remaining material does not matter if the enemy king is already\n        // exploded.\n        if (this.board.pieces((0,_util_js__WEBPACK_IMPORTED_MODULE_4__.opposite)(color), 'king').isEmpty())\n            return false;\n        // Bare king cannot mate.\n        if (this.board[color].diff(this.board.king).isEmpty())\n            return true;\n        // As long as the enemy king is not alone, there is always a chance their\n        // own pieces explode next to it.\n        if (this.board[(0,_util_js__WEBPACK_IMPORTED_MODULE_4__.opposite)(color)].diff(this.board.king).nonEmpty()) {\n            // Unless there are only bishops that cannot explode each other.\n            if (this.board.occupied.equals(this.board.bishop.union(this.board.king))) {\n                if (!this.board.bishop.intersect(this.board.white).intersects(_squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet.darkSquares())) {\n                    return !this.board.bishop.intersect(this.board.black).intersects(_squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet.lightSquares());\n                }\n                if (!this.board.bishop.intersect(this.board.white).intersects(_squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet.lightSquares())) {\n                    return !this.board.bishop.intersect(this.board.black).intersects(_squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet.darkSquares());\n                }\n            }\n            return false;\n        }\n        // Queen or pawn (future queen) can give mate against bare king.\n        if (this.board.queen.nonEmpty() || this.board.pawn.nonEmpty())\n            return false;\n        // Single knight, bishop or rook cannot mate against bare king.\n        if (this.board.knight.union(this.board.bishop).union(this.board.rook).size() === 1)\n            return true;\n        // If only knights, more than two are required to mate bare king.\n        if (this.board.occupied.equals(this.board.knight.union(this.board.king))) {\n            return this.board.knight.size() <= 2;\n        }\n        return false;\n    }\n    dests(square, ctx) {\n        ctx = ctx || this.ctx();\n        let dests = _squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet.empty();\n        for (const to of (0,_chess_js__WEBPACK_IMPORTED_MODULE_0__.pseudoDests)(this, square, ctx)) {\n            const after = this.clone();\n            after.play({ from: square, to });\n            const ourKing = after.board.kingOf(this.turn);\n            if ((0,_util_js__WEBPACK_IMPORTED_MODULE_4__.defined)(ourKing)\n                && (!(0,_util_js__WEBPACK_IMPORTED_MODULE_4__.defined)(after.board.kingOf(after.turn))\n                    || after.kingAttackers(ourKing, after.turn, after.board.occupied).isEmpty())) {\n                dests = dests.with(to);\n            }\n        }\n        return dests;\n    }\n    isVariantEnd() {\n        return !!this.variantOutcome();\n    }\n    variantOutcome(_ctx) {\n        for (const color of _types_js__WEBPACK_IMPORTED_MODULE_6__.COLORS) {\n            if (this.board.pieces(color, 'king').isEmpty())\n                return { winner: (0,_util_js__WEBPACK_IMPORTED_MODULE_4__.opposite)(color) };\n        }\n        return;\n    }\n}\nclass Antichess extends _chess_js__WEBPACK_IMPORTED_MODULE_0__.Position {\n    constructor() {\n        super('antichess');\n    }\n    reset() {\n        super.reset();\n        this.castles = _chess_js__WEBPACK_IMPORTED_MODULE_0__.Castles.empty();\n    }\n    setupUnchecked(setup) {\n        super.setupUnchecked(setup);\n        this.castles = _chess_js__WEBPACK_IMPORTED_MODULE_0__.Castles.empty();\n    }\n    static default() {\n        const pos = new this();\n        pos.reset();\n        return pos;\n    }\n    static fromSetup(setup) {\n        const pos = new this();\n        pos.setupUnchecked(setup);\n        return pos.validate().map(_ => pos);\n    }\n    clone() {\n        return super.clone();\n    }\n    validate() {\n        if (this.board.occupied.isEmpty())\n            return _badrap_result__WEBPACK_IMPORTED_MODULE_2__.Result.err(new _chess_js__WEBPACK_IMPORTED_MODULE_0__.PositionError(_chess_js__WEBPACK_IMPORTED_MODULE_0__.IllegalSetup.Empty));\n        if (_squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet.backranks().intersects(this.board.pawn)) {\n            return _badrap_result__WEBPACK_IMPORTED_MODULE_2__.Result.err(new _chess_js__WEBPACK_IMPORTED_MODULE_0__.PositionError(_chess_js__WEBPACK_IMPORTED_MODULE_0__.IllegalSetup.PawnsOnBackrank));\n        }\n        return _badrap_result__WEBPACK_IMPORTED_MODULE_2__.Result.ok(undefined);\n    }\n    kingAttackers(_square, _attacker, _occupied) {\n        return _squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet.empty();\n    }\n    ctx() {\n        const ctx = super.ctx();\n        if ((0,_util_js__WEBPACK_IMPORTED_MODULE_4__.defined)(this.epSquare)\n            && (0,_attacks_js__WEBPACK_IMPORTED_MODULE_5__.pawnAttacks)((0,_util_js__WEBPACK_IMPORTED_MODULE_4__.opposite)(this.turn), this.epSquare).intersects(this.board.pieces(this.turn, 'pawn'))) {\n            ctx.mustCapture = true;\n            return ctx;\n        }\n        const enemy = this.board[(0,_util_js__WEBPACK_IMPORTED_MODULE_4__.opposite)(this.turn)];\n        for (const from of this.board[this.turn]) {\n            if ((0,_chess_js__WEBPACK_IMPORTED_MODULE_0__.pseudoDests)(this, from, ctx).intersects(enemy)) {\n                ctx.mustCapture = true;\n                return ctx;\n            }\n        }\n        return ctx;\n    }\n    dests(square, ctx) {\n        ctx = ctx || this.ctx();\n        const dests = (0,_chess_js__WEBPACK_IMPORTED_MODULE_0__.pseudoDests)(this, square, ctx);\n        const enemy = this.board[(0,_util_js__WEBPACK_IMPORTED_MODULE_4__.opposite)(this.turn)];\n        return dests.intersect(ctx.mustCapture\n            ? (0,_util_js__WEBPACK_IMPORTED_MODULE_4__.defined)(this.epSquare) && this.board.getRole(square) === 'pawn'\n                ? enemy.with(this.epSquare)\n                : enemy\n            : _squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet.full());\n    }\n    hasInsufficientMaterial(color) {\n        if (this.board[color].isEmpty())\n            return false;\n        if (this.board[(0,_util_js__WEBPACK_IMPORTED_MODULE_4__.opposite)(color)].isEmpty())\n            return true;\n        if (this.board.occupied.equals(this.board.bishop)) {\n            const weSomeOnLight = this.board[color].intersects(_squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet.lightSquares());\n            const weSomeOnDark = this.board[color].intersects(_squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet.darkSquares());\n            const theyAllOnDark = this.board[(0,_util_js__WEBPACK_IMPORTED_MODULE_4__.opposite)(color)].isDisjoint(_squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet.lightSquares());\n            const theyAllOnLight = this.board[(0,_util_js__WEBPACK_IMPORTED_MODULE_4__.opposite)(color)].isDisjoint(_squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet.darkSquares());\n            return (weSomeOnLight && theyAllOnDark) || (weSomeOnDark && theyAllOnLight);\n        }\n        if (this.board.occupied.equals(this.board.knight) && this.board.occupied.size() === 2) {\n            return ((this.board.white.intersects(_squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet.lightSquares())\n                !== this.board.black.intersects(_squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet.darkSquares()))\n                !== (this.turn === color));\n        }\n        return false;\n    }\n    isVariantEnd() {\n        return this.board[this.turn].isEmpty();\n    }\n    variantOutcome(ctx) {\n        ctx = ctx || this.ctx();\n        if (ctx.variantEnd || this.isStalemate(ctx)) {\n            return { winner: this.turn };\n        }\n        return;\n    }\n}\nclass KingOfTheHill extends _chess_js__WEBPACK_IMPORTED_MODULE_0__.Position {\n    constructor() {\n        super('kingofthehill');\n    }\n    static default() {\n        const pos = new this();\n        pos.reset();\n        return pos;\n    }\n    static fromSetup(setup) {\n        const pos = new this();\n        pos.setupUnchecked(setup);\n        return pos.validate().map(_ => pos);\n    }\n    clone() {\n        return super.clone();\n    }\n    hasInsufficientMaterial(_color) {\n        return false;\n    }\n    isVariantEnd() {\n        return this.board.king.intersects(_squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet.center());\n    }\n    variantOutcome(_ctx) {\n        for (const color of _types_js__WEBPACK_IMPORTED_MODULE_6__.COLORS) {\n            if (this.board.pieces(color, 'king').intersects(_squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet.center()))\n                return { winner: color };\n        }\n        return;\n    }\n}\nclass ThreeCheck extends _chess_js__WEBPACK_IMPORTED_MODULE_0__.Position {\n    constructor() {\n        super('3check');\n    }\n    reset() {\n        super.reset();\n        this.remainingChecks = _setup_js__WEBPACK_IMPORTED_MODULE_1__.RemainingChecks.default();\n    }\n    setupUnchecked(setup) {\n        var _a;\n        super.setupUnchecked(setup);\n        this.remainingChecks = ((_a = setup.remainingChecks) === null || _a === void 0 ? void 0 : _a.clone()) || _setup_js__WEBPACK_IMPORTED_MODULE_1__.RemainingChecks.default();\n    }\n    static default() {\n        const pos = new this();\n        pos.reset();\n        return pos;\n    }\n    static fromSetup(setup) {\n        const pos = new this();\n        pos.setupUnchecked(setup);\n        return pos.validate().map(_ => pos);\n    }\n    clone() {\n        return super.clone();\n    }\n    hasInsufficientMaterial(color) {\n        return this.board.pieces(color, 'king').equals(this.board[color]);\n    }\n    isVariantEnd() {\n        return !!this.remainingChecks && (this.remainingChecks.white <= 0 || this.remainingChecks.black <= 0);\n    }\n    variantOutcome(_ctx) {\n        if (this.remainingChecks) {\n            for (const color of _types_js__WEBPACK_IMPORTED_MODULE_6__.COLORS) {\n                if (this.remainingChecks[color] <= 0)\n                    return { winner: color };\n            }\n        }\n        return;\n    }\n}\nconst racingKingsBoard = () => {\n    const board = _board_js__WEBPACK_IMPORTED_MODULE_7__.Board.empty();\n    board.occupied = new _squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet(0xffff, 0);\n    board.promoted = _squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet.empty();\n    board.white = new _squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet(0xf0f0, 0);\n    board.black = new _squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet(0x0f0f, 0);\n    board.pawn = _squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet.empty();\n    board.knight = new _squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet(0x1818, 0);\n    board.bishop = new _squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet(0x2424, 0);\n    board.rook = new _squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet(0x4242, 0);\n    board.queen = new _squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet(0x0081, 0);\n    board.king = new _squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet(0x8100, 0);\n    return board;\n};\nclass RacingKings extends _chess_js__WEBPACK_IMPORTED_MODULE_0__.Position {\n    constructor() {\n        super('racingkings');\n    }\n    reset() {\n        this.board = racingKingsBoard();\n        this.pockets = undefined;\n        this.turn = 'white';\n        this.castles = _chess_js__WEBPACK_IMPORTED_MODULE_0__.Castles.empty();\n        this.epSquare = undefined;\n        this.remainingChecks = undefined;\n        this.halfmoves = 0;\n        this.fullmoves = 1;\n    }\n    setupUnchecked(setup) {\n        super.setupUnchecked(setup);\n        this.castles = _chess_js__WEBPACK_IMPORTED_MODULE_0__.Castles.empty();\n    }\n    static default() {\n        const pos = new this();\n        pos.reset();\n        return pos;\n    }\n    static fromSetup(setup) {\n        const pos = new this();\n        pos.setupUnchecked(setup);\n        return pos.validate().map(_ => pos);\n    }\n    clone() {\n        return super.clone();\n    }\n    validate() {\n        if (this.isCheck() || this.board.pawn.nonEmpty())\n            return _badrap_result__WEBPACK_IMPORTED_MODULE_2__.Result.err(new _chess_js__WEBPACK_IMPORTED_MODULE_0__.PositionError(_chess_js__WEBPACK_IMPORTED_MODULE_0__.IllegalSetup.Variant));\n        return super.validate();\n    }\n    dests(square, ctx) {\n        ctx = ctx || this.ctx();\n        // Kings cannot give check.\n        if (square === ctx.king)\n            return super.dests(square, ctx);\n        // Do not allow giving check.\n        let dests = _squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet.empty();\n        for (const to of super.dests(square, ctx)) {\n            // Valid, because there are no promotions (or even pawns).\n            const move = { from: square, to };\n            const after = this.clone();\n            after.play(move);\n            if (!after.isCheck())\n                dests = dests.with(to);\n        }\n        return dests;\n    }\n    hasInsufficientMaterial(_color) {\n        return false;\n    }\n    isVariantEnd() {\n        const goal = _squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet.fromRank(7);\n        const inGoal = this.board.king.intersect(goal);\n        if (inGoal.isEmpty())\n            return false;\n        if (this.turn === 'white' || inGoal.intersects(this.board.black))\n            return true;\n        // White has reached the backrank. Check if black can catch up.\n        const blackKing = this.board.kingOf('black');\n        if ((0,_util_js__WEBPACK_IMPORTED_MODULE_4__.defined)(blackKing)) {\n            const occ = this.board.occupied.without(blackKing);\n            for (const target of (0,_attacks_js__WEBPACK_IMPORTED_MODULE_5__.kingAttacks)(blackKing).intersect(goal).diff(this.board.black)) {\n                if (this.kingAttackers(target, 'white', occ).isEmpty())\n                    return false;\n            }\n        }\n        return true;\n    }\n    variantOutcome(ctx) {\n        if (ctx ? !ctx.variantEnd : !this.isVariantEnd())\n            return;\n        const goal = _squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet.fromRank(7);\n        const blackInGoal = this.board.pieces('black', 'king').intersects(goal);\n        const whiteInGoal = this.board.pieces('white', 'king').intersects(goal);\n        if (blackInGoal && !whiteInGoal)\n            return { winner: 'black' };\n        if (whiteInGoal && !blackInGoal)\n            return { winner: 'white' };\n        return { winner: undefined };\n    }\n}\nconst hordeBoard = () => {\n    const board = _board_js__WEBPACK_IMPORTED_MODULE_7__.Board.empty();\n    board.occupied = new _squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet(4294967295, 4294901862);\n    board.promoted = _squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet.empty();\n    board.white = new _squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet(4294967295, 102);\n    board.black = new _squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet(0, 4294901760);\n    board.pawn = new _squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet(4294967295, 16711782);\n    board.knight = new _squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet(0, 1107296256);\n    board.bishop = new _squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet(0, 603979776);\n    board.rook = new _squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet(0, 2164260864);\n    board.queen = new _squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet(0, 134217728);\n    board.king = new _squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet(0, 268435456);\n    return board;\n};\nclass Horde extends _chess_js__WEBPACK_IMPORTED_MODULE_0__.Position {\n    constructor() {\n        super('horde');\n    }\n    reset() {\n        this.board = hordeBoard();\n        this.pockets = undefined;\n        this.turn = 'white';\n        this.castles = _chess_js__WEBPACK_IMPORTED_MODULE_0__.Castles.default();\n        this.castles.discardColor('white');\n        this.epSquare = undefined;\n        this.remainingChecks = undefined;\n        this.halfmoves = 0;\n        this.fullmoves = 1;\n    }\n    static default() {\n        const pos = new this();\n        pos.reset();\n        return pos;\n    }\n    static fromSetup(setup) {\n        const pos = new this();\n        pos.setupUnchecked(setup);\n        return pos.validate().map(_ => pos);\n    }\n    clone() {\n        return super.clone();\n    }\n    validate() {\n        if (this.board.occupied.isEmpty())\n            return _badrap_result__WEBPACK_IMPORTED_MODULE_2__.Result.err(new _chess_js__WEBPACK_IMPORTED_MODULE_0__.PositionError(_chess_js__WEBPACK_IMPORTED_MODULE_0__.IllegalSetup.Empty));\n        if (this.board.king.size() !== 1)\n            return _badrap_result__WEBPACK_IMPORTED_MODULE_2__.Result.err(new _chess_js__WEBPACK_IMPORTED_MODULE_0__.PositionError(_chess_js__WEBPACK_IMPORTED_MODULE_0__.IllegalSetup.Kings));\n        const otherKing = this.board.kingOf((0,_util_js__WEBPACK_IMPORTED_MODULE_4__.opposite)(this.turn));\n        if ((0,_util_js__WEBPACK_IMPORTED_MODULE_4__.defined)(otherKing) && this.kingAttackers(otherKing, this.turn, this.board.occupied).nonEmpty()) {\n            return _badrap_result__WEBPACK_IMPORTED_MODULE_2__.Result.err(new _chess_js__WEBPACK_IMPORTED_MODULE_0__.PositionError(_chess_js__WEBPACK_IMPORTED_MODULE_0__.IllegalSetup.OppositeCheck));\n        }\n        for (const color of _types_js__WEBPACK_IMPORTED_MODULE_6__.COLORS) {\n            const backranks = this.board.pieces(color, 'king').isEmpty()\n                ? _squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet.backrank((0,_util_js__WEBPACK_IMPORTED_MODULE_4__.opposite)(color))\n                : _squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet.backranks();\n            if (this.board.pieces(color, 'pawn').intersects(backranks)) {\n                return _badrap_result__WEBPACK_IMPORTED_MODULE_2__.Result.err(new _chess_js__WEBPACK_IMPORTED_MODULE_0__.PositionError(_chess_js__WEBPACK_IMPORTED_MODULE_0__.IllegalSetup.PawnsOnBackrank));\n            }\n        }\n        return _badrap_result__WEBPACK_IMPORTED_MODULE_2__.Result.ok(undefined);\n    }\n    hasInsufficientMaterial(color) {\n        // The side with the king can always win by capturing the horde.\n        if (this.board.pieces(color, 'king').nonEmpty())\n            return false;\n        const oppositeSquareColor = (squareColor) => (squareColor === 'light' ? 'dark' : 'light');\n        const coloredSquares = (squareColor) => squareColor === 'light' ? _squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet.lightSquares() : _squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet.darkSquares();\n        const hasBishopPair = (side) => {\n            const bishops = this.board.pieces(side, 'bishop');\n            return bishops.intersects(_squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet.darkSquares()) && bishops.intersects(_squareSet_js__WEBPACK_IMPORTED_MODULE_3__.SquareSet.lightSquares());\n        };\n        // By this point: color is the horde.\n        // Based on\n        // https://github.com/stevepapazis/horde-insufficient-material-tests.\n        const horde = _setup_js__WEBPACK_IMPORTED_MODULE_1__.MaterialSide.fromBoard(this.board, color);\n        const hordeBishops = (squareColor) => coloredSquares(squareColor).intersect(this.board.pieces(color, 'bishop')).size();\n        const hordeBishopColor = hordeBishops('light') >= 1 ? 'light' : 'dark';\n        const hordeNum = horde.pawn\n            + horde.knight\n            + horde.rook\n            + horde.queen\n            + Math.min(hordeBishops('dark'), 2)\n            + Math.min(hordeBishops('light'), 2);\n        const pieces = _setup_js__WEBPACK_IMPORTED_MODULE_1__.MaterialSide.fromBoard(this.board, (0,_util_js__WEBPACK_IMPORTED_MODULE_4__.opposite)(color));\n        const piecesBishops = (squareColor) => coloredSquares(squareColor)\n            .intersect(this.board.pieces((0,_util_js__WEBPACK_IMPORTED_MODULE_4__.opposite)(color), 'bishop'))\n            .size();\n        const piecesNum = pieces.size();\n        const piecesOfRoleNot = (piece) => piecesNum - piece;\n        if (hordeNum === 0)\n            return true;\n        if (hordeNum >= 4) {\n            // Four or more pieces can always deliver mate.\n            return false;\n        }\n        if ((horde.pawn >= 1 || horde.queen >= 1) && hordeNum >= 2) {\n            // Pawns/queens are never insufficient material when paired with any other\n            // piece (a pawn promotes to a queen and delivers mate).\n            return false;\n        }\n        if (horde.rook >= 1 && hordeNum >= 2) {\n            // A rook is insufficient material only when it is paired with a bishop\n            // against a lone king. The horde can mate in any other case.\n            // A rook on A1 and a bishop on C3 mate a king on B1 when there is a\n            // friendly pawn/opposite-color-bishop/rook/queen on C2.\n            // A rook on B8 and a bishop C3 mate a king on A1 when there is a friendly\n            // knight on A2.\n            if (!(hordeNum === 2\n                && horde.rook === 1\n                && horde.bishop === 1\n                && piecesOfRoleNot(piecesBishops(hordeBishopColor)) === 1)) {\n                return false;\n            }\n        }\n        if (hordeNum === 1) {\n            if (piecesNum === 1) {\n                // A lone piece cannot mate a lone king.\n                return true;\n            }\n            else if (horde.queen === 1) {\n                // The horde has a lone queen.\n                // A lone queen mates a king on A1 bounded by:\n                //  -- a pawn/rook on A2\n                //  -- two same color bishops on A2, B1\n                // We ignore every other mating case, since it can be reduced to\n                // the two previous cases (e.g. a black pawn on A2 and a black\n                // bishop on B1).\n                return !(pieces.pawn >= 1 || pieces.rook >= 1 || piecesBishops('light') >= 2 || piecesBishops('dark') >= 2);\n            }\n            else if (horde.pawn === 1) {\n                // Promote the pawn to a queen or a knight and check whether white\n                // can mate.\n                const pawnSquare = this.board.pieces(color, 'pawn').last();\n                const promoteToQueen = this.clone();\n                promoteToQueen.board.set(pawnSquare, { color, role: 'queen' });\n                const promoteToKnight = this.clone();\n                promoteToKnight.board.set(pawnSquare, { color, role: 'knight' });\n                return promoteToQueen.hasInsufficientMaterial(color) && promoteToKnight.hasInsufficientMaterial(color);\n            }\n            else if (horde.rook === 1) {\n                // A lone rook mates a king on A8 bounded by a pawn/rook on A7 and a\n                // pawn/knight on B7. We ignore every other case, since it can be\n                // reduced to the two previous cases.\n                // (e.g. three pawns on A7, B7, C7)\n                return !(pieces.pawn >= 2\n                    || (pieces.rook >= 1 && pieces.pawn >= 1)\n                    || (pieces.rook >= 1 && pieces.knight >= 1)\n                    || (pieces.pawn >= 1 && pieces.knight >= 1));\n            }\n            else if (horde.bishop === 1) {\n                // The horde has a lone bishop.\n                return !(\n                // The king can be mated on A1 if there is a pawn/opposite-color-bishop\n                // on A2 and an opposite-color-bishop on B1.\n                // If black has two or more pawns, white gets the benefit of the doubt;\n                // there is an outside chance that white promotes its pawns to\n                // opposite-color-bishops and selfmates theirself.\n                // Every other case that the king is mated by the bishop requires that\n                // black has two pawns or two opposite-color-bishop or a pawn and an\n                // opposite-color-bishop.\n                // For example a king on A3 can be mated if there is\n                // a pawn/opposite-color-bishop on A4, a pawn/opposite-color-bishop on\n                // B3, a pawn/bishop/rook/queen on A2 and any other piece on B2.\n                piecesBishops(oppositeSquareColor(hordeBishopColor)) >= 2\n                    || (piecesBishops(oppositeSquareColor(hordeBishopColor)) >= 1 && pieces.pawn >= 1)\n                    || pieces.pawn >= 2);\n            }\n            else if (horde.knight === 1) {\n                // The horde has a lone knight.\n                return !(\n                // The king on A1 can be smother mated by a knight on C2 if there is\n                // a pawn/knight/bishop on B2, a knight/rook on B1 and any other piece\n                // on A2.\n                // Moreover, when black has four or more pieces and two of them are\n                // pawns, black can promote their pawns and selfmate theirself.\n                piecesNum >= 4\n                    && (pieces.knight >= 2\n                        || pieces.pawn >= 2\n                        || (pieces.rook >= 1 && pieces.knight >= 1)\n                        || (pieces.rook >= 1 && pieces.bishop >= 1)\n                        || (pieces.knight >= 1 && pieces.bishop >= 1)\n                        || (pieces.rook >= 1 && pieces.pawn >= 1)\n                        || (pieces.knight >= 1 && pieces.pawn >= 1)\n                        || (pieces.bishop >= 1 && pieces.pawn >= 1)\n                        || (hasBishopPair((0,_util_js__WEBPACK_IMPORTED_MODULE_4__.opposite)(color)) && pieces.pawn >= 1))\n                    && (piecesBishops('dark') < 2 || piecesOfRoleNot(piecesBishops('dark')) >= 3)\n                    && (piecesBishops('light') < 2 || piecesOfRoleNot(piecesBishops('light')) >= 3));\n            }\n            // By this point, we only need to deal with white's minor pieces.\n        }\n        else if (hordeNum === 2) {\n            if (piecesNum === 1) {\n                // Two minor pieces cannot mate a lone king.\n                return true;\n            }\n            else if (horde.knight === 2) {\n                // A king on A1 is mated by two knights, if it is obstructed by a\n                // pawn/bishop/knight on B2. On the other hand, if black only has\n                // major pieces it is a draw.\n                return pieces.pawn + pieces.bishop + pieces.knight < 1;\n            }\n            else if (hasBishopPair(color)) {\n                return !(\n                // A king on A1 obstructed by a pawn/bishop on A2 is mated\n                // by the bishop pair.\n                pieces.pawn >= 1\n                    || pieces.bishop >= 1\n                    // A pawn/bishop/knight on B4, a pawn/bishop/rook/queen on\n                    // A4 and the king on A3 enable Boden's mate by the bishop\n                    // pair. In every other case white cannot win.\n                    || (pieces.knight >= 1 && pieces.rook + pieces.queen >= 1));\n            }\n            else if (horde.bishop >= 1 && horde.knight >= 1) {\n                // The horde has a bishop and a knight.\n                return !(\n                // A king on A1 obstructed by a pawn/opposite-color-bishop on\n                // A2 is mated by a knight on D2 and a bishop on C3.\n                pieces.pawn >= 1\n                    || piecesBishops(oppositeSquareColor(hordeBishopColor)) >= 1\n                    // A king on A1 bounded by two friendly pieces on A2 and B1 is\n                    // mated when the knight moves from D4 to C2 so that both the\n                    // knight and the bishop deliver check.\n                    || piecesOfRoleNot(piecesBishops(hordeBishopColor)) >= 3);\n            }\n            else {\n                // The horde has two or more bishops on the same color.\n                // White can only win if black has enough material to obstruct\n                // the squares of the opposite color around the king.\n                return !(\n                // A king on A1 obstructed by a pawn/opposite-bishop/knight\n                // on A2 and a opposite-bishop/knight on B1 is mated by two\n                // bishops on B2 and C3. This position is theoretically\n                // achievable even when black has two pawns or when they\n                // have a pawn and an opposite color bishop.\n                (pieces.pawn >= 1 && piecesBishops(oppositeSquareColor(hordeBishopColor)) >= 1)\n                    || (pieces.pawn >= 1 && pieces.knight >= 1)\n                    || (piecesBishops(oppositeSquareColor(hordeBishopColor)) >= 1 && pieces.knight >= 1)\n                    || piecesBishops(oppositeSquareColor(hordeBishopColor)) >= 2\n                    || pieces.knight >= 2\n                    || pieces.pawn >= 2\n                // In every other case, white can only draw.\n                );\n            }\n        }\n        else if (hordeNum === 3) {\n            // A king in the corner is mated by two knights and a bishop or three\n            // knights or the bishop pair and a knight/bishop.\n            if ((horde.knight === 2 && horde.bishop === 1) || horde.knight === 3 || hasBishopPair(color)) {\n                return false;\n            }\n            else {\n                // White has two same color bishops and a knight.\n                // A king on A1 is mated by a bishop on B2, a bishop on C1 and a\n                // knight on C3, as long as there is another black piece to waste\n                // a tempo.\n                return piecesNum === 1;\n            }\n        }\n        return true;\n    }\n    isVariantEnd() {\n        return this.board.white.isEmpty() || this.board.black.isEmpty();\n    }\n    variantOutcome(_ctx) {\n        if (this.board.white.isEmpty())\n            return { winner: 'black' };\n        if (this.board.black.isEmpty())\n            return { winner: 'white' };\n        return;\n    }\n}\nconst defaultPosition = (rules) => {\n    switch (rules) {\n        case 'chess':\n            return _chess_js__WEBPACK_IMPORTED_MODULE_0__.Chess.default();\n        case 'antichess':\n            return Antichess.default();\n        case 'atomic':\n            return Atomic.default();\n        case 'horde':\n            return Horde.default();\n        case 'racingkings':\n            return RacingKings.default();\n        case 'kingofthehill':\n            return KingOfTheHill.default();\n        case '3check':\n            return ThreeCheck.default();\n        case 'crazyhouse':\n            return Crazyhouse.default();\n    }\n};\nconst setupPosition = (rules, setup) => {\n    switch (rules) {\n        case 'chess':\n            return _chess_js__WEBPACK_IMPORTED_MODULE_0__.Chess.fromSetup(setup);\n        case 'antichess':\n            return Antichess.fromSetup(setup);\n        case 'atomic':\n            return Atomic.fromSetup(setup);\n        case 'horde':\n            return Horde.fromSetup(setup);\n        case 'racingkings':\n            return RacingKings.fromSetup(setup);\n        case 'kingofthehill':\n            return KingOfTheHill.fromSetup(setup);\n        case '3check':\n            return ThreeCheck.fromSetup(setup);\n        case 'crazyhouse':\n            return Crazyhouse.fromSetup(setup);\n    }\n};\nconst isStandardMaterial = (pos) => {\n    var _a, _b, _c, _d, _e;\n    switch (pos.rules) {\n        case 'chess':\n        case 'antichess':\n        case 'atomic':\n        case 'kingofthehill':\n        case '3check':\n            return _types_js__WEBPACK_IMPORTED_MODULE_6__.COLORS.every(color => (0,_chess_js__WEBPACK_IMPORTED_MODULE_0__.isStandardMaterialSide)(pos.board, color));\n        case 'crazyhouse': {\n            const promoted = pos.board.promoted;\n            return (promoted.size() + pos.board.pawn.size() + (((_a = pos.pockets) === null || _a === void 0 ? void 0 : _a.count('pawn')) || 0) <= 16\n                && pos.board.knight.diff(promoted).size() + (((_b = pos.pockets) === null || _b === void 0 ? void 0 : _b.count('knight')) || 0) <= 4\n                && pos.board.bishop.diff(promoted).size() + (((_c = pos.pockets) === null || _c === void 0 ? void 0 : _c.count('bishop')) || 0) <= 4\n                && pos.board.rook.diff(promoted).size() + (((_d = pos.pockets) === null || _d === void 0 ? void 0 : _d.count('rook')) || 0) <= 4\n                && pos.board.queen.diff(promoted).size() + (((_e = pos.pockets) === null || _e === void 0 ? void 0 : _e.count('queen')) || 0) <= 2);\n        }\n        case 'horde':\n            return _types_js__WEBPACK_IMPORTED_MODULE_6__.COLORS.every(color => pos.board.pieces(color, 'king').nonEmpty()\n                ? (0,_chess_js__WEBPACK_IMPORTED_MODULE_0__.isStandardMaterialSide)(pos.board, color)\n                : pos.board[color].size() <= 36);\n        case 'racingkings':\n            return _types_js__WEBPACK_IMPORTED_MODULE_6__.COLORS.every(color => pos.board.pieces(color, 'knight').size() <= 2\n                && pos.board.pieces(color, 'bishop').size() <= 2\n                && pos.board.pieces(color, 'rook').size() <= 2\n                && pos.board.pieces(color, 'queen').size() <= 1);\n    }\n};\n//# sourceMappingURL=variant.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvY2hlc3NvcHMvZGlzdC9lc20vdmFyaWFudC5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBd0M7QUFDeUI7QUFDOUI7QUFDeUo7QUFDdkg7QUFDMUI7QUFDUDtBQUNVO0FBQ3VGO0FBQzlILHlCQUF5QiwrQ0FBUTtBQUN4QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLCtDQUFRO0FBQy9CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0RBQStELCtDQUFRO0FBQ3ZFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QixrREFBTSxTQUFTLG9EQUFhLENBQUMsbURBQVk7QUFDaEU7QUFDQTtBQUNBLHVCQUF1QixrREFBTSxTQUFTLG9EQUFhLENBQUMsbURBQVk7QUFDaEU7QUFDQSxtQkFBbUIsa0RBQU07QUFDekIsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYyxvREFBUztBQUN2QjtBQUNBLGtCQUFrQixvREFBUztBQUMzQixrQkFBa0Isb0RBQVM7QUFDM0I7QUFDQSxZQUFZLGlEQUFPO0FBQ25CO0FBQ0EsaUJBQWlCLGlEQUFPO0FBQ3hCLHVCQUF1QixvREFBUztBQUNoQyxrQ0FBa0Msb0RBQU87QUFDekM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPLHFCQUFxQiwrQ0FBUTtBQUNwQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQixrREFBTSxTQUFTLG9EQUFhLENBQUMsbURBQVk7QUFDNUQ7QUFDQSxtQkFBbUIsa0RBQU0sU0FBUyxvREFBYSxDQUFDLG1EQUFZO0FBQzVELDRDQUE0QyxrREFBUTtBQUNwRCxhQUFhLGlEQUFPO0FBQ3BCLG1CQUFtQixrREFBTSxTQUFTLG9EQUFhLENBQUMsbURBQVk7QUFDNUQ7QUFDQSxtQkFBbUIsa0RBQU0sU0FBUyxvREFBYSxDQUFDLG1EQUFZO0FBQzVEO0FBQ0EsWUFBWSxvREFBUztBQUNyQixtQkFBbUIsa0RBQU0sU0FBUyxvREFBYSxDQUFDLG1EQUFZO0FBQzVEO0FBQ0EsZUFBZSxrREFBTTtBQUNyQjtBQUNBO0FBQ0E7QUFDQSx1Q0FBdUMsd0RBQVc7QUFDbEQsbUJBQW1CLG9EQUFTO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhCQUE4Qix3REFBVztBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhCQUE4QixrREFBUTtBQUN0QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsa0RBQVE7QUFDL0I7QUFDQTtBQUNBLDhFQUE4RSxvREFBUztBQUN2RixxRkFBcUYsb0RBQVM7QUFDOUY7QUFDQSw4RUFBOEUsb0RBQVM7QUFDdkYscUZBQXFGLG9EQUFTO0FBQzlGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixvREFBUztBQUM3Qix5QkFBeUIsc0RBQVc7QUFDcEM7QUFDQSx5QkFBeUIsa0JBQWtCO0FBQzNDO0FBQ0EsZ0JBQWdCLGlEQUFPO0FBQ3ZCLHFCQUFxQixpREFBTztBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0Qiw2Q0FBTTtBQUNsQztBQUNBLHlCQUF5QixRQUFRLGtEQUFRO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ08sd0JBQXdCLCtDQUFRO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsOENBQU87QUFDOUI7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLDhDQUFPO0FBQzlCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CLGtEQUFNLFNBQVMsb0RBQWEsQ0FBQyxtREFBWTtBQUM1RCxZQUFZLG9EQUFTO0FBQ3JCLG1CQUFtQixrREFBTSxTQUFTLG9EQUFhLENBQUMsbURBQVk7QUFDNUQ7QUFDQSxlQUFlLGtEQUFNO0FBQ3JCO0FBQ0E7QUFDQSxlQUFlLG9EQUFTO0FBQ3hCO0FBQ0E7QUFDQTtBQUNBLFlBQVksaURBQU87QUFDbkIsZUFBZSx3REFBVyxDQUFDLGtEQUFRO0FBQ25DO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQyxrREFBUTtBQUN6QztBQUNBLGdCQUFnQixzREFBVztBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCLHNEQUFXO0FBQ2pDLGlDQUFpQyxrREFBUTtBQUN6QztBQUNBLGNBQWMsaURBQU87QUFDckI7QUFDQTtBQUNBLGNBQWMsb0RBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsa0RBQVE7QUFDL0I7QUFDQTtBQUNBLCtEQUErRCxvREFBUztBQUN4RSw4REFBOEQsb0RBQVM7QUFDdkUsNkNBQTZDLGtEQUFRLG9CQUFvQixvREFBUztBQUNsRiw4Q0FBOEMsa0RBQVEsb0JBQW9CLG9EQUFTO0FBQ25GO0FBQ0E7QUFDQTtBQUNBLGlEQUFpRCxvREFBUztBQUMxRCxnREFBZ0Qsb0RBQVM7QUFDekQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDTyw0QkFBNEIsK0NBQVE7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBDQUEwQyxvREFBUztBQUNuRDtBQUNBO0FBQ0EsNEJBQTRCLDZDQUFNO0FBQ2xDLDREQUE0RCxvREFBUztBQUNyRSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDTyx5QkFBeUIsK0NBQVE7QUFDeEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQixzREFBZTtBQUM5QztBQUNBO0FBQ0E7QUFDQTtBQUNBLGlIQUFpSCxzREFBZTtBQUNoSTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQyw2Q0FBTTtBQUN0QztBQUNBLDZCQUE2QjtBQUM3QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0IsNENBQUs7QUFDdkIseUJBQXlCLG9EQUFTO0FBQ2xDLHFCQUFxQixvREFBUztBQUM5QixzQkFBc0Isb0RBQVM7QUFDL0Isc0JBQXNCLG9EQUFTO0FBQy9CLGlCQUFpQixvREFBUztBQUMxQix1QkFBdUIsb0RBQVM7QUFDaEMsdUJBQXVCLG9EQUFTO0FBQ2hDLHFCQUFxQixvREFBUztBQUM5QixzQkFBc0Isb0RBQVM7QUFDL0IscUJBQXFCLG9EQUFTO0FBQzlCO0FBQ0E7QUFDTywwQkFBMEIsK0NBQVE7QUFDekM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsOENBQU87QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsOENBQU87QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUIsa0RBQU0sU0FBUyxvREFBYSxDQUFDLG1EQUFZO0FBQzVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0Isb0RBQVM7QUFDN0I7QUFDQTtBQUNBLDJCQUEyQjtBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCLG9EQUFTO0FBQzlCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxpREFBTztBQUNuQjtBQUNBLGlDQUFpQyx3REFBVztBQUM1QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUIsb0RBQVM7QUFDOUI7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0EscUJBQXFCO0FBQ3JCLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQSxrQkFBa0IsNENBQUs7QUFDdkIseUJBQXlCLG9EQUFTO0FBQ2xDLHFCQUFxQixvREFBUztBQUM5QixzQkFBc0Isb0RBQVM7QUFDL0Isc0JBQXNCLG9EQUFTO0FBQy9CLHFCQUFxQixvREFBUztBQUM5Qix1QkFBdUIsb0RBQVM7QUFDaEMsdUJBQXVCLG9EQUFTO0FBQ2hDLHFCQUFxQixvREFBUztBQUM5QixzQkFBc0Isb0RBQVM7QUFDL0IscUJBQXFCLG9EQUFTO0FBQzlCO0FBQ0E7QUFDTyxvQkFBb0IsK0NBQVE7QUFDbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsOENBQU87QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CLGtEQUFNLFNBQVMsb0RBQWEsQ0FBQyxtREFBWTtBQUM1RDtBQUNBLG1CQUFtQixrREFBTSxTQUFTLG9EQUFhLENBQUMsbURBQVk7QUFDNUQsNENBQTRDLGtEQUFRO0FBQ3BELFlBQVksaURBQU87QUFDbkIsbUJBQW1CLGtEQUFNLFNBQVMsb0RBQWEsQ0FBQyxtREFBWTtBQUM1RDtBQUNBLDRCQUE0Qiw2Q0FBTTtBQUNsQztBQUNBLGtCQUFrQixvREFBUyxVQUFVLGtEQUFRO0FBQzdDLGtCQUFrQixvREFBUztBQUMzQjtBQUNBLHVCQUF1QixrREFBTSxTQUFTLG9EQUFhLENBQUMsbURBQVk7QUFDaEU7QUFDQTtBQUNBLGVBQWUsa0RBQU07QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEVBQTBFLG9EQUFTLGtCQUFrQixvREFBUztBQUM5RztBQUNBO0FBQ0Esc0NBQXNDLG9EQUFTLHNDQUFzQyxvREFBUztBQUM5RjtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQixtREFBWTtBQUNsQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLG1EQUFZLHVCQUF1QixrREFBUTtBQUNsRTtBQUNBLHlDQUF5QyxrREFBUTtBQUNqRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1REFBdUQsc0JBQXNCO0FBQzdFO0FBQ0Esd0RBQXdELHVCQUF1QjtBQUMvRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMENBQTBDLGtEQUFRO0FBQ2xEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0EsbUJBQW1CLDRDQUFLO0FBQ3hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0EsbUJBQW1CLDRDQUFLO0FBQ3hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQiw2Q0FBTSxnQkFBZ0IsaUVBQXNCO0FBQy9EO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQiw2Q0FBTTtBQUN6QixrQkFBa0IsaUVBQXNCO0FBQ3hDO0FBQ0E7QUFDQSxtQkFBbUIsNkNBQU07QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyIvVXNlcnMvcmFrc2hpdC93b3Jrc3BhY2UvYXJjaGl2ZXMvcmVwb3MvY2hlc3MvZXZhbC1iYXIvbm9kZV9tb2R1bGVzL2NoZXNzb3BzL2Rpc3QvZXNtL3ZhcmlhbnQuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUmVzdWx0IH0gZnJvbSAnQGJhZHJhcC9yZXN1bHQnO1xuaW1wb3J0IHsgYmV0d2Vlbiwga2luZ0F0dGFja3MsIHBhd25BdHRhY2tzIH0gZnJvbSAnLi9hdHRhY2tzLmpzJztcbmltcG9ydCB7IEJvYXJkIH0gZnJvbSAnLi9ib2FyZC5qcyc7XG5pbXBvcnQgeyBDYXN0bGVzLCBjYXN0bGluZ1NpZGUsIENoZXNzLCBlcXVhbHNJZ25vcmVNb3ZlcywgSWxsZWdhbFNldHVwLCBpc0ltcG9zc2libGVDaGVjaywgaXNTdGFuZGFyZE1hdGVyaWFsU2lkZSwgbm9ybWFsaXplTW92ZSwgUG9zaXRpb24sIFBvc2l0aW9uRXJyb3IsIHBzZXVkb0Rlc3RzLCB9IGZyb20gJy4vY2hlc3MuanMnO1xuaW1wb3J0IHsgTWF0ZXJpYWwsIE1hdGVyaWFsU2lkZSwgUmVtYWluaW5nQ2hlY2tzIH0gZnJvbSAnLi9zZXR1cC5qcyc7XG5pbXBvcnQgeyBTcXVhcmVTZXQgfSBmcm9tICcuL3NxdWFyZVNldC5qcyc7XG5pbXBvcnQgeyBDT0xPUlMgfSBmcm9tICcuL3R5cGVzLmpzJztcbmltcG9ydCB7IGRlZmluZWQsIG9wcG9zaXRlIH0gZnJvbSAnLi91dGlsLmpzJztcbmV4cG9ydCB7IENhc3RsZXMsIGNhc3RsaW5nU2lkZSwgQ2hlc3MsIGVxdWFsc0lnbm9yZU1vdmVzLCBJbGxlZ2FsU2V0dXAsIGlzSW1wb3NzaWJsZUNoZWNrLCBub3JtYWxpemVNb3ZlLCBQb3NpdGlvbiwgUG9zaXRpb25FcnJvciwgfTtcbmV4cG9ydCBjbGFzcyBDcmF6eWhvdXNlIGV4dGVuZHMgUG9zaXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcignY3Jhenlob3VzZScpO1xuICAgIH1cbiAgICByZXNldCgpIHtcbiAgICAgICAgc3VwZXIucmVzZXQoKTtcbiAgICAgICAgdGhpcy5wb2NrZXRzID0gTWF0ZXJpYWwuZW1wdHkoKTtcbiAgICB9XG4gICAgc2V0dXBVbmNoZWNrZWQoc2V0dXApIHtcbiAgICAgICAgc3VwZXIuc2V0dXBVbmNoZWNrZWQoc2V0dXApO1xuICAgICAgICB0aGlzLmJvYXJkLnByb21vdGVkID0gc2V0dXAuYm9hcmQucHJvbW90ZWRcbiAgICAgICAgICAgIC5pbnRlcnNlY3Qoc2V0dXAuYm9hcmQub2NjdXBpZWQpXG4gICAgICAgICAgICAuZGlmZihzZXR1cC5ib2FyZC5raW5nKVxuICAgICAgICAgICAgLmRpZmYoc2V0dXAuYm9hcmQucGF3bik7XG4gICAgICAgIHRoaXMucG9ja2V0cyA9IHNldHVwLnBvY2tldHMgPyBzZXR1cC5wb2NrZXRzLmNsb25lKCkgOiBNYXRlcmlhbC5lbXB0eSgpO1xuICAgIH1cbiAgICBzdGF0aWMgZGVmYXVsdCgpIHtcbiAgICAgICAgY29uc3QgcG9zID0gbmV3IHRoaXMoKTtcbiAgICAgICAgcG9zLnJlc2V0KCk7XG4gICAgICAgIHJldHVybiBwb3M7XG4gICAgfVxuICAgIHN0YXRpYyBmcm9tU2V0dXAoc2V0dXApIHtcbiAgICAgICAgY29uc3QgcG9zID0gbmV3IHRoaXMoKTtcbiAgICAgICAgcG9zLnNldHVwVW5jaGVja2VkKHNldHVwKTtcbiAgICAgICAgcmV0dXJuIHBvcy52YWxpZGF0ZSgpLm1hcChfID0+IHBvcyk7XG4gICAgfVxuICAgIGNsb25lKCkge1xuICAgICAgICByZXR1cm4gc3VwZXIuY2xvbmUoKTtcbiAgICB9XG4gICAgdmFsaWRhdGUoKSB7XG4gICAgICAgIHJldHVybiBzdXBlci52YWxpZGF0ZSgpLmNoYWluKF8gPT4ge1xuICAgICAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgICAgIGlmICgoX2EgPSB0aGlzLnBvY2tldHMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5jb3VudCgna2luZycpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFJlc3VsdC5lcnIobmV3IFBvc2l0aW9uRXJyb3IoSWxsZWdhbFNldHVwLktpbmdzKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoKCgoX2IgPSB0aGlzLnBvY2tldHMpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5zaXplKCkpIHx8IDApICsgdGhpcy5ib2FyZC5vY2N1cGllZC5zaXplKCkgPiA2NCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBSZXN1bHQuZXJyKG5ldyBQb3NpdGlvbkVycm9yKElsbGVnYWxTZXR1cC5WYXJpYW50KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gUmVzdWx0Lm9rKHVuZGVmaW5lZCk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBoYXNJbnN1ZmZpY2llbnRNYXRlcmlhbChjb2xvcikge1xuICAgICAgICAvLyBObyBtYXRlcmlhbCBjYW4gbGVhdmUgdGhlIGdhbWUsIGJ1dCB3ZSBjYW4gZWFzaWx5IGNoZWNrIHRoaXMgZm9yXG4gICAgICAgIC8vIGN1c3RvbSBwb3NpdGlvbnMuXG4gICAgICAgIGlmICghdGhpcy5wb2NrZXRzKVxuICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmhhc0luc3VmZmljaWVudE1hdGVyaWFsKGNvbG9yKTtcbiAgICAgICAgcmV0dXJuICh0aGlzLmJvYXJkLm9jY3VwaWVkLnNpemUoKSArIHRoaXMucG9ja2V0cy5zaXplKCkgPD0gM1xuICAgICAgICAgICAgJiYgdGhpcy5ib2FyZC5wYXduLmlzRW1wdHkoKVxuICAgICAgICAgICAgJiYgdGhpcy5ib2FyZC5wcm9tb3RlZC5pc0VtcHR5KClcbiAgICAgICAgICAgICYmIHRoaXMuYm9hcmQucm9va3NBbmRRdWVlbnMoKS5pc0VtcHR5KClcbiAgICAgICAgICAgICYmIHRoaXMucG9ja2V0cy5jb3VudCgncGF3bicpIDw9IDBcbiAgICAgICAgICAgICYmIHRoaXMucG9ja2V0cy5jb3VudCgncm9vaycpIDw9IDBcbiAgICAgICAgICAgICYmIHRoaXMucG9ja2V0cy5jb3VudCgncXVlZW4nKSA8PSAwKTtcbiAgICB9XG4gICAgZHJvcERlc3RzKGN0eCkge1xuICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICBjb25zdCBtYXNrID0gdGhpcy5ib2FyZC5vY2N1cGllZFxuICAgICAgICAgICAgLmNvbXBsZW1lbnQoKVxuICAgICAgICAgICAgLmludGVyc2VjdCgoKF9hID0gdGhpcy5wb2NrZXRzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2FbdGhpcy50dXJuXS5oYXNOb25QYXducygpKVxuICAgICAgICAgICAgPyBTcXVhcmVTZXQuZnVsbCgpXG4gICAgICAgICAgICA6ICgoX2IgPSB0aGlzLnBvY2tldHMpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYlt0aGlzLnR1cm5dLmhhc1Bhd25zKCkpXG4gICAgICAgICAgICAgICAgPyBTcXVhcmVTZXQuYmFja3JhbmtzKCkuY29tcGxlbWVudCgpXG4gICAgICAgICAgICAgICAgOiBTcXVhcmVTZXQuZW1wdHkoKSk7XG4gICAgICAgIGN0eCA9IGN0eCB8fCB0aGlzLmN0eCgpO1xuICAgICAgICBpZiAoZGVmaW5lZChjdHgua2luZykgJiYgY3R4LmNoZWNrZXJzLm5vbkVtcHR5KCkpIHtcbiAgICAgICAgICAgIGNvbnN0IGNoZWNrZXIgPSBjdHguY2hlY2tlcnMuc2luZ2xlU3F1YXJlKCk7XG4gICAgICAgICAgICBpZiAoIWRlZmluZWQoY2hlY2tlcikpXG4gICAgICAgICAgICAgICAgcmV0dXJuIFNxdWFyZVNldC5lbXB0eSgpO1xuICAgICAgICAgICAgcmV0dXJuIG1hc2suaW50ZXJzZWN0KGJldHdlZW4oY2hlY2tlciwgY3R4LmtpbmcpKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICByZXR1cm4gbWFzaztcbiAgICB9XG59XG5leHBvcnQgY2xhc3MgQXRvbWljIGV4dGVuZHMgUG9zaXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcignYXRvbWljJyk7XG4gICAgfVxuICAgIHN0YXRpYyBkZWZhdWx0KCkge1xuICAgICAgICBjb25zdCBwb3MgPSBuZXcgdGhpcygpO1xuICAgICAgICBwb3MucmVzZXQoKTtcbiAgICAgICAgcmV0dXJuIHBvcztcbiAgICB9XG4gICAgc3RhdGljIGZyb21TZXR1cChzZXR1cCkge1xuICAgICAgICBjb25zdCBwb3MgPSBuZXcgdGhpcygpO1xuICAgICAgICBwb3Muc2V0dXBVbmNoZWNrZWQoc2V0dXApO1xuICAgICAgICByZXR1cm4gcG9zLnZhbGlkYXRlKCkubWFwKF8gPT4gcG9zKTtcbiAgICB9XG4gICAgY2xvbmUoKSB7XG4gICAgICAgIHJldHVybiBzdXBlci5jbG9uZSgpO1xuICAgIH1cbiAgICB2YWxpZGF0ZSgpIHtcbiAgICAgICAgLy8gTGlrZSBjaGVzcywgYnV0IGFsbG93IG91ciBraW5nIHRvIGJlIG1pc3NpbmcuXG4gICAgICAgIGlmICh0aGlzLmJvYXJkLm9jY3VwaWVkLmlzRW1wdHkoKSlcbiAgICAgICAgICAgIHJldHVybiBSZXN1bHQuZXJyKG5ldyBQb3NpdGlvbkVycm9yKElsbGVnYWxTZXR1cC5FbXB0eSkpO1xuICAgICAgICBpZiAodGhpcy5ib2FyZC5raW5nLnNpemUoKSA+IDIpXG4gICAgICAgICAgICByZXR1cm4gUmVzdWx0LmVycihuZXcgUG9zaXRpb25FcnJvcihJbGxlZ2FsU2V0dXAuS2luZ3MpKTtcbiAgICAgICAgY29uc3Qgb3RoZXJLaW5nID0gdGhpcy5ib2FyZC5raW5nT2Yob3Bwb3NpdGUodGhpcy50dXJuKSk7XG4gICAgICAgIGlmICghZGVmaW5lZChvdGhlcktpbmcpKVxuICAgICAgICAgICAgcmV0dXJuIFJlc3VsdC5lcnIobmV3IFBvc2l0aW9uRXJyb3IoSWxsZWdhbFNldHVwLktpbmdzKSk7XG4gICAgICAgIGlmICh0aGlzLmtpbmdBdHRhY2tlcnMob3RoZXJLaW5nLCB0aGlzLnR1cm4sIHRoaXMuYm9hcmQub2NjdXBpZWQpLm5vbkVtcHR5KCkpIHtcbiAgICAgICAgICAgIHJldHVybiBSZXN1bHQuZXJyKG5ldyBQb3NpdGlvbkVycm9yKElsbGVnYWxTZXR1cC5PcHBvc2l0ZUNoZWNrKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKFNxdWFyZVNldC5iYWNrcmFua3MoKS5pbnRlcnNlY3RzKHRoaXMuYm9hcmQucGF3bikpIHtcbiAgICAgICAgICAgIHJldHVybiBSZXN1bHQuZXJyKG5ldyBQb3NpdGlvbkVycm9yKElsbGVnYWxTZXR1cC5QYXduc09uQmFja3JhbmspKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gUmVzdWx0Lm9rKHVuZGVmaW5lZCk7XG4gICAgfVxuICAgIGtpbmdBdHRhY2tlcnMoc3F1YXJlLCBhdHRhY2tlciwgb2NjdXBpZWQpIHtcbiAgICAgICAgY29uc3QgYXR0YWNrZXJLaW5ncyA9IHRoaXMuYm9hcmQucGllY2VzKGF0dGFja2VyLCAna2luZycpO1xuICAgICAgICBpZiAoYXR0YWNrZXJLaW5ncy5pc0VtcHR5KCkgfHwga2luZ0F0dGFja3Moc3F1YXJlKS5pbnRlcnNlY3RzKGF0dGFja2VyS2luZ3MpKSB7XG4gICAgICAgICAgICByZXR1cm4gU3F1YXJlU2V0LmVtcHR5KCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHN1cGVyLmtpbmdBdHRhY2tlcnMoc3F1YXJlLCBhdHRhY2tlciwgb2NjdXBpZWQpO1xuICAgIH1cbiAgICBwbGF5Q2FwdHVyZUF0KHNxdWFyZSwgY2FwdHVyZWQpIHtcbiAgICAgICAgc3VwZXIucGxheUNhcHR1cmVBdChzcXVhcmUsIGNhcHR1cmVkKTtcbiAgICAgICAgdGhpcy5ib2FyZC50YWtlKHNxdWFyZSk7XG4gICAgICAgIGZvciAoY29uc3QgZXhwbG9kZSBvZiBraW5nQXR0YWNrcyhzcXVhcmUpLmludGVyc2VjdCh0aGlzLmJvYXJkLm9jY3VwaWVkKS5kaWZmKHRoaXMuYm9hcmQucGF3bikpIHtcbiAgICAgICAgICAgIGNvbnN0IHBpZWNlID0gdGhpcy5ib2FyZC50YWtlKGV4cGxvZGUpO1xuICAgICAgICAgICAgaWYgKChwaWVjZSA9PT0gbnVsbCB8fCBwaWVjZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogcGllY2Uucm9sZSkgPT09ICdyb29rJylcbiAgICAgICAgICAgICAgICB0aGlzLmNhc3RsZXMuZGlzY2FyZFJvb2soZXhwbG9kZSk7XG4gICAgICAgICAgICBpZiAoKHBpZWNlID09PSBudWxsIHx8IHBpZWNlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwaWVjZS5yb2xlKSA9PT0gJ2tpbmcnKVxuICAgICAgICAgICAgICAgIHRoaXMuY2FzdGxlcy5kaXNjYXJkQ29sb3IocGllY2UuY29sb3IpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGhhc0luc3VmZmljaWVudE1hdGVyaWFsKGNvbG9yKSB7XG4gICAgICAgIC8vIFJlbWFpbmluZyBtYXRlcmlhbCBkb2VzIG5vdCBtYXR0ZXIgaWYgdGhlIGVuZW15IGtpbmcgaXMgYWxyZWFkeVxuICAgICAgICAvLyBleHBsb2RlZC5cbiAgICAgICAgaWYgKHRoaXMuYm9hcmQucGllY2VzKG9wcG9zaXRlKGNvbG9yKSwgJ2tpbmcnKS5pc0VtcHR5KCkpXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIC8vIEJhcmUga2luZyBjYW5ub3QgbWF0ZS5cbiAgICAgICAgaWYgKHRoaXMuYm9hcmRbY29sb3JdLmRpZmYodGhpcy5ib2FyZC5raW5nKS5pc0VtcHR5KCkpXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgLy8gQXMgbG9uZyBhcyB0aGUgZW5lbXkga2luZyBpcyBub3QgYWxvbmUsIHRoZXJlIGlzIGFsd2F5cyBhIGNoYW5jZSB0aGVpclxuICAgICAgICAvLyBvd24gcGllY2VzIGV4cGxvZGUgbmV4dCB0byBpdC5cbiAgICAgICAgaWYgKHRoaXMuYm9hcmRbb3Bwb3NpdGUoY29sb3IpXS5kaWZmKHRoaXMuYm9hcmQua2luZykubm9uRW1wdHkoKSkge1xuICAgICAgICAgICAgLy8gVW5sZXNzIHRoZXJlIGFyZSBvbmx5IGJpc2hvcHMgdGhhdCBjYW5ub3QgZXhwbG9kZSBlYWNoIG90aGVyLlxuICAgICAgICAgICAgaWYgKHRoaXMuYm9hcmQub2NjdXBpZWQuZXF1YWxzKHRoaXMuYm9hcmQuYmlzaG9wLnVuaW9uKHRoaXMuYm9hcmQua2luZykpKSB7XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmJvYXJkLmJpc2hvcC5pbnRlcnNlY3QodGhpcy5ib2FyZC53aGl0ZSkuaW50ZXJzZWN0cyhTcXVhcmVTZXQuZGFya1NxdWFyZXMoKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICF0aGlzLmJvYXJkLmJpc2hvcC5pbnRlcnNlY3QodGhpcy5ib2FyZC5ibGFjaykuaW50ZXJzZWN0cyhTcXVhcmVTZXQubGlnaHRTcXVhcmVzKCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuYm9hcmQuYmlzaG9wLmludGVyc2VjdCh0aGlzLmJvYXJkLndoaXRlKS5pbnRlcnNlY3RzKFNxdWFyZVNldC5saWdodFNxdWFyZXMoKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICF0aGlzLmJvYXJkLmJpc2hvcC5pbnRlcnNlY3QodGhpcy5ib2FyZC5ibGFjaykuaW50ZXJzZWN0cyhTcXVhcmVTZXQuZGFya1NxdWFyZXMoKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIC8vIFF1ZWVuIG9yIHBhd24gKGZ1dHVyZSBxdWVlbikgY2FuIGdpdmUgbWF0ZSBhZ2FpbnN0IGJhcmUga2luZy5cbiAgICAgICAgaWYgKHRoaXMuYm9hcmQucXVlZW4ubm9uRW1wdHkoKSB8fCB0aGlzLmJvYXJkLnBhd24ubm9uRW1wdHkoKSlcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgLy8gU2luZ2xlIGtuaWdodCwgYmlzaG9wIG9yIHJvb2sgY2Fubm90IG1hdGUgYWdhaW5zdCBiYXJlIGtpbmcuXG4gICAgICAgIGlmICh0aGlzLmJvYXJkLmtuaWdodC51bmlvbih0aGlzLmJvYXJkLmJpc2hvcCkudW5pb24odGhpcy5ib2FyZC5yb29rKS5zaXplKCkgPT09IDEpXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgLy8gSWYgb25seSBrbmlnaHRzLCBtb3JlIHRoYW4gdHdvIGFyZSByZXF1aXJlZCB0byBtYXRlIGJhcmUga2luZy5cbiAgICAgICAgaWYgKHRoaXMuYm9hcmQub2NjdXBpZWQuZXF1YWxzKHRoaXMuYm9hcmQua25pZ2h0LnVuaW9uKHRoaXMuYm9hcmQua2luZykpKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5ib2FyZC5rbmlnaHQuc2l6ZSgpIDw9IDI7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBkZXN0cyhzcXVhcmUsIGN0eCkge1xuICAgICAgICBjdHggPSBjdHggfHwgdGhpcy5jdHgoKTtcbiAgICAgICAgbGV0IGRlc3RzID0gU3F1YXJlU2V0LmVtcHR5KCk7XG4gICAgICAgIGZvciAoY29uc3QgdG8gb2YgcHNldWRvRGVzdHModGhpcywgc3F1YXJlLCBjdHgpKSB7XG4gICAgICAgICAgICBjb25zdCBhZnRlciA9IHRoaXMuY2xvbmUoKTtcbiAgICAgICAgICAgIGFmdGVyLnBsYXkoeyBmcm9tOiBzcXVhcmUsIHRvIH0pO1xuICAgICAgICAgICAgY29uc3Qgb3VyS2luZyA9IGFmdGVyLmJvYXJkLmtpbmdPZih0aGlzLnR1cm4pO1xuICAgICAgICAgICAgaWYgKGRlZmluZWQob3VyS2luZylcbiAgICAgICAgICAgICAgICAmJiAoIWRlZmluZWQoYWZ0ZXIuYm9hcmQua2luZ09mKGFmdGVyLnR1cm4pKVxuICAgICAgICAgICAgICAgICAgICB8fCBhZnRlci5raW5nQXR0YWNrZXJzKG91cktpbmcsIGFmdGVyLnR1cm4sIGFmdGVyLmJvYXJkLm9jY3VwaWVkKS5pc0VtcHR5KCkpKSB7XG4gICAgICAgICAgICAgICAgZGVzdHMgPSBkZXN0cy53aXRoKHRvKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZGVzdHM7XG4gICAgfVxuICAgIGlzVmFyaWFudEVuZCgpIHtcbiAgICAgICAgcmV0dXJuICEhdGhpcy52YXJpYW50T3V0Y29tZSgpO1xuICAgIH1cbiAgICB2YXJpYW50T3V0Y29tZShfY3R4KSB7XG4gICAgICAgIGZvciAoY29uc3QgY29sb3Igb2YgQ09MT1JTKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5ib2FyZC5waWVjZXMoY29sb3IsICdraW5nJykuaXNFbXB0eSgpKVxuICAgICAgICAgICAgICAgIHJldHVybiB7IHdpbm5lcjogb3Bwb3NpdGUoY29sb3IpIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbn1cbmV4cG9ydCBjbGFzcyBBbnRpY2hlc3MgZXh0ZW5kcyBQb3NpdGlvbiB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKCdhbnRpY2hlc3MnKTtcbiAgICB9XG4gICAgcmVzZXQoKSB7XG4gICAgICAgIHN1cGVyLnJlc2V0KCk7XG4gICAgICAgIHRoaXMuY2FzdGxlcyA9IENhc3RsZXMuZW1wdHkoKTtcbiAgICB9XG4gICAgc2V0dXBVbmNoZWNrZWQoc2V0dXApIHtcbiAgICAgICAgc3VwZXIuc2V0dXBVbmNoZWNrZWQoc2V0dXApO1xuICAgICAgICB0aGlzLmNhc3RsZXMgPSBDYXN0bGVzLmVtcHR5KCk7XG4gICAgfVxuICAgIHN0YXRpYyBkZWZhdWx0KCkge1xuICAgICAgICBjb25zdCBwb3MgPSBuZXcgdGhpcygpO1xuICAgICAgICBwb3MucmVzZXQoKTtcbiAgICAgICAgcmV0dXJuIHBvcztcbiAgICB9XG4gICAgc3RhdGljIGZyb21TZXR1cChzZXR1cCkge1xuICAgICAgICBjb25zdCBwb3MgPSBuZXcgdGhpcygpO1xuICAgICAgICBwb3Muc2V0dXBVbmNoZWNrZWQoc2V0dXApO1xuICAgICAgICByZXR1cm4gcG9zLnZhbGlkYXRlKCkubWFwKF8gPT4gcG9zKTtcbiAgICB9XG4gICAgY2xvbmUoKSB7XG4gICAgICAgIHJldHVybiBzdXBlci5jbG9uZSgpO1xuICAgIH1cbiAgICB2YWxpZGF0ZSgpIHtcbiAgICAgICAgaWYgKHRoaXMuYm9hcmQub2NjdXBpZWQuaXNFbXB0eSgpKVxuICAgICAgICAgICAgcmV0dXJuIFJlc3VsdC5lcnIobmV3IFBvc2l0aW9uRXJyb3IoSWxsZWdhbFNldHVwLkVtcHR5KSk7XG4gICAgICAgIGlmIChTcXVhcmVTZXQuYmFja3JhbmtzKCkuaW50ZXJzZWN0cyh0aGlzLmJvYXJkLnBhd24pKSB7XG4gICAgICAgICAgICByZXR1cm4gUmVzdWx0LmVycihuZXcgUG9zaXRpb25FcnJvcihJbGxlZ2FsU2V0dXAuUGF3bnNPbkJhY2tyYW5rKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFJlc3VsdC5vayh1bmRlZmluZWQpO1xuICAgIH1cbiAgICBraW5nQXR0YWNrZXJzKF9zcXVhcmUsIF9hdHRhY2tlciwgX29jY3VwaWVkKSB7XG4gICAgICAgIHJldHVybiBTcXVhcmVTZXQuZW1wdHkoKTtcbiAgICB9XG4gICAgY3R4KCkge1xuICAgICAgICBjb25zdCBjdHggPSBzdXBlci5jdHgoKTtcbiAgICAgICAgaWYgKGRlZmluZWQodGhpcy5lcFNxdWFyZSlcbiAgICAgICAgICAgICYmIHBhd25BdHRhY2tzKG9wcG9zaXRlKHRoaXMudHVybiksIHRoaXMuZXBTcXVhcmUpLmludGVyc2VjdHModGhpcy5ib2FyZC5waWVjZXModGhpcy50dXJuLCAncGF3bicpKSkge1xuICAgICAgICAgICAgY3R4Lm11c3RDYXB0dXJlID0gdHJ1ZTtcbiAgICAgICAgICAgIHJldHVybiBjdHg7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZW5lbXkgPSB0aGlzLmJvYXJkW29wcG9zaXRlKHRoaXMudHVybildO1xuICAgICAgICBmb3IgKGNvbnN0IGZyb20gb2YgdGhpcy5ib2FyZFt0aGlzLnR1cm5dKSB7XG4gICAgICAgICAgICBpZiAocHNldWRvRGVzdHModGhpcywgZnJvbSwgY3R4KS5pbnRlcnNlY3RzKGVuZW15KSkge1xuICAgICAgICAgICAgICAgIGN0eC5tdXN0Q2FwdHVyZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGN0eDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY3R4O1xuICAgIH1cbiAgICBkZXN0cyhzcXVhcmUsIGN0eCkge1xuICAgICAgICBjdHggPSBjdHggfHwgdGhpcy5jdHgoKTtcbiAgICAgICAgY29uc3QgZGVzdHMgPSBwc2V1ZG9EZXN0cyh0aGlzLCBzcXVhcmUsIGN0eCk7XG4gICAgICAgIGNvbnN0IGVuZW15ID0gdGhpcy5ib2FyZFtvcHBvc2l0ZSh0aGlzLnR1cm4pXTtcbiAgICAgICAgcmV0dXJuIGRlc3RzLmludGVyc2VjdChjdHgubXVzdENhcHR1cmVcbiAgICAgICAgICAgID8gZGVmaW5lZCh0aGlzLmVwU3F1YXJlKSAmJiB0aGlzLmJvYXJkLmdldFJvbGUoc3F1YXJlKSA9PT0gJ3Bhd24nXG4gICAgICAgICAgICAgICAgPyBlbmVteS53aXRoKHRoaXMuZXBTcXVhcmUpXG4gICAgICAgICAgICAgICAgOiBlbmVteVxuICAgICAgICAgICAgOiBTcXVhcmVTZXQuZnVsbCgpKTtcbiAgICB9XG4gICAgaGFzSW5zdWZmaWNpZW50TWF0ZXJpYWwoY29sb3IpIHtcbiAgICAgICAgaWYgKHRoaXMuYm9hcmRbY29sb3JdLmlzRW1wdHkoKSlcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgaWYgKHRoaXMuYm9hcmRbb3Bwb3NpdGUoY29sb3IpXS5pc0VtcHR5KCkpXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgaWYgKHRoaXMuYm9hcmQub2NjdXBpZWQuZXF1YWxzKHRoaXMuYm9hcmQuYmlzaG9wKSkge1xuICAgICAgICAgICAgY29uc3Qgd2VTb21lT25MaWdodCA9IHRoaXMuYm9hcmRbY29sb3JdLmludGVyc2VjdHMoU3F1YXJlU2V0LmxpZ2h0U3F1YXJlcygpKTtcbiAgICAgICAgICAgIGNvbnN0IHdlU29tZU9uRGFyayA9IHRoaXMuYm9hcmRbY29sb3JdLmludGVyc2VjdHMoU3F1YXJlU2V0LmRhcmtTcXVhcmVzKCkpO1xuICAgICAgICAgICAgY29uc3QgdGhleUFsbE9uRGFyayA9IHRoaXMuYm9hcmRbb3Bwb3NpdGUoY29sb3IpXS5pc0Rpc2pvaW50KFNxdWFyZVNldC5saWdodFNxdWFyZXMoKSk7XG4gICAgICAgICAgICBjb25zdCB0aGV5QWxsT25MaWdodCA9IHRoaXMuYm9hcmRbb3Bwb3NpdGUoY29sb3IpXS5pc0Rpc2pvaW50KFNxdWFyZVNldC5kYXJrU3F1YXJlcygpKTtcbiAgICAgICAgICAgIHJldHVybiAod2VTb21lT25MaWdodCAmJiB0aGV5QWxsT25EYXJrKSB8fCAod2VTb21lT25EYXJrICYmIHRoZXlBbGxPbkxpZ2h0KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5ib2FyZC5vY2N1cGllZC5lcXVhbHModGhpcy5ib2FyZC5rbmlnaHQpICYmIHRoaXMuYm9hcmQub2NjdXBpZWQuc2l6ZSgpID09PSAyKSB7XG4gICAgICAgICAgICByZXR1cm4gKCh0aGlzLmJvYXJkLndoaXRlLmludGVyc2VjdHMoU3F1YXJlU2V0LmxpZ2h0U3F1YXJlcygpKVxuICAgICAgICAgICAgICAgICE9PSB0aGlzLmJvYXJkLmJsYWNrLmludGVyc2VjdHMoU3F1YXJlU2V0LmRhcmtTcXVhcmVzKCkpKVxuICAgICAgICAgICAgICAgICE9PSAodGhpcy50dXJuID09PSBjb2xvcikpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgaXNWYXJpYW50RW5kKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5ib2FyZFt0aGlzLnR1cm5dLmlzRW1wdHkoKTtcbiAgICB9XG4gICAgdmFyaWFudE91dGNvbWUoY3R4KSB7XG4gICAgICAgIGN0eCA9IGN0eCB8fCB0aGlzLmN0eCgpO1xuICAgICAgICBpZiAoY3R4LnZhcmlhbnRFbmQgfHwgdGhpcy5pc1N0YWxlbWF0ZShjdHgpKSB7XG4gICAgICAgICAgICByZXR1cm4geyB3aW5uZXI6IHRoaXMudHVybiB9O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybjtcbiAgICB9XG59XG5leHBvcnQgY2xhc3MgS2luZ09mVGhlSGlsbCBleHRlbmRzIFBvc2l0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoJ2tpbmdvZnRoZWhpbGwnKTtcbiAgICB9XG4gICAgc3RhdGljIGRlZmF1bHQoKSB7XG4gICAgICAgIGNvbnN0IHBvcyA9IG5ldyB0aGlzKCk7XG4gICAgICAgIHBvcy5yZXNldCgpO1xuICAgICAgICByZXR1cm4gcG9zO1xuICAgIH1cbiAgICBzdGF0aWMgZnJvbVNldHVwKHNldHVwKSB7XG4gICAgICAgIGNvbnN0IHBvcyA9IG5ldyB0aGlzKCk7XG4gICAgICAgIHBvcy5zZXR1cFVuY2hlY2tlZChzZXR1cCk7XG4gICAgICAgIHJldHVybiBwb3MudmFsaWRhdGUoKS5tYXAoXyA9PiBwb3MpO1xuICAgIH1cbiAgICBjbG9uZSgpIHtcbiAgICAgICAgcmV0dXJuIHN1cGVyLmNsb25lKCk7XG4gICAgfVxuICAgIGhhc0luc3VmZmljaWVudE1hdGVyaWFsKF9jb2xvcikge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGlzVmFyaWFudEVuZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYm9hcmQua2luZy5pbnRlcnNlY3RzKFNxdWFyZVNldC5jZW50ZXIoKSk7XG4gICAgfVxuICAgIHZhcmlhbnRPdXRjb21lKF9jdHgpIHtcbiAgICAgICAgZm9yIChjb25zdCBjb2xvciBvZiBDT0xPUlMpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmJvYXJkLnBpZWNlcyhjb2xvciwgJ2tpbmcnKS5pbnRlcnNlY3RzKFNxdWFyZVNldC5jZW50ZXIoKSkpXG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgd2lubmVyOiBjb2xvciB9O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybjtcbiAgICB9XG59XG5leHBvcnQgY2xhc3MgVGhyZWVDaGVjayBleHRlbmRzIFBvc2l0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoJzNjaGVjaycpO1xuICAgIH1cbiAgICByZXNldCgpIHtcbiAgICAgICAgc3VwZXIucmVzZXQoKTtcbiAgICAgICAgdGhpcy5yZW1haW5pbmdDaGVja3MgPSBSZW1haW5pbmdDaGVja3MuZGVmYXVsdCgpO1xuICAgIH1cbiAgICBzZXR1cFVuY2hlY2tlZChzZXR1cCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIHN1cGVyLnNldHVwVW5jaGVja2VkKHNldHVwKTtcbiAgICAgICAgdGhpcy5yZW1haW5pbmdDaGVja3MgPSAoKF9hID0gc2V0dXAucmVtYWluaW5nQ2hlY2tzKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuY2xvbmUoKSkgfHwgUmVtYWluaW5nQ2hlY2tzLmRlZmF1bHQoKTtcbiAgICB9XG4gICAgc3RhdGljIGRlZmF1bHQoKSB7XG4gICAgICAgIGNvbnN0IHBvcyA9IG5ldyB0aGlzKCk7XG4gICAgICAgIHBvcy5yZXNldCgpO1xuICAgICAgICByZXR1cm4gcG9zO1xuICAgIH1cbiAgICBzdGF0aWMgZnJvbVNldHVwKHNldHVwKSB7XG4gICAgICAgIGNvbnN0IHBvcyA9IG5ldyB0aGlzKCk7XG4gICAgICAgIHBvcy5zZXR1cFVuY2hlY2tlZChzZXR1cCk7XG4gICAgICAgIHJldHVybiBwb3MudmFsaWRhdGUoKS5tYXAoXyA9PiBwb3MpO1xuICAgIH1cbiAgICBjbG9uZSgpIHtcbiAgICAgICAgcmV0dXJuIHN1cGVyLmNsb25lKCk7XG4gICAgfVxuICAgIGhhc0luc3VmZmljaWVudE1hdGVyaWFsKGNvbG9yKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmJvYXJkLnBpZWNlcyhjb2xvciwgJ2tpbmcnKS5lcXVhbHModGhpcy5ib2FyZFtjb2xvcl0pO1xuICAgIH1cbiAgICBpc1ZhcmlhbnRFbmQoKSB7XG4gICAgICAgIHJldHVybiAhIXRoaXMucmVtYWluaW5nQ2hlY2tzICYmICh0aGlzLnJlbWFpbmluZ0NoZWNrcy53aGl0ZSA8PSAwIHx8IHRoaXMucmVtYWluaW5nQ2hlY2tzLmJsYWNrIDw9IDApO1xuICAgIH1cbiAgICB2YXJpYW50T3V0Y29tZShfY3R4KSB7XG4gICAgICAgIGlmICh0aGlzLnJlbWFpbmluZ0NoZWNrcykge1xuICAgICAgICAgICAgZm9yIChjb25zdCBjb2xvciBvZiBDT0xPUlMpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5yZW1haW5pbmdDaGVja3NbY29sb3JdIDw9IDApXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7IHdpbm5lcjogY29sb3IgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm47XG4gICAgfVxufVxuY29uc3QgcmFjaW5nS2luZ3NCb2FyZCA9ICgpID0+IHtcbiAgICBjb25zdCBib2FyZCA9IEJvYXJkLmVtcHR5KCk7XG4gICAgYm9hcmQub2NjdXBpZWQgPSBuZXcgU3F1YXJlU2V0KDB4ZmZmZiwgMCk7XG4gICAgYm9hcmQucHJvbW90ZWQgPSBTcXVhcmVTZXQuZW1wdHkoKTtcbiAgICBib2FyZC53aGl0ZSA9IG5ldyBTcXVhcmVTZXQoMHhmMGYwLCAwKTtcbiAgICBib2FyZC5ibGFjayA9IG5ldyBTcXVhcmVTZXQoMHgwZjBmLCAwKTtcbiAgICBib2FyZC5wYXduID0gU3F1YXJlU2V0LmVtcHR5KCk7XG4gICAgYm9hcmQua25pZ2h0ID0gbmV3IFNxdWFyZVNldCgweDE4MTgsIDApO1xuICAgIGJvYXJkLmJpc2hvcCA9IG5ldyBTcXVhcmVTZXQoMHgyNDI0LCAwKTtcbiAgICBib2FyZC5yb29rID0gbmV3IFNxdWFyZVNldCgweDQyNDIsIDApO1xuICAgIGJvYXJkLnF1ZWVuID0gbmV3IFNxdWFyZVNldCgweDAwODEsIDApO1xuICAgIGJvYXJkLmtpbmcgPSBuZXcgU3F1YXJlU2V0KDB4ODEwMCwgMCk7XG4gICAgcmV0dXJuIGJvYXJkO1xufTtcbmV4cG9ydCBjbGFzcyBSYWNpbmdLaW5ncyBleHRlbmRzIFBvc2l0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoJ3JhY2luZ2tpbmdzJyk7XG4gICAgfVxuICAgIHJlc2V0KCkge1xuICAgICAgICB0aGlzLmJvYXJkID0gcmFjaW5nS2luZ3NCb2FyZCgpO1xuICAgICAgICB0aGlzLnBvY2tldHMgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMudHVybiA9ICd3aGl0ZSc7XG4gICAgICAgIHRoaXMuY2FzdGxlcyA9IENhc3RsZXMuZW1wdHkoKTtcbiAgICAgICAgdGhpcy5lcFNxdWFyZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5yZW1haW5pbmdDaGVja3MgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuaGFsZm1vdmVzID0gMDtcbiAgICAgICAgdGhpcy5mdWxsbW92ZXMgPSAxO1xuICAgIH1cbiAgICBzZXR1cFVuY2hlY2tlZChzZXR1cCkge1xuICAgICAgICBzdXBlci5zZXR1cFVuY2hlY2tlZChzZXR1cCk7XG4gICAgICAgIHRoaXMuY2FzdGxlcyA9IENhc3RsZXMuZW1wdHkoKTtcbiAgICB9XG4gICAgc3RhdGljIGRlZmF1bHQoKSB7XG4gICAgICAgIGNvbnN0IHBvcyA9IG5ldyB0aGlzKCk7XG4gICAgICAgIHBvcy5yZXNldCgpO1xuICAgICAgICByZXR1cm4gcG9zO1xuICAgIH1cbiAgICBzdGF0aWMgZnJvbVNldHVwKHNldHVwKSB7XG4gICAgICAgIGNvbnN0IHBvcyA9IG5ldyB0aGlzKCk7XG4gICAgICAgIHBvcy5zZXR1cFVuY2hlY2tlZChzZXR1cCk7XG4gICAgICAgIHJldHVybiBwb3MudmFsaWRhdGUoKS5tYXAoXyA9PiBwb3MpO1xuICAgIH1cbiAgICBjbG9uZSgpIHtcbiAgICAgICAgcmV0dXJuIHN1cGVyLmNsb25lKCk7XG4gICAgfVxuICAgIHZhbGlkYXRlKCkge1xuICAgICAgICBpZiAodGhpcy5pc0NoZWNrKCkgfHwgdGhpcy5ib2FyZC5wYXduLm5vbkVtcHR5KCkpXG4gICAgICAgICAgICByZXR1cm4gUmVzdWx0LmVycihuZXcgUG9zaXRpb25FcnJvcihJbGxlZ2FsU2V0dXAuVmFyaWFudCkpO1xuICAgICAgICByZXR1cm4gc3VwZXIudmFsaWRhdGUoKTtcbiAgICB9XG4gICAgZGVzdHMoc3F1YXJlLCBjdHgpIHtcbiAgICAgICAgY3R4ID0gY3R4IHx8IHRoaXMuY3R4KCk7XG4gICAgICAgIC8vIEtpbmdzIGNhbm5vdCBnaXZlIGNoZWNrLlxuICAgICAgICBpZiAoc3F1YXJlID09PSBjdHgua2luZylcbiAgICAgICAgICAgIHJldHVybiBzdXBlci5kZXN0cyhzcXVhcmUsIGN0eCk7XG4gICAgICAgIC8vIERvIG5vdCBhbGxvdyBnaXZpbmcgY2hlY2suXG4gICAgICAgIGxldCBkZXN0cyA9IFNxdWFyZVNldC5lbXB0eSgpO1xuICAgICAgICBmb3IgKGNvbnN0IHRvIG9mIHN1cGVyLmRlc3RzKHNxdWFyZSwgY3R4KSkge1xuICAgICAgICAgICAgLy8gVmFsaWQsIGJlY2F1c2UgdGhlcmUgYXJlIG5vIHByb21vdGlvbnMgKG9yIGV2ZW4gcGF3bnMpLlxuICAgICAgICAgICAgY29uc3QgbW92ZSA9IHsgZnJvbTogc3F1YXJlLCB0byB9O1xuICAgICAgICAgICAgY29uc3QgYWZ0ZXIgPSB0aGlzLmNsb25lKCk7XG4gICAgICAgICAgICBhZnRlci5wbGF5KG1vdmUpO1xuICAgICAgICAgICAgaWYgKCFhZnRlci5pc0NoZWNrKCkpXG4gICAgICAgICAgICAgICAgZGVzdHMgPSBkZXN0cy53aXRoKHRvKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZGVzdHM7XG4gICAgfVxuICAgIGhhc0luc3VmZmljaWVudE1hdGVyaWFsKF9jb2xvcikge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGlzVmFyaWFudEVuZCgpIHtcbiAgICAgICAgY29uc3QgZ29hbCA9IFNxdWFyZVNldC5mcm9tUmFuayg3KTtcbiAgICAgICAgY29uc3QgaW5Hb2FsID0gdGhpcy5ib2FyZC5raW5nLmludGVyc2VjdChnb2FsKTtcbiAgICAgICAgaWYgKGluR29hbC5pc0VtcHR5KCkpXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIGlmICh0aGlzLnR1cm4gPT09ICd3aGl0ZScgfHwgaW5Hb2FsLmludGVyc2VjdHModGhpcy5ib2FyZC5ibGFjaykpXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgLy8gV2hpdGUgaGFzIHJlYWNoZWQgdGhlIGJhY2tyYW5rLiBDaGVjayBpZiBibGFjayBjYW4gY2F0Y2ggdXAuXG4gICAgICAgIGNvbnN0IGJsYWNrS2luZyA9IHRoaXMuYm9hcmQua2luZ09mKCdibGFjaycpO1xuICAgICAgICBpZiAoZGVmaW5lZChibGFja0tpbmcpKSB7XG4gICAgICAgICAgICBjb25zdCBvY2MgPSB0aGlzLmJvYXJkLm9jY3VwaWVkLndpdGhvdXQoYmxhY2tLaW5nKTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgdGFyZ2V0IG9mIGtpbmdBdHRhY2tzKGJsYWNrS2luZykuaW50ZXJzZWN0KGdvYWwpLmRpZmYodGhpcy5ib2FyZC5ibGFjaykpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5raW5nQXR0YWNrZXJzKHRhcmdldCwgJ3doaXRlJywgb2NjKS5pc0VtcHR5KCkpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgdmFyaWFudE91dGNvbWUoY3R4KSB7XG4gICAgICAgIGlmIChjdHggPyAhY3R4LnZhcmlhbnRFbmQgOiAhdGhpcy5pc1ZhcmlhbnRFbmQoKSlcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgY29uc3QgZ29hbCA9IFNxdWFyZVNldC5mcm9tUmFuayg3KTtcbiAgICAgICAgY29uc3QgYmxhY2tJbkdvYWwgPSB0aGlzLmJvYXJkLnBpZWNlcygnYmxhY2snLCAna2luZycpLmludGVyc2VjdHMoZ29hbCk7XG4gICAgICAgIGNvbnN0IHdoaXRlSW5Hb2FsID0gdGhpcy5ib2FyZC5waWVjZXMoJ3doaXRlJywgJ2tpbmcnKS5pbnRlcnNlY3RzKGdvYWwpO1xuICAgICAgICBpZiAoYmxhY2tJbkdvYWwgJiYgIXdoaXRlSW5Hb2FsKVxuICAgICAgICAgICAgcmV0dXJuIHsgd2lubmVyOiAnYmxhY2snIH07XG4gICAgICAgIGlmICh3aGl0ZUluR29hbCAmJiAhYmxhY2tJbkdvYWwpXG4gICAgICAgICAgICByZXR1cm4geyB3aW5uZXI6ICd3aGl0ZScgfTtcbiAgICAgICAgcmV0dXJuIHsgd2lubmVyOiB1bmRlZmluZWQgfTtcbiAgICB9XG59XG5jb25zdCBob3JkZUJvYXJkID0gKCkgPT4ge1xuICAgIGNvbnN0IGJvYXJkID0gQm9hcmQuZW1wdHkoKTtcbiAgICBib2FyZC5vY2N1cGllZCA9IG5ldyBTcXVhcmVTZXQoNDI5NDk2NzI5NSwgNDI5NDkwMTg2Mik7XG4gICAgYm9hcmQucHJvbW90ZWQgPSBTcXVhcmVTZXQuZW1wdHkoKTtcbiAgICBib2FyZC53aGl0ZSA9IG5ldyBTcXVhcmVTZXQoNDI5NDk2NzI5NSwgMTAyKTtcbiAgICBib2FyZC5ibGFjayA9IG5ldyBTcXVhcmVTZXQoMCwgNDI5NDkwMTc2MCk7XG4gICAgYm9hcmQucGF3biA9IG5ldyBTcXVhcmVTZXQoNDI5NDk2NzI5NSwgMTY3MTE3ODIpO1xuICAgIGJvYXJkLmtuaWdodCA9IG5ldyBTcXVhcmVTZXQoMCwgMTEwNzI5NjI1Nik7XG4gICAgYm9hcmQuYmlzaG9wID0gbmV3IFNxdWFyZVNldCgwLCA2MDM5Nzk3NzYpO1xuICAgIGJvYXJkLnJvb2sgPSBuZXcgU3F1YXJlU2V0KDAsIDIxNjQyNjA4NjQpO1xuICAgIGJvYXJkLnF1ZWVuID0gbmV3IFNxdWFyZVNldCgwLCAxMzQyMTc3MjgpO1xuICAgIGJvYXJkLmtpbmcgPSBuZXcgU3F1YXJlU2V0KDAsIDI2ODQzNTQ1Nik7XG4gICAgcmV0dXJuIGJvYXJkO1xufTtcbmV4cG9ydCBjbGFzcyBIb3JkZSBleHRlbmRzIFBvc2l0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoJ2hvcmRlJyk7XG4gICAgfVxuICAgIHJlc2V0KCkge1xuICAgICAgICB0aGlzLmJvYXJkID0gaG9yZGVCb2FyZCgpO1xuICAgICAgICB0aGlzLnBvY2tldHMgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMudHVybiA9ICd3aGl0ZSc7XG4gICAgICAgIHRoaXMuY2FzdGxlcyA9IENhc3RsZXMuZGVmYXVsdCgpO1xuICAgICAgICB0aGlzLmNhc3RsZXMuZGlzY2FyZENvbG9yKCd3aGl0ZScpO1xuICAgICAgICB0aGlzLmVwU3F1YXJlID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnJlbWFpbmluZ0NoZWNrcyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5oYWxmbW92ZXMgPSAwO1xuICAgICAgICB0aGlzLmZ1bGxtb3ZlcyA9IDE7XG4gICAgfVxuICAgIHN0YXRpYyBkZWZhdWx0KCkge1xuICAgICAgICBjb25zdCBwb3MgPSBuZXcgdGhpcygpO1xuICAgICAgICBwb3MucmVzZXQoKTtcbiAgICAgICAgcmV0dXJuIHBvcztcbiAgICB9XG4gICAgc3RhdGljIGZyb21TZXR1cChzZXR1cCkge1xuICAgICAgICBjb25zdCBwb3MgPSBuZXcgdGhpcygpO1xuICAgICAgICBwb3Muc2V0dXBVbmNoZWNrZWQoc2V0dXApO1xuICAgICAgICByZXR1cm4gcG9zLnZhbGlkYXRlKCkubWFwKF8gPT4gcG9zKTtcbiAgICB9XG4gICAgY2xvbmUoKSB7XG4gICAgICAgIHJldHVybiBzdXBlci5jbG9uZSgpO1xuICAgIH1cbiAgICB2YWxpZGF0ZSgpIHtcbiAgICAgICAgaWYgKHRoaXMuYm9hcmQub2NjdXBpZWQuaXNFbXB0eSgpKVxuICAgICAgICAgICAgcmV0dXJuIFJlc3VsdC5lcnIobmV3IFBvc2l0aW9uRXJyb3IoSWxsZWdhbFNldHVwLkVtcHR5KSk7XG4gICAgICAgIGlmICh0aGlzLmJvYXJkLmtpbmcuc2l6ZSgpICE9PSAxKVxuICAgICAgICAgICAgcmV0dXJuIFJlc3VsdC5lcnIobmV3IFBvc2l0aW9uRXJyb3IoSWxsZWdhbFNldHVwLktpbmdzKSk7XG4gICAgICAgIGNvbnN0IG90aGVyS2luZyA9IHRoaXMuYm9hcmQua2luZ09mKG9wcG9zaXRlKHRoaXMudHVybikpO1xuICAgICAgICBpZiAoZGVmaW5lZChvdGhlcktpbmcpICYmIHRoaXMua2luZ0F0dGFja2VycyhvdGhlcktpbmcsIHRoaXMudHVybiwgdGhpcy5ib2FyZC5vY2N1cGllZCkubm9uRW1wdHkoKSkge1xuICAgICAgICAgICAgcmV0dXJuIFJlc3VsdC5lcnIobmV3IFBvc2l0aW9uRXJyb3IoSWxsZWdhbFNldHVwLk9wcG9zaXRlQ2hlY2spKTtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGNvbnN0IGNvbG9yIG9mIENPTE9SUykge1xuICAgICAgICAgICAgY29uc3QgYmFja3JhbmtzID0gdGhpcy5ib2FyZC5waWVjZXMoY29sb3IsICdraW5nJykuaXNFbXB0eSgpXG4gICAgICAgICAgICAgICAgPyBTcXVhcmVTZXQuYmFja3Jhbmsob3Bwb3NpdGUoY29sb3IpKVxuICAgICAgICAgICAgICAgIDogU3F1YXJlU2V0LmJhY2tyYW5rcygpO1xuICAgICAgICAgICAgaWYgKHRoaXMuYm9hcmQucGllY2VzKGNvbG9yLCAncGF3bicpLmludGVyc2VjdHMoYmFja3JhbmtzKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBSZXN1bHQuZXJyKG5ldyBQb3NpdGlvbkVycm9yKElsbGVnYWxTZXR1cC5QYXduc09uQmFja3JhbmspKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gUmVzdWx0Lm9rKHVuZGVmaW5lZCk7XG4gICAgfVxuICAgIGhhc0luc3VmZmljaWVudE1hdGVyaWFsKGNvbG9yKSB7XG4gICAgICAgIC8vIFRoZSBzaWRlIHdpdGggdGhlIGtpbmcgY2FuIGFsd2F5cyB3aW4gYnkgY2FwdHVyaW5nIHRoZSBob3JkZS5cbiAgICAgICAgaWYgKHRoaXMuYm9hcmQucGllY2VzKGNvbG9yLCAna2luZycpLm5vbkVtcHR5KCkpXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIGNvbnN0IG9wcG9zaXRlU3F1YXJlQ29sb3IgPSAoc3F1YXJlQ29sb3IpID0+IChzcXVhcmVDb2xvciA9PT0gJ2xpZ2h0JyA/ICdkYXJrJyA6ICdsaWdodCcpO1xuICAgICAgICBjb25zdCBjb2xvcmVkU3F1YXJlcyA9IChzcXVhcmVDb2xvcikgPT4gc3F1YXJlQ29sb3IgPT09ICdsaWdodCcgPyBTcXVhcmVTZXQubGlnaHRTcXVhcmVzKCkgOiBTcXVhcmVTZXQuZGFya1NxdWFyZXMoKTtcbiAgICAgICAgY29uc3QgaGFzQmlzaG9wUGFpciA9IChzaWRlKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBiaXNob3BzID0gdGhpcy5ib2FyZC5waWVjZXMoc2lkZSwgJ2Jpc2hvcCcpO1xuICAgICAgICAgICAgcmV0dXJuIGJpc2hvcHMuaW50ZXJzZWN0cyhTcXVhcmVTZXQuZGFya1NxdWFyZXMoKSkgJiYgYmlzaG9wcy5pbnRlcnNlY3RzKFNxdWFyZVNldC5saWdodFNxdWFyZXMoKSk7XG4gICAgICAgIH07XG4gICAgICAgIC8vIEJ5IHRoaXMgcG9pbnQ6IGNvbG9yIGlzIHRoZSBob3JkZS5cbiAgICAgICAgLy8gQmFzZWQgb25cbiAgICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3N0ZXZlcGFwYXppcy9ob3JkZS1pbnN1ZmZpY2llbnQtbWF0ZXJpYWwtdGVzdHMuXG4gICAgICAgIGNvbnN0IGhvcmRlID0gTWF0ZXJpYWxTaWRlLmZyb21Cb2FyZCh0aGlzLmJvYXJkLCBjb2xvcik7XG4gICAgICAgIGNvbnN0IGhvcmRlQmlzaG9wcyA9IChzcXVhcmVDb2xvcikgPT4gY29sb3JlZFNxdWFyZXMoc3F1YXJlQ29sb3IpLmludGVyc2VjdCh0aGlzLmJvYXJkLnBpZWNlcyhjb2xvciwgJ2Jpc2hvcCcpKS5zaXplKCk7XG4gICAgICAgIGNvbnN0IGhvcmRlQmlzaG9wQ29sb3IgPSBob3JkZUJpc2hvcHMoJ2xpZ2h0JykgPj0gMSA/ICdsaWdodCcgOiAnZGFyayc7XG4gICAgICAgIGNvbnN0IGhvcmRlTnVtID0gaG9yZGUucGF3blxuICAgICAgICAgICAgKyBob3JkZS5rbmlnaHRcbiAgICAgICAgICAgICsgaG9yZGUucm9va1xuICAgICAgICAgICAgKyBob3JkZS5xdWVlblxuICAgICAgICAgICAgKyBNYXRoLm1pbihob3JkZUJpc2hvcHMoJ2RhcmsnKSwgMilcbiAgICAgICAgICAgICsgTWF0aC5taW4oaG9yZGVCaXNob3BzKCdsaWdodCcpLCAyKTtcbiAgICAgICAgY29uc3QgcGllY2VzID0gTWF0ZXJpYWxTaWRlLmZyb21Cb2FyZCh0aGlzLmJvYXJkLCBvcHBvc2l0ZShjb2xvcikpO1xuICAgICAgICBjb25zdCBwaWVjZXNCaXNob3BzID0gKHNxdWFyZUNvbG9yKSA9PiBjb2xvcmVkU3F1YXJlcyhzcXVhcmVDb2xvcilcbiAgICAgICAgICAgIC5pbnRlcnNlY3QodGhpcy5ib2FyZC5waWVjZXMob3Bwb3NpdGUoY29sb3IpLCAnYmlzaG9wJykpXG4gICAgICAgICAgICAuc2l6ZSgpO1xuICAgICAgICBjb25zdCBwaWVjZXNOdW0gPSBwaWVjZXMuc2l6ZSgpO1xuICAgICAgICBjb25zdCBwaWVjZXNPZlJvbGVOb3QgPSAocGllY2UpID0+IHBpZWNlc051bSAtIHBpZWNlO1xuICAgICAgICBpZiAoaG9yZGVOdW0gPT09IDApXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgaWYgKGhvcmRlTnVtID49IDQpIHtcbiAgICAgICAgICAgIC8vIEZvdXIgb3IgbW9yZSBwaWVjZXMgY2FuIGFsd2F5cyBkZWxpdmVyIG1hdGUuXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKChob3JkZS5wYXduID49IDEgfHwgaG9yZGUucXVlZW4gPj0gMSkgJiYgaG9yZGVOdW0gPj0gMikge1xuICAgICAgICAgICAgLy8gUGF3bnMvcXVlZW5zIGFyZSBuZXZlciBpbnN1ZmZpY2llbnQgbWF0ZXJpYWwgd2hlbiBwYWlyZWQgd2l0aCBhbnkgb3RoZXJcbiAgICAgICAgICAgIC8vIHBpZWNlIChhIHBhd24gcHJvbW90ZXMgdG8gYSBxdWVlbiBhbmQgZGVsaXZlcnMgbWF0ZSkuXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGhvcmRlLnJvb2sgPj0gMSAmJiBob3JkZU51bSA+PSAyKSB7XG4gICAgICAgICAgICAvLyBBIHJvb2sgaXMgaW5zdWZmaWNpZW50IG1hdGVyaWFsIG9ubHkgd2hlbiBpdCBpcyBwYWlyZWQgd2l0aCBhIGJpc2hvcFxuICAgICAgICAgICAgLy8gYWdhaW5zdCBhIGxvbmUga2luZy4gVGhlIGhvcmRlIGNhbiBtYXRlIGluIGFueSBvdGhlciBjYXNlLlxuICAgICAgICAgICAgLy8gQSByb29rIG9uIEExIGFuZCBhIGJpc2hvcCBvbiBDMyBtYXRlIGEga2luZyBvbiBCMSB3aGVuIHRoZXJlIGlzIGFcbiAgICAgICAgICAgIC8vIGZyaWVuZGx5IHBhd24vb3Bwb3NpdGUtY29sb3ItYmlzaG9wL3Jvb2svcXVlZW4gb24gQzIuXG4gICAgICAgICAgICAvLyBBIHJvb2sgb24gQjggYW5kIGEgYmlzaG9wIEMzIG1hdGUgYSBraW5nIG9uIEExIHdoZW4gdGhlcmUgaXMgYSBmcmllbmRseVxuICAgICAgICAgICAgLy8ga25pZ2h0IG9uIEEyLlxuICAgICAgICAgICAgaWYgKCEoaG9yZGVOdW0gPT09IDJcbiAgICAgICAgICAgICAgICAmJiBob3JkZS5yb29rID09PSAxXG4gICAgICAgICAgICAgICAgJiYgaG9yZGUuYmlzaG9wID09PSAxXG4gICAgICAgICAgICAgICAgJiYgcGllY2VzT2ZSb2xlTm90KHBpZWNlc0Jpc2hvcHMoaG9yZGVCaXNob3BDb2xvcikpID09PSAxKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoaG9yZGVOdW0gPT09IDEpIHtcbiAgICAgICAgICAgIGlmIChwaWVjZXNOdW0gPT09IDEpIHtcbiAgICAgICAgICAgICAgICAvLyBBIGxvbmUgcGllY2UgY2Fubm90IG1hdGUgYSBsb25lIGtpbmcuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChob3JkZS5xdWVlbiA9PT0gMSkge1xuICAgICAgICAgICAgICAgIC8vIFRoZSBob3JkZSBoYXMgYSBsb25lIHF1ZWVuLlxuICAgICAgICAgICAgICAgIC8vIEEgbG9uZSBxdWVlbiBtYXRlcyBhIGtpbmcgb24gQTEgYm91bmRlZCBieTpcbiAgICAgICAgICAgICAgICAvLyAgLS0gYSBwYXduL3Jvb2sgb24gQTJcbiAgICAgICAgICAgICAgICAvLyAgLS0gdHdvIHNhbWUgY29sb3IgYmlzaG9wcyBvbiBBMiwgQjFcbiAgICAgICAgICAgICAgICAvLyBXZSBpZ25vcmUgZXZlcnkgb3RoZXIgbWF0aW5nIGNhc2UsIHNpbmNlIGl0IGNhbiBiZSByZWR1Y2VkIHRvXG4gICAgICAgICAgICAgICAgLy8gdGhlIHR3byBwcmV2aW91cyBjYXNlcyAoZS5nLiBhIGJsYWNrIHBhd24gb24gQTIgYW5kIGEgYmxhY2tcbiAgICAgICAgICAgICAgICAvLyBiaXNob3Agb24gQjEpLlxuICAgICAgICAgICAgICAgIHJldHVybiAhKHBpZWNlcy5wYXduID49IDEgfHwgcGllY2VzLnJvb2sgPj0gMSB8fCBwaWVjZXNCaXNob3BzKCdsaWdodCcpID49IDIgfHwgcGllY2VzQmlzaG9wcygnZGFyaycpID49IDIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoaG9yZGUucGF3biA9PT0gMSkge1xuICAgICAgICAgICAgICAgIC8vIFByb21vdGUgdGhlIHBhd24gdG8gYSBxdWVlbiBvciBhIGtuaWdodCBhbmQgY2hlY2sgd2hldGhlciB3aGl0ZVxuICAgICAgICAgICAgICAgIC8vIGNhbiBtYXRlLlxuICAgICAgICAgICAgICAgIGNvbnN0IHBhd25TcXVhcmUgPSB0aGlzLmJvYXJkLnBpZWNlcyhjb2xvciwgJ3Bhd24nKS5sYXN0KCk7XG4gICAgICAgICAgICAgICAgY29uc3QgcHJvbW90ZVRvUXVlZW4gPSB0aGlzLmNsb25lKCk7XG4gICAgICAgICAgICAgICAgcHJvbW90ZVRvUXVlZW4uYm9hcmQuc2V0KHBhd25TcXVhcmUsIHsgY29sb3IsIHJvbGU6ICdxdWVlbicgfSk7XG4gICAgICAgICAgICAgICAgY29uc3QgcHJvbW90ZVRvS25pZ2h0ID0gdGhpcy5jbG9uZSgpO1xuICAgICAgICAgICAgICAgIHByb21vdGVUb0tuaWdodC5ib2FyZC5zZXQocGF3blNxdWFyZSwgeyBjb2xvciwgcm9sZTogJ2tuaWdodCcgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHByb21vdGVUb1F1ZWVuLmhhc0luc3VmZmljaWVudE1hdGVyaWFsKGNvbG9yKSAmJiBwcm9tb3RlVG9LbmlnaHQuaGFzSW5zdWZmaWNpZW50TWF0ZXJpYWwoY29sb3IpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoaG9yZGUucm9vayA9PT0gMSkge1xuICAgICAgICAgICAgICAgIC8vIEEgbG9uZSByb29rIG1hdGVzIGEga2luZyBvbiBBOCBib3VuZGVkIGJ5IGEgcGF3bi9yb29rIG9uIEE3IGFuZCBhXG4gICAgICAgICAgICAgICAgLy8gcGF3bi9rbmlnaHQgb24gQjcuIFdlIGlnbm9yZSBldmVyeSBvdGhlciBjYXNlLCBzaW5jZSBpdCBjYW4gYmVcbiAgICAgICAgICAgICAgICAvLyByZWR1Y2VkIHRvIHRoZSB0d28gcHJldmlvdXMgY2FzZXMuXG4gICAgICAgICAgICAgICAgLy8gKGUuZy4gdGhyZWUgcGF3bnMgb24gQTcsIEI3LCBDNylcbiAgICAgICAgICAgICAgICByZXR1cm4gIShwaWVjZXMucGF3biA+PSAyXG4gICAgICAgICAgICAgICAgICAgIHx8IChwaWVjZXMucm9vayA+PSAxICYmIHBpZWNlcy5wYXduID49IDEpXG4gICAgICAgICAgICAgICAgICAgIHx8IChwaWVjZXMucm9vayA+PSAxICYmIHBpZWNlcy5rbmlnaHQgPj0gMSlcbiAgICAgICAgICAgICAgICAgICAgfHwgKHBpZWNlcy5wYXduID49IDEgJiYgcGllY2VzLmtuaWdodCA+PSAxKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChob3JkZS5iaXNob3AgPT09IDEpIHtcbiAgICAgICAgICAgICAgICAvLyBUaGUgaG9yZGUgaGFzIGEgbG9uZSBiaXNob3AuXG4gICAgICAgICAgICAgICAgcmV0dXJuICEoXG4gICAgICAgICAgICAgICAgLy8gVGhlIGtpbmcgY2FuIGJlIG1hdGVkIG9uIEExIGlmIHRoZXJlIGlzIGEgcGF3bi9vcHBvc2l0ZS1jb2xvci1iaXNob3BcbiAgICAgICAgICAgICAgICAvLyBvbiBBMiBhbmQgYW4gb3Bwb3NpdGUtY29sb3ItYmlzaG9wIG9uIEIxLlxuICAgICAgICAgICAgICAgIC8vIElmIGJsYWNrIGhhcyB0d28gb3IgbW9yZSBwYXducywgd2hpdGUgZ2V0cyB0aGUgYmVuZWZpdCBvZiB0aGUgZG91YnQ7XG4gICAgICAgICAgICAgICAgLy8gdGhlcmUgaXMgYW4gb3V0c2lkZSBjaGFuY2UgdGhhdCB3aGl0ZSBwcm9tb3RlcyBpdHMgcGF3bnMgdG9cbiAgICAgICAgICAgICAgICAvLyBvcHBvc2l0ZS1jb2xvci1iaXNob3BzIGFuZCBzZWxmbWF0ZXMgdGhlaXJzZWxmLlxuICAgICAgICAgICAgICAgIC8vIEV2ZXJ5IG90aGVyIGNhc2UgdGhhdCB0aGUga2luZyBpcyBtYXRlZCBieSB0aGUgYmlzaG9wIHJlcXVpcmVzIHRoYXRcbiAgICAgICAgICAgICAgICAvLyBibGFjayBoYXMgdHdvIHBhd25zIG9yIHR3byBvcHBvc2l0ZS1jb2xvci1iaXNob3Agb3IgYSBwYXduIGFuZCBhblxuICAgICAgICAgICAgICAgIC8vIG9wcG9zaXRlLWNvbG9yLWJpc2hvcC5cbiAgICAgICAgICAgICAgICAvLyBGb3IgZXhhbXBsZSBhIGtpbmcgb24gQTMgY2FuIGJlIG1hdGVkIGlmIHRoZXJlIGlzXG4gICAgICAgICAgICAgICAgLy8gYSBwYXduL29wcG9zaXRlLWNvbG9yLWJpc2hvcCBvbiBBNCwgYSBwYXduL29wcG9zaXRlLWNvbG9yLWJpc2hvcCBvblxuICAgICAgICAgICAgICAgIC8vIEIzLCBhIHBhd24vYmlzaG9wL3Jvb2svcXVlZW4gb24gQTIgYW5kIGFueSBvdGhlciBwaWVjZSBvbiBCMi5cbiAgICAgICAgICAgICAgICBwaWVjZXNCaXNob3BzKG9wcG9zaXRlU3F1YXJlQ29sb3IoaG9yZGVCaXNob3BDb2xvcikpID49IDJcbiAgICAgICAgICAgICAgICAgICAgfHwgKHBpZWNlc0Jpc2hvcHMob3Bwb3NpdGVTcXVhcmVDb2xvcihob3JkZUJpc2hvcENvbG9yKSkgPj0gMSAmJiBwaWVjZXMucGF3biA+PSAxKVxuICAgICAgICAgICAgICAgICAgICB8fCBwaWVjZXMucGF3biA+PSAyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGhvcmRlLmtuaWdodCA9PT0gMSkge1xuICAgICAgICAgICAgICAgIC8vIFRoZSBob3JkZSBoYXMgYSBsb25lIGtuaWdodC5cbiAgICAgICAgICAgICAgICByZXR1cm4gIShcbiAgICAgICAgICAgICAgICAvLyBUaGUga2luZyBvbiBBMSBjYW4gYmUgc21vdGhlciBtYXRlZCBieSBhIGtuaWdodCBvbiBDMiBpZiB0aGVyZSBpc1xuICAgICAgICAgICAgICAgIC8vIGEgcGF3bi9rbmlnaHQvYmlzaG9wIG9uIEIyLCBhIGtuaWdodC9yb29rIG9uIEIxIGFuZCBhbnkgb3RoZXIgcGllY2VcbiAgICAgICAgICAgICAgICAvLyBvbiBBMi5cbiAgICAgICAgICAgICAgICAvLyBNb3Jlb3Zlciwgd2hlbiBibGFjayBoYXMgZm91ciBvciBtb3JlIHBpZWNlcyBhbmQgdHdvIG9mIHRoZW0gYXJlXG4gICAgICAgICAgICAgICAgLy8gcGF3bnMsIGJsYWNrIGNhbiBwcm9tb3RlIHRoZWlyIHBhd25zIGFuZCBzZWxmbWF0ZSB0aGVpcnNlbGYuXG4gICAgICAgICAgICAgICAgcGllY2VzTnVtID49IDRcbiAgICAgICAgICAgICAgICAgICAgJiYgKHBpZWNlcy5rbmlnaHQgPj0gMlxuICAgICAgICAgICAgICAgICAgICAgICAgfHwgcGllY2VzLnBhd24gPj0gMlxuICAgICAgICAgICAgICAgICAgICAgICAgfHwgKHBpZWNlcy5yb29rID49IDEgJiYgcGllY2VzLmtuaWdodCA+PSAxKVxuICAgICAgICAgICAgICAgICAgICAgICAgfHwgKHBpZWNlcy5yb29rID49IDEgJiYgcGllY2VzLmJpc2hvcCA+PSAxKVxuICAgICAgICAgICAgICAgICAgICAgICAgfHwgKHBpZWNlcy5rbmlnaHQgPj0gMSAmJiBwaWVjZXMuYmlzaG9wID49IDEpXG4gICAgICAgICAgICAgICAgICAgICAgICB8fCAocGllY2VzLnJvb2sgPj0gMSAmJiBwaWVjZXMucGF3biA+PSAxKVxuICAgICAgICAgICAgICAgICAgICAgICAgfHwgKHBpZWNlcy5rbmlnaHQgPj0gMSAmJiBwaWVjZXMucGF3biA+PSAxKVxuICAgICAgICAgICAgICAgICAgICAgICAgfHwgKHBpZWNlcy5iaXNob3AgPj0gMSAmJiBwaWVjZXMucGF3biA+PSAxKVxuICAgICAgICAgICAgICAgICAgICAgICAgfHwgKGhhc0Jpc2hvcFBhaXIob3Bwb3NpdGUoY29sb3IpKSAmJiBwaWVjZXMucGF3biA+PSAxKSlcbiAgICAgICAgICAgICAgICAgICAgJiYgKHBpZWNlc0Jpc2hvcHMoJ2RhcmsnKSA8IDIgfHwgcGllY2VzT2ZSb2xlTm90KHBpZWNlc0Jpc2hvcHMoJ2RhcmsnKSkgPj0gMylcbiAgICAgICAgICAgICAgICAgICAgJiYgKHBpZWNlc0Jpc2hvcHMoJ2xpZ2h0JykgPCAyIHx8IHBpZWNlc09mUm9sZU5vdChwaWVjZXNCaXNob3BzKCdsaWdodCcpKSA+PSAzKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBCeSB0aGlzIHBvaW50LCB3ZSBvbmx5IG5lZWQgdG8gZGVhbCB3aXRoIHdoaXRlJ3MgbWlub3IgcGllY2VzLlxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGhvcmRlTnVtID09PSAyKSB7XG4gICAgICAgICAgICBpZiAocGllY2VzTnVtID09PSAxKSB7XG4gICAgICAgICAgICAgICAgLy8gVHdvIG1pbm9yIHBpZWNlcyBjYW5ub3QgbWF0ZSBhIGxvbmUga2luZy5cbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGhvcmRlLmtuaWdodCA9PT0gMikge1xuICAgICAgICAgICAgICAgIC8vIEEga2luZyBvbiBBMSBpcyBtYXRlZCBieSB0d28ga25pZ2h0cywgaWYgaXQgaXMgb2JzdHJ1Y3RlZCBieSBhXG4gICAgICAgICAgICAgICAgLy8gcGF3bi9iaXNob3Ava25pZ2h0IG9uIEIyLiBPbiB0aGUgb3RoZXIgaGFuZCwgaWYgYmxhY2sgb25seSBoYXNcbiAgICAgICAgICAgICAgICAvLyBtYWpvciBwaWVjZXMgaXQgaXMgYSBkcmF3LlxuICAgICAgICAgICAgICAgIHJldHVybiBwaWVjZXMucGF3biArIHBpZWNlcy5iaXNob3AgKyBwaWVjZXMua25pZ2h0IDwgMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGhhc0Jpc2hvcFBhaXIoY29sb3IpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICEoXG4gICAgICAgICAgICAgICAgLy8gQSBraW5nIG9uIEExIG9ic3RydWN0ZWQgYnkgYSBwYXduL2Jpc2hvcCBvbiBBMiBpcyBtYXRlZFxuICAgICAgICAgICAgICAgIC8vIGJ5IHRoZSBiaXNob3AgcGFpci5cbiAgICAgICAgICAgICAgICBwaWVjZXMucGF3biA+PSAxXG4gICAgICAgICAgICAgICAgICAgIHx8IHBpZWNlcy5iaXNob3AgPj0gMVxuICAgICAgICAgICAgICAgICAgICAvLyBBIHBhd24vYmlzaG9wL2tuaWdodCBvbiBCNCwgYSBwYXduL2Jpc2hvcC9yb29rL3F1ZWVuIG9uXG4gICAgICAgICAgICAgICAgICAgIC8vIEE0IGFuZCB0aGUga2luZyBvbiBBMyBlbmFibGUgQm9kZW4ncyBtYXRlIGJ5IHRoZSBiaXNob3BcbiAgICAgICAgICAgICAgICAgICAgLy8gcGFpci4gSW4gZXZlcnkgb3RoZXIgY2FzZSB3aGl0ZSBjYW5ub3Qgd2luLlxuICAgICAgICAgICAgICAgICAgICB8fCAocGllY2VzLmtuaWdodCA+PSAxICYmIHBpZWNlcy5yb29rICsgcGllY2VzLnF1ZWVuID49IDEpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGhvcmRlLmJpc2hvcCA+PSAxICYmIGhvcmRlLmtuaWdodCA+PSAxKSB7XG4gICAgICAgICAgICAgICAgLy8gVGhlIGhvcmRlIGhhcyBhIGJpc2hvcCBhbmQgYSBrbmlnaHQuXG4gICAgICAgICAgICAgICAgcmV0dXJuICEoXG4gICAgICAgICAgICAgICAgLy8gQSBraW5nIG9uIEExIG9ic3RydWN0ZWQgYnkgYSBwYXduL29wcG9zaXRlLWNvbG9yLWJpc2hvcCBvblxuICAgICAgICAgICAgICAgIC8vIEEyIGlzIG1hdGVkIGJ5IGEga25pZ2h0IG9uIEQyIGFuZCBhIGJpc2hvcCBvbiBDMy5cbiAgICAgICAgICAgICAgICBwaWVjZXMucGF3biA+PSAxXG4gICAgICAgICAgICAgICAgICAgIHx8IHBpZWNlc0Jpc2hvcHMob3Bwb3NpdGVTcXVhcmVDb2xvcihob3JkZUJpc2hvcENvbG9yKSkgPj0gMVxuICAgICAgICAgICAgICAgICAgICAvLyBBIGtpbmcgb24gQTEgYm91bmRlZCBieSB0d28gZnJpZW5kbHkgcGllY2VzIG9uIEEyIGFuZCBCMSBpc1xuICAgICAgICAgICAgICAgICAgICAvLyBtYXRlZCB3aGVuIHRoZSBrbmlnaHQgbW92ZXMgZnJvbSBENCB0byBDMiBzbyB0aGF0IGJvdGggdGhlXG4gICAgICAgICAgICAgICAgICAgIC8vIGtuaWdodCBhbmQgdGhlIGJpc2hvcCBkZWxpdmVyIGNoZWNrLlxuICAgICAgICAgICAgICAgICAgICB8fCBwaWVjZXNPZlJvbGVOb3QocGllY2VzQmlzaG9wcyhob3JkZUJpc2hvcENvbG9yKSkgPj0gMyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBUaGUgaG9yZGUgaGFzIHR3byBvciBtb3JlIGJpc2hvcHMgb24gdGhlIHNhbWUgY29sb3IuXG4gICAgICAgICAgICAgICAgLy8gV2hpdGUgY2FuIG9ubHkgd2luIGlmIGJsYWNrIGhhcyBlbm91Z2ggbWF0ZXJpYWwgdG8gb2JzdHJ1Y3RcbiAgICAgICAgICAgICAgICAvLyB0aGUgc3F1YXJlcyBvZiB0aGUgb3Bwb3NpdGUgY29sb3IgYXJvdW5kIHRoZSBraW5nLlxuICAgICAgICAgICAgICAgIHJldHVybiAhKFxuICAgICAgICAgICAgICAgIC8vIEEga2luZyBvbiBBMSBvYnN0cnVjdGVkIGJ5IGEgcGF3bi9vcHBvc2l0ZS1iaXNob3Ava25pZ2h0XG4gICAgICAgICAgICAgICAgLy8gb24gQTIgYW5kIGEgb3Bwb3NpdGUtYmlzaG9wL2tuaWdodCBvbiBCMSBpcyBtYXRlZCBieSB0d29cbiAgICAgICAgICAgICAgICAvLyBiaXNob3BzIG9uIEIyIGFuZCBDMy4gVGhpcyBwb3NpdGlvbiBpcyB0aGVvcmV0aWNhbGx5XG4gICAgICAgICAgICAgICAgLy8gYWNoaWV2YWJsZSBldmVuIHdoZW4gYmxhY2sgaGFzIHR3byBwYXducyBvciB3aGVuIHRoZXlcbiAgICAgICAgICAgICAgICAvLyBoYXZlIGEgcGF3biBhbmQgYW4gb3Bwb3NpdGUgY29sb3IgYmlzaG9wLlxuICAgICAgICAgICAgICAgIChwaWVjZXMucGF3biA+PSAxICYmIHBpZWNlc0Jpc2hvcHMob3Bwb3NpdGVTcXVhcmVDb2xvcihob3JkZUJpc2hvcENvbG9yKSkgPj0gMSlcbiAgICAgICAgICAgICAgICAgICAgfHwgKHBpZWNlcy5wYXduID49IDEgJiYgcGllY2VzLmtuaWdodCA+PSAxKVxuICAgICAgICAgICAgICAgICAgICB8fCAocGllY2VzQmlzaG9wcyhvcHBvc2l0ZVNxdWFyZUNvbG9yKGhvcmRlQmlzaG9wQ29sb3IpKSA+PSAxICYmIHBpZWNlcy5rbmlnaHQgPj0gMSlcbiAgICAgICAgICAgICAgICAgICAgfHwgcGllY2VzQmlzaG9wcyhvcHBvc2l0ZVNxdWFyZUNvbG9yKGhvcmRlQmlzaG9wQ29sb3IpKSA+PSAyXG4gICAgICAgICAgICAgICAgICAgIHx8IHBpZWNlcy5rbmlnaHQgPj0gMlxuICAgICAgICAgICAgICAgICAgICB8fCBwaWVjZXMucGF3biA+PSAyXG4gICAgICAgICAgICAgICAgLy8gSW4gZXZlcnkgb3RoZXIgY2FzZSwgd2hpdGUgY2FuIG9ubHkgZHJhdy5cbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGhvcmRlTnVtID09PSAzKSB7XG4gICAgICAgICAgICAvLyBBIGtpbmcgaW4gdGhlIGNvcm5lciBpcyBtYXRlZCBieSB0d28ga25pZ2h0cyBhbmQgYSBiaXNob3Agb3IgdGhyZWVcbiAgICAgICAgICAgIC8vIGtuaWdodHMgb3IgdGhlIGJpc2hvcCBwYWlyIGFuZCBhIGtuaWdodC9iaXNob3AuXG4gICAgICAgICAgICBpZiAoKGhvcmRlLmtuaWdodCA9PT0gMiAmJiBob3JkZS5iaXNob3AgPT09IDEpIHx8IGhvcmRlLmtuaWdodCA9PT0gMyB8fCBoYXNCaXNob3BQYWlyKGNvbG9yKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIFdoaXRlIGhhcyB0d28gc2FtZSBjb2xvciBiaXNob3BzIGFuZCBhIGtuaWdodC5cbiAgICAgICAgICAgICAgICAvLyBBIGtpbmcgb24gQTEgaXMgbWF0ZWQgYnkgYSBiaXNob3Agb24gQjIsIGEgYmlzaG9wIG9uIEMxIGFuZCBhXG4gICAgICAgICAgICAgICAgLy8ga25pZ2h0IG9uIEMzLCBhcyBsb25nIGFzIHRoZXJlIGlzIGFub3RoZXIgYmxhY2sgcGllY2UgdG8gd2FzdGVcbiAgICAgICAgICAgICAgICAvLyBhIHRlbXBvLlxuICAgICAgICAgICAgICAgIHJldHVybiBwaWVjZXNOdW0gPT09IDE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGlzVmFyaWFudEVuZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYm9hcmQud2hpdGUuaXNFbXB0eSgpIHx8IHRoaXMuYm9hcmQuYmxhY2suaXNFbXB0eSgpO1xuICAgIH1cbiAgICB2YXJpYW50T3V0Y29tZShfY3R4KSB7XG4gICAgICAgIGlmICh0aGlzLmJvYXJkLndoaXRlLmlzRW1wdHkoKSlcbiAgICAgICAgICAgIHJldHVybiB7IHdpbm5lcjogJ2JsYWNrJyB9O1xuICAgICAgICBpZiAodGhpcy5ib2FyZC5ibGFjay5pc0VtcHR5KCkpXG4gICAgICAgICAgICByZXR1cm4geyB3aW5uZXI6ICd3aGl0ZScgfTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbn1cbmV4cG9ydCBjb25zdCBkZWZhdWx0UG9zaXRpb24gPSAocnVsZXMpID0+IHtcbiAgICBzd2l0Y2ggKHJ1bGVzKSB7XG4gICAgICAgIGNhc2UgJ2NoZXNzJzpcbiAgICAgICAgICAgIHJldHVybiBDaGVzcy5kZWZhdWx0KCk7XG4gICAgICAgIGNhc2UgJ2FudGljaGVzcyc6XG4gICAgICAgICAgICByZXR1cm4gQW50aWNoZXNzLmRlZmF1bHQoKTtcbiAgICAgICAgY2FzZSAnYXRvbWljJzpcbiAgICAgICAgICAgIHJldHVybiBBdG9taWMuZGVmYXVsdCgpO1xuICAgICAgICBjYXNlICdob3JkZSc6XG4gICAgICAgICAgICByZXR1cm4gSG9yZGUuZGVmYXVsdCgpO1xuICAgICAgICBjYXNlICdyYWNpbmdraW5ncyc6XG4gICAgICAgICAgICByZXR1cm4gUmFjaW5nS2luZ3MuZGVmYXVsdCgpO1xuICAgICAgICBjYXNlICdraW5nb2Z0aGVoaWxsJzpcbiAgICAgICAgICAgIHJldHVybiBLaW5nT2ZUaGVIaWxsLmRlZmF1bHQoKTtcbiAgICAgICAgY2FzZSAnM2NoZWNrJzpcbiAgICAgICAgICAgIHJldHVybiBUaHJlZUNoZWNrLmRlZmF1bHQoKTtcbiAgICAgICAgY2FzZSAnY3Jhenlob3VzZSc6XG4gICAgICAgICAgICByZXR1cm4gQ3Jhenlob3VzZS5kZWZhdWx0KCk7XG4gICAgfVxufTtcbmV4cG9ydCBjb25zdCBzZXR1cFBvc2l0aW9uID0gKHJ1bGVzLCBzZXR1cCkgPT4ge1xuICAgIHN3aXRjaCAocnVsZXMpIHtcbiAgICAgICAgY2FzZSAnY2hlc3MnOlxuICAgICAgICAgICAgcmV0dXJuIENoZXNzLmZyb21TZXR1cChzZXR1cCk7XG4gICAgICAgIGNhc2UgJ2FudGljaGVzcyc6XG4gICAgICAgICAgICByZXR1cm4gQW50aWNoZXNzLmZyb21TZXR1cChzZXR1cCk7XG4gICAgICAgIGNhc2UgJ2F0b21pYyc6XG4gICAgICAgICAgICByZXR1cm4gQXRvbWljLmZyb21TZXR1cChzZXR1cCk7XG4gICAgICAgIGNhc2UgJ2hvcmRlJzpcbiAgICAgICAgICAgIHJldHVybiBIb3JkZS5mcm9tU2V0dXAoc2V0dXApO1xuICAgICAgICBjYXNlICdyYWNpbmdraW5ncyc6XG4gICAgICAgICAgICByZXR1cm4gUmFjaW5nS2luZ3MuZnJvbVNldHVwKHNldHVwKTtcbiAgICAgICAgY2FzZSAna2luZ29mdGhlaGlsbCc6XG4gICAgICAgICAgICByZXR1cm4gS2luZ09mVGhlSGlsbC5mcm9tU2V0dXAoc2V0dXApO1xuICAgICAgICBjYXNlICczY2hlY2snOlxuICAgICAgICAgICAgcmV0dXJuIFRocmVlQ2hlY2suZnJvbVNldHVwKHNldHVwKTtcbiAgICAgICAgY2FzZSAnY3Jhenlob3VzZSc6XG4gICAgICAgICAgICByZXR1cm4gQ3Jhenlob3VzZS5mcm9tU2V0dXAoc2V0dXApO1xuICAgIH1cbn07XG5leHBvcnQgY29uc3QgaXNTdGFuZGFyZE1hdGVyaWFsID0gKHBvcykgPT4ge1xuICAgIHZhciBfYSwgX2IsIF9jLCBfZCwgX2U7XG4gICAgc3dpdGNoIChwb3MucnVsZXMpIHtcbiAgICAgICAgY2FzZSAnY2hlc3MnOlxuICAgICAgICBjYXNlICdhbnRpY2hlc3MnOlxuICAgICAgICBjYXNlICdhdG9taWMnOlxuICAgICAgICBjYXNlICdraW5nb2Z0aGVoaWxsJzpcbiAgICAgICAgY2FzZSAnM2NoZWNrJzpcbiAgICAgICAgICAgIHJldHVybiBDT0xPUlMuZXZlcnkoY29sb3IgPT4gaXNTdGFuZGFyZE1hdGVyaWFsU2lkZShwb3MuYm9hcmQsIGNvbG9yKSk7XG4gICAgICAgIGNhc2UgJ2NyYXp5aG91c2UnOiB7XG4gICAgICAgICAgICBjb25zdCBwcm9tb3RlZCA9IHBvcy5ib2FyZC5wcm9tb3RlZDtcbiAgICAgICAgICAgIHJldHVybiAocHJvbW90ZWQuc2l6ZSgpICsgcG9zLmJvYXJkLnBhd24uc2l6ZSgpICsgKCgoX2EgPSBwb3MucG9ja2V0cykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmNvdW50KCdwYXduJykpIHx8IDApIDw9IDE2XG4gICAgICAgICAgICAgICAgJiYgcG9zLmJvYXJkLmtuaWdodC5kaWZmKHByb21vdGVkKS5zaXplKCkgKyAoKChfYiA9IHBvcy5wb2NrZXRzKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuY291bnQoJ2tuaWdodCcpKSB8fCAwKSA8PSA0XG4gICAgICAgICAgICAgICAgJiYgcG9zLmJvYXJkLmJpc2hvcC5kaWZmKHByb21vdGVkKS5zaXplKCkgKyAoKChfYyA9IHBvcy5wb2NrZXRzKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MuY291bnQoJ2Jpc2hvcCcpKSB8fCAwKSA8PSA0XG4gICAgICAgICAgICAgICAgJiYgcG9zLmJvYXJkLnJvb2suZGlmZihwcm9tb3RlZCkuc2l6ZSgpICsgKCgoX2QgPSBwb3MucG9ja2V0cykgPT09IG51bGwgfHwgX2QgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9kLmNvdW50KCdyb29rJykpIHx8IDApIDw9IDRcbiAgICAgICAgICAgICAgICAmJiBwb3MuYm9hcmQucXVlZW4uZGlmZihwcm9tb3RlZCkuc2l6ZSgpICsgKCgoX2UgPSBwb3MucG9ja2V0cykgPT09IG51bGwgfHwgX2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9lLmNvdW50KCdxdWVlbicpKSB8fCAwKSA8PSAyKTtcbiAgICAgICAgfVxuICAgICAgICBjYXNlICdob3JkZSc6XG4gICAgICAgICAgICByZXR1cm4gQ09MT1JTLmV2ZXJ5KGNvbG9yID0+IHBvcy5ib2FyZC5waWVjZXMoY29sb3IsICdraW5nJykubm9uRW1wdHkoKVxuICAgICAgICAgICAgICAgID8gaXNTdGFuZGFyZE1hdGVyaWFsU2lkZShwb3MuYm9hcmQsIGNvbG9yKVxuICAgICAgICAgICAgICAgIDogcG9zLmJvYXJkW2NvbG9yXS5zaXplKCkgPD0gMzYpO1xuICAgICAgICBjYXNlICdyYWNpbmdraW5ncyc6XG4gICAgICAgICAgICByZXR1cm4gQ09MT1JTLmV2ZXJ5KGNvbG9yID0+IHBvcy5ib2FyZC5waWVjZXMoY29sb3IsICdrbmlnaHQnKS5zaXplKCkgPD0gMlxuICAgICAgICAgICAgICAgICYmIHBvcy5ib2FyZC5waWVjZXMoY29sb3IsICdiaXNob3AnKS5zaXplKCkgPD0gMlxuICAgICAgICAgICAgICAgICYmIHBvcy5ib2FyZC5waWVjZXMoY29sb3IsICdyb29rJykuc2l6ZSgpIDw9IDJcbiAgICAgICAgICAgICAgICAmJiBwb3MuYm9hcmQucGllY2VzKGNvbG9yLCAncXVlZW4nKS5zaXplKCkgPD0gMSk7XG4gICAgfVxufTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXZhcmlhbnQuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/chessops/dist/esm/variant.js\n");

/***/ })

};
;